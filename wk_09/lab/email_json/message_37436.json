{"category": "ham", "to_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "from_address": "ronggui <ronggui.huang@gmail.com>", "subject": "Re: [R] Question about \"evalq\"", "body": "That's great. I got it. Million thanks.\n\nOn 5/28/07, Gabor Grothendieck  wrote:\n> On 5/27/07, ronggui  wrote:\n> > Hi,Gabor Grothendieck, Thanks very much.\n> >\n> > On 5/27/07, Gabor Grothendieck  wrote:\n> > > evalq looks like this:\n> > >\n> > >    > evalq\n> > >    function (expr, envir, enclos)\n> > >    eval.parent(substitute(eval(quote(expr), envir, enclos)))\n> > >    \n> > >\n> > > so it seems the difference is that\n> > >\n> > > - eval(quote(), envir, enclos) evaluates envir and enclos\n> > >   in the current frame but\n> > > - evalq evaluates them in the parent.frame.\n> > >\n> > > This may be easier to see in the following example:\n> >\n> > Yeah, This example make the question easier to understand.\n> >\n> > >    x <- \"G\"\n> > >    f1 <- function() eval(quote(x), parent.frame())\n> > >    f2 <- function() evalq(x, parent.frame())\n> > >    f11 <- function() {\n> > >         x <- \"a\"\n> > >         f1()\n> > >    }\n> > >    f22 <- function() {\n> > >         x <- \"b\"\n> > >         f2()\n> > >    }\n> > >    f11() # a\n> > >    f22() # G\n> > >\n> > > To avoid this problem pass a variable whose value is\n> > > to be enclos= rather than an expression to compute it:\n> >\n> > --This is a good idea.\n> > --If \"evalq evaluates them in the parent.frame\", I expected that if I\n> > change parent.frame(2) to parent.frame(1), I will get the answer.But I\n> > can not actually. So what's wrong with my understanding?\n> >\n> >    f1 <- function(x,digits=5) lapply(x, f2)\n> >    f2 <- function(x) {\n> >       evalq(print(digits), list(x=x), parent.frame(1))\n> >    }\n> >    f1(list(x1=1)) ##Error in print(digits) : object \"digits\" not found\n>\n>\n> Good point.  Insert a browser statement where the parent.frame\n> call was and when it stops do a traceback.  That will show you\n> what the call stack looks like at that point in time.\n>\n>\n> > f1 <- function(x,digits=5) lapply(x, f2)\n> > f2 <- function(x) evalq(print(digits), list(x=x), { browser() } )\n> > f1(list(x1=1)) ##Error in print(digits) : object \"digits\" not found\n> Called from: eval(quote(print(digits)), list(x = x), {\n>     browser()\n> })\n> Browse[1]> traceback()\n> 10: print(digits)\n> 9: eval(expr, envir, enclos)\n> 8: eval(quote(print(digits)), list(x = x), browser())\n> 7: eval(expr, envir, enclos)\n> 6: eval(expr, p)\n> 5: eval.parent(substitute(eval(quote(expr), envir, enclos)))\n> 4: evalq(print(digits), list(x = x), browser())\n> 3: FUN(X[[1L]], ...)\n> 2: lapply(x, f2)\n> 1: f1(list(x1 = 1))\n> Browse[1]>\n>\n\n\n-- \nRonggui Huang\nDepartment of Sociology\nFudan University, Shanghai, China\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}