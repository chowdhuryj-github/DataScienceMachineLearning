{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 247: make catdb take a dbname instead of an id in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 247\nrevision-id: tridge@samba.org-20070504032530-ni45j80aucjdgxfe\nparent: tridge@samba.org-20070504021839-0d8138o2tzki943u\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Fri 2007-05-04 13:25:30 +1000\nmessage:\n  make catdb take a dbname instead of an id\nmodified:\n  tools/ctdb_control.c           ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1\n=== modified file 'tools/ctdb_control.c'\n--- a/tools/ctdb_control.c\t2007-05-04 02:18:39 +0000\n+++ b/tools/ctdb_control.c\t2007-05-04 03:25:30 +0000\n@@ -46,7 +46,7 @@\n \t\t\"  getdbmap                      lists databases on a node\\n\"\n \t\t\"  getnodemap                    lists nodes known to a ctdb daemon\\n\"\n \t\t\"  createdb              create a database\\n\"\n-\t\t\"  catdb                        lists all keys/data in a db\\n\"\n+\t\t\"  catdb                      lists all keys/data in a db\\n\"\n \t\t\"  cpdb         lists all keys in a remote tdb\\n\"\n \t\t\"  setdmaster     sets new dmaster for all records in the database\\n\"\n \t\t\"  cleardb                 deletes all records in a db\\n\"\n@@ -512,7 +512,7 @@\n  */\n static int control_catdb(struct ctdb_context *ctdb, int argc, const char **argv)\n {\n-\tuint32_t dbid;\n+\tconst char *db_name;\n \tstruct ctdb_db_context *ctdb_db;\n \tint ret;\n \n@@ -520,11 +520,10 @@\n \t\tusage();\n \t}\n \n-\tdbid = strtoul(argv[0], NULL, 0);\n-\t\n-\tctdb_db = find_ctdb_db(ctdb, dbid);\n+\tdb_name = argv[0];\n+\tctdb_db = ctdb_attach(ctdb, db_name);\n \tif (ctdb_db == NULL) {\n-\t\tprintf(\"Unable to find database 0x%x\\n\", dbid);\n+\t\tDEBUG(0,(\"Unable to attach to database '%s'\\n\", db_name));\n \t\treturn -1;\n \t}\n \n@@ -534,6 +533,8 @@\n \t\treturn -1;\n \t}\n \n+\ttalloc_free(ctdb_db);\n+\n \tprintf(\"Dumped %d records\\n\", ret);\n \treturn 0;\n }\n\n"}