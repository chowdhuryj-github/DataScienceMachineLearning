{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r22730 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_26/source/nsswitch", "body": "Author: jerry\nDate: 2007-05-06 22:22:47 +0000 (Sun, 06 May 2007)\nNew Revision: 22730\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22730\n\nLog:\nFix password changes via pam_winbindd when using \"winbind normalize names\"\nand the username has been munged.  Make sure to munge it back before\nperforming the change_password() request.\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\t2007-05-06 22:18:44 UTC (rev 22729)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\t2007-05-06 22:22:47 UTC (rev 22730)\n@@ -1976,6 +1976,8 @@\n \n \t/* Setup crap */\n \n+\tws_name_return( state->request.data.auth.user, WB_REPLACE_CHAR );\n+\n \tif (!canonicalize_username(state->request.data.chauthtok.user, domain, user)) {\n \t\tset_auth_errors(&state->response, NT_STATUS_NO_SUCH_USER);\n \t\tDEBUG(5, (\"winbindd_pam_chauthtok: canonicalize_username %s failed with %s\"\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\t2007-05-06 22:18:44 UTC (rev 22729)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\t2007-05-06 22:22:47 UTC (rev 22730)\n@@ -1976,6 +1976,8 @@\n \n \t/* Setup crap */\n \n+\tws_name_return( state->request.data.auth.user, WB_REPLACE_CHAR );\n+\n \tif (!canonicalize_username(state->request.data.chauthtok.user, domain, user)) {\n \t\tset_auth_errors(&state->response, NT_STATUS_NO_SUCH_USER);\n \t\tDEBUG(5, (\"winbindd_pam_chauthtok: canonicalize_username %s failed with %s\"\n\n"}