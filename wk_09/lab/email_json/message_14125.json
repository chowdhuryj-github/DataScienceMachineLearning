{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r22498 - in\n\tbranches/SAMBA_4_0/source/script/tests: .", "body": "Author: abartlet\nDate: 2007-04-24 07:57:44 +0000 (Tue, 24 Apr 2007)\nNew Revision: 22498\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22498\n\nLog:\nThe initial LDIF import into Fedora DS didn't work, so just push this\nonto the end of dse.ldif.\n\nThis make Fedora DS work with multiple naming contexts.\n\nAndrew Bartlett\n\n\nModified:\n   branches/SAMBA_4_0/source/script/tests/Samba4.pm\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/script/tests/Samba4.pm\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/Samba4.pm\t2007-04-24 05:57:56 UTC (rev 22497)\n+++ branches/SAMBA_4_0/source/script/tests/Samba4.pm\t2007-04-24 07:57:44 UTC (rev 22498)\n@@ -201,7 +201,7 @@\n RootDN= cn=Manager,$basedn\n RootDNPwd= $password\n ServerIdentifier= samba4\n-InstallLdifFile=$fedora_ds_initial_ldif\n+#InstallLdifFile=$fedora_ds_initial_ldif\n \n inst_dir= $fedora_ds_dir\n config_dir= $fedora_ds_dir\n@@ -220,38 +220,32 @@\n \tclose(CONF);\n \n \topen(LDIF, \">$fedora_ds_initial_ldif\");\n-\tprint LDIF \"\n-# These entries need to be added to get the container for the \n-# provision to be aimed at.\n \n-dn: cn=\\\"$basedn\\\",cn=mapping tree,cn=config\n-objectclass: top\n-objectclass: extensibleObject\n-objectclass: nsMappingTree\n-nsslapd-state: backend\n-nsslapd-backend: userData\n-cn: $basedn\n+my $dir = getcwd();\n+chdir \"$ENV{FEDORA_DS_PREFIX}/bin\" || die;\n+\tif (system(\"perl $ENV{FEDORA_DS_PREFIX}/bin/ds_newinst.pl $fedora_ds_inf >&2\") != 0) {\n+            chdir $dir;\n+            die(\"perl $ENV{FEDORA_DS_PREFIX}/bin/ds_newinst.pl $fedora_ds_inf FAILED: $?\");\n+        }\n+        chdir $dir || die;\n+\tforeach(<$fedora_ds_dir/schema/*>) {\n+\t\tunlink unless (/00core.*/);\n+\t}\n \n-dn: cn=userData,cn=ldbm database,cn=plugins,cn=config\n-objectclass: extensibleObject\n-objectclass: nsBackendInstance\n-nsslapd-suffix: $basedn\n-cn=userData\n-\n-dn: cn=\\\"cn=Configuration,$basedn\\\",cn=mapping tree,cn=config\n+\topen(LDIF, \">>$fedora_ds_dir/dse.ldif\");\n+\tprint LDIF \"dn: cn=\\\"cn=Configuration,$basedn\\\",cn=mapping tree,cn=config\n objectclass: top\n objectclass: extensibleObject\n objectclass: nsMappingTree\n nsslapd-state: backend\n nsslapd-backend: configData\n-nsslapd-parent-suffix: $basedn\n cn: cn=Configuration,$basedn\n \n dn: cn=configData,cn=ldbm database,cn=plugins,cn=config\n objectclass: extensibleObject\n objectclass: nsBackendInstance\n nsslapd-suffix: cn=Configuration,$basedn\n-cn=configData\n+cn: configData\n \n dn: cn=\\\"cn=Schema,cn=Configuration,$basedn\\\",cn=mapping tree,cn=config\n objectclass: top\n@@ -259,30 +253,15 @@\n objectclass: nsMappingTree\n nsslapd-state: backend\n nsslapd-backend: schemaData\n-nsslapd-parent-suffix: cn=Configuration,$basedn\n cn: cn=Schema,cn=Configuration,$basedn\n \n dn: cn=schemaData,cn=ldbm database,cn=plugins,cn=config\n objectclass: extensibleObject\n objectclass: nsBackendInstance\n nsslapd-suffix: cn=Schema,cn=Configuration,$basedn\n-cn=schemaData\n-\";\n-\tclose(LDIF);\n+cn: schemaData\n \n-my $dir = getcwd();\n-chdir \"$ENV{FEDORA_DS_PREFIX}/bin\" || die;\n-\tif (system(\"perl $ENV{FEDORA_DS_PREFIX}/bin/ds_newinst.pl $fedora_ds_inf >&2\") != 0) {\n-            chdir $dir;\n-            die(\"perl $ENV{FEDORA_DS_PREFIX}/bin/ds_newinst.pl $fedora_ds_inf FAILED: $?\");\n-        }\n-        chdir $dir || die;\n-\tforeach(<$fedora_ds_dir/schema/*>) {\n-\t\tunlink unless (/00core.*/);\n-\t}\n-\n-\topen(LDIF, \">>$fedora_ds_dir/dse.ldif\");\n-\tprint LDIF \"dn: cn=bitwise,cn=plugins,cn=config\n+dn: cn=bitwise,cn=plugins,cn=config\n objectClass: top\n objectClass: nsSlapdPlugin\n objectClass: extensibleObject\n\n"}