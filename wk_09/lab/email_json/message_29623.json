{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22865 - in branches/SAMBA_4_0/source/ntvfs: .", "body": "Author: metze\nDate: 2007-05-14 17:58:28 +0000 (Mon, 14 May 2007)\nNew Revision: 22865\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22865\n\nLog:\nhandle pending locks in smb2\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/ntvfs/ntvfs_generic.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/ntvfs/ntvfs_generic.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/ntvfs_generic.c\t2007-05-14 17:56:00 UTC (rev 22864)\n+++ branches/SAMBA_4_0/source/ntvfs/ntvfs_generic.c\t2007-05-14 17:58:28 UTC (rev 22865)\n@@ -999,7 +999,11 @@\n \t\t} else {\n \t\t\tlck2->generic.in.mode = LOCKING_ANDX_SHARED_LOCK;\n \t\t}\n-\t\tlck2->generic.in.timeout = 0;\n+\t\tif (lck->smb2.in.flags & SMB2_LOCK_FLAG_NO_PENDING) {\n+\t\t\tlck2->generic.in.timeout = 0;\n+\t\t} else {\n+\t\t\tlck2->generic.in.timeout = UINT32_MAX;\n+\t\t}\n \t\tif (lck->smb2.in.flags & SMB2_LOCK_FLAG_UNLOCK) {\n \t\t\tlck2->generic.in.ulock_cnt = 1;\n \t\t\tlck2->generic.in.lock_cnt = 0;\n\n"}