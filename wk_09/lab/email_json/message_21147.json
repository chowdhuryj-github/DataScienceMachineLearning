{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 225: added attach command in ctdb_control in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 225\nrevision-id: tridge@samba.org-20070430135406-5f2krpfqjekpa2n3\nparent: tridge@samba.org-20070430133140-79ydyjc7o4pq21k9\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Mon 2007-04-30 15:54:06 +0200\nmessage:\n  added attach command in ctdb_control\nrenamed:\n  direct/ctdbd.sh => tests/ctdbd.sh ctdbd.sh-20070411085038-phusiewluwzyqjpc-2\nmodified:\n  tests/run_tests.sh             run_tests.sh-20070428085745-ec2w6vybjf07vtvg-1\n  tools/ctdb_control.c           ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1\n  tests/ctdbd.sh                 ctdbd.sh-20070411085038-phusiewluwzyqjpc-2\n=== renamed file 'direct/ctdbd.sh' => 'tests/ctdbd.sh'\n--- a/direct/ctdbd.sh\t2007-04-29 20:42:23 +0000\n+++ b/tests/ctdbd.sh\t2007-04-30 13:54:06 +0000\n@@ -23,8 +23,12 @@\n \n echo \"Testing map calls\"\n bin/ctdb_control getvnnmap 0 || exit 1\n+\n+echo \"Attaching to some databases\"\n+bin/ctdb_control attach test1.tdb || exit 1\n+bin/ctdb_control attach test2.tdb || exit 1\n+\n+echo \"Testing getdbmap\"\n bin/ctdb_control getdbmap 0 || exit 1\n \n killall -q ctdbd\n-\n-\n\n=== modified file 'tests/run_tests.sh'\n--- a/tests/run_tests.sh\t2007-04-29 20:42:23 +0000\n+++ b/tests/run_tests.sh\t2007-04-30 13:54:06 +0000\n@@ -3,7 +3,7 @@\n tests/fetch.sh 4 || exit 1\n tests/bench.sh 4 || exit 1\n tests/test.sh || exit 1\n-direct/ctdbd.sh || exit 1\n+tests/ctdbd.sh || exit 1\n \n echo \"All OK\"\n exit 0\n\n=== modified file 'tools/ctdb_control.c'\n--- a/tools/ctdb_control.c\t2007-04-28 17:13:36 +0000\n+++ b/tools/ctdb_control.c\t2007-04-30 13:54:06 +0000\n@@ -436,6 +436,28 @@\n \treturn 0;\n }\n \n+\n+/*\n+  attach to a database\n+ */\n+static int control_attach(struct ctdb_context *ctdb, int argc, const char **argv)\n+{\n+\tconst char *db_name;\n+\tstruct ctdb_db_context *ctdb_db;\n+\tif (argc < 1) {\n+\t\tusage();\n+\t}\n+\tdb_name = argv[0];\n+\n+\tctdb_db = ctdb_attach(ctdb, db_name);\n+\tif (ctdb_db == NULL) {\n+\t\tDEBUG(0,(\"Unable to attach to database '%s'\\n\", db_name));\n+\t\treturn -1;\n+\t}\n+\n+\treturn 0;\n+}\n+\n /*\n   main program\n */\n@@ -508,6 +530,8 @@\n \t\tret = control_debug(ctdb, extra_argc-1, extra_argv+1);\n \t} else if (strcmp(control, \"debuglevel\") == 0) {\n \t\tret = control_debuglevel(ctdb, extra_argc-1, extra_argv+1);\n+\t} else if (strcmp(control, \"attach\") == 0) {\n+\t\tret = control_attach(ctdb, extra_argc-1, extra_argv+1);\n \t} else {\n \t\tprintf(\"Unknown control '%s'\\n\", control);\n \t\texit(1);\n\n"}