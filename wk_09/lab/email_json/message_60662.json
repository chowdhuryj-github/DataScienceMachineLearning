{"category": "ham", "to_address": "Gerald (Jerry) Carter <jerry@samba.org>", "from_address": "James Peach <jpeach@samba.org>", "subject": "Re: [patch] hide libsmbclient's private symbols", "body": "On Jul 2, 2007, at 2:01 PM, Gerald (Jerry) Carter wrote:\n\n> -----BEGIN PGP SIGNED MESSAGE-----\n> Hash: SHA1\n>\n> James,\n>\n>>> The rules might look like this for a gcc-based toolchain. The only\n>>> problem remaining is how to express the DSO version number in a  \n>>> generic\n>>> way.\n>>\n>>> DSO_EXPORTS = -Wl,--version-script,exports/`basename $@ |\\\n>>> \tsed -e/@SHLIBEXT@/syms/`\n>>> SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS) \\\n>>> \t@SONAMEFLAG@`basename $@`.$(XXXXXX_MAJOR)\n>>\n>>> bin/libsmbclient.@SHLIBEXT@: $(BINARY_PREREQS) $(LIBSMBCLIENT_OBJ)\n>>>   @echo Linking libsmbclient shared library $@\n>>>   @$(SHLD_DSO) $(LIBSMBCLIENT_OBJ) $(LIBS) $(KRB5LIBS) \\\n>>>    $(LDAP_LIBS) $(NSCD_LIBS)\n>>\n>> I poked around and the only thing I could think of was\n>> was to store the library versions outside of the Makefile\n>> and read them from the file. For example,\n>>\n>>  DSO_EXPORTS = -Wl,--version-script,exports/`basename $@ |\\\n>> \tsed -e/@SHLIBEXT@/syms/`\n>>  SONAME_VER = `grep $@ $(srcdir)/library-versions | cut -d: -t2`\n>>  SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS) \\\n>> \t@SONAMEFLAG@`basename $@`.$(SONAME_VER)\n>\n> I just realized why this won't work.  On some platforms\n> the @SONAMEFLAG@ just becomes '#' and comments out the remainder\n> of the line.\n\nWhat platforms does this happen on? SHLD_MODULE uses exactly the same  \ntrick and appears to work OK in the build farm.\n\n>\n>\n> SO this is good:\n>\n>  SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS)\n>\n> but you have to add the @SONAMEFLAG@ last in the list\n> I still like moving the major and minor numbers of the\n> Makefile thought.  What do you think?\n>\n>\n>\n> cheers, jerry\n> -----BEGIN PGP SIGNATURE-----\n> Version: GnuPG v1.4.6 (GNU/Linux)\n> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org\n>\n> iD8DBQFGiWfCIR7qMdg1EfYRAv/0AKCMajZ8dRwrjcK94PMiUQfrdk3eagCeNr6R\n> n1zg65KSc9Fa5mXEyf1AyKQ=\n> =ucqG\n> -----END PGP SIGNATURE-----\n\n--\nJames Peach | jpeach@samba.org\n\n"}