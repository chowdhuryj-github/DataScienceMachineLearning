{"category": "ham", "to_address": "<beginners@perl.org>", "from_address": "\"Bob McConnell\" <rvm@CBORD.com>", "subject": "Having trouble porting an application to MS-Windows", "body": "Good morning,\n\nThe code listed below is part of a link level serial protocol that\ndoesn't port to Win32. A framed message with a checksum is sent and then\na single character response (ACK or NAK) is expected in return. On the\nWin32 platform, this form of select is only implemented for sockets, and\nalarm() is not implemented at all. How can I set up a sysread() with an\nadjustable timeout on a device in MS-Windows?\n\n$port = 'COM4' unless $port;\nsysopen( PORT, \"$port\", O_RDWR ) or die \"Can't sysopen $port: $!\";\nbinmode(PORT);\n\n\t# loop on NAK or timeout with two retries\n\t$done = 0;\n\t$tries = 0;\n\tdo {\n\t\tsyswrite PORT, $_, length;\n\n\t\t$rin = $win = $ein = '';\n\t\tvec($rin, fileno(PORT), 1) = 1;\n\t\tvec($win, fileno(PORT), 1) = 1;\n\t\t$ein = $rin | $win;\n\t\t$timeout = 3.0;\n\n\t\t($nfound,$timeleft) = select($rout=$rin, $wout=$win,\n$eout=$ein, $timeout);\n\n\t\tif ($nfound > 0) {\n\t\t\t$inchar = sysread PORT, $line, 1, 0;\n\t\t\tif (ord ($line) == 21) {\n\t\t\t\tprint STDOUT \" NAK\";\n\t\t\t}\n\t\t\tif (ord ($line) == 6) {\n\t\t\t\tprint STDOUT \" ACK\";\n\t\t\t\t$done = 1;\n\t\t\t}\n        }\n        else {\n        \tprint STDOUT \" t/o\";\n        }\n\t} while ($done == 0 && ++$tries < 3);\n\tprint STDOUT \"\\n\";\n\tif ($done == 0) {\n\t\tnext LINE;\n\t}\n\n\nI have ActiveState Perl 5.8.0.806 or Cygwin with Perl 5.6.1 available.\nBoth versions are parts of SDK's which prevent me from upgrading. I\ntried to install Linux in a VM session, but I don't have a recent enough\nversion of VMWare to do so, and my manager has refused to allow me to\nupdate that one either. (He said something about being too near the end\nof the fiscal year.)\n\nNOTA BENE: I don't do objects. After 30 years of procedural code, they\ndon't make any sense to me, on several levels. I have looked at\nWin32-SerialPort-0.19 but can't make heads nor tails of it.\n\nThank you,\n\nBob McConnell\nPrincipal Communications Programmer\nThe CBORD Group, Inc.\n61 Brown Road\nIthaca NY, 14850\nPhone 607 257-2410\nFAX 607 257-1902\nEmail rvm@cbord.com\nWeb www.cbord.com\n\n-- \nTo unsubscribe, e-mail: beginners-unsubscribe@perl.org\nFor additional commands, e-mail: beginners-help@perl.org\nhttp://learn.perl.org/\n\n\n\n"}