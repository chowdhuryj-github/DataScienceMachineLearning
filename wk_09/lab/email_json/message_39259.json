{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23256 - in branches/SAMBA_3_0_26/source/libads: .", "body": "Author: jerry\nDate: 2007-05-30 23:06:48 +0000 (Wed, 30 May 2007)\nNew Revision: 23256\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23256\n\nLog:\nfix length and siglen checks in pac_io_pac_signature_data()\nModified:\n   branches/SAMBA_3_0_26/source/libads/authdata.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/libads/authdata.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libads/authdata.c\t2007-05-30 22:57:46 UTC (rev 23255)\n+++ branches/SAMBA_3_0_26/source/libads/authdata.c\t2007-05-30 23:06:48 UTC (rev 23256)\n@@ -451,10 +451,11 @@\n \t\t\t\t      PAC_SIGNATURE_DATA *data, uint32 length,\n \t\t\t\t      prs_struct *ps, int depth)\n {\n-\tuint32 siglen = length - sizeof(uint32);\n+\tuint32 siglen = 0;\n+\n \tprs_debug(ps, depth, desc, \"pac_io_pac_signature_data\");\n \tdepth++;\n-\t\n+\n \tif (data == NULL)\n \t\treturn False;\n \n@@ -463,6 +464,9 @@\n \tif (!prs_uint32(\"type\", ps, depth, &data->type))\n \t\treturn False;\n \n+\tif ( length > sizeof(uint32) )\n+\t\tsiglen = length - sizeof(uint32);\t\n+\n \tif (UNMARSHALLING(ps) && length) {\n \t\tif (siglen) {\n \t\t\tdata->signature.buffer = PRS_ALLOC_MEM(ps, uint8, siglen);\n\n"}