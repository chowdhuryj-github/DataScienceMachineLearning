{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r22847 - in branches/SAMBA_3_0/source/nsswitch: .", "body": "Author: obnox\nDate: 2007-05-14 13:31:42 +0000 (Mon, 14 May 2007)\nNew Revision: 22847\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22847\n\nLog:\nThe new validate_panic function calls exit (instead of setting\na global error flag an returning), so cleanups and returns \nsubsequent to calls of smb_panic_fn have become unnecessary.\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\t2007-05-14 13:01:28 UTC (rev 22846)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\t2007-05-14 13:31:42 UTC (rev 22847)\n@@ -224,7 +224,6 @@\n \n \tif (!centry_check_bytes(centry, 4)) {\n \t\tsmb_panic_fn(\"centry_uint32\");\n-\t\treturn (uint32)-1;\n \t}\n \tret = IVAL(centry->data, centry->ofs);\n \tcentry->ofs += 4;\n@@ -239,7 +238,6 @@\n \tuint16 ret;\n \tif (!centry_check_bytes(centry, 2)) {\n \t\tsmb_panic_fn(\"centry_uint16\");\n-\t\treturn (uint16)-1;\n \t}\n \tret = CVAL(centry->data, centry->ofs);\n \tcentry->ofs += 2;\n@@ -254,7 +252,6 @@\n \tuint8 ret;\n \tif (!centry_check_bytes(centry, 1)) {\n \t\tsmb_panic_fn(\"centry_uint8\");\n-\t\treturn (uint8)-1;\n \t}\n \tret = CVAL(centry->data, centry->ofs);\n \tcentry->ofs += 1;\n@@ -269,7 +266,6 @@\n \tNTTIME ret;\n \tif (!centry_check_bytes(centry, 8)) {\n \t\tsmb_panic_fn(\"centry_nttime\");\n-\t\treturn (NTTIME)-1;\n \t}\n \tret = IVAL(centry->data, centry->ofs);\n \tcentry->ofs += 4;\n@@ -303,13 +299,11 @@\n \n \tif (!centry_check_bytes(centry, (size_t)len)) {\n \t\tsmb_panic_fn(\"centry_string\");\n-\t\treturn NULL;\n \t}\n \n \tret = TALLOC_ARRAY(mem_ctx, char, len+1);\n \tif (!ret) {\n \t\tsmb_panic_fn(\"centry_string out of memory\\n\");\n-\t\treturn NULL;\n \t}\n \tmemcpy(ret,centry->data + centry->ofs, len);\n \tret[len] = 0;\n@@ -340,7 +334,6 @@\n \tret = TALLOC_ARRAY(mem_ctx, char, 16);\n \tif (!ret) {\n \t\tsmb_panic_fn(\"centry_hash out of memory\\n\");\n-\t\treturn NULL;\n \t}\n \tmemcpy(ret,centry->data + centry->ofs, 16);\n \tcentry->ofs += 16;\n@@ -1111,8 +1104,6 @@\n \t(*info) = TALLOC_ARRAY(mem_ctx, WINBIND_USERINFO, *num_entries);\n \tif (! (*info)) {\n \t\tsmb_panic_fn(\"query_user_list out of memory\");\n-\t\tcentry_free(centry);\n-\t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \tfor (i=0; i<(*num_entries); i++) {\n \t\t(*info)[i].acct_name = centry_string(centry, mem_ctx);\n@@ -1229,8 +1220,6 @@\n \t(*info) = TALLOC_ARRAY(mem_ctx, struct acct_info, *num_entries);\n \tif (! (*info)) {\n \t\tsmb_panic_fn(\"enum_dom_groups out of memory\");\n-\t\tcentry_free(centry);\n-\t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \tfor (i=0; i<(*num_entries); i++) {\n \t\tfstrcpy((*info)[i].acct_name, centry_string(centry, mem_ctx));\n@@ -1305,8 +1294,6 @@\n \t(*info) = TALLOC_ARRAY(mem_ctx, struct acct_info, *num_entries);\n \tif (! (*info)) {\n \t\tsmb_panic_fn(\"enum_dom_groups out of memory\");\n-\t\tcentry_free(centry);\n-\t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \tfor (i=0; i<(*num_entries); i++) {\n \t\tfstrcpy((*info)[i].acct_name, centry_string(centry, mem_ctx));\n@@ -1724,8 +1711,6 @@\n \t(*user_gids) = TALLOC_ARRAY(mem_ctx, DOM_SID, *num_groups);\n \tif (! (*user_gids)) {\n \t\tsmb_panic_fn(\"lookup_usergroups out of memory\");\n-\t\tcentry_free(centry);\n-\t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \tfor (i=0; i<(*num_groups); i++) {\n \t\tcentry_sid(centry, mem_ctx, &(*user_gids)[i]);\n@@ -1893,8 +1878,6 @@\n \n \tif (! (*sid_mem) || ! (*names) || ! (*name_types)) {\n \t\tsmb_panic_fn(\"lookup_groupmem out of memory\");\n-\t\tcentry_free(centry);\n-\t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \n \tfor (i=0; i<(*num_names); i++) {\n@@ -1990,8 +1973,6 @@\n  \n \t\tif (! (*dom_sids) || ! (*names) || ! (*alt_names)) {\n \t\t\tsmb_panic_fn(\"trusted_domains out of memory\");\n-\t\t\tcentry_free(centry);\n-\t\t\treturn NT_STATUS_NO_MEMORY;\n  \t\t}\n \t} else {\n \t\t(*names) = NULL;\n\n"}