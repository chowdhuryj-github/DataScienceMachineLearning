{"category": "ham", "to_address": "Gabor Grothendieck <ggrothendieck@gmail.com>", "from_address": "Duncan Murdoch <murdoch@stats.uwo.ca>", "subject": "Re: [R] R package development in windows", "body": "On 5/4/2007 11:31 AM, Gabor Grothendieck wrote:\n> On 5/4/07, Duncan Murdoch  wrote:\n>> On 5/4/2007 9:30 AM, Doran, Harold wrote:\n>> > OK, so I just want to go on record as noting that following the\n>> > instructions exactly (exactly, exactly, exactly, emphatically) on the\n>> > web given by Duncan, Gabor, and Tony at the page below, and following\n>> > the instructions in Writing R Extensions results in a successful Windows\n>> > build of a package.\n>> >\n>> > Should this email turn up in someones search using RSiteSearch() or\n>> > elsewhere, my best advice is to ignore all other documents on the web\n>> > attempting to explain this. I personally went through 4 or 5 different\n>> > personal web sites looking for a straightforward guide. After a week or\n>> > so of late night reading and experimentation, all of those documents led\n>> > me to a path of failure. After reading the info on the link below, and\n>> > then referring back to Writing R Extensions, I was able to build the\n>> > package in only a few hours of time. It took significantly less time to\n>> > read the manual and information on the link below than it did to google\n>> > help pages on the topic, read those, and end up even more confused.\n>> >\n>> > I'm not in the best position to offer specific recommendations on how to\n>> > improve this process. The reality is that after collecting all programs\n>> > required, making the required changes to the path, the Rcmd commands for\n>> > the build are very simple. So, the biggest task is the collection of\n>> > essential programs and modification to the path.\n>> >\n>> > Obviously, Rtools is designed to move forward in this direction. Its\n>> > current phase still doesn't automate that collection and modification\n>> > process entirely, and the reasons are given on Duncan's web site.\n>> > However, I suppose the only good recommendation I can make at this point\n>> > is to still move forward with Rtools such that it installs all required\n>> > programs and automatically updates the path accordingly. Maybe this can\n>> > even become part of the base installation. Since the open source nature\n>> > of R encourages development, the tools needed for development should be\n>> > readily available.\n>> >\n>> > I am certain this recommendation is not novel, and Duncan et al have\n>> > already thought of this. But, it's my attempt to do a little better than\n>> > complain.\n>> >\n>> > The only other piece of advice I can offer is to keep this stable. That\n>> > is, when R 2.5.1 et seq are released, I beg of the developers not to\n>> > require a new collection of tools or a different set up than what is\n>> > already required. It is a bit of work, and if changes are required at\n>> > each R release, this may be too disheartening.\n>>\n>> Thanks for your comments and suggestions.  I've thought of a few changes\n>> we can make; let me know if you see any problems with these:\n>>\n>> 1.  I will simplify the Rtools site.  Rather than duplicating the\n>> information from the R-admin manual, I will just include the\n>> #The-Windows-toolset link as given below, together with post-release\n>> updates.  This should help with the \"too many places to look\" problem.\n>> Now, if other sites did the same...\n>>\n>> 2.  You suggest that Rtools.exe make automatic changes to the user's\n>> PATH.  I'm quite reluctant to do that, because what R needs may conflict\n>> with what a user needs for other work.  However, something that I think\n>> would be fairly easy to do would be to install a shortcut to start a\n>> CMD.EXE or Cygwin shell with the path set appropriately.  I'll look into\n>> that.\n> \n> \n> I agree that setting the path permanently would be bad but\n> the shortcut could check to see if they are in the path already\n> and if not it could find them in the registry and just change the\n> session path rather than permanently set the path.\n\nDo you have a batch file already to do this?  If I were writing it, I'd \ndo something simpler:  I'd just hard code the paths, and expect the user \nto edit the file if I didn't get them right.\n\n>> 3.  You also suggested adding more tools to Rtools.exe.  I think the key\n>> tool to add would be Perl; it's the only essential tool that's currently\n>> missing.  Unfortunately, there are licensing issues with that for\n>> ActiveState Perl, the version we currently recommend.  I'll  try to get\n>> specific permission from ActiveState to include a copy.\n>>\n> \n> The best, of course, would be to get rid of Perl altogether.\n\nI agree, but there is a lot of Perl code in the R scripts now, and I \nthink the maintainers of those scripts are comfortable with it.  I think \nR code for string handling is even harder to read than Perl, so it's not \nlikely to change.\n\n>> 4.  We could include the tools in the base installation of R; that's\n>> what the MacOSX release has done.  However, that would at least double\n>> the size of the download, even with just the minimal additions, and\n>> under the GPL would require CRAN and its mirrors to host source for most\n>> of the tools.  What I plan to do instead is to put a link to the Rtools\n>> page on the CRAN page for the Windows R binary.\n> \n> Some other possiblities are:\n> - use a different toolset.  I seem to remember that there were a few very\n> compact toolsets for use with minimal systems.  One basically put all\n> the UNIX tools in one executable and you could just rename it successively\n> to each tool you wanted.  Another one used lua for implementation which\n> is embeddable and very small.\n\nThis is not really relevant.  The Unix command line tools are fine: \nRtools.exe installs them, and they just work, if you get the PATH right. \n  The current \"problem children\" are Perl, LaTeX, and HHW. (Also Inno \nSetup, but it's not for package builders).\n\n> - rewrite as many tools as possible in R.  The full power of the tool might\n> not be needed making it easier.  If 80% of the tools could be easily eliminated\n> it might not be a problem to include the remaining 20%.  Or if 20% of the\n> tools take up 80% of the space this might be sufficient.  Of course getting\n> them all in R would be nice.\n\nRewriting the Perl code as R scripts is imaginable, but rewriting LaTeX \nand HHW in R is not.\n\n>> 5.  We could modify the MkRules file that we distribute with R to assume\n>> the minimal toolset, i.e. no LaTeX or CHM help.  This would mean you'd\n>> get fewer \"not found\" messages from a basic install, but might be a\n>> little inconvenient for people who have the tools.  Perhaps we can\n>> detect whether those tools have been installed and act accordingly.\n>>\n> \n> Not sure I understand this but could this be decided upon automatically\n> by checking the user's registry for the existence of the tools?\n\nIt might be possible to automate the tests by looking at the PATH. \nNeither LaTeX nor HHW is necessarily going to show up at a predictable \nlocation in the registry.\n\nDuncan Murdoch\n\n>> 6.  You suggested avoiding changes to the toolset.  This is hard,\n>> because the updates often fix bugs in older versions.  Bugs in the tools\n>> lead to bugs in R.  So I think we don't have much choice but to continue\n>> to make necessary updates.\n>>\n>> Duncan Murdoch\n>>\n>>\n>> >\n>> > Harold\n>> >\n>> >> -----Original Message-----\n>> >> From: Duncan Murdoch [mailto:murdoch@stats.uwo.ca]\n>> >> Sent: Thursday, May 03, 2007 3:51 PM\n>> >> To: Doran, Harold\n>> >> Cc: Gabor Grothendieck; r-help@stat.math.ethz.ch\n>> >> Subject: [SPAM] - Re: [SPAM] - Re: [R] R package development\n>> >> in windows - Bayesian Filter detected spam - Bayesian Filter\n>> >> detected spam\n>> >>\n>> >> On 5/3/2007 3:33 PM, Doran, Harold wrote:\n>> >> > Thanks, Duncan. I'll look into that. Is there an authoritative\n>> >> > document that codifies the new package development procedures for\n>> >> > 2.5.0 (windows-specific), or is that Writing R Extensions? In this\n>> >> > thread alone I've received multiple emails pointing to multiple web\n>> >> > sites with instructions for windows. Inasmuch as its\n>> >> appreciated, I'm\n>> >> > a bit confused as to which I should consider authoritative.\n>> >> >\n>> >> > I do hope I can resolve this and appreciate the help I've received.\n>> >> > However, I feel a bit compelled to note how very difficult this\n>> >> > process is.\n>> >>\n>> >> The manuals are the authoritative reference.  Writing R\n>> >> Extensions tells you what to do to set up a package.  The R\n>> >> Administration and Installation manual tells you how to set\n>> >> up your system so those instructions will work.  On Windows,\n>> >> you want to pay particular attention to the appendix of the\n>> >> Admin manual called \"The Windows Toolset\". This is Appendix E\n>> >> in the distributed .pdf; an HTML version is available here:\n>> >>\n>> >>\n>> >> http://cran.r-project.org/doc/manuals/R-admin.html#The-Windows-toolset\n>> >>\n>> >> We realize that these instructions are not easy to follow,\n>> >> there's no need to tell us that.  However, specific\n>> >> corrections or improvements would be welcome.\n>> >>\n>> >> Duncan Murdoch\n>> >>\n>> >>\n>> >> > Harold\n>> >> >\n>> >> >\n>> >> >> -----Original Message-----\n>> >> >> From: Duncan Murdoch [mailto:murdoch@stats.uwo.ca]\n>> >> >> Sent: Thursday, May 03, 2007 3:24 PM\n>> >> >> To: Doran, Harold\n>> >> >> Cc: Gabor Grothendieck; r-help@stat.math.ethz.ch\n>> >> >> Subject: [SPAM] - Re: [R] R package development in windows\n>> >> - Bayesian\n>> >> >> Filter detected spam\n>> >> >>\n>> >> >> On 5/3/2007 3:04 PM, Doran, Harold wrote:\n>> >> >> > Thanks Gabor, Sundar, and Tony. Indeed, Rtools was\n>> >> missing from the\n>> >> >> > path. With that resolved, and another 10 minute windows\n>> >> >> restart, I get\n>> >> >> > the following below. The log suggests that hhc is not\n>> >> installed. It\n>> >> >> > is, and, according to the directions I am following, I have\n>> >> >> placed it\n>> >> >> > in the c:\\cygwin directory.\n>> >> >>\n>> >> >> I think the problem is that you are following a real mix of\n>> >> >> instructions, and they don't make sense.\n>> >> >>\n>> >> >> It would be nice if folks would submit patches to the R\n>> >> Admin manual\n>> >> >> (or to the Rtools web site) rather than putting together web sites\n>> >> >> with advice that is bad from day one, and quickly gets\n>> >> worse when it\n>> >> >> is not updated.\n>> >> >>\n>> >> >> > BTW, package.skeleton() doesn't seem to create the correct\n>> >> >> DESCRIPTION\n>> >> >> > template. I had to add the DEPENDS line. Without this, I\n>> >> >> get another\n>> >> >> > error.\n>> >> >> >\n>> >> >> >\n>> >> >> > C:\\Program Files\\R\\R-2.4.1\\bin>Rcmd build --force --binary g:\\foo\n>> >> >>\n>> >> >> R 2.4.1 is no longer current; the package building\n>> >> instructions in R\n>> >> >> 2.5.0 have been simplified a bit.  You might want to try those.\n>> >> >>\n>> >> >> Duncan Murdoch\n>> >> >>\n>> >> >> > * checking for file 'g:\\foo/DESCRIPTION' ... OK\n>> >> >> > * preparing 'g:\\foo':\n>> >> >> > * checking DESCRIPTION meta-information ... OK\n>> >> >> > * removing junk files\n>> >> >> > * checking for LF line-endings in source files\n>> >> >> > * checking for empty or unneeded directories\n>> >> >> > * building binary distribution\n>> >> >> >  WARNING\n>> >> >> > * some HTML links may not be found\n>> >> >> > installing R.css in c:/TEMP/Rinst40061099\n>> >> >> >\n>> >> >> > Using auto-selected zip options ''\n>> >> >> > latex: not found\n>> >> >> > latex: not found\n>> >> >> > latex: not found\n>> >> >> >\n>> >> >> > ---------- Making package foo ------------\n>> >> >> > latex: not found\n>> >> >> >   adding build stamp to DESCRIPTION\n>> >> >> > latex: not found\n>> >> >> > latex: not found\n>> >> >> > latex: not found\n>> >> >> >   installing R files\n>> >> >> > latex: not found\n>> >> >> >   installing data files\n>> >> >> > latex: not found\n>> >> >> >   installing man source files\n>> >> >> >   installing indices\n>> >> >> > latex: not found\n>> >> >> >   not zipping data\n>> >> >> >   installing help\n>> >> >> > Warning: \\alias{foo} already in foo-package.Rd -- skipping\n>> >> >> the one in\n>> >> >> > foo.Rd  >>> Building/Updating help pages for package 'foo'\n>> >> >> >      Formats: text html latex example chm\n>> >> >> >   foo-package                       text    html    latex\n>> >> >> example chm\n>> >> >> >   foo                               text    html    latex\n>> >> >> example chm\n>> >> >> >   mydata                            text    html    latex\n>> >> >> example chm\n>> >> >> > hhc: not found\n>> >> >> > cp: cannot stat `c:/TEMP/Rbuild40048815/foo/chm/foo.chm':\n>> >> >> No such file\n>> >> >> > or direct ory\n>> >> >> > make[1]: *** [chm-foo] Error 1\n>> >> >> > make: *** [pkg-foo] Error 2\n>> >> >> > *** Installation of foo failed ***\n>> >> >> >\n>> >> >> > Removing 'c:/TEMP/Rinst40061099/foo'\n>> >> >> >  ERROR\n>> >> >> > * installation failed\n>> >> >> >\n>> >> >> >\n>> >> >> > C:\\Program Files\\R\\R-2.4.1\\bin>\n>> >> >> >\n>> >> >> >> -----Original Message-----\n>> >> >> >> From: Gabor Grothendieck [mailto:ggrothendieck@gmail.com]\n>> >> >> >> Sent: Thursday, May 03, 2007 2:50 PM\n>> >> >> >> To: Doran, Harold\n>> >> >> >> Cc: r-help@stat.math.ethz.ch\n>> >> >> >> Subject: Re: [R] R package development in windows\n>> >> >> >>\n>> >> >> >> It can find sh.exe so you haven't installed Rtools.\n>> >> >> >>\n>> >> >> >> There are several HowTo's listed in the links section here that\n>> >> >> >> include pointers to R manuals and other step by step\n>> >> >> >> instructions:\n>> >> >> >>\n>> >> >> >> http://code.google.com/p/batchfiles/\n>> >> >> >>\n>> >> >> >> On 5/3/07, Doran, Harold  wrote:\n>> >> >> >> > I'm attempting to build an R package for distribution and\n>> >> >> >> am working\n>> >> >> >> > from the directions found at\n>> >> >> >> >\n>> >> >> >>\n>> >> >>\n>> >> http://www.maths.bris.ac.uk/~maman/computerstuff/Rhelp/Rpackages.html\n>> >> >> >> #\n>> >> >> >> > Wi\n>> >> >> >> > n-Win\n>> >> >> >> >\n>> >> >> >> > I've read through Writing R Extensions and various other\n>> >> >> >> \"helpful\" web\n>> >> >> >> > sites. I've installed all relevant software (perl,\n>> >> >> cygwin, mingwin,\n>> >> >> >> > hhc.exe). Here is what I have done so far:\n>> >> >> >> >\n>> >> >> >> > 1) Sourced data and functions into R\n>> >> >> >> > 2) Used package.skeleton\n>> >> >> >> > 3) Edited Description file\n>> >> >> >> > 4) Edited my windows path to ensure the new programs (e.g.,\n>> >> >> >> perl) are\n>> >> >> >> > in the path\n>> >> >> >> > 5) Then, I open DOS and do the following in the script below\n>> >> >> >> >\n>> >> >> >> > C:\\Program Files\\R\\R-2.4.1\\bin>Rcmd build  --force\n>> >> >> --binary g:\\foo\n>> >> >> >> > * checking for file 'g:\\foo/DESCRIPTION' ... OK\n>> >> >> >> > * preparing 'g:\\foo':\n>> >> >> >> > * checking DESCRIPTION meta-information ...'sh' is not\n>> >> >> >> recognized as\n>> >> >> >> > an internal  or external command, operable program or\n>> >> batch file.\n>> >> >> >> >  OK\n>> >> >> >> > * removing junk files\n>> >> >> >> > 'sh' is not recognized as an internal or external\n>> >> >> command, operable\n>> >> >> >> > program or batch file.\n>> >> >> >> > 'sh' is not recognized as an internal or external\n>> >> >> command, operable\n>> >> >> >> > program or batch file.\n>> >> >> >> > 'sh' is not recognized as an internal or external\n>> >> >> command, operable\n>> >> >> >> > program or batch file.\n>> >> >> >> > Error: cannot open file 'foo/DESCRIPTION' for reading\n>> >> >> >> >\n>> >> >> >> > I'ver read through about as much documentation as I can\n>> >> >> >> find, and I'm\n>> >> >> >> > just not sure what I should do from here. I admit that I\n>> >> >> >> have reached\n>> >> >> >> > a point of frustration and must apologize if the problem\n>> >> >> would be\n>> >> >> >> > evident if I read documentation further, but I'm about\n>> >> >> tapped out\n>> >> >> >> > after a few days of experimentation.\n>> >> >> >> >\n>> >> >> >> > Can anyone suggest how I could resolve this and what the\n>> >> >> next steps\n>> >> >> >> > would be?\n>> >> >> >> >\n>> >> >> >> > Thanks:\n>> >> >> >> >\n>> >> >> >> > I'm using Windows XP and R 2.4.1\n>> >> >> >> >\n>> >> >> >> > Harold\n>> >> >> >> >\n>> >> >> >> >        [[alternative HTML version deleted]]\n>> >> >> >> >\n>> >> >> >> > ______________________________________________\n>> >> >> >> > R-help@stat.math.ethz.ch mailing list\n>> >> >> >> > https://stat.ethz.ch/mailman/listinfo/r-help\n>> >> >> >> > PLEASE do read the posting guide\n>> >> >> >> > http://www.R-project.org/posting-guide.html\n>> >> >> >> > and provide commented, minimal, self-contained,\n>> >> >> reproducible code.\n>> >> >> >> >\n>> >> >> >>\n>> >> >> >\n>> >> >> > ______________________________________________\n>> >> >> > R-help@stat.math.ethz.ch mailing list\n>> >> >> > https://stat.ethz.ch/mailman/listinfo/r-help\n>> >> >> > PLEASE do read the posting guide\n>> >> >> > http://www.R-project.org/posting-guide.html\n>> >> >> > and provide commented, minimal, self-contained,\n>> >> reproducible code.\n>> >> >>\n>> >> >>\n>> >>\n>> >>\n>>\n>>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}