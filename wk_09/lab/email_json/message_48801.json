{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23509 - in branches: SAMBA_3_0/source\n\tSAMBA_3_0/source/include SAMBA_3_0/source/param\n\tSAMBA_3_0/source/registry SAMBA_3_0_26/source\n\tSAMBA_3_0_26/source/include SAMBA_3_0_26/source/param\n\tSAMBA_3_0_26/source/registry", "body": "Author: obnox\nDate: 2007-06-15 21:38:10 +0000 (Fri, 15 Jun 2007)\nNew Revision: 23509\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23509\n\nLog:\nThis activates the global options from the registry in loadparm. \nThe global options are stored as values in the subkey \"global\"\nof the SMBCONF registry key. \n\nThe activation is accomplished in smb.conf though a new special \nsemantic of the \"include\" parameter: \"include = registry\" triggers\nthe processing of the registry global options exactly at the\nposition of the include statement. Options read from the registry\ntake the same precedence as parameters loaded from a file via\ninclude. Need to reload the registry globals is detected by\nwatching the tdb sequence number. \n\nRegistry shares are automatically activated when the registry\nglobals are processed.\n\nSo a \"registry only\" configuration can be realized by an\nsmb.conf that looks as follows:\n\n================================\n[global]\ninclude = registry\n================================\n\nThe global options and registry shares can be conveniently\nedited with the \"net conf\" utility.\n\n\nCaveat:\n\nA possible pitfall consists in using \"include = registry\"\ntogether with the \"lock directory\" directive in the registry.\nThis problem will be addressed in the next time.\n\n\nNote on the code:\n\nProcessing of the registry options is accomplished by a function\nprocess_registry_globals() in loadparm.c The current version is\nonly an interim solution: It is handcoded instead of using the\ninfrastructure of reg_api.c. The reason for this is that using \nreg_api still has too large linker dependencies, bloating virtually\nall targets by PASSDB_OBJ, SMBLDAP_OBJ, GROUPDB_OBJ and LDB stuff.\nA version of process_registry_globals that uses reg_api is \nincluded but commented out. The goal is to eventually refactor\nand restructure the registry code so that one can use the reg_api\nto access only the registry tdb and not link all the dynamic\nbackends with all their linking implications.\n\n\n\nAdded:\n   branches/SAMBA_3_0/source/include/reg_db.h\n   branches/SAMBA_3_0_26/source/include/reg_db.h\nModified:\n   branches/SAMBA_3_0/source/Makefile.in\n   branches/SAMBA_3_0/source/include/includes.h\n   branches/SAMBA_3_0/source/param/loadparm.c\n   branches/SAMBA_3_0/source/registry/reg_db.c\n   branches/SAMBA_3_0_26/source/Makefile.in\n   branches/SAMBA_3_0_26/source/include/includes.h\n   branches/SAMBA_3_0_26/source/param/loadparm.c\n   branches/SAMBA_3_0_26/source/registry/reg_db.c\n\n\nChangeset:\nSorry, the patch is too large (865 lines) to include; please use WebSVN to see it!\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23509\n\n"}