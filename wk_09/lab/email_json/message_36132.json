{"category": "ham", "to_address": "Martin Zielinski <mz@seh.de>", "from_address": "\"Gerald (Jerry) Carter\" <jerry@samba.org>", "subject": "Re: 3.0.25 publish printer problem", "body": "-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA1\n\nMartin Zielinski wrote:\n> \n> \n> Gerald (Jerry) Carter schrieb:\n>> -----BEGIN PGP SIGNED MESSAGE-----\n>> Hash: SHA1\n>>\n>> Martin Zielinski wrote:\n>>\n>>> I encounter problems (un)publishing printers to ADS.\n>>> The samba log shows up the following message:\n>>>\n>>> kerberos_kinit_password SERVER$@MY.DOMAIN failed: Cannot contact any\n>>> KDC for requested realm\n>>>\n>>> The error occurs, when the smbd runs through the ads_kinit_password()\n>>> routine the second time.\n>>> I've follow the \"data-flow\" until krb5_cc_get_principal() in clikrb5.c.\n>>>\n>>> Removing the   \n>>> ads_kdestroy(\"MEMORY:prtpub_cache\");\n>>>\n>>> in line 3294 of nt_printing.c fixes this for me.\n>>\n>> Martin,\n>>\n>> I don't understand why this would be necessary.  In\n>> nt_printer_publish() we set the memory ccache again.\n>>\n>> I also don't understand why the kinit() in ads_sasl_spnego_bind()\n>> is failing.  It seems to me that the existing ds_kdestroy()\n>> in check_printers-Published() is correct and that we should add\n>> one to nt_printer_publish().\n>>\n>> What am I missing?\n>>\n> Sorry, apparently nothing.\n> The problem was related to a broken DNS configuration.\n> \n> I still don't know, why the first run through ads_kinit_password\n> succeeds (as I'm not familiar with the kerberos internals), but the\n> later calls depend on successfull responses to\n> \"SRV _kerberos._udp.MY.DOMAIN.COM\" and related DNS-requests. This has no\n> effect, if the ccache is not deleted - which caused the difference in\n> the behaviour of 3.0.25rc3 and 3.0.25.\n\nOK.  So no changes needed here then.  Cool. Thanks for the update.\n\n\nPS: Still working on the printer comment and location patches.\n\n\n\n\njerry\n\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1.4.2.2 (Darwin)\nComment: Using GnuPG with Mozilla - http://enigmail.mozdev.org\n\niD8DBQFGVwJhIR7qMdg1EfYRArYJAJwM+nOOjl8MtRtX7iXOcESQMmdD+wCg207A\nZ9zTgmfdxGcbkOeJZCBGksA=\n=deoi\n-----END PGP SIGNATURE-----\n\n"}