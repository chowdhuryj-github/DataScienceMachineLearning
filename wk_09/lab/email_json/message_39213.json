{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23249 - in branches/SAMBA_3_0/source/rpcclient: .", "body": "Author: jerry\nDate: 2007-05-30 21:46:03 +0000 (Wed, 30 May 2007)\nNew Revision: 23249\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23249\n\nLog:\nanother sync from 3.0.26 for the echo work to rpcclient\nModified:\n   branches/SAMBA_3_0/source/rpcclient/cmd_echo.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/rpcclient/cmd_echo.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpcclient/cmd_echo.c\t2007-05-30 21:43:48 UTC (rev 23248)\n+++ branches/SAMBA_3_0/source/rpcclient/cmd_echo.c\t2007-05-30 21:46:03 UTC (rev 23249)\n@@ -52,7 +52,7 @@\n {\n \tuint32 size, i;\n \tNTSTATUS result;\n-\tuint8 *in_data = NULL, *out_data = NULL;\n+\tuint8_t *in_data = NULL, *out_data = NULL;\n \n \tif (argc != 2) {\n \t\tprintf(\"Usage: %s num\\n\", argv[0]);\n@@ -60,8 +60,16 @@\n \t}\n \n \tsize = atoi(argv[1]);\n-\tin_data = (uint8 *)SMB_MALLOC(size);\n-\tout_data = (uint8 *)SMB_MALLOC(size);\n+\tif ( (in_data = (uint8_t*)SMB_MALLOC(size)) == NULL ) {\n+\t\tprintf(\"Failure to allocate buff of %d bytes\\n\",\n+\t\t       size);\n+\t\tgoto done;\t\t\n+\t}\n+\tif ( (out_data = (uint8_t*)SMB_MALLOC(size)) == NULL ) {\n+\t\tprintf(\"Failure to allocate buff of %d bytes\\n\",\n+\t\t       size);\n+\t\tgoto done;\t\t\n+\t}\n \n \tfor (i = 0; i < size; i++)\n \t\tin_data[i] = i & 0xff;\n@@ -81,7 +89,7 @@\n \n done:\n \tSAFE_FREE(in_data);\n-\tTALLOC_FREE(out_data);\n+\tSAFE_FREE(out_data);\n \n \treturn result;\n }\n@@ -92,7 +100,7 @@\n {\n \tuint32 size, i;\n \tNTSTATUS result;\n-\tuint8 *out_data;\n+\tuint8_t *out_data = NULL;\n \n \tif (argc != 2) {\n \t\tprintf(\"Usage: %s num\\n\", argv[0]);\n@@ -100,15 +108,20 @@\n \t}\n \n \tsize = atoi(argv[1]);\n+\tif ( (out_data = (uint8_t*)SMB_MALLOC(size)) == NULL ) {\n+\t\tprintf(\"Failure to allocate buff of %d bytes\\n\",\n+\t\t       size);\n+\t\tgoto done;\t\t\n+\t}\n+\t\n \n-\tout_data = SMB_MALLOC_ARRAY(uint8, size);\n \tresult = rpccli_echo_SourceData(cli, mem_ctx, size, out_data);\n \n \tif (!NT_STATUS_IS_OK(result))\n \t\tgoto done;\n \n \tfor (i = 0; i < size; i++) {\n-\t\tif (out_data[i] != (i & 0xff)) {\n+\t\tif (out_data && out_data[i] != (i & 0xff)) {\n \t\t\tprintf(\"mismatch at offset %d, %d != %d\\n\",\n \t\t\t       i, out_data[i], i & 0xff);\n \t\t\tresult = NT_STATUS_UNSUCCESSFUL;\n@@ -116,8 +129,6 @@\n \t}\n \n done:\n-\tTALLOC_FREE(out_data);\n-\n \treturn result;\n }\n \n@@ -126,7 +137,7 @@\n {\n \tuint32 size, i;\n \tNTSTATUS result;\n-\tuint8 *in_data = NULL;\n+\tuint8_t *in_data = NULL;\n \n \tif (argc != 2) {\n \t\tprintf(\"Usage: %s num\\n\", argv[0]);\n@@ -134,7 +145,11 @@\n \t}\n \n \tsize = atoi(argv[1]);\n-\tin_data = (uint8 *)SMB_MALLOC(size);\n+\tif ( (in_data = (uint8_t*)SMB_MALLOC(size)) == NULL ) {\n+\t\tprintf(\"Failure to allocate buff of %d bytes\\n\",\n+\t\t       size);\n+\t\tgoto done;\t\t\n+\t}\n \n \tfor (i = 0; i < size; i++)\n \t\tin_data[i] = i & 0xff;\n\n"}