{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jpeach@samba.org", "subject": "svn commit: samba r23010 - in branches: SAMBA_3_0/source/utils\n\tSAMBA_3_0_26/source/utils", "body": "Author: jpeach\nDate: 2007-05-19 04:59:00 +0000 (Sat, 19 May 2007)\nNew Revision: 23010\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23010\n\nLog:\nMake the output of \"smbcontrol --help\" match that of \"smbcontrol help\".\nBug #3181.\n\nModified:\n   branches/SAMBA_3_0/source/utils/smbcontrol.c\n   branches/SAMBA_3_0_26/source/utils/smbcontrol.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/utils/smbcontrol.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/smbcontrol.c\t2007-05-19 04:23:04 UTC (rev 23009)\n+++ branches/SAMBA_3_0/source/utils/smbcontrol.c\t2007-05-19 04:59:00 UTC (rev 23010)\n@@ -1062,11 +1062,11 @@\n \n /* Display usage information */\n \n-static void usage(poptContext *pc)\n+static void usage(poptContext pc)\n {\n \tint i;\n \n-\tpoptPrintHelp(*pc, stderr, 0);\n+\tpoptPrintHelp(pc, stderr, 0);\n \n \tfprintf(stderr, \"\\n\");\n \tfprintf(stderr, \" is one of \\\"nmbd\\\", \\\"smbd\\\", \\\"winbindd\\\" or a \"\n@@ -1160,6 +1160,29 @@\n \treturn False;\n }\n \n+static void smbcontrol_help(poptContext pc,\n+\t\t    enum poptCallbackReason preason,\n+\t\t    struct poptOption * poption,\n+\t\t    const char * parg,\n+\t\t    void * pdata)\n+{\n+\tif (poption->shortName != '?') {\n+\t\tpoptPrintUsage(pc, stdout, 0);\n+\t} else {\n+\t\tusage(pc);\n+\t}\n+\n+\texit(0);\n+}\n+\n+struct poptOption help_options[] = {\n+\t{ NULL, '\\0', POPT_ARG_CALLBACK, (void *)&smbcontrol_help, '\\0',\n+\t  NULL, NULL },\n+\t{ \"help\", '?', 0, NULL, '?', \"Show this help message\", NULL },\n+\t{ \"usage\", '\\0', 0, NULL, 'u', \"Display brief usage message\", NULL },\n+\t{ NULL }\n+} ;\n+\n /* Main program */\n \n int main(int argc, const char **argv)\n@@ -1170,7 +1193,9 @@\n \tstruct messaging_context *msg_ctx;\n \n \tstatic struct poptOption long_options[] = {\n-\t\tPOPT_AUTOHELP\n+\t\t/* POPT_AUTOHELP */\n+\t\t{ NULL, '\\0', POPT_ARG_INCLUDE_TABLE, help_options,\n+\t\t                        0, \"Help options:\", NULL },\n \t\t{ \"timeout\", 't', POPT_ARG_INT, &timeout, 't', \n \t\t  \"Set timeout value in seconds\", \"TIMEOUT\" },\n \n@@ -1191,7 +1216,7 @@\n \t\t\t       \"\");\n \n \tif (argc == 1)\n-\t\tusage(&pc);\n+\t\tusage(pc);\n \n \twhile ((opt = poptGetNextOpt(pc)) != -1) {\n \t\tswitch(opt) {\n@@ -1215,7 +1240,7 @@\n \t}\n \n \tif (argc == 1)\n-\t\tusage(&pc);\n+\t\tusage(pc);\n \n \tlp_load(dyn_CONFIGFILE,False,False,False,True);\n \n\nModified: branches/SAMBA_3_0_26/source/utils/smbcontrol.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/smbcontrol.c\t2007-05-19 04:23:04 UTC (rev 23009)\n+++ branches/SAMBA_3_0_26/source/utils/smbcontrol.c\t2007-05-19 04:59:00 UTC (rev 23010)\n@@ -1062,11 +1062,11 @@\n \n /* Display usage information */\n \n-static void usage(poptContext *pc)\n+static void usage(poptContext pc)\n {\n \tint i;\n \n-\tpoptPrintHelp(*pc, stderr, 0);\n+\tpoptPrintHelp(pc, stderr, 0);\n \n \tfprintf(stderr, \"\\n\");\n \tfprintf(stderr, \" is one of \\\"nmbd\\\", \\\"smbd\\\", \\\"winbindd\\\" or a \"\n@@ -1160,6 +1160,29 @@\n \treturn False;\n }\n \n+static void smbcontrol_help(poptContext pc,\n+\t\t    enum poptCallbackReason preason,\n+\t\t    struct poptOption * poption,\n+\t\t    const char * parg,\n+\t\t    void * pdata)\n+{\n+\tif (poption->shortName != '?') {\n+\t\tpoptPrintUsage(pc, stdout, 0);\n+\t} else {\n+\t\tusage(pc);\n+\t}\n+\n+\texit(0);\n+}\n+\n+struct poptOption help_options[] = {\n+\t{ NULL, '\\0', POPT_ARG_CALLBACK, (void *)&smbcontrol_help, '\\0',\n+\t  NULL, NULL },\n+\t{ \"help\", '?', 0, NULL, '?', \"Show this help message\", NULL },\n+\t{ \"usage\", '\\0', 0, NULL, 'u', \"Display brief usage message\", NULL },\n+\t{ NULL }\n+} ;\n+\n /* Main program */\n \n int main(int argc, const char **argv)\n@@ -1170,7 +1193,9 @@\n \tstruct messaging_context *msg_ctx;\n \n \tstatic struct poptOption long_options[] = {\n-\t\tPOPT_AUTOHELP\n+\t\t/* POPT_AUTOHELP */\n+\t\t{ NULL, '\\0', POPT_ARG_INCLUDE_TABLE, help_options,\n+\t\t                        0, \"Help options:\", NULL },\n \t\t{ \"timeout\", 't', POPT_ARG_INT, &timeout, 't', \n \t\t  \"Set timeout value in seconds\", \"TIMEOUT\" },\n \n@@ -1191,7 +1216,7 @@\n \t\t\t       \"\");\n \n \tif (argc == 1)\n-\t\tusage(&pc);\n+\t\tusage(pc);\n \n \twhile ((opt = poptGetNextOpt(pc)) != -1) {\n \t\tswitch(opt) {\n@@ -1215,7 +1240,7 @@\n \t}\n \n \tif (argc == 1)\n-\t\tusage(&pc);\n+\t\tusage(pc);\n \n \tlp_load(dyn_CONFIGFILE,False,False,False,True);\n \n\n"}