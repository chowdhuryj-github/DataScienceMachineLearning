{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r22747 - in branches/SAMBA_3_0/source: librpc/ndr\n\tlibsmb nsswitch printing smbd utils", "body": "Author: vlendec\nDate: 2007-05-07 15:07:49 +0000 (Mon, 07 May 2007)\nNew Revision: 22747\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22747\n\nLog:\nFix some C++ warnings\n\nModified:\n   branches/SAMBA_3_0/source/librpc/ndr/ndr.c\n   branches/SAMBA_3_0/source/libsmb/clikrb5.c\n   branches/SAMBA_3_0/source/libsmb/smb_seal.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\n   branches/SAMBA_3_0/source/printing/printing.c\n   branches/SAMBA_3_0/source/smbd/seal.c\n   branches/SAMBA_3_0/source/smbd/sesssetup.c\n   branches/SAMBA_3_0/source/utils/net_rpc_registry.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/librpc/ndr/ndr.c\n===================================================================\n--- branches/SAMBA_3_0/source/librpc/ndr/ndr.c\t2007-05-07 15:05:04 UTC (rev 22746)\n+++ branches/SAMBA_3_0/source/librpc/ndr/ndr.c\t2007-05-07 15:07:49 UTC (rev 22747)\n@@ -213,13 +213,16 @@\n \tint i;\n \n \tfor (i=0;idepth;i++) {\n-\t\tndr->private_data = talloc_asprintf_append(ndr->private_data, \"    \");\n+\t\tndr->private_data = talloc_asprintf_append(\n+\t\t\t(char *)ndr->private_data, \"    \");\n \t}\n \n \tva_start(ap, format);\n-\tndr->private_data = talloc_vasprintf_append(ndr->private_data, format, ap);\n+\tndr->private_data = talloc_vasprintf_append(\n+\t\t(char *)ndr->private_data, format, ap);\n \tva_end(ap);\n-\tndr->private_data = talloc_asprintf_append(ndr->private_data, \"\\n\");\n+\tndr->private_data = talloc_asprintf_append(\n+\t\t(char *)ndr->private_data, \"\\n\");\n }\n \n /*\n\nModified: branches/SAMBA_3_0/source/libsmb/clikrb5.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/clikrb5.c\t2007-05-07 15:05:04 UTC (rev 22746)\n+++ branches/SAMBA_3_0/source/libsmb/clikrb5.c\t2007-05-07 15:07:49 UTC (rev 22747)\n@@ -1450,7 +1450,7 @@\n \n \t*opt = NULL;\n \n-\tif ((my_opt = SMB_MALLOC(sizeof(krb5_get_init_creds_opt))) == NULL) {\n+\tif ((my_opt = SMB_MALLOC_P(krb5_get_init_creds_opt)) == NULL) {\n \t\treturn ENOMEM;\n \t}\n \n\nModified: branches/SAMBA_3_0/source/libsmb/smb_seal.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/smb_seal.c\t2007-05-07 15:05:04 UTC (rev 22746)\n+++ branches/SAMBA_3_0/source/libsmb/smb_seal.c\t2007-05-07 15:07:49 UTC (rev 22747)\n@@ -72,7 +72,7 @@\n \t\treturn NT_STATUS_BUFFER_TOO_SMALL;\n \t}\n \n-\tinbuf = smb_xmemdup(buf, buf_len);\n+\tinbuf = (char *)smb_xmemdup(buf, buf_len);\n \n \t/* Adjust for the signature. */\n \tdata_len = buf_len - 8 - NTLMSSP_SIG_SIZE;\n@@ -204,7 +204,7 @@\n \t}\n \n \tmemcpy(buf + 8, out_buf.value, out_buf.length);\n-\tsmb_setlen(out_buf.value, buf, out_buf.length + 4);\n+\tsmb_setlen((char *)out_buf.value, buf, out_buf.length + 4);\n \n \tgss_release_buffer(&minor, &out_buf);\n \treturn NT_STATUS_OK;\n@@ -269,7 +269,7 @@\n \t * bother :-*(. JRA.\n \t */\n \n-\t*ppbuf_out = SMB_MALLOC(out_buf.length + 8); /* We know this can't wrap. */\n+\t*ppbuf_out = (char *)SMB_MALLOC(out_buf.length + 8); /* We know this can't wrap. */\n \tif (!*ppbuf_out) {\n \t\tgss_release_buffer(&minor, &out_buf);\n \t\treturn NT_STATUS_NO_MEMORY;\n\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\t2007-05-07 15:05:04 UTC (rev 22746)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\t2007-05-07 15:07:49 UTC (rev 22747)\n@@ -2318,7 +2318,7 @@\n \n \tfstr_sprintf(key_str, \"DE/%d\", pid);\n \tif (tdb_store(wcache->tdb, string_tdb_data(key_str),\n-\t\t      make_tdb_data(response->extra_data.data,\n+\t\t      make_tdb_data((uint8 *)response->extra_data.data,\n \t\t\t\t    response->length - sizeof(*response)),\n \t\t      TDB_REPLACE) == 0)\n \t\treturn;\n@@ -3193,7 +3193,7 @@\n \t\t\tchar *keystr;\n \t\t\tint ret;\n \n-\t\t\tkeystr = SMB_MALLOC(kbuf.dsize+1);\n+\t\t\tkeystr = SMB_MALLOC_ARRAY(char, kbuf.dsize+1);\n \t\t\tif (!keystr) {\n \t\t\t\treturn 1;\n \t\t\t}\n\nModified: branches/SAMBA_3_0/source/printing/printing.c\n===================================================================\n--- branches/SAMBA_3_0/source/printing/printing.c\t2007-05-07 15:05:04 UTC (rev 22746)\n+++ branches/SAMBA_3_0/source/printing/printing.c\t2007-05-07 15:07:49 UTC (rev 22747)\n@@ -1357,7 +1357,7 @@\n \tint printing_type;\n \tsize_t len;\n \n-\tlen = tdb_unpack( buf, msglen, \"fdPP\",\n+\tlen = tdb_unpack( (uint8 *)buf, msglen, \"fdPP\",\n \t\tsharename,\n \t\t&printing_type,\n \t\tlpqcommand,\n\nModified: branches/SAMBA_3_0/source/smbd/seal.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/seal.c\t2007-05-07 15:05:04 UTC (rev 22746)\n+++ branches/SAMBA_3_0/source/smbd/seal.c\t2007-05-07 15:07:49 UTC (rev 22747)\n@@ -492,8 +492,7 @@\n \n \tif (NT_STATUS_IS_OK(status)) {\n \t\t/* Return the context we're using for this encryption state. */\n-\t\t*pparam = SMB_MALLOC(2);\n-\t\tif (!*pparam) {\n+\t\tif (!(*pparam = SMB_MALLOC_ARRAY(unsigned char, 2))) {\n \t\t\treturn NT_STATUS_NO_MEMORY;\n \t\t}\n \t\tSSVAL(*pparam,0,partial_srv_trans_enc_ctx->es->enc_ctx_num);\n@@ -542,8 +541,7 @@\n \n \tif (NT_STATUS_IS_OK(status)) {\n \t\t/* Return the context we're using for this encryption state. */\n-\t\t*pparam = SMB_MALLOC(2);\n-\t\tif (!*pparam) {\n+\t\tif (!(*pparam = SMB_MALLOC_ARRAY(unsigned char, 2))) {\n \t\t\treturn NT_STATUS_NO_MEMORY;\n \t\t}\n \t\tSSVAL(*pparam,0,ec->es->enc_ctx_num);\n@@ -593,8 +591,7 @@\n \n \tif (NT_STATUS_IS_OK(status)) {\n \t\t/* Return the context we're using for this encryption state. */\n-\t\t*pparam = SMB_MALLOC(2);\n-\t\tif (!*pparam) {\n+\t\tif (!(*pparam = SMB_MALLOC_ARRAY(unsigned char, 2))) {\n \t\t\treturn NT_STATUS_NO_MEMORY;\n \t\t}\n \t\tSSVAL(*pparam,0,ec->es->enc_ctx_num);\n\nModified: branches/SAMBA_3_0/source/smbd/sesssetup.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/sesssetup.c\t2007-05-07 15:05:04 UTC (rev 22746)\n+++ branches/SAMBA_3_0/source/smbd/sesssetup.c\t2007-05-07 15:07:49 UTC (rev 22747)\n@@ -990,8 +990,7 @@\n \t}\n \n \t/* We must store this blob until complete. */\n-\tpad = SMB_MALLOC(sizeof(struct pending_auth_data));\n-\tif (!pad) {\n+\tif (!(pad = SMB_MALLOC_P(struct pending_auth_data))) {\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \tpad->needed_len = needed_len - pblob->length;\n\nModified: branches/SAMBA_3_0/source/utils/net_rpc_registry.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/net_rpc_registry.c\t2007-05-07 15:05:04 UTC (rev 22746)\n+++ branches/SAMBA_3_0/source/utils/net_rpc_registry.c\t2007-05-07 15:07:49 UTC (rev 22747)\n@@ -263,7 +263,7 @@\n \t\tname_buf.size = max_valnamelen + 2;\n \n \t\tdata_size = max_valbufsize;\n-\t\tdata = TALLOC(mem_ctx, data_size);\n+\t\tdata = (uint8 *)TALLOC(mem_ctx, data_size);\n \t\tvalue_length = 0;\n \n \t\tstatus = rpccli_winreg_EnumValue(pipe_hnd, mem_ctx, key_hnd,\n\n"}