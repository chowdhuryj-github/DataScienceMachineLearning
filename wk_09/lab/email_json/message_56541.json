{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23634 - in branches/SAMBA_3_0_26/source:\n\tnsswitch rpc_server", "body": "Author: jerry\nDate: 2007-06-27 16:53:56 +0000 (Wed, 27 Jun 2007)\nNew Revision: 23634\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23634\n\nLog:\nSquashed commit of the following:\n\ncommit 46e46d8e2ac45db6b9d8cb0ea05fae36c900ea2c\nAuthor: Gerald (Jerry) Carter \nDate:   Wed Jun 27 11:29:10 2007 -0500\n\n    Fix a couple of crash bugs pointed out by Volker caused by an old\n    change from a pstring to a char* and still trying use pstrcpy().\n\ncommit 64b89f90b8207ba8b9cd0f77e40912c0acaddc99\nAuthor: Gerald (Jerry) Carter \nDate:   Wed Jun 27 08:27:34 2007 -0500\n\n    Correctly return the new_group list pointer from expand_groups\n    or else getgrnam() always  acts like 'winbind expand groups = 1'\n\nModified:\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_group.c\n   branches/SAMBA_3_0_26/source/rpc_server/srv_winreg_nt.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_group.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_group.c\t2007-06-27 16:52:36 UTC (rev 23633)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_group.c\t2007-06-27 16:53:56 UTC (rev 23634)\n@@ -456,7 +456,7 @@\n \t\tTALLOC_FREE( tmp_ctx );\n \t}\n \n-\tnew_glist = &new_groups;\n+\t*new_glist = new_groups;\n \t*n_new_glist = (uint32)new_groups_size;\t\n \t\n  out:\n\nModified: branches/SAMBA_3_0_26/source/rpc_server/srv_winreg_nt.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_server/srv_winreg_nt.c\t2007-06-27 16:52:36 UTC (rev 23633)\n+++ branches/SAMBA_3_0_26/source/rpc_server/srv_winreg_nt.c\t2007-06-27 16:53:56 UTC (rev 23634)\n@@ -763,7 +763,12 @@\n \t\t\ttopkeypath ));\n \t\treturn WERR_BADFILE;\n \t}\n-\tpstrcpy( registry_key.name, topkeypath );\n+\n+\tregistry_key.name = talloc_strdup( regfile->mem_ctx, topkeypath );\n+\tif ( !registry_key.name ) {\n+\t\tDEBUG(0,(\"reg_load_tree: Talloc failed for reg_key.name!\\n\"));\n+\t\treturn WERR_NOMEM;\n+\t}\n \t\n \t/* now start parsing the values and subkeys */\n \n@@ -912,7 +917,11 @@\n \t/* we need a REGISTRY_KEY object here to enumerate subkeys and values */\n \t\n \tZERO_STRUCT( registry_key );\n-\tpstrcpy( registry_key.name, keypath );\n+\tregistry_key.name = talloc_strdup( regfile->mem_ctx, keypath );\n+\tif ( !registry_key.name ) {\n+\t\tDEBUG(0,(\"reg_load_tree: Talloc failed for reg_key.name!\\n\"));\n+\t\treturn WERR_NOMEM;\n+\t}\n \tif ( !(registry_key.hook = reghook_cache_find( registry_key.name )) )\n \t\treturn WERR_BADFILE;\n \n\n"}