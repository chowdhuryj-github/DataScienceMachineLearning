{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r23067 - in branches/SAMBA_4_0/source: ntvfs\n\tntvfs/cifs ntvfs/cifs_posix_cli ntvfs/ipc ntvfs/nbench\n\tntvfs/posix ntvfs/simple ntvfs/unixuid smb_server\n\tsmb_server/smb smb_server/smb2", "body": "Author: metze\nDate: 2007-05-22 09:25:58 +0000 (Tue, 22 May 2007)\nNew Revision: 23067\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23067\n\nLog:\nuse 'const union smb_search_data *file' also in the server code to get rid\nof compiler warnings in the cifs backend\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/ntvfs/cifs/vfs_cifs.c\n   branches/SAMBA_4_0/source/ntvfs/cifs_posix_cli/vfs_cifs_posix.c\n   branches/SAMBA_4_0/source/ntvfs/ipc/vfs_ipc.c\n   branches/SAMBA_4_0/source/ntvfs/nbench/vfs_nbench.c\n   branches/SAMBA_4_0/source/ntvfs/ntvfs.h\n   branches/SAMBA_4_0/source/ntvfs/ntvfs_interface.c\n   branches/SAMBA_4_0/source/ntvfs/posix/pvfs_search.c\n   branches/SAMBA_4_0/source/ntvfs/simple/vfs_simple.c\n   branches/SAMBA_4_0/source/ntvfs/unixuid/vfs_unixuid.c\n   branches/SAMBA_4_0/source/smb_server/blob.c\n   branches/SAMBA_4_0/source/smb_server/smb/search.c\n   branches/SAMBA_4_0/source/smb_server/smb/trans2.c\n   branches/SAMBA_4_0/source/smb_server/smb2/find.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/ntvfs/cifs/vfs_cifs.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/cifs/vfs_cifs.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/ntvfs/cifs/vfs_cifs.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -920,7 +920,7 @@\n static NTSTATUS cvfs_search_first(struct ntvfs_module_context *ntvfs, \n \t\t\t\t  struct ntvfs_request *req, union smb_search_first *io, \n \t\t\t\t  void *search_private, \n-\t\t\t\t  BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t  BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct cvfs_private *private = ntvfs->private_data;\n \n@@ -933,7 +933,7 @@\n static NTSTATUS cvfs_search_next(struct ntvfs_module_context *ntvfs, \n \t\t\t\t struct ntvfs_request *req, union smb_search_next *io, \n \t\t\t\t void *search_private, \n-\t\t\t\t BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct cvfs_private *private = ntvfs->private_data;\n \n\nModified: branches/SAMBA_4_0/source/ntvfs/cifs_posix_cli/vfs_cifs_posix.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/cifs_posix_cli/vfs_cifs_posix.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/ntvfs/cifs_posix_cli/vfs_cifs_posix.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -830,7 +830,7 @@\n static NTSTATUS cifspsx_search_first(struct ntvfs_module_context *ntvfs,\n \t\t\t\t  struct ntvfs_request *req, union smb_search_first *io, \n \t\t\t\t  void *search_private, \n-\t\t\t\t  BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t  BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct cifspsx_dir *dir;\n \tint i;\n@@ -904,7 +904,7 @@\n static NTSTATUS cifspsx_search_next(struct ntvfs_module_context *ntvfs,\n \t\t\t\t struct ntvfs_request *req, union smb_search_next *io, \n \t\t\t\t void *search_private, \n-\t\t\t\t BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct cifspsx_dir *dir;\n \tint i;\n\nModified: branches/SAMBA_4_0/source/ntvfs/ipc/vfs_ipc.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/ipc/vfs_ipc.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/ntvfs/ipc/vfs_ipc.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -669,7 +669,7 @@\n static NTSTATUS ipc_search_first(struct ntvfs_module_context *ntvfs,\n \t\t\t  struct ntvfs_request *req, union smb_search_first *io,\n \t\t\t  void *search_private, \n-\t\t\t  BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t  BOOL (*callback)(void *, const union smb_search_data *))\n {\n \treturn NT_STATUS_ACCESS_DENIED;\n }\n@@ -680,7 +680,7 @@\n static NTSTATUS ipc_search_next(struct ntvfs_module_context *ntvfs,\n \t\t\t struct ntvfs_request *req, union smb_search_next *io,\n \t\t\t void *search_private, \n-\t\t\t BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t BOOL (*callback)(void *, const union smb_search_data *))\n {\n \treturn NT_STATUS_ACCESS_DENIED;\n }\n\nModified: branches/SAMBA_4_0/source/ntvfs/nbench/vfs_nbench.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/nbench/vfs_nbench.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/ntvfs/nbench/vfs_nbench.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -842,7 +842,7 @@\n static NTSTATUS nbench_search_first(struct ntvfs_module_context *ntvfs,\n \t\t\t\t    struct ntvfs_request *req, union smb_search_first *io, \n \t\t\t\t    void *search_private, \n-\t\t\t\t    BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t    BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tNTSTATUS status;\n \n@@ -864,7 +864,7 @@\n static NTSTATUS nbench_search_next(struct ntvfs_module_context *ntvfs,\n \t\t\t\t   struct ntvfs_request *req, union smb_search_next *io, \n \t\t\t\t   void *search_private, \n-\t\t\t\t   BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t   BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tNTSTATUS status;\n \n\nModified: branches/SAMBA_4_0/source/ntvfs/ntvfs.h\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/ntvfs.h\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/ntvfs/ntvfs.h\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -92,11 +92,11 @@\n \tNTSTATUS (*search_first)(struct ntvfs_module_context *ntvfs,\n \t\t\t\t struct ntvfs_request *req,\n \t\t\t\t union smb_search_first *io, void *private,\n-\t\t\t\t BOOL (*callback)(void *private, union smb_search_data *file));\n+\t\t\t\t BOOL (*callback)(void *private, const union smb_search_data *file));\n \tNTSTATUS (*search_next)(struct ntvfs_module_context *ntvfs,\n \t\t\t\tstruct ntvfs_request *req,\n \t\t\t\tunion smb_search_next *io, void *private,\n-\t\t\t\tBOOL (*callback)(void *private, union smb_search_data *file));\n+\t\t\t\tBOOL (*callback)(void *private, const union smb_search_data *file));\n \tNTSTATUS (*search_close)(struct ntvfs_module_context *ntvfs,\n \t\t\t\t struct ntvfs_request *req,\n \t\t\t\t union smb_search_close *io);\n\nModified: branches/SAMBA_4_0/source/ntvfs/ntvfs_interface.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/ntvfs_interface.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/ntvfs/ntvfs_interface.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -150,7 +150,7 @@\n \n /* directory search */\n _PUBLIC_ NTSTATUS ntvfs_search_first(struct ntvfs_request *req, union smb_search_first *io, void *private,\n-\t\t\t\t     BOOL ntvfs_callback(void *private, union smb_search_data *file))\n+\t\t\t\t     BOOL ntvfs_callback(void *private, const union smb_search_data *file))\n {\n \tstruct ntvfs_module_context *ntvfs = req->ctx->modules;\n \tif (!ntvfs->ops->search_first) {\n@@ -160,7 +160,7 @@\n }\n \n _PUBLIC_ NTSTATUS ntvfs_search_next(struct ntvfs_request *req, union smb_search_next *io, void *private,\n-\t\t\t\t    BOOL ntvfs_callback(void *private, union smb_search_data *file))\n+\t\t\t\t    BOOL ntvfs_callback(void *private, const union smb_search_data *file))\n {\n \tstruct ntvfs_module_context *ntvfs = req->ctx->modules;\n \tif (!ntvfs->ops->search_next) {\n@@ -470,7 +470,7 @@\n _PUBLIC_ NTSTATUS ntvfs_next_search_first(struct ntvfs_module_context *ntvfs, \n \t\t\t\t\t  struct ntvfs_request *req,\n \t\t\t\t\t  union smb_search_first *io, void *private,\n-\t\t\t\t\t  BOOL (*callback)(void *private, union smb_search_data *file))\n+\t\t\t\t\t  BOOL (*callback)(void *private, const union smb_search_data *file))\n {\n \tif (!ntvfs->next || !ntvfs->next->ops->search_first) {\n \t\treturn NT_STATUS_NOT_IMPLEMENTED;\n@@ -481,7 +481,7 @@\n _PUBLIC_ NTSTATUS ntvfs_next_search_next(struct ntvfs_module_context *ntvfs, \n \t\t\t\t\t struct ntvfs_request *req,\n \t\t\t\t\t union smb_search_next *io, void *private,\n-\t\t\t\t\t BOOL (*callback)(void *private, union smb_search_data *file))\n+\t\t\t\t\t BOOL (*callback)(void *private, const union smb_search_data *file))\n {\n \tif (!ntvfs->next || !ntvfs->next->ops->search_next) {\n \t\treturn NT_STATUS_NOT_IMPLEMENTED;\n\nModified: branches/SAMBA_4_0/source/ntvfs/posix/pvfs_search.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/posix/pvfs_search.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/ntvfs/posix/pvfs_search.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -238,7 +238,7 @@\n \t\t\t\t enum smb_search_data_level level,\n \t\t\t\t uint_t *reply_count,\n \t\t\t\t void *search_private, \n-\t\t\t\t BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct pvfs_dir *dir = search->dir;\n \tNTSTATUS status;\n@@ -314,7 +314,7 @@\n static NTSTATUS pvfs_search_first_old(struct ntvfs_module_context *ntvfs,\n \t\t\t\t      struct ntvfs_request *req, union smb_search_first *io, \n \t\t\t\t      void *search_private, \n-\t\t\t\t      BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t      BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct pvfs_dir *dir;\n \tstruct pvfs_state *pvfs = ntvfs->private_data;\n@@ -404,7 +404,7 @@\n static NTSTATUS pvfs_search_next_old(struct ntvfs_module_context *ntvfs,\n \t\t\t\t     struct ntvfs_request *req, union smb_search_next *io, \n \t\t\t\t     void *search_private, \n-\t\t\t\t     BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t     BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct pvfs_state *pvfs = ntvfs->private_data;\n \tstruct pvfs_search_state *search;\n@@ -453,7 +453,7 @@\n static NTSTATUS pvfs_search_first_trans2(struct ntvfs_module_context *ntvfs,\n \t\t\t\t\t struct ntvfs_request *req, union smb_search_first *io, \n \t\t\t\t\t void *search_private, \n-\t\t\t\t\t BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t\t BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct pvfs_dir *dir;\n \tstruct pvfs_state *pvfs = ntvfs->private_data;\n@@ -549,7 +549,7 @@\n static NTSTATUS pvfs_search_next_trans2(struct ntvfs_module_context *ntvfs,\n \t\t\t\t\tstruct ntvfs_request *req, union smb_search_next *io, \n \t\t\t\t\tvoid *search_private, \n-\t\t\t\t\tBOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t\tBOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct pvfs_state *pvfs = ntvfs->private_data;\n \tstruct pvfs_search_state *search;\n@@ -610,7 +610,7 @@\n static NTSTATUS pvfs_search_first_smb2(struct ntvfs_module_context *ntvfs,\n \t\t\t\t       struct ntvfs_request *req, const struct smb2_find *io, \n \t\t\t\t       void *search_private, \n-\t\t\t\t       BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t       BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct pvfs_dir *dir;\n \tstruct pvfs_state *pvfs = ntvfs->private_data;\n@@ -713,7 +713,7 @@\n static NTSTATUS pvfs_search_next_smb2(struct ntvfs_module_context *ntvfs,\n \t\t\t\t      struct ntvfs_request *req, const struct smb2_find *io, \n \t\t\t\t      void *search_private, \n-\t\t\t\t      BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t      BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct pvfs_state *pvfs = ntvfs->private_data;\n \tstruct pvfs_search_state *search;\n@@ -766,7 +766,7 @@\n NTSTATUS pvfs_search_first(struct ntvfs_module_context *ntvfs,\n \t\t\t   struct ntvfs_request *req, union smb_search_first *io, \n \t\t\t   void *search_private, \n-\t\t\t   BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t   BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tswitch (io->generic.level) {\n \tcase RAW_SEARCH_SEARCH:\n@@ -788,7 +788,7 @@\n NTSTATUS pvfs_search_next(struct ntvfs_module_context *ntvfs,\n \t\t\t  struct ntvfs_request *req, union smb_search_next *io, \n \t\t\t  void *search_private, \n-\t\t\t  BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t  BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tswitch (io->generic.level) {\n \tcase RAW_SEARCH_SEARCH:\n\nModified: branches/SAMBA_4_0/source/ntvfs/simple/vfs_simple.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/simple/vfs_simple.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/ntvfs/simple/vfs_simple.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -827,7 +827,7 @@\n static NTSTATUS svfs_search_first(struct ntvfs_module_context *ntvfs,\n \t\t\t\t  struct ntvfs_request *req, union smb_search_first *io, \n \t\t\t\t  void *search_private, \n-\t\t\t\t  BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t  BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct svfs_dir *dir;\n \tint i;\n@@ -901,7 +901,7 @@\n static NTSTATUS svfs_search_next(struct ntvfs_module_context *ntvfs,\n \t\t\t\t struct ntvfs_request *req, union smb_search_next *io, \n \t\t\t\t void *search_private, \n-\t\t\t\t BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tstruct svfs_dir *dir;\n \tint i;\n\nModified: branches/SAMBA_4_0/source/ntvfs/unixuid/vfs_unixuid.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/unixuid/vfs_unixuid.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/ntvfs/unixuid/vfs_unixuid.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -592,7 +592,7 @@\n static NTSTATUS unixuid_search_first(struct ntvfs_module_context *ntvfs,\n \t\t\t\t    struct ntvfs_request *req, union smb_search_first *io, \n \t\t\t\t    void *search_private, \n-\t\t\t\t    BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t    BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tNTSTATUS status;\n \n@@ -605,7 +605,7 @@\n static NTSTATUS unixuid_search_next(struct ntvfs_module_context *ntvfs,\n \t\t\t\t   struct ntvfs_request *req, union smb_search_next *io, \n \t\t\t\t   void *search_private, \n-\t\t\t\t   BOOL (*callback)(void *, union smb_search_data *))\n+\t\t\t\t   BOOL (*callback)(void *, const union smb_search_data *))\n {\n \tNTSTATUS status;\n \n\nModified: branches/SAMBA_4_0/source/smb_server/blob.c\n===================================================================\n--- branches/SAMBA_4_0/source/smb_server/blob.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/smb_server/blob.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -604,7 +604,7 @@\n NTSTATUS smbsrv_push_passthru_search(TALLOC_CTX *mem_ctx,\n \t\t\t\t     DATA_BLOB *blob,\n \t\t\t\t     enum smb_search_data_level level,\n-\t\t\t\t     union smb_search_data *file,\n+\t\t\t\t     const union smb_search_data *file,\n \t\t\t\t     int default_str_flags)\n {\n \tuint8_t *data;\n\nModified: branches/SAMBA_4_0/source/smb_server/smb/search.c\n===================================================================\n--- branches/SAMBA_4_0/source/smb_server/smb/search.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/smb_server/smb/search.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -39,7 +39,7 @@\n   fill a single entry in a search find reply \n */\n static BOOL find_fill_info(struct smbsrv_request *req,\n-\t\t\t   union smb_search_data *file)\n+\t\t\t   const union smb_search_data *file)\n {\n \tuint8_t *p;\n \n@@ -66,7 +66,7 @@\n }\n \n /* callback function for search first/next */\n-static BOOL find_callback(void *private, union smb_search_data *file)\n+static BOOL find_callback(void *private, const union smb_search_data *file)\n {\n \tstruct search_state *state = (struct search_state *)private;\n \n\nModified: branches/SAMBA_4_0/source/smb_server/smb/trans2.c\n===================================================================\n--- branches/SAMBA_4_0/source/smb_server/smb/trans2.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/smb_server/smb/trans2.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -695,7 +695,7 @@\n   fill a single entry in a trans2 find reply \n */\n static NTSTATUS find_fill_info(struct find_state *state,\n-\t\t\t       union smb_search_data *file)\n+\t\t\t       const union smb_search_data *file)\n {\n \tstruct smbsrv_request *req = state->op->req;\n \tstruct smb_trans2 *trans = state->op->trans;\n@@ -791,7 +791,7 @@\n }\n \n /* callback function for trans2 findfirst/findnext */\n-static BOOL find_callback(void *private, union smb_search_data *file)\n+static BOOL find_callback(void *private, const union smb_search_data *file)\n {\n \tstruct find_state *state = talloc_get_type(private, struct find_state);\n \tstruct smb_trans2 *trans = state->op->trans;\n\nModified: branches/SAMBA_4_0/source/smb_server/smb2/find.c\n===================================================================\n--- branches/SAMBA_4_0/source/smb_server/smb2/find.c\t2007-05-22 09:02:16 UTC (rev 23066)\n+++ branches/SAMBA_4_0/source/smb_server/smb2/find.c\t2007-05-22 09:25:58 UTC (rev 23067)\n@@ -41,7 +41,7 @@\n };\n \n /* callback function for SMB2 Find */\n-static BOOL smb2srv_find_callback(void *private, union smb_search_data *file)\n+static BOOL smb2srv_find_callback(void *private, const union smb_search_data *file)\n {\n \tstruct smb2srv_find_state *state = talloc_get_type(private, struct smb2srv_find_state);\n \tstruct smb2_find *info = state->info;\n\n"}