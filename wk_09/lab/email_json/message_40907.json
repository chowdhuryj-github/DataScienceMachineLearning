{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 433: merge from ronnie in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 433\nrevision-id: tridge@samba.org-20070602080816-xkcs5l60md7prakr\nparent: tridge@samba.org-20070602033136-ojzzrsknaseuwiyq\nparent: sahlberg@ronnie-20070602065058-zorzcz56e16k4btv\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-06-02 18:08:16 +1000\nmessage:\n  merge from ronnie\nmodified:\n  tools/ctdb.sysconfig           ctdb.sysconfig-20070527204758-biuh7znabuwan3zn-7\n  tools/events.d/nfs             nfs-20070601141008-hy3h4qgbk1jd2jci-1\n  tools/events.d/nfslock         nfslock-20070601105340-vlcvnp6euoj3zdwy-2\n  tools/statd-callout            statdcallout-20070531010857-6sdlz455vusye5y5-1\n  web/ctdb.html                  ctdb.html-20070601052353-vgod9lfo4an4o83j-2\n    ------------------------------------------------------------\n    revno: 432.1.3\n    merged: sahlberg@ronnie-20070602065058-zorzcz56e16k4btv\n    parent: sahlberg@ronnie-20070602064415-xcc5lhkgz2von0qs\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Sat 2007-06-02 16:50:58 +1000\n    message:\n      fix broken link to the CTDB setup page\n    ------------------------------------------------------------\n    revno: 432.1.2\n    merged: sahlberg@ronnie-20070602064415-xcc5lhkgz2von0qs\n    parent: sahlberg@ronnie-20070602063317-ymvyqz9cvymmu2mr\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Sat 2007-06-02 16:44:15 +1000\n    message:\n      update the evens scripts for nfs and nfslock to honour CTDB_MANAGES_NFS \n      which is set in /etc/sysconfig/nfs\n    ------------------------------------------------------------\n    revno: 432.1.1\n    merged: sahlberg@ronnie-20070602063317-ymvyqz9cvymmu2mr\n    parent: tridge@samba.org-20070602033136-ojzzrsknaseuwiyq\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Sat 2007-06-02 16:33:17 +1000\n    message:\n      STATD_SHARED_DIRECTORY should be define din the nfs sysconfig file and \n      not the ctdb sysconfig file since this variable has nothing at all to do \n      with ctdb\n=== modified file 'tools/ctdb.sysconfig'\n--- a/tools/ctdb.sysconfig\t2007-06-02 01:36:42 +0000\n+++ b/tools/ctdb.sysconfig\t2007-06-02 06:33:17 +0000\n@@ -48,11 +48,6 @@\n # the default is 0\n # DEBUGLEVEL=0\n \n-# the shared directory where you want to put statd information on\n-# which clients to notify on a NFS restart\n-# there is no default\n-# STATD_SHARED_DIRECTORY=\"/some/shared/directory\"\n-\n # any other options you might want. Run ctdbd --help for a list\n # CTDB_OPTIONS=\n \n\n=== modified file 'tools/events.d/nfs'\n--- a/tools/events.d/nfs\t2007-06-01 14:10:22 +0000\n+++ b/tools/events.d/nfs\t2007-06-02 06:44:15 +0000\n@@ -1,15 +1,23 @@\n #!/bin/sh\n # script to manage nfs in a clustered environment\n \n-. /etc/sysconfig/ctdb\n+. /etc/sysconfig/nfs\n . /etc/ctdb/functions\n \n+[ -z $CTDB_MANAGES_NFS ] && exit 0\n+[ $CTDB_MANAGES_NFS != \"yes\" ] && exit 0\n+\n cmd=\"$1\"\n shift\n \n case $cmd in \n      startup)\n \tmkdir -p /etc/ctdb/state/nfs\n+\tservice nfs start\n+\t;;\n+\n+     shutdown)\n+\tservice nfs stop\n \t;;\n \n      releaseip)\n\n=== modified file 'tools/events.d/nfslock'\n--- a/tools/events.d/nfslock\t2007-06-01 11:20:05 +0000\n+++ b/tools/events.d/nfslock\t2007-06-02 06:44:15 +0000\n@@ -1,18 +1,23 @@\n #!/bin/sh\n # event strict to manage lockd and statd in a cluster environment\n \n-. /etc/sysconfig/ctdb\n+. /etc/sysconfig/nfs\n . /etc/ctdb/functions\n \n+[ -z $CTDB_MANAGES_NFS ] && exit 0\n+[ $CTDB_MANAGES_NFS != \"yes\" ] && exit 0\n+\n cmd=\"$1\"\n shift\n \n case $cmd in \n      startup)\n \t/bin/mkdir -p /etc/ctdb/state/statd/ip\n+\tservice nfslock start\n \t;;\n \n      shutdown)\n+\tservice nfslock stop\n \t;;\n \n      takeip)\n\n=== modified file 'tools/statd-callout'\n--- a/tools/statd-callout\t2007-06-01 13:25:33 +0000\n+++ b/tools/statd-callout\t2007-06-02 06:33:17 +0000\n@@ -3,7 +3,7 @@\n # this script needs to be installed so that statd points to it with the -H \n # command line argument. The easiest way to do that is \n \n-. /etc/sysconfig/ctdb\n+. /etc/sysconfig/nfs\n \n [ -z \"$STATD_SHARED_DIRECTORY\" ] && exit 0\n \n\n=== modified file 'web/ctdb.html'\n--- a/web/ctdb.html\t2007-06-01 07:16:19 +0000\n+++ b/web/ctdb.html\t2007-06-02 06:50:58 +0000\n@@ -13,7 +13,7 @@\n It is the core component for samba3/4 clustering.\n \n To get started with ctdb, I would recommend you read the ctdb wiki.\n+href=\"http://wiki.samba.org/index.php/CTDB_Setup\">the ctdb wiki.\n \n Discussion and bug reports\n"}