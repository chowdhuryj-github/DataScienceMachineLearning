{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "Jelmer Vernooij <jelmer@samba.org>", "subject": "Rev 11920: Simple refactoring. in\n\tfile:///home/jelmer/bzr.samba/SAMBA_4_0/", "body": "At file:///home/jelmer/bzr.samba/SAMBA_4_0/\n\n------------------------------------------------------------\nrevno: 11920\nrevision-id: jelmer@samba.org-20070419005219-xhzck81g2odsayyq\nparent: svn-v2:22346@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0\ncommitter: Jelmer Vernooij \nbranch nick: SAMBA_4_0\ntimestamp: Thu 2007-04-19 02:52:19 +0200\nmessage:\n  Simple refactoring.\nmodified:\n  source/script/tests/selftest.pl svn-v2:20693@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fscript%2ftests%2fselftest.pl\n=== modified file 'source/script/tests/selftest.pl'\n--- a/source/script/tests/selftest.pl\t2007-04-18 14:43:05 +0000\n+++ b/source/script/tests/selftest.pl\t2007-04-19 00:52:19 +0000\n@@ -672,6 +672,12 @@\n \tdelete $running_envs{$envname};\n }\n \n+my $msg_ops;\n+if ($from_build_farm) {\n+\t$msg_ops = $buildfarm_msg_ops;\n+} else {\n+\t$msg_ops = $plain_msg_ops;\n+}\n \n if ($opt_testenv) {\n \tmy $testenv_vars = setup_env(\"dc\");\n@@ -708,12 +714,8 @@\n \t\tmy $pcap_file = \"$pcap_dir/$shname.cap\";\n \n \t\tSocketWrapper::setup_pcap($pcap_file) if ($opt_socket_wrapper_pcap);\n-\t\tmy $result;\n-\t\tif ($from_build_farm) {\n-\t\t\t$result = run_test($envname, $name, $cmd, $i, $suitestotal, $buildfarm_msg_ops);\n-\t\t} else {\n-\t\t\t$result = run_test($envname, $name, $cmd, $i, $suitestotal, $plain_msg_ops);\n-\t\t}\n+\t\tmy $result = run_test($envname, $name, $cmd, $i, $suitestotal, \n+\t\t\t\t\t\t\t  $msg_ops);\n \n \t\tif ($opt_socket_wrapper_pcap and $result and \n \t\t\tnot $opt_socket_wrapper_keep_pcap) {\n@@ -738,7 +740,8 @@\n my $duration = ($end-$start);\n my $numfailed = $#$suitesfailed+1;\n if ($numfailed == 0) {\n-\tmy $ok = $statistics->{TESTS_EXPECTED_OK} + $statistics->{TESTS_EXPECTED_FAIL};\n+\tmy $ok = $statistics->{TESTS_EXPECTED_OK} + \n+\t         $statistics->{TESTS_EXPECTED_FAIL};\n \tprint \"ALL OK ($ok tests in $statistics->{SUITES_OK} testsuites)\\n\";\n } else {\n \tunless ($from_build_farm) {\n\n"}