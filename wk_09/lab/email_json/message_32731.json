{"category": "ham", "to_address": "ronggui <ronggui.huang@gmail.com>", "from_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "subject": "Re: [R] What's wrong with my code ?", "body": "I have not checked your code but that error can stem from an incorrect\ngradient.\n\nOn 5/19/07, ronggui  wrote:\n> I try to code the ULS factor analysis descrbied in\n> ftp://ftp.spss.com/pub/spss/statistics/spss/algorithms/ factor.pdf\n> # see PP5-6\n>\n> factanal.fit.uls <- function(cmat, factors, start=NULL, lower = 0.005,\n> control = NULL, ...)\n> {\n>  FAfn <- function(Psi, S, q)\n>  {\n>    Sstar <- S - diag(Psi)\n>    E <- eigen(Sstar, symmetric = TRUE, only.values = TRUE)\n>    e <- E$values[-(1:q)]\n>    e <- sum(e^2/2)\n>    e\n>  }\n>\n>  FAgr <- function(Psi, S, q)\n>  {\n>    Sstar <- S - diag(Psi)\n>    E <- eigen(Sstar, symmetric = TRUE)\n>    L <- E$vectors[, -(1:q), drop = FALSE]\n>    e <- E$values[-(1:q)]\n>    gr <- 2*Psi*((L^2)%*%e)\n>    gr\n>  }\n>\n>  p <- ncol(cmat)\n>  if(is.null(start))\n>    start <- (1 - 0.5*factors/p)/diag(solve(cmat))\n>  res <- optim(start, FAfn,\n>                 FAgr,\n>          method=\"L-BFGS-B\",\n>          lower = lower, upper = 1,\n>          control = c(list(fnscale=1,\n>          parscale = rep(0.01, length(start))), control),\n>          q = factors, S = cmat)\n> res\n> }\n>\n> covmat <-\n> structure(c(1, 0.0920030858518061, 0.053952442382614, -0.0380048634941013,\n> 0.237986469993129, 0.243144461077282, 0.0920030858518061, 1,\n> 0.328163804480881, 0.142002180914605, -0.139369611642031, -0.0670944471678571,\n> 0.053952442382614, 0.328163804480881, 1, 0.267648727315665, -0.0549987508157441,\n> -0.107488501744669, -0.0380048634941013, 0.142002180914605, 0.267648727315665,\n> 1, -0.0566976575082817, -0.132943658387513, 0.237986469993129,\n> -0.139369611642031, -0.0549987508157441, -0.0566976575082817,\n> 1, 0.352367996102745, 0.243144461077282, -0.0670944471678571,\n> -0.107488501744669, -0.132943658387513, 0.352367996102745, 1), .Dim = c(6L,\n> 6L), .Dimnames = list(c(\"bg2cost1\", \"bg2cost2\", \"bg2cost3\", \"bg2cost4\",\n> \"bg2cost5\", \"bg2cost6\"), c(\"bg2cost1\", \"bg2cost2\", \"bg2cost3\",\n> \"bg2cost4\", \"bg2cost5\", \"bg2cost6\")))\n>\n>\n> > factanal.fit.uls(covmat,2)\n> $par\n> bg2cost1 bg2cost2 bg2cost3 bg2cost4 bg2cost5 bg2cost6\n> 0.7454829 0.7191459 0.6969019 0.7611750 0.6940870 0.6930580\n>\n> $value\n> [1] 0.02167674\n>\n> $counts\n> function gradient\n>    21     21\n>\n> $convergence\n> [1] 52\n>\n> $message\n> [1] \"ERROR: ABNORMAL_TERMINATION_IN_LNSRCH\"\n>\n> --\n> Ronggui Huang\n> Department of Sociology\n> Fudan University, Shanghai, China\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}