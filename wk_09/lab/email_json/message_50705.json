{"category": "ham", "to_address": "beginners@perl.org", "from_address": "Matt <mlist@cmcflex.com>", "subject": "Re: find2perl output to array", "body": "Rob Dixon wrote:\n> Matt wrote:\n>> Thanks Martin,\n>>> change following line:\n>>>  \n>>>>     (($dev,$ino,$mode,$nlink,$uid,$gid) = lstat($_)) && -f _ && \n>>>> /^DATA.*\\.zip\\z/s && print(\"$name\\n\");\n>>>>     \n>>>\n>>> to\n>>>\n>>>  \n>>>>     (($dev,$ino,$mode,$nlink,$uid,$gid) = lstat($_)) && -f _ && \n>>>> /^DATA.*\\.zip\\z/s && push @files, $name;\n>>>>     \n>>>\n>>> at the end you have all files in the @files array.\n>>>\n>>>   \n>>\n>> I did that, and then at the bottom of the script I tried looping \n>> through just to verify that @files was populated - no dice.\n>>\n>> use vars qw/*name *dir *prune/;\n>> *name   = *File::Find::name;\n>> *dir    = *File::Find::dir;\n>> *prune  = *File::Find::prune;\n>>\n>> sub wanted;\n>>\n>> $smallcuid = lc $cuid;\n>>\n>> # Traverse desired filesystems\n>> File::Find::find({wanted => \\&wanted}, \n>> '/home/ftpuser/'.$smallcuid.'/flexvault/'.$directory.'/');\n>> exit;\n>>\n>>\n>> sub wanted {\n>>    my ($dev,$ino,$mode,$nlink,$uid,$gid);\n>>\n>> (($dev,$ino,$mode,$nlink,$uid,$gid) = lstat($_)) && -f _ && \n>> /^DATA.*\\.zip\\z/s && push @files, name;\n>> }\n>>\n>> for $element (@files) {\n>>       print $element, \"\\n\";\n>> }\n>>\n>>\n>>\n>> What have I done wrong?  Although if I put that for loop within the \n>> function it does populate, but it repeats each results 6 times.\n>\n> It's not displaying the contents of the array becuase you have a\n> call to exit before the loop.\n>\n> It's repeating several times because your wanted() subroutine is called\n> for every file and directory.\n>\n> The code you have published will put 'name' into @files several times,\n> and doesn't show the origin of $cuid or directory.\n>\n> Something like the code below should work.\n>\n> HTH,\n>\n> Rob\n>\n>\n> use strict;\n> use warnings;\n>\n> use File::Find;\n>\n> my ($cuid, $smallcuid);\n> my $directory;\n> my @files;\n>\n> find(\\&wanted, \"/home/ftpuser/$smallcuid/flexvault/$directory/\");\n>\n> print \"$_\\n\" foreach @files;\n>\n> sub wanted {\n>  push @files, $File::Find::name if -f and /^DATA.*\\.zip\\z/s;\n> }\n>\n>\n>\nAhh, very good.  Thanks Rob (and Martin from earlier).  I think I \nunderstand now.  It calls the wanted sub routine, populates the @files \narray for each iteration.  Then when that completes the contents of the \narray @files are printed. . .?\n\nMatt\n\n-- \nTo unsubscribe, e-mail: beginners-unsubscribe@perl.org\nFor additional commands, e-mail: beginners-help@perl.org\nhttp://learn.perl.org/\n\n\n"}