{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23565 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_25/source/nsswitch SAMBA_3_0_26/source/nsswitch", "body": "Author: gd\nDate: 2007-06-21 14:04:55 +0000 (Thu, 21 Jun 2007)\nNew Revision: 23565\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23565\n\nLog:\nAvoid double NULL pointer checks.\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_cm.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\n   branches/SAMBA_3_0_25/source/nsswitch/winbindd_cm.c\n   branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_cm.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_cm.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_cm.c\t2007-06-21 13:05:56 UTC (rev 23564)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_cm.c\t2007-06-21 14:04:55 UTC (rev 23565)\n@@ -258,9 +258,7 @@\n \t\t  \"%s (online = %s)\\n\", domain->name, \n \t\t  domain->online ? \"True\" : \"False\" ));\n \n-\tif (domain->check_online_event) {\n-\t\tTALLOC_FREE(domain->check_online_event);\n-\t}\n+\tTALLOC_FREE(domain->check_online_event);\n \n \t/* Are we still in \"startup\" mode ? */\n \n@@ -312,9 +310,7 @@\n \tDEBUG(10,(\"set_domain_offline: called for domain %s\\n\",\n \t\tdomain->name ));\n \n-\tif (domain->check_online_event) {\n-\t\tTALLOC_FREE(domain->check_online_event);\n-\t}\n+\tTALLOC_FREE(domain->check_online_event);\n \n \tif (domain->internal) {\n \t\tDEBUG(3,(\"set_domain_offline: domain %s is internal - logic error.\\n\",\n@@ -426,9 +422,7 @@\n \n \t/* Ensure we have no online timeout checks. */\n \tdomain->check_online_timeout = 0;\n-\tif (domain->check_online_event) {\n-\t\tTALLOC_FREE(domain->check_online_event);\n-\t}\n+\tTALLOC_FREE(domain->check_online_event);\n \n \t/* Ensure we ignore any pending child messages. */\n \tmessaging_deregister(winbind_messaging_context(),\n\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\t2007-06-21 13:05:56 UTC (rev 23564)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\t2007-06-21 14:04:55 UTC (rev 23565)\n@@ -248,9 +248,7 @@\n \t\ttalloc_get_type_abort(private_data, struct winbindd_async_request);\n \tstruct winbindd_child *child = state->child;\n \n-\tif (state->reply_timeout_event) {\n-\t\tTALLOC_FREE(state->reply_timeout_event);\n-\t}\n+\tTALLOC_FREE(state->reply_timeout_event);\n \n \tstate->response->length = sizeof(struct winbindd_response);\n \n@@ -736,9 +734,7 @@\n \n \tDEBUG(10,(\"account_lockout_policy_handler called\\n\"));\n \n-\tif (child->lockout_policy_event) {\n-\t\tTALLOC_FREE(child->lockout_policy_event);\n-\t}\n+\tTALLOC_FREE(child->lockout_policy_event);\n \n \tif ( !winbindd_can_contact_domain( child->domain ) ) {\n \t\tDEBUG(10,(\"account_lockout_policy_handler: Removing myself since I \"\n@@ -1016,9 +1012,7 @@\n \n \tfor (domain = domain_list(); domain; domain = domain->next) {\n \t\tif (domain != child->domain) {\n-\t\t\tif (domain->check_online_event) {\n-\t\t\t\tTALLOC_FREE(domain->check_online_event);\n-\t\t\t}\n+\t\t\tTALLOC_FREE(domain->check_online_event);\n \t\t}\n \t}\n \n\nModified: branches/SAMBA_3_0_25/source/nsswitch/winbindd_cm.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/winbindd_cm.c\t2007-06-21 13:05:56 UTC (rev 23564)\n+++ branches/SAMBA_3_0_25/source/nsswitch/winbindd_cm.c\t2007-06-21 14:04:55 UTC (rev 23565)\n@@ -249,9 +249,7 @@\n \tDEBUG(10,(\"check_domain_online_handler: called for domain %s\\n\",\n \t\tdomain->name ));\n \n-\tif (domain->check_online_event) {\n-\t\tTALLOC_FREE(domain->check_online_event);\n-\t}\n+\tTALLOC_FREE(domain->check_online_event);\n \n \t/* Are we still in \"startup\" mode ? */\n \n@@ -303,9 +301,7 @@\n \tDEBUG(10,(\"set_domain_offline: called for domain %s\\n\",\n \t\tdomain->name ));\n \n-\tif (domain->check_online_event) {\n-\t\tTALLOC_FREE(domain->check_online_event);\n-\t}\n+\tTALLOC_FREE(domain->check_online_event);\n \n \tif (domain->internal) {\n \t\tDEBUG(3,(\"set_domain_offline: domain %s is internal - logic error.\\n\",\n@@ -400,9 +396,7 @@\n \n \t/* Ensure we have no online timeout checks. */\n \tdomain->check_online_timeout = 0;\n-\tif (domain->check_online_event) {\n-\t\tTALLOC_FREE(domain->check_online_event);\n-\t}\n+\tTALLOC_FREE(domain->check_online_event);\n \n \t/* Ensure we ignore any pending child messages. */\n \tmessage_deregister(MSG_WINBIND_TRY_TO_GO_ONLINE);\n\nModified: branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\t2007-06-21 13:05:56 UTC (rev 23564)\n+++ branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\t2007-06-21 14:04:55 UTC (rev 23565)\n@@ -248,9 +248,7 @@\n \t\ttalloc_get_type_abort(private_data, struct winbindd_async_request);\n \tstruct winbindd_child *child = state->child;\n \n-\tif (state->reply_timeout_event) {\n-\t\tTALLOC_FREE(state->reply_timeout_event);\n-\t}\n+\tTALLOC_FREE(state->reply_timeout_event);\n \n \tstate->response->length = sizeof(struct winbindd_response);\n \n@@ -713,9 +711,7 @@\n \n \tDEBUG(10,(\"account_lockout_policy_handler called\\n\"));\n \n-\tif (child->lockout_policy_event) {\n-\t\tTALLOC_FREE(child->lockout_policy_event);\n-\t}\n+\tTALLOC_FREE(child->lockout_policy_event);\n \n \tmethods = child->domain->methods;\n \n@@ -962,9 +958,7 @@\n \n \tfor (domain = domain_list(); domain; domain = domain->next) {\n \t\tif (domain != child->domain) {\n-\t\t\tif (domain->check_online_event) {\n-\t\t\t\tTALLOC_FREE(domain->check_online_event);\n-\t\t\t}\n+\t\t\tTALLOC_FREE(domain->check_online_event);\n \t\t}\n \t}\n \n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_cm.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_cm.c\t2007-06-21 13:05:56 UTC (rev 23564)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_cm.c\t2007-06-21 14:04:55 UTC (rev 23565)\n@@ -258,9 +258,7 @@\n \t\t  \"%s (online = %s)\\n\", domain->name, \n \t\t  domain->online ? \"True\" : \"False\" ));\n \n-\tif (domain->check_online_event) {\n-\t\tTALLOC_FREE(domain->check_online_event);\n-\t}\n+\tTALLOC_FREE(domain->check_online_event);\n \n \t/* Are we still in \"startup\" mode ? */\n \n@@ -312,9 +310,7 @@\n \tDEBUG(10,(\"set_domain_offline: called for domain %s\\n\",\n \t\tdomain->name ));\n \n-\tif (domain->check_online_event) {\n-\t\tTALLOC_FREE(domain->check_online_event);\n-\t}\n+\tTALLOC_FREE(domain->check_online_event);\n \n \tif (domain->internal) {\n \t\tDEBUG(3,(\"set_domain_offline: domain %s is internal - logic error.\\n\",\n@@ -426,9 +422,7 @@\n \n \t/* Ensure we have no online timeout checks. */\n \tdomain->check_online_timeout = 0;\n-\tif (domain->check_online_event) {\n-\t\tTALLOC_FREE(domain->check_online_event);\n-\t}\n+\tTALLOC_FREE(domain->check_online_event);\n \n \t/* Ensure we ignore any pending child messages. */\n \tmessaging_deregister(winbind_messaging_context(),\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\t2007-06-21 13:05:56 UTC (rev 23564)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\t2007-06-21 14:04:55 UTC (rev 23565)\n@@ -248,9 +248,7 @@\n \t\ttalloc_get_type_abort(private_data, struct winbindd_async_request);\n \tstruct winbindd_child *child = state->child;\n \n-\tif (state->reply_timeout_event) {\n-\t\tTALLOC_FREE(state->reply_timeout_event);\n-\t}\n+\tTALLOC_FREE(state->reply_timeout_event);\n \n \tstate->response->length = sizeof(struct winbindd_response);\n \n@@ -736,9 +734,7 @@\n \n \tDEBUG(10,(\"account_lockout_policy_handler called\\n\"));\n \n-\tif (child->lockout_policy_event) {\n-\t\tTALLOC_FREE(child->lockout_policy_event);\n-\t}\n+\tTALLOC_FREE(child->lockout_policy_event);\n \n \tif ( !winbindd_can_contact_domain( child->domain ) ) {\n \t\tDEBUG(10,(\"account_lockout_policy_handler: Removing myself since I \"\n@@ -1016,9 +1012,7 @@\n \n \tfor (domain = domain_list(); domain; domain = domain->next) {\n \t\tif (domain != child->domain) {\n-\t\t\tif (domain->check_online_event) {\n-\t\t\t\tTALLOC_FREE(domain->check_online_event);\n-\t\t\t}\n+\t\t\tTALLOC_FREE(domain->check_online_event);\n \t\t}\n \t}\n \n\n"}