{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22667 - in\n\tbranches/SAMBA_4_0/source/pidl/lib/Parse/Pidl/Samba4: .", "body": "Author: metze\nDate: 2007-05-04 10:44:41 +0000 (Fri, 04 May 2007)\nNew Revision: 22667\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22667\n\nLog:\nrevert revision 22640 as it breaks nested structs in idl\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/pidl/lib/Parse/Pidl/Samba4/Header.pm\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/pidl/lib/Parse/Pidl/Samba4/Header.pm\n===================================================================\n--- branches/SAMBA_4_0/source/pidl/lib/Parse/Pidl/Samba4/Header.pm\t2007-05-04 10:21:39 UTC (rev 22666)\n+++ branches/SAMBA_4_0/source/pidl/lib/Parse/Pidl/Samba4/Header.pm\t2007-05-04 10:44:41 UTC (rev 22667)\n@@ -43,7 +43,7 @@\n \t}\n \n \tif ($ret) {\n-\t\tpidl \" /* [\" . substr($ret, 0, -1) . \"] */\";\n+\t\tpidl \"/* [\" . substr($ret, 0, -1) . \"] */\";\n \t}\n }\n \n@@ -108,12 +108,10 @@\n \t    pidl tabs().\"char _empty_;\\n\";\n     }\n     $tab_depth--;\n-\n-    pidl \"};\";\n+    pidl tabs().\"}\";\n \tif (defined $struct->{PROPERTIES}) {\n \t\tHeaderProperties($struct->{PROPERTIES}, []);\n \t}\n-    pidl \"\\n\\n\";\n }\n \n #####################################################################\n@@ -134,10 +132,10 @@\n \t}\n \tpidl \"\\n\";\n \t$tab_depth--;\n-\tpidl \"};\\n\";\n+\tpidl \"}\\n\";\n \tpidl \"#else\\n\";\n \tmy $count = 0;\n-\tpidl \"enum $name { __donnot_use_enum_$name=0x7FFFFFFF};\\n\";\n+\tpidl \"enum $name { __donnot_use_enum_$name=0x7FFFFFFF}\\n\";\n \tmy $with_val = 0;\n \tmy $without_val = 0;\n \tforeach my $e (@{$enum->{ELEMENTS}}) {\n@@ -193,12 +191,11 @@\n \t\t}\n \t}\n \t$tab_depth--;\n+\tpidl \"}\";\n \n-\tpidl \"};\";\n \tif (defined $union->{PROPERTIES}) {\n \t\tHeaderProperties($union->{PROPERTIES}, []);\n \t}\n-\tpidl \"\\n\\n\";\n }\n \n #####################################################################\n@@ -300,7 +297,7 @@\n \t    HeaderFunctionInOut($fn, \"in\");\n \t    HeaderFunctionInOut($fn, \"inout\");\n \t    $tab_depth--;\n-\t    pidl tabs().\"} in;\\n\";\n+\t    pidl tabs().\"} in;\\n\\n\";\n \t    $needed++;\n     }\n \n@@ -314,7 +311,7 @@\n \t\t    pidl tabs().mapTypeName($fn->{RETURN_TYPE}) . \" result;\\n\";\n \t    }\n \t    $tab_depth--;\n-\t    pidl tabs().\"} out;\\n\";\n+\t    pidl tabs().\"} out;\\n\\n\";\n \t    $needed++;\n     }\n \n@@ -365,6 +362,11 @@\n \t\tHeaderUnion($d, $d->{NAME}) if ($d->{TYPE} eq \"UNION\");\n \t\tHeaderEnum($d, $d->{NAME}) if ($d->{TYPE} eq \"ENUM\");\n \t\tHeaderBitmap($d, $d->{NAME}) if ($d->{TYPE} eq \"BITMAP\");\n+\t\tpidl \";\\n\\n\" if ($d->{TYPE} eq \"BITMAP\" or \n+\t\t\t             $d->{TYPE} eq \"STRUCT\" or \n+\t\t\t\t\t\t $d->{TYPE} eq \"TYPEDEF\" or \n+\t\t\t\t\t\t $d->{TYPE} eq \"UNION\" or \n+\t\t\t\t\t\t $d->{TYPE} eq \"ENUM\");\n \t}\n \n \tforeach my $d (@{$interface->{DATA}}) {\n\n"}