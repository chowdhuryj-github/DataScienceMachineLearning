{"category": "ham", "to_address": "Todd Stecher <todd.stecher@isilon.com>", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: Problem with DELETE_ON_CLOSE open_file_ntcreate()?", "body": "On Tue, Jun 19, 2007 at 10:51:04AM -0700, Todd Stecher wrote:\n> We're running 3.0.24.\n> \n> Here's the scenario:\n> \n> *\tA file exists on our share\n> * \tAn XP client opens the file:\n> \tCreateFile(file, DELETE, 0, NULL, OPEN_EXISTING, DELETE_ON_CLOSE)  \n> api) with DELETE_ON_CLOSE (only 1 opener of file)\n> \n> * \tThe file handle is closed, the file is NOT deleted.\n> \n> I'm hesitant to \"fix\" this (e.g. set the lock->delete_on_close bit  \n> when we see the FILE_DELETE_ON_CLOSE option), because there might be  \n> some subtlety I'm missing here.  It also appears that Jeremy's been  \n> doing a lot of work in this area (so maybe its a TODO?).  Upgrading  \n> to a newer version of Samba is not an option, but if there's a one  \n> line fix I'm missing, that'd be great.  If its just an oversite, I'll  \n> submit a patch.\n\nHave you tested the 3.0.25b codebase (SAMBA_3_0_25 branch) ?\n\nI'm pretty sure I've fixed this for 3.0.25b. Look into\nthe flag I added SHARE_MODE_ALLOW_INITIAL_DELETE_ON_CLOSE,\nwhich is now set as the last parameter in the set_share_mode()\ncall.\n\nJeremy.\n\n"}