{"category": "ham", "to_address": "\"Raymond Wan\" <rwan@kuicr.kyoto-u.ac.jp>, <r-help@stat.math.ethz.ch>", "from_address": "\"Mendiburu, Felipe \\(CIP\\)\" <F.MENDIBURU@CGIAR.ORG>", "subject": "Re: [R] R's Spearman", "body": "Dear Ray,\n\nThe R's Spearman calculated by R is correct for ties or nonties, which is not correct is the probability for the case of ties. I send to you formulates it for the correlation with ties, that is equal to R. \n\nRegards,\n\nFelipe de Mendiburu\nStatistician\n\n\n# Spearman correlation \"rs\" with ties or no ties\nrs<-function(x,y) {\nd<-rank(x)-rank(y)\ntx<-as.numeric(table(x))\nty<-as.numeric(table(y))\nLx<-sum((tx^3-tx)/12)\nLy<-sum((ty^3-ty)/12)\nN<-length(x)\nSX2<- (N^3-N)/12 - Lx\nSY2<- (N^3-N)/12 - Ly\nrs<- (SX2+SY2-sum(d^2))/(2*sqrt(SX2*SY2))\nreturn(rs)\n}\n\n# Aplicacion\n> cor(y[,1],y[,2],method=\"spearman\")\n[1] 0.2319084\n> rs(y[,1],y[,2])\n[1] 0.2319084\n\n\n\n-----Original Message-----\nFrom: r-help-bounces@stat.math.ethz.ch\n[mailto:r-help-bounces@stat.math.ethz.ch]On Behalf Of Raymond Wan\nSent: Monday, May 28, 2007 10:29 PM\nTo: r-help@stat.math.ethz.ch\nSubject: [R] R's Spearman\n\n\n\nHi all,\n\nI am trying to figure out the formula used by R's Spearman rho (using \ncor(method=\"spearman\")) because I can't seem to get the same value as by \ncalculating \"by hand\".  Perhaps I'm using \"cor\" wrong, but I don't know \nwhere.  Basically, I am running these commands:\n\n > y=read.table(file=\"tmp\",header=TRUE,sep=\"\\t\")\n > y\n   IQ Hours\n1 106     7\n2  86     0\n3  97    20\n4 113    12\n5 120    12\n6 110    17\n > cor(y[1],y[2],method=\"spearman\")\n       Hours\nIQ 0.2319084\n\n[it's an abbreviated example of one I took from Wikipedia].  I \ncalculated by hand (apologies if the table looks strange when pasted \ninto e-mail):\n\n      IQ    Hours    rank(IQ)  rank(hours)    diff    diff^2\n1    106    7        3         2                 1    1\n2     86    0        1         1                 0    0\n3     97    20       2         6                -4    16\n4    113    12       5         3.5             1.5    2.25\n5    120    12       6         3.5             2.5    6.25\n6    110    17       4         5                -1    1\n                                                      26.5\n                           \n                                              rho=    0.242857\n\nwhere rho = (1 - ((6 * 26.5) / 6 * (6^2 - 1))).  I kept modifying the \ntable and realized that the difference in result comes from ties.  i.e., \nif I remove the tie in rows 4 and 5, I get the same result from both cor \nand calculating by hand.  Perhaps I'm handling ties wrong...does anyone \nknow how R does it or perhaps I need to change how I'm using it?\n\nThank you!\n\nRay\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}