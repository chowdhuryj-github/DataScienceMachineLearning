{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22536 - in branches/SAMBA_4_0/source/libnet: .", "body": "Author: metze\nDate: 2007-04-27 14:31:26 +0000 (Fri, 27 Apr 2007)\nNew Revision: 22536\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22536\n\nLog:\nresolve name before passing to cldap\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/libnet/libnet_site.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/libnet/libnet_site.c\n===================================================================\n--- branches/SAMBA_4_0/source/libnet/libnet_site.c\t2007-04-27 14:23:08 UTC (rev 22535)\n+++ branches/SAMBA_4_0/source/libnet/libnet_site.c\t2007-04-27 14:31:26 UTC (rev 22536)\n@@ -24,6 +24,7 @@\n #include \"lib/ldb/include/ldb.h\"\n #include \"lib/ldb/include/ldb_errors.h\"\n #include \"librpc/rpc/dcerpc.h\"\n+#include \"libcli/resolve/resolve.h\"\n \n /*\n  * 1. Setup a CLDAP socket.\n@@ -128,6 +129,8 @@\n \n \tconst char *server_dn_str;\n \tconst char *config_dn_str;\n+\tstruct nbt_name name;\n+\tconst char *dest_addr = NULL;\n \n \ttmp_ctx = talloc_named(libnet_r, 0, \"libnet_JoinSite temp context\");\n \tif (!tmp_ctx) {\n@@ -142,8 +145,16 @@\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \n+\tmake_nbt_name_client(&name, libnet_r->out.samr_binding->host);\n+\tstatus = resolve_name(&name, r, &dest_addr, NULL);\n+\tif (!NT_STATUS_IS_OK(status)) {\n+\t\tlibnet_r->out.error_string = NULL;\n+\t\ttalloc_free(tmp_ctx);\n+\t\treturn status;\n+\t}\n+\n \t/* Resolve the site name and AD DN's. */\n-\tr->in.dest_address = libnet_r->out.samr_binding->host;\n+\tr->in.dest_address = dest_addr;\n \tr->in.netbios_name = libnet_r->in.netbios_name;\n \tr->in.domain_dn_str = libnet_r->out.domain_dn_str;\n \n@@ -152,7 +163,7 @@\n \t\tlibnet_r->out.error_string =\n \t\t\ttalloc_steal(libnet_r, r->out.error_string);\n \t\ttalloc_free(tmp_ctx);\n-\t\treturn NT_STATUS_NO_MEMORY;\n+\t\treturn status;\n \t}\n \n \tconfig_dn_str = r->out.config_dn_str;\n\n"}