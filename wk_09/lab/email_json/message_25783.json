{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "mimir@samba.org", "subject": "svn commit: samba r22764 - in branches/SAMBA_4_0/source/libnet: .", "body": "Author: mimir\nDate: 2007-05-08 22:08:26 +0000 (Tue, 08 May 2007)\nNew Revision: 22764\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22764\n\nLog:\n- replace talloc_zero with composite_create\n- use event context provided with libnet context instead of creating\n  a new one\n\n\nrafal\n\n\nModified:\n   branches/SAMBA_4_0/source/libnet/libnet_lookup.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/libnet/libnet_lookup.c\n===================================================================\n--- branches/SAMBA_4_0/source/libnet/libnet_lookup.c\t2007-05-08 22:04:28 UTC (rev 22763)\n+++ branches/SAMBA_4_0/source/libnet/libnet_lookup.c\t2007-05-08 22:08:26 UTC (rev 22764)\n@@ -59,22 +59,14 @@\n \tconst char** methods;\n \n \t/* allocate context and state structures */\n-\tc = talloc_zero(NULL, struct composite_context);\n+\tc = composite_create(ctx, ctx->event_ctx);\n \tif (c == NULL) return NULL;\n \n \ts = talloc_zero(c, struct lookup_state);\n-\tif (s == NULL) {\n-\t\tcomposite_error(c, NT_STATUS_NO_MEMORY);\n-\t\treturn c;\n-\t}\n-\t\n-\t/* prepare event context */\n-\tc->event_ctx = event_context_find(c);\n-\tif (c->event_ctx == NULL) {\n-\t\tcomposite_error(c, NT_STATUS_NO_MEMORY);\n-\t\treturn c;\n-\t}\n+\tif (composite_nomem(s, c)) return c;\n \n+\tc->private_data\t= s;\n+\n \tif (io == NULL || io->in.hostname == NULL) {\n \t\tcomposite_error(c, NT_STATUS_INVALID_PARAMETER);\n \t\treturn c;\n@@ -92,14 +84,11 @@\n \t\tmethods = ctx->name_res_methods;\n \t}\n \n-\tc->private_data\t= s;\n-\tc->state\t= COMPOSITE_STATE_IN_PROGRESS;\n-\n \t/* send resolve request */\n \tcresolve_req = resolve_name_send(&s->hostname, c->event_ctx, methods);\n+\tif (composite_nomem(cresolve_req, c)) return c;\n \n \tcomposite_continue(c, cresolve_req, continue_name_resolved, c);\n-\n \treturn c;\n }\n \n\n"}