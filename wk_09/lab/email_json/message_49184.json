{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 593: fixed use of talloc_asprintf_append in\n\thttp://samba.org/~tridge/3_0-ctdb", "body": "------------------------------------------------------------\nrevno: 593\nrevision-id: tridge@samba.org-20070616174439-c1fqcwt8v32vu47e\nparent: tridge@samba.org-20070616153906-4nky8hi3amons61l\ncommitter: Andrew Tridgell \nbranch nick: s3-ctdb-tridge\ntimestamp: Sun 2007-06-17 03:44:39 +1000\nmessage:\n  fixed use of talloc_asprintf_append\nmodified:\n  source/modules/vfs_shadow_copy2.c vfs_shadow_copy2.c-20070616115727-8jw10u301cshsoqz-1\n=== modified file 'source/modules/vfs_shadow_copy2.c'\n--- a/source/modules/vfs_shadow_copy2.c\t2007-06-16 15:39:06 +0000\n+++ b/source/modules/vfs_shadow_copy2.c\t2007-06-16 17:44:39 +0000\n@@ -166,6 +166,7 @@\n {\n \tconst char *snapdir;\n \tchar *mount_point;\n+\tconst char *ret;\n \n \tsnapdir = lp_parm_const_string(SNUM(handle->conn), \"shadow\", \"snapdir\", NULL);\n \tif (snapdir == NULL) {\n@@ -182,7 +183,9 @@\n \t\treturn NULL;\n \t}\n \n-\treturn talloc_asprintf_append(mount_point, \"/%s\", snapdir);\n+\tret = talloc_asprintf(mem_ctx, \"%s/%s\", mount_point, snapdir);\n+\ttalloc_free(mount_point);\n+\treturn ret;\n }\n \n /*\n\n"}