{"category": "ham", "to_address": "davecb@spamcop.net", "from_address": "\"Mikhail T.\" <mi+metlife@aldan.algebra.com>", "subject": "Re: prs_uint32 applied to pointers?", "body": "David Collier-Brown wrote:\n>> The way things are now, it could be getting it wrong every once in a \n>> while, when the lower 32-bits of the pointer happen to be zeros. :-( \n>> How about:\n>>\n>>     uni_p = (fl3->path != NULL);\n>>\n>  That should work, even for the famous brain-dead Honeywell GCOS 6 MOD \n> 400 (;-))\nOk, the broken statement occurs in two places (do build with -Werror!).\nHere is the patch (mind the space/tab mangling):\n\n--- source/rpc_parse/parse_srv.c   Tue Mar 20 18:25:39 2007\n+++ source/rpc_parse/parse_srv.c   Thu May 17 09:41:19 2007\n@@ -2405,5 +2405,5 @@\n                return False;\n\n-       uni_p = fl3->path ? (uint32)fl3->path : 0;\n+       uni_p = fl3->path != NULL;\n        if(!prs_uint32(\"ptr\", ps, depth, &uni_p))\n                return False;\n@@ -2414,5 +2414,5 @@\n        }\n\n-       uni_p = fl3->user ? (uint32)fl3->user : 0;\n+       uni_p = fl3->path != NULL;\n        if(!prs_uint32(\"ptr\", ps, depth, &uni_p))\n                return False;\n\n\nThanks for all the advice. Yours,\n\n    -mi\n\n"}