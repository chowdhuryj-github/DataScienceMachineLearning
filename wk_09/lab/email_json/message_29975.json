{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jpeach@samba.org", "subject": "svn commit: samba r22879 - in branches/SAMBA_3_0/source: .", "body": "Author: jpeach\nDate: 2007-05-15 05:25:10 +0000 (Tue, 15 May 2007)\nNew Revision: 22879\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22879\n\nLog:\nTidy the build rules for targets that need the installation paths.\n\nModified:\n   branches/SAMBA_3_0/source/Makefile.in\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0/source/Makefile.in\t2007-05-15 04:28:20 UTC (rev 22878)\n+++ branches/SAMBA_3_0/source/Makefile.in\t2007-05-15 05:25:10 UTC (rev 22879)\n@@ -139,15 +139,19 @@\n FLAGS5 = $(FLAGS1) $(FLAGS2) $(FLAGS3) $(FLAGS4)\n FLAGS  = $(ISA) $(FLAGS5) -I$(srcdir)/lib -D_SAMBA_BUILD_=3\n \n-PASSWD_FLAGS = -DSMB_PASSWD_FILE=\\\"$(SMB_PASSWD_FILE)\\\" -DPRIVATE_DIR=\\\"$(PRIVATE_DIR)\\\"\n-PATH_FLAGS1 = -DCONFIGFILE=\\\"$(CONFIGFILE)\\\"  -DSBINDIR=\\\"$(SBINDIR)\\\"\n-PATH_FLAGS2 = $(PATH_FLAGS1) -DBINDIR=\\\"$(BINDIR)\\\"\n-PATH_FLAGS3 = $(PATH_FLAGS2) -DLMHOSTSFILE=\\\"$(LMHOSTSFILE)\\\"\n-PATH_FLAGS4 = $(PATH_FLAGS3) -DSWATDIR=\\\"$(SWATDIR)\\\"  -DLOCKDIR=\\\"$(LOCKDIR)\\\" -DPIDDIR=\\\"$(PIDDIR)\\\"\n-PATH_FLAGS5 = $(PATH_FLAGS4) -DLIBDIR=\\\"$(LIBDIR)\\\" \\\n-\t      -DLOGFILEBASE=\\\"$(LOGFILEBASE)\\\" -DSHLIBEXT=\\\"@SHLIBEXT@\\\"\n-PATH_FLAGS6 = $(PATH_FLAGS5) -DCONFIGDIR=\\\"$(CONFIGDIR)\\\"\n-PATH_FLAGS = $(PATH_FLAGS6) $(PASSWD_FLAGS)\n+PATH_FLAGS = -DSMB_PASSWD_FILE=\\\"$(SMB_PASSWD_FILE)\\\" \\\n+\t-DPRIVATE_DIR=\\\"$(PRIVATE_DIR)\\\" \\\n+\t-DCONFIGFILE=\\\"$(CONFIGFILE)\\\" \\\n+\t-DSBINDIR=\\\"$(SBINDIR)\\\" \\\n+\t-DBINDIR=\\\"$(BINDIR)\\\" \\\n+\t-DLMHOSTSFILE=\\\"$(LMHOSTSFILE)\\\" \\\n+\t-DSWATDIR=\\\"$(SWATDIR)\\\" \\\n+\t-DLOCKDIR=\\\"$(LOCKDIR)\\\" \\\n+\t-DPIDDIR=\\\"$(PIDDIR)\\\" \\\n+\t-DLIBDIR=\\\"$(LIBDIR)\\\" \\\n+      \t-DLOGFILEBASE=\\\"$(LOGFILEBASE)\\\" \\\n+\t-DSHLIBEXT=\\\"@SHLIBEXT@\\\" \\\n+\t-DCONFIGDIR=\\\"$(CONFIGDIR)\\\"\n \n # Note that all executable programs now provide for an optional executable suffix.\n \n@@ -1012,8 +1016,12 @@\n \t  mkdir \"$$dir\" || \\\n \t  exec false; fi || exec false\n \n+# Run a static checker.\n CHECK_CC = $(CC_CHECKER) -I. -I$(srcdir) $(FLAGS) $(PICFLAG) -c $< -o $@\n+# Compile a source file.\n COMPILE_CC = $(CC) -I. -I$(srcdir) $(FLAGS) $(PICFLAG) -c $< -o $@\n+# Compile a source file with the installation paths defined.\n+COMPILE_CC_PATH = $(CC) -I. -I$(srcdir) $(PATH_FLAGS) $(FLAGS) $(PICFLAG) -c $< -o $@\n \n COMPILE = $(COMPILE_CC)\n \n@@ -1069,22 +1077,31 @@\n \n dynconfig.o: dynconfig.c Makefile\n \t@echo Compiling $*.c\n-\t@$(CC) $(FLAGS) $(PATH_FLAGS) $(PICFLAG) -c $(srcdir)/dynconfig.c -o $@ && exit 0;\\\n+\t@$(COMPILE_CC_PATH) && exit 0;\\\n \t\techo \"The following command failed:\" 1>&2;\\\n-\t\techo \"$(CC) $(FLAGS) $(PATH_FLAGS) $(PICFLAG) -c $(srcdir)/dynconfig.c -o $@\" 1>&2;\\\n-\t\t$(CC) $(FLAGS) $(PATH_FLAGS) $(PICFLAG) -c $(srcdir)/dynconfig.c -o $@ >/dev/null 2>&1\n+\t\techo \"$(COMPILE_CC_PATH)\" 1>&2;\\\n+\t\t$(COMPILE_CC_PATH) >/dev/null 2>&1\n \n lib/pidfile.o: lib/pidfile.c\n \t@echo Compiling $*.c\n-\t@$(CC) -I. -I$(srcdir) $(FLAGS) $(PATH_FLAGS) $(PICFLAG) -c $(srcdir)/lib/pidfile.c -o $@\n+\t@$(COMPILE_CC_PATH) && exit 0;\\\n+\t\techo \"The following command failed:\" 1>&2;\\\n+\t\techo \"$(COMPILE_CC_PATH)\" 1>&2;\\\n+\t\t$(COMPILE_CC_PATH) >/dev/null 2>&1\n \n lib/version.o: lib/version.c include/version.h\n \t@echo Compiling $*.c\n-\t@$(CC) -I. -I$(srcdir) $(FLAGS) $(PATH_FLAGS) $(PICFLAG) -c $(srcdir)/lib/version.c -o $@\n+\t@$(COMPILE_CC_PATH) && exit 0;\\\n+\t\techo \"The following command failed:\" 1>&2;\\\n+\t\techo \"$(COMPILE_CC_PATH)\" 1>&2;\\\n+\t\t$(COMPILE_CC_PATH) >/dev/null 2>&1\n \n smbd/build_options.o: smbd/build_options.c Makefile include/config.h include/build_env.h include/proto.h\n \t@echo Compiling $*.c\n-\t@$(CC) $(FLAGS) $(PATH_FLAGS) $(PICFLAG) -c smbd/build_options.c -o $@\n+\t@$(COMPILE_CC_PATH) && exit 0;\\\n+\t\techo \"The following command failed:\" 1>&2;\\\n+\t\techo \"$(COMPILE_CC_PATH)\" 1>&2;\\\n+\t\t$(COMPILE_CC_PATH) >/dev/null 2>&1\n \n smbd/build_options.c: include/config.h.in script/mkbuildoptions.awk\n \t@echo Generating $@\n\n"}