{"category": "ham", "to_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "from_address": "\"Alfonso Sammassimo\" <cincinattikid@bigpond.com>", "subject": "Re: [R] Help on manipulating a data frame", "body": "Thankyou for your reply Gabor.\n\n\n\nYour code helped me get started in creating id for each week of month. What \nI'm really looking for though is a more general application where I can \nextract each final week of the month conditional on the pattern of values \n(simply plus or minus signs) of the weeks preceding it in that month (i \ndidnt really explain that in my previous post).\n\nFor example, with the data below:\n\n\n\n                    Date              Value         Sign Week\n\n2005-02.4   2005-02-04  1.67427972    1    1\n\n2005-02.5   2005-02-11  0.00000000    0    2\n\n2005-02.6   2005-02-18  0.14221382    1    3\n\n2005-02.7   2005-02-25 -0.85633254   -1    4\n\n2005-03.8   2005-03-04  2.22073856    1    1\n\n2005-03.9   2005-03-11 -0.07011803   -1    2\n\n2005-03.10  2005-03-18  1.00035730    1    3\n\n2005-03.11  2005-03-25 -2.48430869   -1    4\n\n2005-04.12  2005-04-01 -0.04747211   -1    1\n\n2005-04.13  2005-04-08  0.18975338    1    2\n\n2005-04.14  2005-04-15 -3.54552994   -1    3\n\n2005-04.15  2005-04-22  0.51426586    1    4\n\n2005-04.16  2005-04-29 -1.52599565   -1    5\n\n\n\nif I wanted to show the last week of any months where the pattern of the \nsigns of the three  preceding weeks was \"1,-1,1\" , then the following would \nbe returned:\n\n\n\n                     Date              Value          Sign  Week\n\n2005-03.11  2005-03-25 -2.48430869   -1      4\n\n2005-04.16  2005-04-29 -1.52599565   -1      5\n\n\n\nI would greatly appreciate any hint or example which might lead me the right \nway on this.\n\n\n\nThankyou,\n\n\n\nAlf Sammassimo\n\n----- Original Message ----- \nFrom: \"Gabor Grothendieck\" \nTo: \"Alfonso Sammassimo\" \nCc: \nSent: Monday, April 23, 2007 2:31 PM\nSubject: Re: [R] Help on manipulating a data frame\n\n\n> Do you mean you want to return the first row for each mont for\n> which the value > 0?\n>\n> In that case try this.  The first group of lines recreates your\n> data frame and calls it DF.  by causes f to operate on a subset of\n> rows comprising one month extracting the first row for which\n> the value is positive and also adding in the week number.\n> do.call rbinds the results from each month altogether.\n>\n> Input <- \"2007-01-05 -1.52377151\n> 2007-01-12  1.04787390\n> 2007-01-19  0.61647047\n> 2007-01-26  1.87864283\n> 2007-02-02  0.54992405\n> 2007-02-09  1.96850069\n> 2007-02-16  0.26850159\n> 2007-02-23  1.56305144\n> 2007-03-02 -4.19500573\n> 2007-03-09  0.77127814\n> 2007-03-16  0.32387312\n> 2007-03-23  2.02163219\n> 2007-03-30  0.63175605\n> 2007-04-06  1.33346284\n> 2007-04-13  0.96021569\"\n> DF <- read.table(textConnection(Input), col.names = c(\"Date\", \"Value\"),\n> colClasses = c(\"Date\", \"numeric\"))\n>\n> f <- function(x) cbind(x, Week = seq_len(nrow(x)))[which.max(x$Value > \n> 0),]\n> do.call(\"rbind\", by(DF, format(DF$Date, \"%Y-%m\"), f))\n>\n> On 4/22/07, Alfonso Sammassimo  wrote:\n>> Hi R-experts,\n>>\n>>\n>>\n>> I have a large set of weekly data in this format:\n>>\n>>\n>>\n>> 2007-01-05 -1.52377151\n>> 2007-01-12  1.04787390\n>> 2007-01-19  0.61647047\n>> 2007-01-26  1.87864283\n>> 2007-02-02  0.54992405\n>> 2007-02-09  1.96850069\n>> 2007-02-16  0.26850159\n>> 2007-02-23  1.56305144\n>> 2007-03-02 -4.19500573\n>> 2007-03-09  0.77127814\n>> 2007-03-16  0.32387312\n>> 2007-03-23  2.02163219\n>> 2007-03-30  0.63175605\n>> 2007-04-06  1.33346284\n>> 2007-04-13  0.96021569\n>>\n>>\n>>\n>> How might this data be sorted to something like this?:\n>>\n>>\n>>\n>> Date               Week of Month     Value\n>>\n>> 2007-01-05          1                     -1.52377151\n>> 2007-01-12          2                      1.04787390\n>> 2007-01-19          3                      0.61647047\n>> 2007-01-26          4                      1.87864283\n>>\n>> 2007-02-02          1                      0.54992405\n>>\n>>\n>>\n>> My aim is to return the last value of every month where the previous \n>> values\n>> in that month were negative values, hence the need to split the data by\n>> month. Any guide as to how this might this be possible without a loop?\n>>\n>>\n>>\n>> Any help would be much appreciated.\n>>\n>>\n>>\n>> Thanks,\n>>\n>>\n>>\n>> Alf Sammassimo\n>>\n>> Melbourne, Australia\n>>\n>> ______________________________________________\n>> R-help@stat.math.ethz.ch mailing list\n>> https://stat.ethz.ch/mailman/listinfo/r-help\n>> PLEASE do read the posting guide \n>> http://www.R-project.org/posting-guide.html\n>> and provide commented, minimal, self-contained, reproducible code.\n>>\n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}