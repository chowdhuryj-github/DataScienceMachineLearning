{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r23683 - in branches: SAMBA_3_0/source/smbd\n\tSAMBA_3_0_26/source/smbd", "body": "Author: idra\nDate: 2007-07-03 13:11:56 +0000 (Tue, 03 Jul 2007)\nNew Revision: 23683\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23683\n\nLog:\n\nCheck ports are in the correct range (1-65535)\n\n\nModified:\n   branches/SAMBA_3_0/source/smbd/sockinit.c\n   branches/SAMBA_3_0_26/source/smbd/server.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/smbd/sockinit.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/sockinit.c\t2007-07-03 13:07:56 UTC (rev 23682)\n+++ branches/SAMBA_3_0/source/smbd/sockinit.c\t2007-07-03 13:11:56 UTC (rev 23683)\n@@ -63,7 +63,7 @@\n \n \t\t\tfor (ptr=ports; next_token(&ptr, tok, \" \\t,\", sizeof(tok)); ) {\n \t\t\t\tunsigned port = atoi(tok);\n-\t\t\t\tif (port == 0) {\n+\t\t\t\tif (port == 0 || port > 0xffff) {\n \t\t\t\t\tcontinue;\n \t\t\t\t}\n \t\t\t\ts = listenset[num_sockets] = open_socket_in(SOCK_STREAM, port, 0, ifip->s_addr, True);\n@@ -101,7 +101,7 @@\n \t\t\n \t\tfor (ptr=ports; next_token(&ptr, tok, \" \\t,\", sizeof(tok)); ) {\n \t\t\tunsigned port = atoi(tok);\n-\t\t\tif (port == 0) continue;\n+\t\t\tif (port == 0  || port > 0xffff) continue;\n \t\t\t/* open an incoming socket */\n \t\t\ts = open_socket_in(SOCK_STREAM, port, 0,\n \t\t\t\t\t   interpret_addr(lp_socket_address()),True);\n\nModified: branches/SAMBA_3_0_26/source/smbd/server.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/smbd/server.c\t2007-07-03 13:07:56 UTC (rev 23682)\n+++ branches/SAMBA_3_0_26/source/smbd/server.c\t2007-07-03 13:11:56 UTC (rev 23683)\n@@ -381,7 +381,7 @@\n \n \t\t\tfor (ptr=ports; next_token(&ptr, tok, \" \\t,\", sizeof(tok)); ) {\n \t\t\t\tunsigned port = atoi(tok);\n-\t\t\t\tif (port == 0) {\n+\t\t\t\tif (port == 0 || port > 0xffff) {\n \t\t\t\t\tcontinue;\n \t\t\t\t}\n \t\t\t\ts = fd_listenset[num_sockets] = open_socket_in(SOCK_STREAM, port, 0, ifip->s_addr, True);\n@@ -421,7 +421,7 @@\n \t\t\n \t\tfor (ptr=ports; next_token(&ptr, tok, \" \\t,\", sizeof(tok)); ) {\n \t\t\tunsigned port = atoi(tok);\n-\t\t\tif (port == 0) continue;\n+\t\t\tif (port == 0 || port > 0xffff) continue;\n \t\t\t/* open an incoming socket */\n \t\t\ts = open_socket_in(SOCK_STREAM, port, 0,\n \t\t\t\t\t   interpret_addr(lp_socket_address()),True);\n\n"}