{"category": "ham", "to_address": "Terry Therneau <therneau@mayo.edu>", "from_address": "Prof Brian Ripley <ripley@stats.ox.ac.uk>", "subject": "Re: [R] Predicted Cox survival curves - factor coding problems..", "body": "On Mon, 7 May 2007, Terry Therneau wrote:\n\n>  The combination of survfit, coxph, and factors is getting confused.  It is\n> not smart enough to match a new data frame that contains a numeric for sitenew\n> to a fit that contained that variable as a factor.  (Perhaps it should be smart\n> enough to at least die gracefully -- but it's not).\n\nThe 'standard' model-fitting functions in R do make an attempt to match \nthe new data to that used for fitting, or die gracefully.  Perhaps Thomas \ncould look into adding this to survift and coxph (see \nhttp://developer.r-project.org/model-fitting-functions.txt).\n\n\n>   The simple solution is to not use factors.\n>\n> site1 <- 1*(coxsnps$sitenew==1)\n> site2 <- 1*(coxsnps$sitenew==2)\n> test1 <- coxph(Surv(time, censor) ~ snp1 + sex + site1 + site2 + gene +\n> \t  eth.self + strata(edu), data= coxsnps)\n>\n> \t output\n>\n> profile1 <- data.frame(snp1=c(0,1), site2=c(0,0), sex=c(0,0),\n> \t               site1=c(0,0), site2=c(0,0), geno=c(0,0) eth.self=c(0,0))\n> plot(survfit(test1, newdata=profile1))\n>\n> Note that you do not have to explicitly make \"edu\" a factor.  Since it is\n> included in a strata statement, the coxph routine must treat it as discrete\n> groups.\n>\n> \tTerry Therneau\n\n-- \nBrian D. Ripley,                  ripley@stats.ox.ac.uk\nProfessor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/\nUniversity of Oxford,             Tel:  +44 1865 272861 (self)\n1 South Parks Road,                     +44 1865 272866 (PA)\nOxford OX1 3TG, UK                Fax:  +44 1865 272595\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}