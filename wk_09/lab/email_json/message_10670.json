{"category": "ham", "to_address": "Michael Toews <mwtoews@sfu.ca>", "from_address": "Charilaos Skiadas <skiadas@hanover.edu>", "subject": "Re: [R] sequential for loop", "body": "Hi Michael,\nOn Apr 20, 2007, at 12:31 AM, Michael Toews wrote:\n\n> Hi all,\n>\n> I'm usually comfortable using the *apply functions for vectorizing  \n> loops\n> in R. However, my particular problem now is using it in a sequential\n> operation, which uses values evaluated in an offset of the loop  \n> vector.\n>\n> Here is my example using a for loop approach:\n>\n> dat <- data.frame(year=rep(1970:1980,each=365),yday=1:365)\n> dat$value <- sin(dat$yday*2*pi/365)+rnorm(nrow(dat),sd=0.5)\n> dat$ca <- dat$cb <- 0 # consecutive above and below 0\n>\n> for(n in 2:nrow(dat)){\n>   if(dat$value[n] > 0)\n>     dat$ca[n] <- dat$ca[n-1] + 1\n>   else\n>     dat$cb[n] <- dat$cb[n-1] + 1\n> }\n>\n> I'm inquiring if there is a straightforward way to vectorize this  \n> (or a\n> similar example) in R, since it gets rather slow with larger data\n> frames. If there is no straightforward method, no worries.\n>\nWould this do what you want:\n\ndat <- data.frame(year=rep(1970:1980,each=365),yday=1:365)\ndat$value <- sin(dat$yday*2*pi/365)+rnorm(nrow(dat),sd=0.5)\npositives <- dat$value > 0\ndat$ca <- cumsum(c(0,positives[-1]))\ndat$cb <- cumsum(c(0,!positives[-1]))\n\n> Thanks in advance.\n> +mt\n\nHaris Skiadas\nDepartment of Mathematics and Computer Science\nHanover College\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}