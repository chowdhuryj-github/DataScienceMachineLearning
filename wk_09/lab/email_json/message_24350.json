{"category": "ham", "to_address": "jerry@samba.org, samba-technical@lists.samba.org", "from_address": "simo <idra@samba.org>", "subject": "Re: svn commit: samba r22713 - in branches:\n\tSAMBA_3_0/source/nsswitch SAMBA_3_0_26/source/nsswitch", "body": "On Sun, 2007-05-06 at 21:04 +0000, jerry@samba.org wrote:\n> Author: jerry\n> Date: 2007-05-06 21:04:30 +0000 (Sun, 06 May 2007)\n> New Revision: 22713\n> \n> WebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22713\n> \n> Log:\n> Offline logon fixes for idmap manager:\n> \n> (a) Ignore the negative cache when the domain is offline\n> (b) don't delete expired entries from the cache as these\n>     can be used when offline (same model as thw wcache entries)\n> (c) Delay idmap backend initialization when offline\n>     as the backend routines will not be called until we go \n>     online anyways.  This prevents idmap_init() from failing\n>     when a backend's init() function fails becuase of lack of\n>     network connectivity\n\nJerry,\nthis commit doesn't seem right to me.\n\nYou basically reverted some code you already committed and I changed in\n3_0_25. Right now each single backend init function can cope with the\noffline mode. Each one has a delayed initialization mode, so point (c)\nshould not be needed.\n\nThe query code should also be able to cope with offline requests, that's\nthe whole point of returning ID_EXPIRED, so that in case we can't really\nresolve we keep it, otherwise we get the correct return.\n\nBasically the problem of avoiding the query completely is that you also\navoid querying idmap_tdb/idmap_rid/idmap_passdb/idmap_nss. they all the\nmappings and can be consulted when offline without problems.\n \nThe negative cache changes are fine.\n\nSimo.\n\n-- \nSimo Sorce\nSamba Team GPL Compliance Officer\nemail: idra@samba.org\nhttp://samba.org\n\n"}