{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r23631 - in\n\tbranches/SAMBA_4_0/source/build/smb_build: .", "body": "Author: metze\nDate: 2007-06-27 15:37:03 +0000 (Wed, 27 Jun 2007)\nNew Revision: 23631\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23631\n\nLog:\nwhen linking shared libraries we need to make shure the linker doesn't\nskip \"unneeded\" object files from within .a files.\n\nIf the build-farm doesn't like -Wl,--whole-archive, I'll add some more\nconfigure logic fix it tomorrow.\n\nKai: with this your libnss_winbind.so patch works for me\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/build/smb_build/makefile.pm\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/build/smb_build/makefile.pm\n===================================================================\n--- branches/SAMBA_4_0/source/build/smb_build/makefile.pm\t2007-06-27 12:35:12 UTC (rev 23630)\n+++ branches/SAMBA_4_0/source/build/smb_build/makefile.pm\t2007-06-27 15:37:03 UTC (rev 23631)\n@@ -247,16 +247,28 @@\n \treturn $output;\n }\n \n-sub _prepare_list($$$)\n+sub _prepare_list_ex($$$$$)\n {\n-\tmy ($self,$ctx,$var) = @_;\n+\tmy ($self,$ctx,$var,$pre,$post) = @_;\n+\tmy @tmparr = ();\n \n-\tmy $tmplist = array2oneperline($ctx->{$var});\n+\tpush(@tmparr, $pre) if defined($pre);\n+\tpush(@tmparr, @{$ctx->{$var}}) if defined($ctx->{$var});\n+\tpush(@tmparr, $post) if defined($post);\n+\n+\tmy $tmplist = array2oneperline(\\@tmparr);\n \treturn if ($tmplist eq \"\");\n \n \t$self->output(\"$ctx->{TYPE}\\_$ctx->{NAME}_$var =$tmplist\\n\");\n }\n \n+sub _prepare_list($$$)\n+{\n+\tmy ($self,$ctx,$var) = @_;\n+\n+\t$self->_prepare_list_ex($ctx, $var, undef, undef);\n+}\n+\n sub Integrated($$)\n {\n \tmy ($self,$ctx) = @_;\n@@ -302,7 +314,7 @@\n \t\t$self->_prepare_list($ctx, \"FULL_OBJ_LIST\");\n \t}\n \t$self->_prepare_list($ctx, \"DEPEND_LIST\");\n-\t$self->_prepare_list($ctx, \"LINK_FLAGS\");\n+\t$self->_prepare_list_ex($ctx, \"LINK_FLAGS\", \"-Wl,--whole-archive\", \"-Wl,--no-whole-archive\");\n \n \tpush(@{$self->{all_objs}}, \"\\$($ctx->{TYPE}_$ctx->{NAME}_FULL_OBJ_LIST)\");\n \n\n"}