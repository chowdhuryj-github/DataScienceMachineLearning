{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r23404 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_25/source/nsswitch SAMBA_3_0_26/source/nsswitch", "body": "Author: idra\nDate: 2007-06-09 18:18:24 +0000 (Sat, 09 Jun 2007)\nNew Revision: 23404\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23404\n\nLog:\n\nFix wrong (and missing) action on error condition in ldap reply evaluation loop\nFixes one of the segfaults in bug #4667\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/idmap_ldap.c\n   branches/SAMBA_3_0_25/source/nsswitch/idmap_ldap.c\n   branches/SAMBA_3_0_26/source/nsswitch/idmap_ldap.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/idmap_ldap.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/idmap_ldap.c\t2007-06-09 07:17:24 UTC (rev 23403)\n+++ branches/SAMBA_3_0/source/nsswitch/idmap_ldap.c\t2007-06-09 18:18:24 UTC (rev 23404)\n@@ -965,7 +965,7 @@\n \t\t}\n \t\tif ( ! entry) {\n \t\t\tDEBUG(2, (\"ERROR: Unable to fetch ldap entries from results\\n\"));\n-\t\t\tcontinue;\n+\t\t\tbreak;\n \t\t}\n \n \t\t/* first check if the SID is present */\n@@ -1180,6 +1180,10 @@\n \t\t} else { /* following ones */\n \t\t\tentry = ldap_next_entry(ctx->smbldap_state->ldap_struct, entry);\n \t\t}\n+\t\tif ( ! entry) {\n+\t\t\tDEBUG(2, (\"ERROR: Unable to fetch ldap entries from results\\n\"));\n+\t\t\tbreak;\n+\t\t}\n \n \t\t/* first check if the SID is present */\n \t\tsidstr = smbldap_talloc_single_attribute(\n\nModified: branches/SAMBA_3_0_25/source/nsswitch/idmap_ldap.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/idmap_ldap.c\t2007-06-09 07:17:24 UTC (rev 23403)\n+++ branches/SAMBA_3_0_25/source/nsswitch/idmap_ldap.c\t2007-06-09 18:18:24 UTC (rev 23404)\n@@ -962,7 +962,7 @@\n \t\t}\n \t\tif ( ! entry) {\n \t\t\tDEBUG(2, (\"ERROR: Unable to fetch ldap entries from results\\n\"));\n-\t\t\tcontinue;\n+\t\t\tbreak;\n \t\t}\n \n \t\t/* first check if the SID is present */\n@@ -1177,6 +1177,10 @@\n \t\t} else { /* following ones */\n \t\t\tentry = ldap_next_entry(ctx->smbldap_state->ldap_struct, entry);\n \t\t}\n+\t\tif ( ! entry) {\n+\t\t\tDEBUG(2, (\"ERROR: Unable to fetch ldap entries from results\\n\"));\n+\t\t\tbreak;\n+\t\t}\n \n \t\t/* first check if the SID is present */\n \t\tsidstr = smbldap_talloc_single_attribute(\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/idmap_ldap.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/idmap_ldap.c\t2007-06-09 07:17:24 UTC (rev 23403)\n+++ branches/SAMBA_3_0_26/source/nsswitch/idmap_ldap.c\t2007-06-09 18:18:24 UTC (rev 23404)\n@@ -962,7 +962,7 @@\n \t\t}\n \t\tif ( ! entry) {\n \t\t\tDEBUG(2, (\"ERROR: Unable to fetch ldap entries from results\\n\"));\n-\t\t\tcontinue;\n+\t\t\tbreak;\n \t\t}\n \n \t\t/* first check if the SID is present */\n@@ -1177,6 +1177,10 @@\n \t\t} else { /* following ones */\n \t\t\tentry = ldap_next_entry(ctx->smbldap_state->ldap_struct, entry);\n \t\t}\n+\t\tif ( ! entry) {\n+\t\t\tDEBUG(2, (\"ERROR: Unable to fetch ldap entries from results\\n\"));\n+\t\t\tbreak;\n+\t\t}\n \n \t\t/* first check if the SID is present */\n \t\tsidstr = smbldap_talloc_single_attribute(\n\n"}