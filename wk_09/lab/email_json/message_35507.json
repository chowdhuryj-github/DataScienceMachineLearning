{"category": "ham", "to_address": "R list <r-help@stat.math.ethz.ch>, r-sig-mac@stat.math.ethz.ch", "from_address": "Chabot Denis <chabotd@globetrotter.net>", "subject": "Re: [R] Reducing the size of pdf graphics files produced with R", "body": "Hi again,\n\nMany of you have suggested other means than pdf device and/or  \nconversion/compression of pdf outside of R.\n\nI ran some tests on a small, a medium-size and a large figure. Here I  \nsummarize the results, which depend very much on the original  \ngraphics file. Please note that I wish to retain a vector-based  \ngraphic file.\n\nYou'll find at the end of this message the R program used to produce  \nthe graphics files.\n\nStarting with a small size graphic file: in order, these were  \nproduced by\n\n1) postscript device\n2) pdf device\n3) bitmap device (pdf output)\n4) dev2bitmap, pdf output, from a quartz window\n5) quartz device saved to pdf via command quarts.save\n6) quartz device saved to pdf via save menu in R gui\n\n-rw-r--r--   1 chabotd  chabotd    243446 May 23 21:00 test_ps_from_R.ps\n-rw-r--r--   1 chabotd  chabotd    572513 May 23 21:00  \ntest_pdf_from_R.pdf\n-rw-r--r--   1 chabotd  chabotd    600106 May 24 09:21  \ntest_pdf_bitmapR.pdf\n-rw-r--r--   1 chabotd  chabotd    600050 May 24 09:22  \ntest_dev2bitmap.pdf\n-rw-r--r--   1 chabotd  chabotd   1657446 May 23 21:00  \ntest_pdf_from_quartz.save.pdf\n-rw-r--r--   1 chabotd  chabotd    572634 May 23 21:01  \ntest_pdf_from_quartz.menu.pdf\n\nThese show how \"test_pdf_from_R.pdf\" can be shrunk outside of R\n1) the command pdftk\n2) opening the pdf in any Mac OS X pdf viewer and doing \"print to  \ncompressed pdf\"\n\n-rw-r--r--   1 chabotd  chabotd     68742 May 24 09:25  \ntest_pdf_pdftk.pdf\n-rw-r--r--   1 chabotd  chabotd    100660 May 23 21:16  \ntest_pdf_print_to_comppdf.pdf\n\nFinally, these show 3 conversions from postscript to pdf outside of R\n1) command ps2pdf\n2) command epstopdf\n3) command pstopdf\n\n-rw-r--r--   1 chabotd  chabotd    566626 May 23 21:12  \ntest_ps_ps2pdf.pdf\n-rw-r--r--   1 chabotd  chabotd    566587 May 24 10:21  \ntest_ps_epstopdf.pdf\n-rw-r--r--   1 chabotd  chabotd   1939788 May 24 10:20  \ntest_ps_pstopdf.pdf\n\nFor this first example, all pdf produced directly within R were of  \nsimilar size, except one (quartz.save) that was 3x larger. Producing  \na postscript file and transforming it into pdf resulted in no  \nsignificant saving. However pdf output from R can be shrunk (here to  \n12% of original size) with pdftk. So far I found no adverse effect of  \nthis shrinking.\n\nI did the same with a larger graphic, this example came from Dave  \nWatson. Using the same blocks as above:\n\nProduced with R:\n-rw-r--r--   1 chabotd  chabotd    854320 May 24 09:08  \nmauna_ps_from_R.eps\n-rw-r--r--   1 chabotd  chabotd   1000504 May 24 09:08  \nmauna_pdf_from_R.pdf\n-rw-r--r--   1 chabotd  chabotd     96737 May 24 09:08  \nmauna_pdf_bitmapR.pdf\n-rw-r--r--   1 chabotd  chabotd     97236 May 24 09:17  \nmauna_dev2bitmap.pdf\n-rw-r--r--   1 chabotd  chabotd    468195 May 24 09:08  \nmauna_pdf_from_quartz.save.pdf\n-rw-r--r--   1 chabotd  chabotd    999853 May 24 09:09  \nmauna_pdf_from_quartz.menu.pdf\n\nPS to pdf outside of R\n-rw-r--r--   1 chabotd  chabotd     95024 May 24 09:11  \nmauna_ps_ps2pdf.pdf\n-rw-r--r--   1 chabotd  chabotd    603021 May 24 10:40  \nmauna_ps_pstopdf.pdf\n-rw-r--r--   1 chabotd  chabotd     95015 May 24 10:40  \nmauna_ps_epstopdf.pdf\n\npdf transformation outside of R\n-rw-r--r--   1 chabotd  chabotd    104487 May 24 09:12  \nmauna_pdf_pdftk.pdf\n-rw-r--r--   1 chabotd  chabotd    134663 May 24 09:23  \nmauna_print_to_comppdf.pdf\n\nFor this example, different methods of producing pdf within R had  \nvery different file sizes. The two methods based on quartz performed  \nin reverse order compare to the previous example. Overall, using  \nbitmap device or postscript-transformed-to-pdf outside of R produced  \nfiles about 10% the size of the file produced by pdf device. But the  \nlatter could be shrunk almost as much using pdftk.\n\nFinally, a larger-size example:\nProduced with R:\n-rw-r--r--   1 chabotd  chabotd   1426330 May 23 20:54 fig_ps_from_R.ps\n-rw-r--r--   1 chabotd  chabotd   3384788 May 23 20:54  \nfig_pdf_from_R.pdf\n-rw-r--r--   1 chabotd  chabotd   3494689 May 24 09:03  \nfig_pdf_bitmapR.pdf\n-rw-r--r--   1 chabotd  chabotd   3494689 May 24 10:46  \nfig_dev2bitmap.pdf\n-rw-r--r--   1 chabotd  chabotd   3384832 May 23 20:54  \nfig_pdf_from_quartz.menu.pdf\n-rw-r--r--   1 chabotd  chabotd   9583552 May 23 20:52  \nfig_pdf_from_quartz.save.pdf\n\nPS to pdf outside of R\n-rw-r--r--   1 chabotd  chabotd   3356223 May 23 21:12 fig_ps_ps2pdf.pdf\n-rw-r--r--   1 chabotd  chabotd  11397461 May 23 23:51  \nfig_ps_pstopdf.pdf\n-rw-r--r--   1 chabotd  chabotd   3354762 May 23 23:55  \nfig_ps_epstopdf.pdf\n\npdf transformation outside of R\n-rw-r--r--   1 chabotd  chabotd    379307 May 23 22:31  \nfig_pdf_comptk.pdf\n-rw-r--r--   1 chabotd  chabotd    520509 May 24 00:19  \nfig_pdf_print_to_comppdf.pdf\n\nThis time, as in the first example, there was little benefit going  \nthe bitmap device or ps to pdf route. Only shrinking the pdf with  \npdftk was effective. So examples with a lot of objects on the plot do  \nnot seem to benefit from postscript use, but one example with few  \nobjects (but objects that were \"filled, don't know if it matters) did.\n\nI have never done this in R, but could the pdftk command be run from  \nwithin a R script? This would allow one to compress automatically  \nwhen needed.\n\nThank you all for the suggestions,\n\nDenis\n\n##############  R program that produced the above files  \n#################\n# example 1, small\npdf(file=\"test_pdf_from_R.pdf\", w=5, h=5, version=\"1.4\",  \nbg=\"transparent\")\nplot(rnorm(10000), rnorm(10000))\ndev.off()\n\npostscript(file=\"test_ps_from_R.ps\", width=5, height=5, paper=\"special\")\nplot(rnorm(10000), rnorm(10000))\ndev.off()\n\nbitmap(file = \"test_pdf_bitmapR.pdf\", width=5, height=5, type =  \n\"pdfwrite\")\nplot(rnorm(10000), rnorm(10000))\ndev.off()\n\nplot(rnorm(10000), rnorm(10000))\nquartz.save(file=\"test_pdf_from_quartz.save.pdf\", type=\"pdf\")\ndev2bitmap(file=\"test_dev2bitmap.pdf\", width=5, height=5,  \ntype=\"pdfwrite\")\n# here I also manually saved the quartz graphics and called it  \n\"test_pdf_from_quartz.menu.pdf\"\n\n\n# Example from Dave Watson\n\n\npostscript(file = \"mauna_ps_from_R.eps\", width=5, height=5,  \nhorizontal=FALSE, paper=\"special\", onefile=FALSE)\nfilled.contour(volcano, color=terrain.colors, asp=1)\ntitle(main=\"volcano data: filled contour map\")\ndev.off()\n\npdf(file = \"mauna_pdf_from_R.pdf\", width=5, height=5)\nfilled.contour(volcano, color=terrain.colors, asp=1)\ntitle(main=\"volcano data: filled contour map\")\ndev.off()\n\nbitmap(file = \"mauna_pdf_bitmapR.pdf\", width=5, height=5, type =  \n\"pdfwrite\")\nfilled.contour(volcano, color=terrain.colors, asp=1)\ntitle(main=\"volcano data: filled contour map\")\ndev.off()\n\n# on mac os x only\nquartz(w=5, h=5)\nfilled.contour(volcano, color=terrain.colors, asp=1)\ntitle(main=\"volcano data: filled contour map\")\ndev2bitmap(file=\"mauna_dev2bitmap.pdf\", width=5, height=5,  \ntype=\"pdfwrite\")\nquartz.save(file=\"mauna_pdf_from_quartz.save.pdf\", type=\"pdf\")\n# here I also manually saved the quartz graphics and called it  \n\"mauna_pdf_from_quartz.menu.pdf\"\n\n\n\n# example 3, large\n\nx <- rep(1:99, 20)\n\nc <- 0\nfor (a in 1:3) {\n   for (b in c(0.7, 0.9) ) {\n   c<-c+1\n   nam <- paste(\"Y\", c, sep=\"\")\n   assign(nam, a + b*x + rnorm(length(x),20,10))\n   }\n   }\nthe.data <- data.frame(Y1, Y2, Y3, Y4, Y5, Y6)\nrm(Y1, Y2, Y3, Y4, Y5, Y6)\n\n\npdf(file=\"fig_pdf_from_R.pdf\", w=8, h=8, version=\"1.4\",  \nbg=\"transparent\")\npairs(the.data)\ndev.off()\n\npostscript(file=\"fig_ps_from_R.ps\", width=8, height=8, paper=\"special\")\npairs(the.data)\ndev.off()\n\nbitmap(file = \"fig_pdf_bitmapR.pdf\", width=8, height=8, type =  \n\"pdfwrite\")\npairs(the.data)\ndev.off()\n\n# on mac os x only\nquartz(w=8, h=8)\npairs(the.data)\ndev2bitmap(file=\"fig_dev2bitmap.pdf\", width=8, height=8,  \ntype=\"pdfwrite\")\nquartz.save(file=\"fig_pdf_from_quartz.savev2.pdf\", type=\"pdf\")\n# here I also manually saved the quartz graphics and called it  \n\"fig_pdf_from_quartz.menu.pdf\"\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}