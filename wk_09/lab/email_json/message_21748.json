{"category": "ham", "to_address": "\"Johann Hanne\" <jhml@gmx.net>, <samba-technical@samba.org>", "from_address": "=?iso-8859-9?Q?Kaya_Bekiro=F0lu?= <kaya.bekiroglu@isilon.com>", "subject": "RE: Bug #3024 still trivial, still applies, still not in svn :-(", "body": "I independently fixed this for Isilon.  Our patches are essentially the same.  I added an additional fix for an incorrect usage of sam_entry_index in a DEBUG().  Using a while(1) is not correct as we could then overrun user_list.  We need a proper termination condition.\n\n--Kaya\n\n@@ -672,3 +696,9 @@ void winbindd_getpwent(struct winbindd_c\n \n-       for (i = 0; i < num_users; i++) {\n+       /*\n+        * samba.org's for loop is broken for large domains, because if\n+        * winbindd_fill_pwent() fails, it will still count that iteration as\n+        * one of the num_users.  This while condition will ensure that all\n+        * num_users have been enumerated.\n+        */\n+       while (user_list_ndx < num_users) {\n                struct getpwent_user *name_list = NULL;\n@@ -713,6 +743,5 @@ void winbindd_getpwent(struct winbindd_c\n                        name_list[ent->sam_entry_index].shell,\n+                       name_list[ent->sam_entry_index].email,\n                        &user_list[user_list_ndx]);\n \n-               ent->sam_entry_index++;\n-\n                /* Add user to return list */\n@@ -729,2 +758,9 @@ void winbindd_getpwent(struct winbindd_c\n                                  name_list[ent->sam_entry_index].name));\n+ \n+               ent->sam_entry_index++;\n        }\n--Kaya\n\n\n-----Original Message-----\nFrom: samba-technical-bounces+kaya=isilon.com@lists.samba.org [mailto:samba-technical-bounces+kaya=isilon.com@lists.samba.org] On Behalf Of Johann Hanne\nSent: Sunday, April 29, 2007 4:25 AM\nTo: samba-technical@samba.org\nSubject: Bug #3024 still trivial, still applies, still not in svn :-(\n\nHi,\n\nI just tested 3.0.25rc3 and found out, that bug #3024 is still in. Moreover, \nthe proposed patch still applies and it still fixes the bug. I'm getting a \nlittle desperate on this. What's the problem? I'd do anything I can to get it \napplied?!\n\nCheers, Johann\n\n"}