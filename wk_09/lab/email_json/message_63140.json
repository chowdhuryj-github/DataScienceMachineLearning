{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "\"Kathy Gerber\" <kathy@virginia.edu>", "subject": "[R] Question on Rmpi looping", "body": "Dear R list,\n\nIn the course of learning to work with Rmpi, we are confused about a few \npoints.  The following simple program is based on some examples we retrieved \nfrom the web. Each slave is writing the same output line multiple times (a \nmultiple equal to the number of slaves). In other words, the write \nstatements are being executed a number of times equal to the number of \nslaves.\n\nI am trying to print out the slave number to a file (once), but it is \nprinting it 4 times (since the number of slaves is 4). The code is as \nfollows:\n\n# Initialize the Rmpi environment\nlibrary(\"Rmpi\")\n\n# We are spawning four slaves\nmpi.spawn.Rslaves(nslaves=4)\n\nif (mpi.comm.size() != 5)\n     {\n     print(\"Please initialize an MPI cluster of at least 5 processors.\")\n     print(\"Then, try again\")\n     mpi.quit()\n     }\n\n.Last <- function()\n     {\n     if (is.loaded(\"mpi_initialize\"))\n         {\n         if (mpi.comm.size(1) > 0)\n             {\n             print(\"Please use mpi.close.Rslaves() to close slaves.\")\n             mpi.close.Rslaves()\n             }\n         print(\"Please use mpi.quit() to quit R\")\n         .Call(\"mpi_finalize\")\n         }\n     }\n\n\n# Define the base directory\nbasedir <- \"/home/user/directory/\"\n\nfcnfishtest <- function()\n   {\n          wrout = paste(basedir, paste(\"processor\",my_rank, sep=\"\"), sep=\"\")\n          write(my_rank, wrout, append=TRUE)\n   }\n################## END OF SLAVES ##################\n\n\n# We're in the parent.\n\n#Have each slave get its rank\n  mpi.bcast.cmd(my_rank <- mpi.comm.rank())\n  mpi.bcast.Robj2slave(basedir)\n\n\n# Send the function to the slaves\n   \n  mpi.bcast.Robj2slave(fcnfishtest)\n\n# Call the function\n\nx<- mpi.remote.exec(fcnfishtest())\nx\n\n# close slaves and exit\n  mpi.close.Rslaves()\n  mpi.quit(save = \"no\")\n\n##### end code\n\n\nThe output is as follows:\n\nfile 1:\n1\n1\n1\n1\n  \nfile 2:\n2\n2\n2\n2\n\nfile 3:\n3\n3\n3\n3\n\nfile 4:\n4\n4\n4\n4\n\n\nWe would like to call four slaves with output files like:\n\nfile 1:\n1\n\nfile 2:\n2\n\nfile 3:\n3\n\nfile 4:\n4\n\n\nAny help would be greatly appreciated. Thank you!\n\nKathy Gerber\nUniversity of Virginia - ITC - Research Computing Support\nkathy@virginia.edu                         434-982-4986\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}