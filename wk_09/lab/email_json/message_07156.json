{"category": "ham", "to_address": "r-help <r-help@stat.math.ethz.ch>", "from_address": "\"Joel J. Adamson\" <jadamson@PARTNERS.ORG>", "subject": "[R] My First Function: cryptic error message", "body": "Dear List,\nMy first R function is a rip-off bagging algorithm from pg. 138 of\nEveritt and Hothorn's \"Handbook of Statistical Analyses using R\"\n(HSAUR).  I'm using recursive partitioning to develop a set of useful\nvariables in diagnosing ADHD.  \n\nI'm running this in ESS in XEmacs 21.4.19, R 2.4.1 on Slackware Linux\n11.0 with a 2.6 kernel.\n\nThis is almost an entire script, although I've removed or disguised\nparts that would reveal my plans for world domination.  The function\nis right here at the top:\n\n####################\n# bagging function:\nbagger <- function (length = 25, formula, dataframe) {\n  trees <- vector(mode = \"list\", length = length)\n  n <- nrow(dataframe)\n  bootsamples <- rmultinom (length(trees), n,\n                            rep(1,n)/n)\n  mod <- rpart(formula, data = dataframe,\n               control = rpart.control(xval = 0))\n  for (i in 1:length(trees)) {\n    trees[[i]] <- update(mod,\n                         weights = bootsamples[, i])\n  }\n}\n\n#bring in data\n[snip]\n#Recursive partitioning:\nlibrary(\"rpart\")\n# get a 2/3 random sample of ids\nids <- sample(probands$id,\n                   size = 2*(length(probands$id))/3,\n                   replace = FALSE)\n# now I want a logical vector telling me which sample to put the\n# subjects in:\n#training_true <- probands$id %in% ids\ntraining <- subset(probands, probands$id %in% ids)\ntesting <- subset(probands, ! probands$id %in% ids)\n\n# formula for the rpart model\nadhdcbin <- factor(probands$adhdcbin, ordered = TRUE,\n                   labels = cbind(\"Control\",\"ADHD\" ))\ncbs38s <- as.formula(paste(\"adhdcbin ~\",\n                     paste(names(probands[grep(\"cbs38_..*\",names(probands))]),\n                           collapse = \"+\")))\n\n# fitting the rpart model\nrpart_training <- rpart(cbs38s,\n                        data = training,\n                        method = \"class\")\nX11 (); plot(rpart_training);text(rpart_training)\nrpart_training.bagged <- bagger(length = 100, formula = cbs38s, training)\nX11 (); plot(rpart_training.bagged);text(rpart_training.bagged)\n####################\n\nThe second-to-last line gives me the following error:\n\nError in eval(expr, envir, enclos) : object \"bootsamples\" not found\n\nI've used backtrace(), debug(bagger) and options(error=recover ()) and\nnothing seems to make sense.  What should I be looking for?\n\"bootsamples\" is there at every time except ...\n\nI've tried this with other formulas, I've tried typing in\nthe function vs. reading it in by source(); I've re-formatted the top\nline to read with the brace on the same line as the declaration or on\nthe next line.  EVerything produces the same message.  Am I binding\nthe variables correctly?  Am I declaring the arguments correctly?\n\nThe most irritating part is that this worked last week ;)  I swear.\n\nThanks,\nJoel\n-- \nJoel J. Adamson\nBiostatistician\nPediatric Psychopharmacology Research Unit\nMassachusetts General Hospital\nBoston, MA  02114\n(617) 643-1432\n(303) 880-3109\n\n\n\n\n\nThe information transmitted in this electronic communication...{{dropped}}\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}