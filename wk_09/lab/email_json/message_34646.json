{"category": "ham", "to_address": "\"Patrick R. Michaud\" <pmichaud@pobox.com>", "from_address": "Will Coleda <will@coleda.com>", "subject": "Re: PMC architecture discussion", "body": "\nOn May 22, 2007, at 10:05 PM, Patrick R. Michaud wrote:\n\n> And I'm really\n> not sure how to create a Perl6Sub from PIR source code.\n\nWe're already doing this in tcl.\n\nSee src/class/tclproc.pir for the PIR class which has Sub for a  \nparent class.\n\nruntime/builtin/proc.pir then puts this to use:\n\n   .local pmc pir_compiler\n   pir_compiler = compreg 'PIR'\n\n   # (see note on trans_charset in lib/parser.pir) RT#40752:\n   $S0 = code\n   $I0 = find_charset 'ascii'\n   $S0 = trans_charset $I0\n   $P0 = pir_compiler($S0)\n\n   # the PIR compiler returns an Eval PMC, which contains each sub that\n   # was compiled in it. we want the first (and only) one, and we  \nwant to\n   # put it into a TclProc...\n   $P0 = $P0[0]\n\n   $P1 = new 'TclProc'\n   assign $P1, $P0\n\n   $P9 = new .String\n   $P9 = $S0\n   setattribute $P1, 'PIR_source', $P9\n\nHope this helps.\n--\nWill \"Coke\" Coleda\nwill@coleda.com\n\n\n"}