{"category": "ham", "to_address": "\"Martin Morgan\" <mtmorgan@fhcrc.org>", "from_address": "deepayan.sarkar@gmail.com", "subject": "Re: [R] Lookups in R", "body": "On 7/4/07, Martin Morgan  wrote:\n> Michael,\n>\n> A hash provides constant-time access, though the resulting perl-esque\n> data structures (a hash of lists, e.g.) are not convenient for other\n> manipulations\n>\n> > n_accts <- 10^3\n> > n_trans <- 10^4\n> > t <- list()\n> > t$amt <- runif(n_trans)\n> > t$acct <- as.character(round(runif(n_trans, 1, n_accts)))\n> >\n> > uhash <- new.env(hash=TRUE, parent=emptyenv(), size=n_accts)\n> > ## keys, presumably account ids\n> > for (acct in as.character(1:n_accts)) uhash[[acct]] <- list(amt=0, n=0)\n> >\n> > system.time(for (i in seq_along(t$amt)) {\n> +     acct <- t$acct[i]\n> +     x <- uhash[[acct]]\n> +     uhash[[acct]] <- list(amt=x$amt + t$amt[i], n=x$n + 1)\n> + })\n>    user  system elapsed\n>   0.264   0.000   0.262\n> > udf <- data.frame(amt=0, n=rep(0L, n_accts),\n> +                   row.names=as.character(1:n_accts))\n> > system.time(for (i in seq_along(t$amt)) {\n> +     idx <- row.names(udf)==t$acct[i]\n> +     udf[idx, ] <- c(udf[idx,\"amt\"], udf[idx, \"n\"]) + c(t$amt[i], 1)\n> + })\n>    user  system elapsed\n>  18.398   0.000  18.394\n\nI don't think that's a fair comparison--- much of the overhead comes\nfrom the use of data frames and the creation of the indexing vector. I\nget\n\n> n_accts <- 10^3\n> n_trans <- 10^4\n> t <- list()\n> t$amt <- runif(n_trans)\n> t$acct <- as.character(round(runif(n_trans, 1, n_accts)))\n> uhash <- new.env(hash=TRUE, parent=emptyenv(), size=n_accts)\n> for (acct in as.character(1:n_accts)) uhash[[acct]] <- list(amt=0, n=0)\n> system.time(for (i in seq_along(t$amt)) {\n+     acct <- t$acct[i]\n+     x <- uhash[[acct]]\n+     uhash[[acct]] <- list(amt=x$amt + t$amt[i], n=x$n + 1)\n+ }, gcFirst = TRUE)\n   user  system elapsed\n  0.508   0.008   0.517\n> udf <- matrix(0, nrow = n_accts, ncol = 2)\n> rownames(udf) <- as.character(1:n_accts)\n> colnames(udf) <- c(\"amt\", \"n\")\n> system.time(for (i in seq_along(t$amt)) {\n+     idx <- t$acct[i]\n+     udf[idx, ] <- udf[idx, ] + c(t$amt[i], 1)\n+ }, gcFirst = TRUE)\n   user  system elapsed\n  1.872   0.008   1.883\n\nThe loop is still going to be the problem for realistic examples.\n\n-Deepayan\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}