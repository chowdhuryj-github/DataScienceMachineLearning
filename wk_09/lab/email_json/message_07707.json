{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22305 - in\n\tbranches/SAMBA_4_0/source/script/tests: .", "body": "Author: metze\nDate: 2007-04-17 13:06:00 +0000 (Tue, 17 Apr 2007)\nNew Revision: 22305\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22305\n\nLog:\nfix make test using a absolute path for\n--with-selftest-prefix\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/script/tests/Samba4.pm\n   branches/SAMBA_4_0/source/script/tests/selftest.pl\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/script/tests/Samba4.pm\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/Samba4.pm\t2007-04-17 12:21:47 UTC (rev 22304)\n+++ branches/SAMBA_4_0/source/script/tests/Samba4.pm\t2007-04-17 13:06:00 UTC (rev 22305)\n@@ -6,6 +6,7 @@\n package Samba4;\n \n use strict;\n+use Cwd qw(abs_path);\n use FindBin qw($RealBin);\n use POSIX;\n \n@@ -403,8 +404,7 @@\n \tmy $server = \"localhost\";\n \tmy $srcdir=\"$RealBin/../..\";\n \t-d $prefix or mkdir($prefix) or die(\"Unable to create $prefix\");\n-\tmy $prefix_abs = getcwd().\"/\".$prefix;\n-\n+\tmy $prefix_abs = abs_path($prefix);\n \tmy $tmpdir = \"$prefix_abs/tmp\";\n \tmy $etcdir = \"$prefix_abs/etc\";\n \tmy $piddir = \"$prefix_abs/pid\";\n\nModified: branches/SAMBA_4_0/source/script/tests/selftest.pl\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-17 12:21:47 UTC (rev 22304)\n+++ branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-17 13:06:00 UTC (rev 22305)\n@@ -113,7 +113,7 @@\n use File::Spec;\n use Getopt::Long;\n use POSIX;\n-use Cwd;\n+use Cwd qw(abs_path);\n use lib \"$RealBin\";\n use Samba3;\n use Samba4;\n@@ -136,7 +136,7 @@\n \n my $srcdir = \".\";\n my $builddir = \".\";\n-my $prefix = \"st\";\n+my $prefix = \"./st\";\n \n my $suitesfailed = [];\n my $start = time();\n@@ -370,6 +370,16 @@\n }\n \n $prefix =~ s+//+/+;\n+$prefix =~ s+/./+/+;\n+$prefix =~ s+/$++;\n+\n+my $prefix_abs = abs_path($prefix);\n+my $srcdir_abs = abs_path($srcdir);\n+\n+die(\"using an empty prefix isn't allowed\") unless $prefix ne \"\";\n+die(\"using an empty absolute prefix isn't allowed\") unless $prefix_abs ne \"\";\n+die(\"using '/' as absolute prefix isn't allowed\") unless $prefix_abs ne \"/\";\n+\n $ENV{PREFIX} = $prefix;\n $ENV{SRCDIR} = $srcdir;\n \n@@ -442,14 +452,12 @@\n \t\t\t    \"127.0.0.10/8\",\n \t\t\t    \"127.0.0.11/8\"));\n \n-my $conffile = \"$prefix/client.conf\";\n+my $conffile = \"$prefix_abs/client/client.conf\";\n \n sub write_clientconf($$)\n {\n \tmy ($conffile, $vars) = @_;\n \n-\tmy $abs_srcdir = cwd();\n-\n \tmkdir \"$prefix/client\" unless -d \"$prefix/client\";\n \t\n \tif ( -d \"$prefix/client/private\" ) {\n@@ -482,16 +490,16 @@\n \t\tprint CF \"\\twinbindd socket directory = $vars->{WINBINDD_SOCKET_DIR}\\n\";\n \t}\n \tprint CF \"\n-        private dir = $abs_srcdir/$prefix/client/private\n-\tjs include = $abs_srcdir/scripting/libjs\n+\tprivate dir = $srcdir_abs/$prefix/client/private\n+\tjs include = $srcdir_abs/scripting/libjs\n \tname resolve order = bcast\n \tinterfaces = $interfaces\n-\tpanic action = $abs_srcdir/script/gdb_backtrace \\%PID\\% \\%PROG\\%\n+\tpanic action = $srcdir_abs/script/gdb_backtrace \\%PID\\% \\%PROG\\%\n \tmax xmit = 32K\n \tnotify:inotify = false\n \tldb:nosync = true\n \tsystem:anonymous = true\n-\ttorture:basedir = ./st\n+\ttorture:basedir = $prefix_abs\n #We don't want to pass our self-tests if the PAC code is wrong\n \tgensec:require_pac = true\n \";\n\n"}