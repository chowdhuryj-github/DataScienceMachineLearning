{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r22975 - in branches: SAMBA_3_0/source/rpc_server\n\tSAMBA_3_0_25/source/rpc_server SAMBA_3_0_26/source/rpc_server", "body": "Author: jerry\nDate: 2007-05-17 19:16:27 +0000 (Thu, 17 May 2007)\nNew Revision: 22975\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22975\n\nLog:\nBUG 4616: Don't return a dns or forest name when replying to the \nDsDGetPrimaryRoleInfo() and configured for security = domain.\n\n\nModified:\n   branches/SAMBA_3_0/source/rpc_server/srv_lsa_ds_nt.c\n   branches/SAMBA_3_0_25/source/rpc_server/srv_lsa_ds_nt.c\n   branches/SAMBA_3_0_26/source/rpc_server/srv_lsa_ds_nt.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/rpc_server/srv_lsa_ds_nt.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_server/srv_lsa_ds_nt.c\t2007-05-17 18:20:16 UTC (rev 22974)\n+++ branches/SAMBA_3_0/source/rpc_server/srv_lsa_ds_nt.c\t2007-05-17 19:16:27 UTC (rev 22975)\n@@ -84,16 +84,16 @@\n \t\t\n \t\tbasic->dnsname_ptr = 1;\n \t\tinit_unistr2( &basic->dns_domain, dnsdomain, UNI_STR_TERMINATE);\n+\n+\t\t/* FIXME!! We really should fill in the correct forest\n+\t\t   name.  Should get this information from winbindd.  */\n \t\tbasic->forestname_ptr = 1;\n \t\tinit_unistr2( &basic->forest_domain, dnsdomain, UNI_STR_TERMINATE);\n \t} else {\n-\t\tget_mydnsdomname(dnsdomain);\n-\t\tstrlower_m(dnsdomain);\n-\n-\t\tbasic->dnsname_ptr = 1;\n-\t\tinit_unistr2( &basic->dns_domain, dnsdomain, UNI_FLAGS_NONE);\n-\t\tbasic->forestname_ptr = 1;\n-\t\tinit_unistr2( &basic->forest_domain, dnsdomain, UNI_FLAGS_NONE);\n+\t\t/* security = domain should not fill in the dns or\n+\t\t   forest name */\n+\t\tbasic->dnsname_ptr = 0;\n+\t\tbasic->forestname_ptr = 0;\n \t}\n \n \t*info = basic;\n\nModified: branches/SAMBA_3_0_25/source/rpc_server/srv_lsa_ds_nt.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/rpc_server/srv_lsa_ds_nt.c\t2007-05-17 18:20:16 UTC (rev 22974)\n+++ branches/SAMBA_3_0_25/source/rpc_server/srv_lsa_ds_nt.c\t2007-05-17 19:16:27 UTC (rev 22975)\n@@ -84,16 +84,16 @@\n \t\t\n \t\tbasic->dnsname_ptr = 1;\n \t\tinit_unistr2( &basic->dns_domain, dnsdomain, UNI_STR_TERMINATE);\n+\n+\t\t/* FIXME!! We really should fill in the correct forest\n+\t\t   name.  Should get this information from winbindd.  */\n \t\tbasic->forestname_ptr = 1;\n \t\tinit_unistr2( &basic->forest_domain, dnsdomain, UNI_STR_TERMINATE);\n \t} else {\n-\t\tget_mydnsdomname(dnsdomain);\n-\t\tstrlower_m(dnsdomain);\n-\n-\t\tbasic->dnsname_ptr = 1;\n-\t\tinit_unistr2( &basic->dns_domain, dnsdomain, UNI_FLAGS_NONE);\n-\t\tbasic->forestname_ptr = 1;\n-\t\tinit_unistr2( &basic->forest_domain, dnsdomain, UNI_FLAGS_NONE);\n+\t\t/* security = domain should not fill in the dns or\n+\t\t   forest name */\n+\t\tbasic->dnsname_ptr = 0;\n+\t\tbasic->forestname_ptr = 0;\n \t}\n \n \t*info = basic;\n\nModified: branches/SAMBA_3_0_26/source/rpc_server/srv_lsa_ds_nt.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_server/srv_lsa_ds_nt.c\t2007-05-17 18:20:16 UTC (rev 22974)\n+++ branches/SAMBA_3_0_26/source/rpc_server/srv_lsa_ds_nt.c\t2007-05-17 19:16:27 UTC (rev 22975)\n@@ -84,16 +84,16 @@\n \t\t\n \t\tbasic->dnsname_ptr = 1;\n \t\tinit_unistr2( &basic->dns_domain, dnsdomain, UNI_STR_TERMINATE);\n+\n+\t\t/* FIXME!! We really should fill in the correct forest\n+\t\t   name.  Should get this information from winbindd.  */\n \t\tbasic->forestname_ptr = 1;\n \t\tinit_unistr2( &basic->forest_domain, dnsdomain, UNI_STR_TERMINATE);\n \t} else {\n-\t\tget_mydnsdomname(dnsdomain);\n-\t\tstrlower_m(dnsdomain);\n-\n-\t\tbasic->dnsname_ptr = 1;\n-\t\tinit_unistr2( &basic->dns_domain, dnsdomain, UNI_FLAGS_NONE);\n-\t\tbasic->forestname_ptr = 1;\n-\t\tinit_unistr2( &basic->forest_domain, dnsdomain, UNI_FLAGS_NONE);\n+\t\t/* security = domain should not fill in the dns or\n+\t\t   forest name */\n+\t\tbasic->dnsname_ptr = 0;\n+\t\tbasic->forestname_ptr = 0;\n \t}\n \n \t*info = basic;\n\n"}