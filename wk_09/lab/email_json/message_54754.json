{"category": "ham", "to_address": "The R Project for Statistical Computing\n\t<The-R-Project-for-Statistical-Computing@googlegroups.com>", "from_address": "DarrenWeber <Darren.Weber@radiology.ucsf.edu>", "subject": "[R] ANOVA non-sphericity test and corrections (eg,\n\tGreenhouse-Geisser)", "body": "\nI'm an experimental psychologist and when I run ANOVA analysis in\nSPSS, I normally ask for a test of non-sphericity (Box's M-test).  I\nalso ask for output of the corrections for non-sphericity, such as\nGreenhouse-Geisser and Huhn-Feldt.  These tests and correction factors\nare commonly used in the journals for experimental and other\npsychology reports.  I have been switching from SPSS to R for over a\nyear now, but I realize now that I don't have the non-sphericity test\nand correction factors.\n\nThe backgroud to this question is that I'm doing a psychophysics\nexperiment and the data analysis uses an aov model that looks like\nthis:\n\nroiAOV <- aov( roi ~ (Cue*Hemisphere) + Error(Subject/\n(Cue*Hemisphere)), data=roiDataframe)\n\nwhere Cue is 2 levels (an arrow on a screen that points left or right)\nand Hemisphere is 2 levels (brain activity in the left or right\ncerebral hemisphere).  There are 8 subjects and they all have one\nobservation for all levels of Cue * Hemisphere (ie, a within-subjects\ndesign).\n\nI need some functions for calculation of Box's M and the Greenhouse-\nGeisser correction factor.  Below is some code example that I have for\nthe latter, but I don't know how to adapt it so it can take the aov\nobject.\n\n# BEGIN CODE BLOCK\n# see pp. 45-47 of\n# http://www.psych.upenn.edu/~baron/rpsych.pdf\n\n# ---\n# create some data\n\nx0 <- rnorm(30)\nx2 <- rnorm(30)\nx4 <- rnorm(30)\n\ndata <- cbind(x0,x2,x4)\n\n# n is the number of 'subjects' or rows; while\n# k is the number of levels in the factor (columns),\n# which is the number of repeated measures\nn <- dim(data)[1]\nk <- dim(data)[2]\n\n# if k <= 2, the epsilon correction is not required.\n# When the data are perfectly spherical, epsilon = 1.\n# The minimum value possible for epsilon is\n\nepsi = 1 / (k - 1)\n\n# if epsi == 1 and k == 2, quit now...\n\n# ---\n# calculate variance-covariance matrix\n# diagonal entries are variance,\n# off-diagonal are covariance\nS <- var(data)\n\n# ---\n# Now estimate Epsilon\n\nD <- k^2 * ( mean(diag(S)) - mean(S) )^2\n\nN1 <- sum(S^2)\nN2 <- 2 * k * sum( apply(S,1,mean)^2 )\nN3 <- k^2 * mean(S)^2\n\nepsi <- D / ( (k-1) * (N1 - N2 + N3) )\n\n# e is used to modify the degrees of freedom for the\n# F test, so we have (k-1) becomes epsi(k-1) and also\n# (k - 1)(n - 1) becomes epsi(k - 1)(n - 1).  The new\n# p-value for the F statistic is found with the\n# pf() function.  For example, if we have\n# df1 =  k - 1 = 3 - 1 = 2\n# df2 = (k - 1)(n - 1) = (3 - 1)(10 - 1) = 18\n# F = 40.719\n# then the adjusted 2-tailed p-value is given by:\n#\n\nFvalue <- 40.719\nPepsi <- 2 * (1 - pf(Fvalue, df1=epsi*(k-1), df2=epsi*(k-1)*(n-1) ) )\n\n# Huynh-Feldt correction\n# The Greenhouse-Geisser epsilon tends to underestimate\n# epsilon when epsilon is greater than 0.70 (Stevens, 1990).\n# An estimated e=0.96 may be actually 1. Huynh-Feldt\n# correction is less conservative. The Huynh-Feldt\n# epsilon is calculated from the Greenhouse-Geisser epsilon,\n\nepsiHF <- (n * (k-1) * epsi - 2) / ((k-1) * ((n-1) - (k-1)*epsi))\n\nPepsiHF <- 2 * (1 - pf(Fvalue, df1=epsiHF*(k-1),\ndf2=epsiHF*(k-1)*(n-1) ) )\n\n# MANOVA (and multivariate tests) may be better if the\n# Greenhouse-Geisser and the Huynh-Feldt corrections do not agree,\n# which may happen when epsilon drops below 0.70. When epsilon\n# drops below 0.40, both the G-G and H-F corrections may indicate\n# that the violation of sphericity is affecting the adjusted p-values.\n# MANOVA is not always appropriate, though. MANOVA usually requires\n# a larger sample size. Maxwell and Delaney (1990, p. 602) suggest\n# a rough rule of thumb that the sample size n should be greater\n# than k+10.\n# END CODE BLOCK\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}