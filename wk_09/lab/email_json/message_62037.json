{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "Deb Midya <debmidya@yahoo.com>", "subject": "[R] Calling C Code from R", "body": "Hi R Users,\n   \n  Thanks in advance.\n   \n  I am using R-2.5.1 on Windows XP.\n   \n  I am trying to call C code (testCX1.C) from R. testCX1.c calls another C code (funcC1.c) and returning a value to testCX1.c. I like to have this value in R.\n   \n  My steps are below:\n   \n  1. R CMD SHLIB testCX1.c funcC1.c (at command propmt)\n   \n  2. It creates testCX1.dll with warning (but testCX1.dll works):\n   \n  testCX1.c:38: warning: implicit declaration of function 'func'\n   \n  How to get rid off this error ?\n   \n  What is the best way to call funcC1.c from testCX1.c?\n   \n  I have provided the codes below:\n   \n  Once again thank you very much for the time you have given.\n   \n  Regards,\n   \n  Debabrata Midya (Deb)\n  Statistician\n  NSW Department of Commerce\n  Sydney, Australia\n   \n  testCX1.C\n  --------------\n   \n  /*\n *********************\n testCX1.c\n  *********************\n*/\n  #include \n#include \n#include \n   \n  SEXP testC1(SEXP a)\n{\n   int i, nr;\n   double *xa, *xw, tmp;\n   SEXP w;\n   \n     PROTECT(a = coerceVector(a, REALSXP));\n   \n   nr = length(a);\n     printf( \"Length : %d \\n\", nr);\n   \n   PROTECT(w = allocVector(REALSXP, 1));\n   \n   xa = REAL(a);\n   xw = REAL(w);\n    \n   tmp = 0.0;\n     for (i = 0; i < nr; i++)\n     {\n        tmp += xa[i];\n     }\n     // tmp = 0.0;\n   xw[0] = func(xa);\n     UNPROTECT(2);\n   return(w);\n}\n\n   \n  funcC1.c\n  ------------\n   \n  /*\n *********************\n funcC1.c\n  *********************\n*/\n   \n  #include \n#include \n#include \n   \n  SEXP func(SEXP a)\n{\n   int i, nr = 3;\n   double *xa, *xw, tmp;\n   SEXP w;\n   \n     PROTECT(a = coerceVector(a, REALSXP));\n   \n   PROTECT(w = allocVector(REALSXP, 1));\n   \n   xa = REAL(a);\n   xw = REAL(w);\n    \n   tmp = 0.0;\n     for (i = 0; i < nr; i++)\n     {\n        tmp += xa[i] * xa[i];\n     }\n     xw[0] = tmp;\n     UNPROTECT(2);\n   return(w);\n}\n\n  R script\n  -----------\n   \n  dyn.load(\"testCX1.dll\")\nxL <- 1:5\nxL <- as.double(as.vector(t(xL)))\n  .Call(\"testC1\",xL)\n\n  [1] 55\n   \n   \n\n       \n---------------------------------\n\n\t[[alternative HTML version deleted]]\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}