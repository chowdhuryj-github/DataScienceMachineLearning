{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22409 - in\n\tbranches/SAMBA_4_0/source/script/tests: .", "body": "Author: metze\nDate: 2007-04-20 11:40:44 +0000 (Fri, 20 Apr 2007)\nNew Revision: 22409\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22409\n\nLog:\ntry to fix selftest.pl on systems with old perl versions\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/script/tests/Samba3.pm\n   branches/SAMBA_4_0/source/script/tests/Samba4.pm\n   branches/SAMBA_4_0/source/script/tests/SocketWrapper.pm\n   branches/SAMBA_4_0/source/script/tests/selftest.pl\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/script/tests/Samba3.pm\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/Samba3.pm\t2007-04-20 11:29:45 UTC (rev 22408)\n+++ branches/SAMBA_4_0/source/script/tests/Samba3.pm\t2007-04-20 11:40:44 UTC (rev 22409)\n@@ -8,7 +8,6 @@\n use strict;\n use Cwd qw(abs_path);\n use FindBin qw($RealBin);\n-use POSIX;\n \n sub binpath($$)\n {\n@@ -203,12 +202,12 @@\n \t## \n \t## create the test directory layout\n \t##\n-\tmkdir($prefix_abs);\n+\tmkdir($prefix_abs, 0777);\n \tprint \"CREATE TEST ENVIRONMENT IN '$prefix'...\";\n \tsystem(\"rm -rf $prefix_abs/*\");\n-\tmkdir($_) foreach($privatedir,$libdir,$piddir,$lockdir,$logdir);\n+\tmkdir($_, 0777) foreach($privatedir,$libdir,$piddir,$lockdir,$logdir);\n \tmy $tmpdir = \"$prefix_abs/tmp\";\n-\tmkdir($tmpdir);\n+\tmkdir($tmpdir, 0777);\n \tchmod 0777, $tmpdir;\n \n \topen(CONF, \">$conffile\") or die(\"Unable to open $conffile\");\n\nModified: branches/SAMBA_4_0/source/script/tests/Samba4.pm\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/Samba4.pm\t2007-04-20 11:29:45 UTC (rev 22408)\n+++ branches/SAMBA_4_0/source/script/tests/Samba4.pm\t2007-04-20 11:40:44 UTC (rev 22409)\n@@ -173,7 +173,7 @@\n {\n \tmy ($self, $ldapdir, $basedn, $root, $password, $privatedir, $configuration) = @_;\n \n-\tmkdir($ldapdir);\n+\tmkdir($ldapdir, 0777);\n \n \tmy $fedora_ds_inf = \"$ldapdir/fedorads.inf\";\n \tmy $fedora_ds_initial_ldif = \"$ldapdir/fedorads-initial.ldif\";\n@@ -270,7 +270,7 @@\n \tmy $pidfile = \"$ldapdir/slapd.pid\";\n \tmy $modconf = \"$ldapdir/modules.conf\";\n \n-\tmkdir($_) foreach ($ldapdir, \"$ldapdir/db\", \"$ldapdir/db/bdb-logs\", \n+\tmkdir($_, 0777) foreach ($ldapdir, \"$ldapdir/db\", \"$ldapdir/db/bdb-logs\", \n \t\t\"$ldapdir/db/tmp\");\n \n \topen(CONF, \">$slapd_conf\");\n@@ -405,7 +405,7 @@\n \tmy $root = ($ENV{USER} or $ENV{LOGNAME} or `whoami`);\n \tmy $server = \"localhost\";\n \tmy $srcdir=\"$RealBin/../..\";\n-\t-d $prefix or mkdir($prefix) or die(\"Unable to create $prefix\");\n+\t-d $prefix or mkdir($prefix, 0777) or die(\"Unable to create $prefix\");\n \tmy $prefix_abs = abs_path($prefix);\n \tmy $tmpdir = \"$prefix_abs/tmp\";\n \tmy $etcdir = \"$prefix_abs/etc\";\n@@ -426,7 +426,7 @@\n \tmy $interfaces = \"$ifaceipv4/8\";\n \n \t(system(\"rm -rf $prefix/*\") == 0) or die(\"Unable to clean up\");\n-\tmkdir($_) foreach ($privatedir, $etcdir, $piddir, $ncalrpcdir, $lockdir, \n+\tmkdir($_, 0777) foreach ($privatedir, $etcdir, $piddir, $ncalrpcdir, $lockdir, \n \t\t$tmpdir);\n \n \topen(CONFFILE, \">$conffile\");\n\nModified: branches/SAMBA_4_0/source/script/tests/SocketWrapper.pm\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/SocketWrapper.pm\t2007-04-20 11:29:45 UTC (rev 22408)\n+++ branches/SAMBA_4_0/source/script/tests/SocketWrapper.pm\t2007-04-20 11:40:44 UTC (rev 22409)\n@@ -21,7 +21,7 @@\n \t\tif ( -d $dir ) {\n \t\t\tunlink <$dir/*>;\n \t\t} else {\n-\t\t\tmkdir($dir);\n+\t\t\tmkdir($dir, 0777);\n \t\t}\n \n \t\tif ($pcap) {\n@@ -30,7 +30,7 @@\n \t\t\tif ( -d $pcap_dir ) {\n \t\t\t\tunlink <$pcap_dir/*>;\n \t\t\t} else {\n-\t\t\t\tmkdir($pcap_dir);\n+\t\t\t\tmkdir($pcap_dir, 0777);\n \t\t\t}\n \t\t}\n \t}\n\nModified: branches/SAMBA_4_0/source/script/tests/selftest.pl\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-20 11:29:45 UTC (rev 22408)\n+++ branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-20 11:40:44 UTC (rev 22409)\n@@ -494,7 +494,7 @@\n die(\"using an empty prefix isn't allowed\") unless $prefix ne \"\";\n \n #Ensure we have the test prefix around\n-mkdir $prefix unless -d $prefix;\n+mkdir($prefix, 0777) unless -d $prefix;\n \n my $prefix_abs = abs_path($prefix);\n my $srcdir_abs = abs_path($srcdir);\n@@ -581,12 +581,12 @@\n {\n \tmy ($conffile, $vars) = @_;\n \n-\tmkdir \"$prefix/client\" unless -d \"$prefix/client\";\n+\tmkdir(\"$prefix/client\", 0777) unless -d \"$prefix/client\";\n \t\n \tif ( -d \"$prefix/client/private\" ) {\n \t        unlink <$prefix/client/private/*>;\n \t} else {\n-\t        mkdir(\"$prefix/client/private\");\n+\t        mkdir(\"$prefix/client/private\", 0777);\n \t}\n \n \topen(CF, \">$conffile\");\n\n"}