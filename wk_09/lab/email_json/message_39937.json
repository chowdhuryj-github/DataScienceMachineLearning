{"category": "ham", "to_address": "\"Lucke, Joseph F\" <Joseph.F.Lucke@uth.tmc.edu>", "from_address": "Prof Brian Ripley <ripley@stats.ox.ac.uk>", "subject": "Re: [R] RODBC query", "body": "On Thu, 31 May 2007, Lucke, Joseph F wrote:\n\n> As a newbie to RODBC (Windows XP), I find that the commands aren't\n> working quite as expected.\n> After\n> Library(RODBC)\n>\n> I had planned to use the two-step process\n>\n> myConn = odbcConnectExcel(\"Dates.xls\")\n> sqlQuery(myConn,\"SELECT ID, ADM_DATE, ADM_TIME FROM A\")\t#A is the Excel\n> spreadsheet name\n> X = sqlGetResults(myConn, as.is=c(T,T,F))\n> #2 char variables and 1 integer\n> odbcClose(myConn)\n>\n> This doesn't work.  Instead the following works:\n>\n> myConn = odbcConnectExcel(\"Dates.xls\")\n> X=sqlQuery(myConn,\"SELECT ID, ADM_DATE, ADM_TIME FROM A\",\n> as.is=c(T,T,F))\n> odbcClose(myConn)\n>\n>\n>> class(X)\n> [1] \"data.frame\"\n>> class(X$ID)\n> [1] \"character\"\n>> class(X[,2])\n> [1] \"character\"\n>> class(X[,3])\n> [1] \"integer\"\n>\n>\n> I thought sqlQuery stored a query that was to be processed by\n> sqlGetResults.  What's happening here?\n\nListing the function shows\n\n> sqlQuery\nfunction (channel, query, errors = TRUE, ..., rows_at_time = 1)\n{\n     if (!odbcValidChannel(channel))\n         stop(\"first argument is not an open RODBC channel\")\n     if (missing(query))\n         stop(\"missing parameter\")\n     stat <- odbcQuery(channel, query, rows_at_time)\n     if (stat == -1) {\n         if (errors)\n             return(odbcGetErrMsg(channel))\n         else return(stat)\n     }\n     else return(sqlGetResults(channel, errors = errors, ...))\n}\n\nIt is odbcQuery that runs the query alone.\n\n-- \nBrian D. Ripley,                  ripley@stats.ox.ac.uk\nProfessor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/\nUniversity of Oxford,             Tel:  +44 1865 272861 (self)\n1 South Parks Road,                     +44 1865 272866 (PA)\nOxford OX1 3TG, UK                Fax:  +44 1865 272595\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}