{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 559: merge from ronnie in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 559\nrevision-id: tridge@samba.org-20070704235911-gugknnnxjrihz80j\nparent: tridge@samba.org-20070704074546-njwthegu8tr03nh1\nparent: sahlberg@ronnie-20070704225602-1pdwoj344094s5nr\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Thu 2007-07-05 09:59:11 +1000\nmessage:\n  merge from ronnie\nmodified:\n  tools/ctdb.c                   ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1\n    ------------------------------------------------------------\n    revno: 432.1.104\n    merged: sahlberg@ronnie-20070704225602-1pdwoj344094s5nr\n    parent: sahlberg@ronnie-20070704075316-eaqoj4wjslthmefz\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Thu 2007-07-05 08:56:02 +1000\n    message:\n      add a command to ctdb to send tickle-ack's\n    ------------------------------------------------------------\n    revno: 432.1.103\n    merged: sahlberg@ronnie-20070704075316-eaqoj4wjslthmefz\n    parent: sahlberg@ronnie-20070704073726-6cnz54zcjrbxjml3\n    parent: tridge@samba.org-20070704074546-njwthegu8tr03nh1\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Wed 2007-07-04 17:53:16 +1000\n    message:\n      merge from tridge\n    ------------------------------------------------------------\n    revno: 432.1.102\n    merged: sahlberg@ronnie-20070704073726-6cnz54zcjrbxjml3\n    parent: sahlberg@ronnie-20070704073516-rbnjmtlp5cz0dbul\n    parent: tridge@samba.org-20070704065238-u4jop7aazj7ptv10\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Wed 2007-07-04 17:37:26 +1000\n    message:\n      merge from tridge\n    ------------------------------------------------------------\n    revno: 432.1.101\n    merged: sahlberg@ronnie-20070704073516-rbnjmtlp5cz0dbul\n    parent: sahlberg@ronnie-20070704041628-k3och7ffjambzc8q\n    parent: tridge@samba.org-20070704065113-wrmwku4qyjcgd3vm\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Wed 2007-07-04 17:35:16 +1000\n    message:\n      merge from tridge\n=== modified file 'tools/ctdb.c'\n--- a/tools/ctdb.c\t2007-07-04 06:51:13 +0000\n+++ b/tools/ctdb.c\t2007-07-04 22:56:02 +0000\n@@ -338,6 +338,37 @@\n }\n \n /*\n+  send a tcp tickle ack\n+ */\n+static int tickle_tcp(struct ctdb_context *ctdb, int argc, const char **argv)\n+{\n+\tint ret;\n+\tstruct sockaddr_in src, dst;\n+\n+\tif (argc < 2) {\n+\t\tusage();\n+\t}\n+\n+\tif (!parse_ip_port(argv[0], &src)) {\n+\t\tprintf(\"Bad IP:port '%s'\\n\", argv[1]);\n+\t\treturn -1;\n+\t}\n+\n+\tif (!parse_ip_port(argv[1], &dst)) {\n+\t\tprintf(\"Bad IP:port '%s'\\n\", argv[1]);\n+\t\treturn -1;\n+\t}\n+\n+\tret = ctdb_sys_send_tcp(&src, &dst, 0, 0, 0);\n+\tif (ret==0) {\n+\t\treturn 0;\n+\t}\n+\tprintf(\"Error while sending tickle ack\\n\");\n+\n+\treturn -1;\n+}\n+\n+/*\n   display public ip status\n  */\n static int control_ip(struct ctdb_context *ctdb, int argc, const char **argv)\n@@ -859,6 +890,7 @@\n \t{ \"freeze\",          control_freeze,            true,  \"freeze all databases\" },\n \t{ \"thaw\",            control_thaw,              true,  \"thaw all databases\" },\n \t{ \"killtcp\",         kill_tcp,                  false, \"kill a tcp connection\", \" \" },\n+\t{ \"tickle\",          tickle_tcp,                false, \"send a tcp tickle ack\", \" \" },\n };\n \n /*\n\n"}