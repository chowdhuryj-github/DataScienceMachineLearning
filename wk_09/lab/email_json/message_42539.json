{"category": "ham", "to_address": "\"Anup Nandialath\" <anup_nandialath@yahoo.com>", "from_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "subject": "Re: [R] Help with conditional lagging of data", "body": "Seems you want to diff X, not lag it.\n\nWe can either maintain the long form of the data and do it as in #1\nor convert the data to \"wide\" form and do it as in #2 which is most\nconvenient using zoo where we make the individual time series into\nzoo series, merge them and then apply diff:\n\n\nLines <- \"ID     Year     X\nAB12   2000    100\nAB12   2001    120\nAB12   2002    140\nAB12   2003    80\nBL14   2000    180\nBL14   2001    150\nCR93   2000    45\nCR93   2001    49\nCR93   2002    56\nCR93   2003    67\n\"\nDF <- read.table(textConnection(Lines), header = TRUE)\n\n# 1\nf <- function(DF) cbind(DF[,1:2], diff = c(NA, diff(DF$X)))\nDF.by <- by(DF, DF$ID, f)\ndo.call(\"rbind\", DF.by)\n\n# 2\nlibrary(zoo)\nfz <- function(DF) zoo(DF$X, DF$Year)\ndiff(do.call(\"merge\", by(DF, DF$ID, fz)), na.pad = TRUE)\n\nFor more info on zoo:\nlibrary(zoo)\nvignette(\"zoo\")\n\nOn 6/4/07, Anup Nandialath  wrote:\n> Dear Friends,\n>\n> I have some data with three columns named ID, Year and Measure X. I need to create a column which gives me a lag for each ID (note not a continous lag), but a lag conditional on the id and the given year. Please find below a sample of the data\n>\n> Input file sample\n>\n> ID     Year     X\n>\n> AB12   2000    100\n> AB12   2001    120\n> AB12   2002    140\n> AB12   2003    80\n> BL14   2000    180\n> BL14   2001    150\n> CR93   2000    45\n> CR93   2001    49\n> CR93   2002    56\n> CR93   2003    67\n>\n> Expected output from this data\n>\n> ID     Year   Xlag\n> AB12   2000     .\n> AB12   2001   20\n> AB12   2002   20\n> AB12   2003   -60\n> BL12   2000    .\n> BL14   2001   -30\n> CR93   2000     .\n> CR93   2001     5\n> CR93   2002     7\n> CR93   2003     9\n>\n> Can somebody please help me with how to implement this in R. Thanks.\n>\n> Sincerely\n>\n> Anup\n>\n>\n>\n> ---------------------------------\n> Looking for a deal? Find great prices on flights and hotels with Yahoo! FareChase.\n>        [[alternative HTML version deleted]]\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}