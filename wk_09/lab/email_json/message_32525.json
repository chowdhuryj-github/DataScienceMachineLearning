{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 324: nicer date formatting in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 324\nrevision-id: tridge@samba.org-20070519040102-fo2l751oby7bd8gr\nparent: tridge@samba.org-20070519034524-ly1k7rzoi42sdpe1\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-05-19 14:01:02 +1000\nmessage:\n  nicer date formatting\nmodified:\n  lib/util/debug.c               debug.c-20070417155854-2i3crb0irl716qft-1\n=== modified file 'lib/util/debug.c'\n--- a/lib/util/debug.c\t2007-04-23 10:45:14 +0000\n+++ b/lib/util/debug.c\t2007-05-19 04:01:02 +0000\n@@ -25,17 +25,22 @@\n \n void do_debug(const char *format, ...)\n {\n-\tstruct timeval tm;\n+\tstruct timeval t;\n \tva_list ap;\n \tchar *s = NULL;\n+\tstruct tm *tm;\n+\tchar tbuf[100];\n \n \tva_start(ap, format);\n \tvasprintf(&s, format, ap);\n \tva_end(ap);\n \n-\tgettimeofday(&tm, NULL);\n-\tprintf(\"%-8.8d.%-6.6d [%d]: %s\", (int)tm.tv_sec, (int)tm.tv_usec,\n-\t       (int)getpid(), s);\n+\tt = timeval_current();\n+\ttm = localtime(&t.tv_sec);\n+\n+\tstrftime(tbuf,sizeof(tbuf)-1,\"%Y/%m/%d %H:%M:%S\", tm);\n+\n+\tprintf(\"%s.%06u [%5u]: %s\", tbuf, (unsigned)t.tv_usec, (unsigned)getpid(), s);\n \tfflush(stdout);\n \tfree(s);\n }\n\n"}