{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r23686 - in branches/SAMBA_3_0_26/source/script: .", "body": "Author: metze\nDate: 2007-07-03 15:44:58 +0000 (Tue, 03 Jul 2007)\nNew Revision: 23686\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23686\n\nLog:\nmerge from SAMBA_4_0:\n\nOnly use the bzr and git information when there's\na .bzr or .git in the top branch directory\n\nI use bzr for my home directory and\nbzr version-info in ~/devel/samba/4.0/samba4-git\ngives the info about the ~/.bzr branch\n\nmetze\nModified:\n   branches/SAMBA_3_0_26/source/script/mkversion.sh\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/script/mkversion.sh\n===================================================================\n--- branches/SAMBA_3_0_26/source/script/mkversion.sh\t2007-07-03 14:46:06 UTC (rev 23685)\n+++ branches/SAMBA_3_0_26/source/script/mkversion.sh\t2007-07-03 15:44:58 UTC (rev 23686)\n@@ -91,7 +91,7 @@\n \tTMP_MIRRORED_REVISION=`echo -e \"${SVK_INFO}\" | grep 'Mirrored From:.*samba\\.org.*' |sed -e 's/Mirrored From: .* Rev\\..* \\([0-9]*\\).*/\\1/'`\n     fi\n \n-    if test x\"${HAVEVER}\" != x\"yes\";then\n+    if test x\"${HAVEVER}\" != x\"yes\" -a -d \"${SOURCE_DIR}../.bzr\";then\n     \tHAVEBZR=no\n \tBZR_INFO=`bzr version-info --check-clean ${SOURCE_DIR} 2>/dev/null`\n \tTMP_REVISION=`echo -e \"${BZR_INFO}\" | grep 'revno:' |sed -e 's/revno: \\([0-9]*\\).*/\\1/'`\n@@ -104,7 +104,7 @@\n \tTMP_CLEAN_TREE=`echo -e \"${BZR_INFO}\" | grep 'clean:' |sed -e 's/clean: \\([a-zA-Z]*\\).*/\\1/'`\n     fi\n \n-    if test x\"${HAVEVER}\" != x\"yes\";then\n+    if test x\"${HAVEVER}\" != x\"yes\" -a -d \"${SOURCE_DIR}../.git\";then\n \tHAVEGIT=no\n         GIT_INFO=`git show --abbrev-commit HEAD 2>/dev/null`\n \tTMP_REVISION=`echo -e \"${GIT_INFO}\" | grep 'commit ' | sed 1q |sed -e 's/commit \\([0-9a-f]*\\).*/\\1/'`\n\n"}