{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r22208 - in\n\tbranches/SAMBA_4_0/source/auth/gensec: .", "body": "Author: abartlet\nDate: 2007-04-13 05:37:08 +0000 (Fri, 13 Apr 2007)\nNew Revision: 22208\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22208\n\nLog:\nPrint the target principal name, to help with kdc unreachable errors.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\n===================================================================\n--- branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\t2007-04-13 01:46:47 UTC (rev 22207)\n+++ branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\t2007-04-13 05:37:08 UTC (rev 22208)\n@@ -320,21 +320,18 @@\n \n \tprincipal = gensec_get_target_principal(gensec_security);\n \tif (principal && lp_client_use_spnego_principal()) {\n-\t\tname_token.value  = discard_const_p(uint8_t, principal);\n-\t\tname_token.length = strlen(principal);\n-\n \t\tname_type = GSS_C_NULL_OID;\n \t} else {\n \t\tprincipal = talloc_asprintf(gensec_gssapi_state, \"%s@%s\", \n \t\t\t\t\t    gensec_get_target_service(gensec_security), \n \t\t\t\t\t    hostname);\n \n-\t\tname_token.value  = discard_const_p(uint8_t, principal);\n-\t\tname_token.length = strlen(principal);\n-\n \t\tname_type = GSS_C_NT_HOSTBASED_SERVICE;\n \t}\t\t\n+\tname_token.value  = discard_const_p(uint8_t, principal);\n+\tname_token.length = strlen(principal);\n \n+\n \tmaj_stat = gss_import_name (&min_stat,\n \t\t\t\t    &name_token,\n \t\t\t\t    name_type,\n@@ -351,7 +348,7 @@\n \tcase 0:\n \t\tbreak;\n \tcase KRB5_KDC_UNREACH:\n-\t\tDEBUG(3, (\"Cannot reach a KDC we require\\n\"));\n+\t\tDEBUG(3, (\"Cannot reach a KDC we require to contact %s\\n\", principal));\n \t\treturn NT_STATUS_INVALID_PARAMETER; /* Make SPNEGO ignore us, we can't go any further here */\n \tdefault:\n \t\tDEBUG(1, (\"Aquiring initiator credentails failed\\n\"));\n\n"}