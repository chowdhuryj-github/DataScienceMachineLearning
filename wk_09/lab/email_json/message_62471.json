{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r23716 - in branches/SAMBA_4_0/source:\n\tscripting/libjs setup", "body": "Author: abartlet\nDate: 2007-07-05 01:45:37 +0000 (Thu, 05 Jul 2007)\nNew Revision: 23716\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23716\n\nLog:\nClarify LDAP Manager DN and fix slapd startup syntax.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/scripting/libjs/provision.js\n   branches/SAMBA_4_0/source/setup/fedorads.inf\n   branches/SAMBA_4_0/source/setup/provision-backend\n   branches/SAMBA_4_0/source/setup/slapd.conf\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/scripting/libjs/provision.js\n===================================================================\n--- branches/SAMBA_4_0/source/scripting/libjs/provision.js\t2007-07-05 00:34:11 UTC (rev 23715)\n+++ branches/SAMBA_4_0/source/scripting/libjs/provision.js\t2007-07-05 01:45:37 UTC (rev 23716)\n@@ -464,6 +464,8 @@\n \tvar ldap_path_list = split(\"/\", paths.ldapdir);\n \tsubobj.LDAPI_URI = \"ldapi://\" + join(\"%2F\", ldap_path_list) + \"%2Fldapi\";\n \n+\tsubobj.LDAP_MANAGERDN = \"cn=Manager,\" + subobj.DOMAINDN;\n+\n \treturn true;\n }\n \n@@ -852,7 +854,7 @@\n \tsubobj.KRBTGTPASS   = randpass(12);\n \tsubobj.MACHINEPASS  = randpass(12);\n \tsubobj.ADMINPASS    = randpass(12);\n-\tsubobj.LDAPMANAGERPASS     = randpass(12);\n+\tsubobj.LDAP_MANAGERPASS     = randpass(12);\n \tsubobj.DEFAULTSITE  = \"Default-First-Site-Name\";\n \tsubobj.NEWGUID      = randguid;\n \tsubobj.NTTIME       = nttime;\n\nModified: branches/SAMBA_4_0/source/setup/fedorads.inf\n===================================================================\n--- branches/SAMBA_4_0/source/setup/fedorads.inf\t2007-07-05 00:34:11 UTC (rev 23715)\n+++ branches/SAMBA_4_0/source/setup/fedorads.inf\t2007-07-05 01:45:37 UTC (rev 23716)\n@@ -6,8 +6,8 @@\n [slapd]\n ldapifilepath=${LDAPDIR}/ldapi\n Suffix= ${DOMAINDN}\n-RootDN= cn=Manager,${DOMAINDN}\n-RootDNPwd= ${LDAPMANAGERPASS}\n+RootDN= ${LDAP_MANAGERDN}\n+RootDNPwd= ${LDAP_MANAGERPASS}\n ServerIdentifier= samba4\n ${SERVERPORT}\n \n\nModified: branches/SAMBA_4_0/source/setup/provision-backend\n===================================================================\n--- branches/SAMBA_4_0/source/setup/provision-backend\t2007-07-05 00:34:11 UTC (rev 23715)\n+++ branches/SAMBA_4_0/source/setup/provision-backend\t2007-07-05 01:45:37 UTC (rev 23716)\n@@ -90,7 +90,7 @@\n var paths = provision_default_paths(subobj);\n provision_fix_subobj(subobj, paths);\n message(\"Provisioning LDAP backend for %s in realm %s into %s\\n\", subobj.HOSTNAME, subobj.REALM, subobj.LDAPDIR);\n-message(\"Using LDAP Manager password: %s\\n\", subobj.LDAPMANAGERPASS);\n+message(\"Using %s password: %s\\n\", subobj.LDAP_MANAGERDN, subobj.LDAP_MANAGERPASS);\n var tmp_schema_ldb = subobj.LDAPDIR + \"/schema-tmp.ldb\";\n sys.mkdir(subobj.LDAPDIR, 0700);\n \n@@ -137,7 +137,7 @@\n \tsetup_file(\"DB_CONFIG\", message, subobj.LDAPDBDIR + \"/DB_CONFIG\", subobj);\n \tif (options[\"ldap-backend-port\"] != undefined) {\n \t\tmessage(\"\\nStart slapd with: \\n\");\n-\t\tslapd_command = \"slapd -f \" + subobj.LDAPDIR + \"/slapd.conf -h ldap://0.0.0.0:\" + options[\"ldap-backend-port\"] + \" -h \" + subobj.LDAPI_URI;\n+\t\tslapd_command = \"slapd -f \" + subobj.LDAPDIR + \"/slapd.conf -h \\\"ldap://0.0.0.0:\" + options[\"ldap-backend-port\"] + \" \" + subobj.LDAPI_URI \"\\\"\";\n \t} else {\n \t\tslapd_command = \"slapd -f \" + subobj.LDAPDIR + \"/slapd.conf -h \" + subobj.LDAPI_URI;\n \t}\n\nModified: branches/SAMBA_4_0/source/setup/slapd.conf\n===================================================================\n--- branches/SAMBA_4_0/source/setup/slapd.conf\t2007-07-05 00:34:11 UTC (rev 23715)\n+++ branches/SAMBA_4_0/source/setup/slapd.conf\t2007-07-05 01:45:37 UTC (rev 23716)\n@@ -47,8 +47,8 @@\n \n database        bdb\n suffix\t\t${DOMAINDN}\n-rootdn          cn=Manager,${DOMAINDN}\n-rootpw          ${LDAPMANAGERPASS}\n+rootdn          ${LDAP_MANAGERDN}\n+rootpw          ${LDAP_MANAGERPASS}\n directory\t${LDAPDIR}/db/user\n index           objectClass eq\n index           samAccountName eq\n\n"}