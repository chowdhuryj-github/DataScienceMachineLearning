{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jpeach@samba.org", "subject": "svn commit: samba r22419 - in branches/SAMBA_3_0/source: . tests", "body": "Author: jpeach\nDate: 2007-04-20 21:31:04 +0000 (Fri, 20 Apr 2007)\nNew Revision: 22419\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22419\n\nLog:\nUpdate configure so that we only need one copy of os2_delete.c\n\nRemoved:\n   branches/SAMBA_3_0/source/tests/os2_delete.c\nModified:\n   branches/SAMBA_3_0/source/configure.in\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/configure.in\n===================================================================\n--- branches/SAMBA_3_0/source/configure.in\t2007-04-20 21:09:44 UTC (rev 22418)\n+++ branches/SAMBA_3_0/source/configure.in\t2007-04-20 21:31:04 UTC (rev 22419)\n@@ -2813,7 +2813,12 @@\n fi\n \n AC_CACHE_CHECK([for broken readdir],samba_cv_HAVE_BROKEN_READDIR,[\n-\tAC_TRY_RUN([#include \"${srcdir-.}/tests/os2_delete.c\"],\n+\tAC_TRY_RUN([\n+#include \"${srcdir-.}/lib/replace/test/os2_delete.c\"\n+int main(void) {\n+    return test_readdir_os2_delete();\n+}\n+],\n \t\t[samba_cv_HAVE_BROKEN_READDIR=no],\n \t\t\t[samba_cv_HAVE_BROKEN_READDIR=yes],\n \t\t\t[samba_cv_HAVE_BROKEN_READDIR=\"assuming not\"])])\n@@ -2822,7 +2827,10 @@\n AC_CACHE_CHECK([for replacing readdir],samba_cv_REPLACE_READDIR,[\n \tAC_TRY_RUN([\n #include \"${srcdir-.}/lib/repdir.c\"\n-#include \"${srcdir-.}/tests/os2_delete.c\"],\n+#include \"${srcdir-.}/lib/replace/test/os2_delete.c\"\n+int main(void) {\n+    return test_readdir_os2_delete();\n+],\n \tsamba_cv_REPLACE_READDIR=yes,samba_cv_REPLACE_READDIR=no)])\n fi\n \n\nDeleted: branches/SAMBA_3_0/source/tests/os2_delete.c\n===================================================================\n--- branches/SAMBA_3_0/source/tests/os2_delete.c\t2007-04-20 21:09:44 UTC (rev 22418)\n+++ branches/SAMBA_3_0/source/tests/os2_delete.c\t2007-04-20 21:31:04 UTC (rev 22419)\n@@ -1,107 +0,0 @@\n-/*\n-  test readdir/unlink pattern that OS/2 uses\n-  tridge@samba.org July 2005\n-*/\n-\n-#include \n-#include \n-#include \n-#include \n-#include \n-#include \n-#include \n-#include \n-#include \n-\n-#define NUM_FILES 700\n-#define READDIR_SIZE 100\n-#define DELETE_SIZE 4\n-\n-#define TESTDIR \"test.dir\"\n-\n-#define FAILED(d) (fprintf(stderr, \"Failed for %s - %s\\n\", d, strerror(errno)), exit(1), 1)\n-\n-#ifndef MIN\n-#define MIN(a,b) ((a)<(b)?(a):(b))\n-#endif\n-\n-static void cleanup(void)\n-{\n-\t/* I'm a lazy bastard */\n-\tsystem(\"rm -rf \" TESTDIR);\n-\tmkdir(TESTDIR, 0700) == 0 || FAILED(\"mkdir\");\n-}\n-\n-static void create_files()\n-{\n-\tint i;\n-\tfor (i=0;id_name);\n-\t}\n-\n-\tif (i == 0) {\n-\t\treturn 0;\n-\t}\n-\n-\t/* delete the first few */\n-\tfor (j=0; jd_name, \".\") == 0 || FAILED(\"match .\");\n-\tde = readdir(d);\n-\tstrcmp(de->d_name, \"..\") == 0 || FAILED(\"match ..\");\n-\n-\twhile (1) {\n-\t\tint n = os2_delete(d);\n-\t\tif (n == 0) break;\n-\t\ttotal_deleted += n;\n-\t}\n-\tclosedir(d);\n-\n-\tprintf(\"Deleted %d files of %d\\n\", total_deleted, NUM_FILES);\n-\n-\trmdir(TESTDIR) == 0 || FAILED(\"rmdir\");\n-\n-\treturn 0;\n-}\n\n"}