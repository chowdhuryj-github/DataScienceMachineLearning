{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r22509 - in branches: SAMBA_3_0/source/groupdb\n\tSAMBA_3_0_25/source/groupdb", "body": "Author: jerry\nDate: 2007-04-25 09:32:03 +0000 (Wed, 25 Apr 2007)\nNew Revision: 22509\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22509\n\nLog:\nFix some memory corruption caused by calling free()\non talloc()'d memory when adding/removing members\nfrom Local Groups.\n\n\nModified:\n   branches/SAMBA_3_0/source/groupdb/mapping_tdb.c\n   branches/SAMBA_3_0_25/source/groupdb/mapping_tdb.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/groupdb/mapping_tdb.c\n===================================================================\n--- branches/SAMBA_3_0/source/groupdb/mapping_tdb.c\t2007-04-25 02:43:23 UTC (rev 22508)\n+++ branches/SAMBA_3_0/source/groupdb/mapping_tdb.c\t2007-04-25 09:32:03 UTC (rev 22509)\n@@ -455,11 +455,11 @@\n \n \tfor (i=0; i<num; i++) {\n \t\tif (sid_compare(alias, &sids[i]) == 0) {\n-\t\t\tSAFE_FREE(sids);\n+\t\t\tTALLOC_FREE(sids);\n \t\t\treturn True;\n \t\t}\n \t}\n-\tSAFE_FREE(sids);\n+\tTALLOC_FREE(sids);\n \treturn False;\n }\n \n@@ -622,7 +622,7 @@\n \t}\n \n \tif (!found) {\n-\t\tSAFE_FREE(sids);\n+\t\tTALLOC_FREE(sids);\n \t\treturn NT_STATUS_MEMBER_NOT_IN_ALIAS;\n \t}\n \n@@ -641,7 +641,7 @@\n \tmember_string = SMB_STRDUP(\"\");\n \n \tif (member_string == NULL) {\n-\t\tSAFE_FREE(sids);\n+\t\tTALLOC_FREE(sids);\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \n@@ -653,7 +653,7 @@\n \n \t\tSAFE_FREE(s);\n \t\tif (member_string == NULL) {\n-\t\t\tSAFE_FREE(sids);\n+\t\t\tTALLOC_FREE(sids);\n \t\t\treturn NT_STATUS_NO_MEMORY;\n \t\t}\n \t}\n@@ -663,7 +663,7 @@\n \tresult = tdb_store_bystring(tdb, key, dbuf, 0) == 0 ?\n \t\tNT_STATUS_OK : NT_STATUS_ACCESS_DENIED;\n \n-\tSAFE_FREE(sids);\n+\tTALLOC_FREE(sids);\n \tSAFE_FREE(member_string);\n \n \treturn result;\n\nModified: branches/SAMBA_3_0_25/source/groupdb/mapping_tdb.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/groupdb/mapping_tdb.c\t2007-04-25 02:43:23 UTC (rev 22508)\n+++ branches/SAMBA_3_0_25/source/groupdb/mapping_tdb.c\t2007-04-25 09:32:03 UTC (rev 22509)\n@@ -466,11 +466,11 @@\n \n \tfor (i=0; i<num; i++) {\n \t\tif (sid_compare(alias, &sids[i]) == 0) {\n-\t\t\tSAFE_FREE(sids);\n+\t\t\tTALLOC_FREE(sids);\n \t\t\treturn True;\n \t\t}\n \t}\n-\tSAFE_FREE(sids);\n+\tTALLOC_FREE(sids);\n \treturn False;\n }\n \n@@ -637,7 +637,7 @@\n \t}\n \n \tif (!found) {\n-\t\tSAFE_FREE(sids);\n+\t\tTALLOC_FREE(sids);\n \t\treturn NT_STATUS_MEMBER_NOT_IN_ALIAS;\n \t}\n \n@@ -659,7 +659,7 @@\n \tmember_string = SMB_STRDUP(\"\");\n \n \tif (member_string == NULL) {\n-\t\tSAFE_FREE(sids);\n+\t\tTALLOC_FREE(sids);\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \n@@ -671,7 +671,7 @@\n \n \t\tSAFE_FREE(s);\n \t\tif (member_string == NULL) {\n-\t\t\tSAFE_FREE(sids);\n+\t\t\tTALLOC_FREE(sids);\n \t\t\treturn NT_STATUS_NO_MEMORY;\n \t\t}\n \t}\n@@ -682,7 +682,7 @@\n \tresult = tdb_store(tdb, kbuf, dbuf, 0) == 0 ?\n \t\tNT_STATUS_OK : NT_STATUS_ACCESS_DENIED;\n \n-\tSAFE_FREE(sids);\n+\tTALLOC_FREE(sids);\n \tSAFE_FREE(member_string);\n \n \treturn result;\n\n"}