{"category": "ham", "to_address": "samba-technical@lists.samba.org", "from_address": "Martin Zielinski <mz@seh.de>", "subject": "3.0.25 cups printer location string sync", "body": "Hello all!\n\nI still don't like the way how the printer location string is grabbed \nfrom cups in get_a_printer_2() and get_a_printer_2_default() functions.\n\nThe reason is, if the comment or location is empty, then samba will\nallways ask cups. This can happen *very* frequently when clients are \nconnected to printer shares.\n\nAnother point is, that in get_printer_2_default() the comment string is \nallways empty. So the if-clause is unnecessary.\n\nThe cups-calls might not be such a big problem on large servers, but \nnonetheless it's a slow-down by design (if I havn't overlooked something \nobvious).\n\nI'd suggest to add the location to the service structure and the \npcap_cache structure. Then the location can be loaded at startup just \nlike the comment string (not overwriting the tdb-value if set).\n\n2ndly, in this case the user cannot update the string from the server \n(linux or so) side. So I would suggest to expand the rpcclient \n\"setprinter\" call (setprinter printername comment [location]).\n\nI'm not sure about the next thing, but if I update the printer comment \nand/or location string and do an AD search for printers afterwards, the \nnew strings are not visible in the result. I don't know, if there are \ntimeouts or sync intervals. If not, the printer should be \"republished\" \nafter the changes have been made.\n\nIf anyone is interested, I could provide a patch against 3.0.25.\n\nBest regards,\n\nMartin\n\n-- \nMartin Zielinski             mz@seh.de\nSoftware Development\nSEH Computertechnik GmbH     www.seh.de\n\n"}