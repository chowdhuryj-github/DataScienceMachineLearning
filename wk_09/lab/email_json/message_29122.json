{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 295: don't allow setrecmaster while not frozen in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 295\nrevision-id: tridge@samba.org-20070514034814-tfzpg9mzglmbr2s6\nparent: tridge@samba.org-20070512232016-fdj2opy995c536bs\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Mon 2007-05-14 13:48:14 +1000\nmessage:\n  don't allow setrecmaster while not frozen\nmodified:\n  common/ctdb_control.c          ctdb_control.c-20070426122724-j6gkpiofhbwdin63-1\n=== modified file 'common/ctdb_control.c'\n--- a/common/ctdb_control.c\t2007-05-12 11:25:26 +0000\n+++ b/common/ctdb_control.c\t2007-05-14 03:48:14 +0000\n@@ -123,8 +123,12 @@\n \t}\n \n \tcase CTDB_CONTROL_SET_RECMASTER: {\n+\t\tCHECK_CONTROL_DATA_SIZE(sizeof(uint32_t));\n+\t\tif (ctdb->freeze_mode != CTDB_FREEZE_FROZEN) {\n+\t\t\tDEBUG(0,(\"Attempt to set recmaster when not frozen\\n\"));\n+\t\t\treturn -1;\n+\t\t}\n \t\tctdb->recovery_master = ((uint32_t *)(&indata.dptr[0]))[0];\n-\n \t\treturn 0;\n \t}\n \n\n"}