{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "Tyler Smith <tyler.smith@mail.mcgill.ca>", "subject": "[R] my ugly apply/sweep code needs help", "body": "Hi,\n\nI have a matrix of data from from several groups. I need to center the\ndata by group, subtracting the group median from each value, initially\nfor two groups at a time. I have a working function to do this, but it\nlooks quite inelegant. There must be a more straightforward way to do\nthis, but I always get tangled up in apply/sweep/subset\noperations. Any suggestions welcome!\n\nThanks,\n\nTyler\n\nMy code:\n\nNotes: data.mat is an nxm matrix of data. group.vec is a vector of\nlength n with grouping factors. group.sel is a vector of length 2 of\nthe groups to include in the analysis.\n\nsweep.median <- function (data.mat, group.vec, group.sel) {\n\n  data.sub1 <- data.mat[group.vec %in% group.sel[1],]\n  data.sub2 <- data.mat[group.vec %in% group.sel[2],]\n\n  data.sub1.med <- apply(data.sub1, MAR=2, median)\n  data.sub1.cent <- sweep(data.sub1, MARGIN=2, data.sub1.med)\n\n  data.sub2.med <- apply(data.sub2, MAR=2, median)\n  data.sub2.cent <- sweep(data.sub2, MARGIN=2, data.sub2.med)\n\n  data.comb <- rbind(data.sub1.cent, data.sub2.cent)\n  data.comb <- cbind(c(rep(group.sel[1],nrow(data.sub1.cent)),\n                       rep(group.sel[2],nrow(data.sub2.cent))),\n                     data.comb)\n\n  return(data.comb)\n}\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}