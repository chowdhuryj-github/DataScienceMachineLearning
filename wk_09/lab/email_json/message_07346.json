{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 123: merge from ronnie in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 123\nrevision-id: tridge@samba.org-20070417013019-9960402b3fe6f53e\nparent: tridge@samba.org-20070417012659-f05788b9fd8c5d2e\nparent: ronniesahlberg@gmail.com-20070417001544-1yn8m2kuv2rq4gha\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Tue 2007-04-17 11:30:19 +1000\nmessage:\n  merge from ronnie\nmodified:\n  common/ctdb_client.c           ctdb_client.c-20070411010216-3kd8v37k61steeya-1\n  common/ctdb_daemon.c           ctdb_daemon.c-20070409200331-3el1kqgdb9m4ib0g-1\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070417001544-1yn8m2kuv2rq4gha\n    parent: ronniesahlberg@gmail.com-20070416233713-rhwr7kumq4ep0z8e\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-04-17 10:15:44 +1000\n    message:\n      change some error printouts to make it easier to determine whether the error occured in the client or in the daemon\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070416233713-rhwr7kumq4ep0z8e\n    parent: ronniesahlberg@gmail.com-20070416060308-8pqh272no0bgiimd\n    parent: tridge@samba.org-20070416231820-74f66bb640e03880\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-04-17 09:37:13 +1000\n    message:\n      merge from tridge\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070416060308-8pqh272no0bgiimd\n    parent: ronniesahlberg@gmail.com-20070416044509-85rjd1uwfjekn2pc\n    parent: tridge@samba.org-20070416060137-6d90f720fec05ba5\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Mon 2007-04-16 16:03:08 +1000\n    message:\n      merge from tridge\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070416044509-85rjd1uwfjekn2pc\n    parent: ronniesahlberg@gmail.com-20070416025048-taxc01rc8zxvgebz\n    parent: tridge@samba.org-20070416041310-3f6200073a57aeff\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Mon 2007-04-16 14:45:09 +1000\n    message:\n      merge from tridge\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070416025048-taxc01rc8zxvgebz\n    parent: ronniesahlberg@gmail.com-20070415223727-ps2603m9yf67eprd\n    parent: tridge@samba.org-20070416003139-ac731d5336e759e3\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Mon 2007-04-16 12:50:48 +1000\n    message:\n      merge from tridge\n=== modified file 'common/ctdb_client.c'\n--- a/common/ctdb_client.c\t2007-04-16 00:21:44 +0000\n+++ b/common/ctdb_client.c\t2007-04-17 00:15:44 +0000\n@@ -114,23 +114,23 @@\n \tstruct ctdb_req_header *hdr;\n \n \tif (cnt < sizeof(*hdr)) {\n-\t\tctdb_set_error(ctdb, \"Bad packet length %d\\n\", cnt);\n+\t\tctdb_set_error(ctdb, \"Bad packet length %d in client\\n\", cnt);\n \t\treturn;\n \t}\n \thdr = (struct ctdb_req_header *)data;\n \tif (cnt != hdr->length) {\n-\t\tctdb_set_error(ctdb, \"Bad header length %d expected %d\\n\", \n+\t\tctdb_set_error(ctdb, \"Bad header length %d expected %d in client\\n\", \n \t\t\t       hdr->length, cnt);\n \t\treturn;\n \t}\n \n \tif (hdr->ctdb_magic != CTDB_MAGIC) {\n-\t\tctdb_set_error(ctdb, \"Non CTDB packet rejected\\n\");\n+\t\tctdb_set_error(ctdb, \"Non CTDB packet rejected in client\\n\");\n \t\treturn;\n \t}\n \n \tif (hdr->ctdb_version != CTDB_VERSION) {\n-\t\tctdb_set_error(ctdb, \"Bad CTDB version 0x%x rejected\\n\", hdr->ctdb_version);\n+\t\tctdb_set_error(ctdb, \"Bad CTDB version 0x%x rejected in client\\n\", hdr->ctdb_version);\n \t\treturn;\n \t}\n \n\n=== modified file 'common/ctdb_daemon.c'\n--- a/common/ctdb_daemon.c\t2007-04-17 01:26:59 +0000\n+++ b/common/ctdb_daemon.c\t2007-04-17 01:30:19 +0000\n@@ -85,7 +85,7 @@\n \tr->srvid         = srvid;\n \tr->datalen       = data.dsize;\n \tmemcpy(&r->data[0], data.dptr, data.dsize);\n-\t\n+\n \tctdb_queue_send(client->queue, (uint8_t *)&r->hdr, len);\n \n \ttalloc_free(r);\n@@ -417,12 +417,12 @@\n \tstruct ctdb_req_header *hdr = data;\n \n \tif (hdr->ctdb_magic != CTDB_MAGIC) {\n-\t\tctdb_set_error(client->ctdb, \"Non CTDB packet rejected\\n\");\n+\t\tctdb_set_error(client->ctdb, \"Non CTDB packet rejected in daemon\\n\");\n \t\tgoto done;\n \t}\n \n \tif (hdr->ctdb_version != CTDB_VERSION) {\n-\t\tctdb_set_error(client->ctdb, \"Bad CTDB version 0x%x rejected\\n\", hdr->ctdb_version);\n+\t\tctdb_set_error(client->ctdb, \"Bad CTDB version 0x%x rejected in daemon\\n\", hdr->ctdb_version);\n \t\tgoto done;\n \t}\n \n@@ -468,12 +468,12 @@\n \t}\n \n \tif (cnt < sizeof(*hdr)) {\n-\t\tctdb_set_error(client->ctdb, \"Bad packet length %d\\n\", cnt);\n+\t\tctdb_set_error(client->ctdb, \"Bad packet length %d in daemon\\n\", cnt);\n \t\treturn;\n \t}\n \thdr = (struct ctdb_req_header *)data;\n \tif (cnt != hdr->length) {\n-\t\tctdb_set_error(client->ctdb, \"Bad header length %d expected %d\\n\", \n+\t\tctdb_set_error(client->ctdb, \"Bad header length %d expected %d\\n in daemon\", \n \t\t\t       hdr->length, cnt);\n \t\treturn;\n \t}\n@@ -484,7 +484,7 @@\n \t}\n \n \tif (hdr->ctdb_version != CTDB_VERSION) {\n-\t\tctdb_set_error(client->ctdb, \"Bad CTDB version 0x%x rejected\\n\", hdr->ctdb_version);\n+\t\tctdb_set_error(client->ctdb, \"Bad CTDB version 0x%x rejected in daemon\\n\", hdr->ctdb_version);\n \t\treturn;\n \t}\n \n\n"}