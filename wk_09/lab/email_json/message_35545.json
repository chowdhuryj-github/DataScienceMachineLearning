{"category": "ham", "to_address": "samba-technical@lists.samba.org", "from_address": "James Peach <jpeach@samba.org>", "subject": "Re: svn commit: samba r23108 - in branches:\n\tSAMBA_3_0/source/lib/replace SAMBA_3_0_26/source/lib/replace\n\tSAMBA_4_0/source/lib/replace", "body": "On May 24, 2007, at 12:15 AM, obnox@samba.org wrote:\n\n> Author: obnox\n> Date: 2007-05-24 07:15:36 +0000 (Thu, 24 May 2007)\n> New Revision: 23108\n>\n> WebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23108\n>\n> Log:\n> Add defines of RTLD_NOW and RTLD_GLOBAL to replace.h.\n> Fixing build of ldb for instance on some systems without dlfcn.h.\n>\n>\n> Modified:\n>   branches/SAMBA_3_0/source/lib/replace/replace.h\n>   branches/SAMBA_3_0_26/source/lib/replace/replace.h\n>   branches/SAMBA_4_0/source/lib/replace/replace.h\n>\n>\n> Changeset:\n> Modified: branches/SAMBA_3_0/source/lib/replace/replace.h\n> ===================================================================\n> --- branches/SAMBA_3_0/source/lib/replace/replace.h\t2007-05-24  \n> 01:57:02 UTC (rev 23107)\n> +++ branches/SAMBA_3_0/source/lib/replace/replace.h\t2007-05-24  \n> 07:15:36 UTC (rev 23108)\n> @@ -111,11 +111,6 @@\n> extern int errno;\n> #endif\n>\n> -#if defined(HAVE_LINUX_READAHEAD) && ! defined(HAVE_READAHEAD_DECL)\n> -ssize_t readahead(int fd, off64_t offset, size_t count);\n> -#endif\n> -\n> -\n> #ifndef HAVE_STRDUP\n> #define strdup rep_strdup\n> char *rep_strdup(const char *s);\n> @@ -326,6 +321,12 @@\n> #ifndef RTLD_LAZY\n> #define RTLD_LAZY 0\n> #endif\n> +#ifndef RTLD_NOW\n> +#define RTLD_NOW 0\n> +#endif\n> +#ifndef RTLD_GLOBAL\n> +#define RTLD_GLOBAL 0\n> +#endif\n\nIs there any expectation that this is actually going to work? If we  \ncabn't figure out the header that these definition live in, then  \nmaking them up isn't necessarily going to help, eg. on AIX RTLD_GLOBAL  \nappears to be 0x100. I don't know any system that defines them *all*  \nto zero.\n\nIf ldb requires these definitions, Id suggest simply disabling shared  \nlibrary support in lds unless they are present. That seems safer that  \npassing an arbitrary (random?) value into dlopen.\n\n--\nJames Peach | jpeach@samba.org\n\n"}