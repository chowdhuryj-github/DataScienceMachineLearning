{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22592 - in branches: SAMBA_3_0/source/modules\n\tSAMBA_3_0_25/source/modules", "body": "Author: jra\nDate: 2007-04-30 03:41:40 +0000 (Mon, 30 Apr 2007)\nNew Revision: 22592\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22592\n\nLog:\nFix TALLOC_SIZE to be consistent.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/modules/nfs4_acls.c\n   branches/SAMBA_3_0_25/source/modules/nfs4_acls.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/modules/nfs4_acls.c\n===================================================================\n--- branches/SAMBA_3_0/source/modules/nfs4_acls.c\t2007-04-30 03:38:19 UTC (rev 22591)\n+++ branches/SAMBA_3_0/source/modules/nfs4_acls.c\t2007-04-30 03:41:40 UTC (rev 22592)\n@@ -206,14 +206,18 @@\n \tif (aclint==NULL)\n \t\treturn False;\n \n-\tnt_ace_list = (SEC_ACE *)TALLOC_SIZE(mem_ctx, aclint->naces * sizeof(SEC_ACE));\n-\tif (nt_ace_list==NULL)\n-\t{\n-\t\tDEBUG(10, (\"talloc error\"));\n-\t\terrno = ENOMEM;\n-\t\treturn False;\n+\tif (aclint->naces) {\n+\t\tnt_ace_list = (SEC_ACE *)TALLOC_SIZE(mem_ctx, aclint->naces * sizeof(SEC_ACE));\n+\t\tif (nt_ace_list==NULL)\n+\t\t{\n+\t\t\tDEBUG(10, (\"talloc error\"));\n+\t\t\terrno = ENOMEM;\n+\t\t\treturn False;\n+\t\t}\n+\t\tmemset(nt_ace_list, 0, aclint->naces * sizeof(SEC_ACE));\n+\t} else {\n+\t\tnt_ace_list = NULL;\n \t}\n-\tmemset(nt_ace_list, 0, aclint->naces * sizeof(SEC_ACE));\n \n \tfor (aceint=aclint->first; aceint!=NULL; aceint=(SMB_ACE4_INT_T *)aceint->next) {\n \t\tSEC_ACCESS mask;\n\nModified: branches/SAMBA_3_0_25/source/modules/nfs4_acls.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/modules/nfs4_acls.c\t2007-04-30 03:38:19 UTC (rev 22591)\n+++ branches/SAMBA_3_0_25/source/modules/nfs4_acls.c\t2007-04-30 03:41:40 UTC (rev 22592)\n@@ -206,14 +206,18 @@\n \tif (aclint==NULL)\n \t\treturn False;\n \n-\tnt_ace_list = (SEC_ACE *)TALLOC_SIZE(mem_ctx, aclint->naces * sizeof(SEC_ACE));\n-\tif (nt_ace_list==NULL)\n-\t{\n-\t\tDEBUG(10, (\"talloc error\"));\n-\t\terrno = ENOMEM;\n-\t\treturn False;\n+\tif (aclint->naces) {\n+\t\tnt_ace_list = (SEC_ACE *)TALLOC_SIZE(mem_ctx, aclint->naces * sizeof(SEC_ACE));\n+\t\tif (nt_ace_list==NULL)\n+\t\t{\n+\t\t\tDEBUG(10, (\"talloc error\"));\n+\t\t\terrno = ENOMEM;\n+\t\t\treturn False;\n+\t\t}\n+\t\tmemset(nt_ace_list, 0, aclint->naces * sizeof(SEC_ACE));\n+\t} else {\n+\t\tnt_ace_list = NULL;\n \t}\n-\tmemset(nt_ace_list, 0, aclint->naces * sizeof(SEC_ACE));\n \n \tfor (aceint=aclint->first; aceint!=NULL; aceint=(SMB_ACE4_INT_T *)aceint->next) {\n \t\tSEC_ACCESS mask;\n\n"}