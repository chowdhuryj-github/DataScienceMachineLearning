{"category": "ham", "to_address": "Atsushi Nakabayashi <nakabayashi@miraclelinux.com>", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: Memory leaks", "body": "On Wed, Jun 20, 2007 at 11:26:53AM +0900, Atsushi Nakabayashi wrote:\n> Hi, samba-tech,\n> \n> I have found a memory leak in the error route of the samba-3.0.24.\n> \n> --- source/nmbd/nmbd_winsserver.c\n> 2327         /* We will do the writing in a child process to ensure \n> that the parent doesn't block while this is done */\n> 2328         if (background) {\n> 2329                 CatchChild();\n> 2330                 if (sys_fork()) {\n> 2331                         return;\n> 2332                 }\n> 2333                 if (tdb_reopen(wins_tdb)) {\n> 2334                         DEBUG(0,(\"wins_write_database: tdb_reopen \n> failed. Error was %s\\n\",\n> 2335                                 strerror(errno)));\n> 2336                         return;\n> 2337                 }\n> \n> The child process is not released, when the tdb_reopen function returns \n> false(-1).\n> \n\n> diff -uNrp samba-3.0.24.org/source/nmbd/nmbd_winsserver.c samba-3.0.24/source/nmbd/nmbd_winsserver.c\n> --- samba-3.0.24.org/source/nmbd/nmbd_winsserver.c\t2007-06-19 23:38:38.000000000 +0900\n> +++ samba-3.0.24/source/nmbd/nmbd_winsserver.c\t2007-06-19 23:39:05.000000000 +0900\n> @@ -2333,6 +2333,7 @@ void wins_write_database(time_t t, BOOL \n>  \t\tif (tdb_reopen(wins_tdb)) {\n>  \t\t\tDEBUG(0,(\"wins_write_database: tdb_reopen failed. Error was %s\\n\",\n>  \t\t\t\tstrerror(errno)));\n> +\t\t\t\t_exit(0);\n>  \t\t\treturn;\n>  \t\t}\n>  \t}\n\nPerfectly correct - applied - thanks !\n\nJeremy.\n\n"}