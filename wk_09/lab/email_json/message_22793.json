{"category": "ham", "to_address": "\"Tony Chiang\" <tchiang@fhcrc.org>", "from_address": "Martin Maechler <maechler@stat.math.ethz.ch>", "subject": "Re: [R] Issue with the Matrix package", "body": ">>>>> \"Tony\" == Tony Chiang \n>>>>>     on Fri, 4 May 2007 00:07:04 +0100 writes:\n\n    Tony> Hi all,\n\n    Tony> I am wondering if this is a bug in the Matrix package\n    Tony> or if it something that I am just getting wrong...\n\n    Tony> here is an example: \n    [..............]\n\nIt's a bug.\n\nA shorter example - w/o dimnames - and showing what the semantic\nreally is for traditional matrices :\n\n------------------------------------------------------------\n> a <- matrix(0,4,4); a[c(1,2,1), 2] <- 1:3; a\n     [,1] [,2] [,3] [,4]\n[1,]    0    3    0    0\n[2,]    0    2    0    0\n[3,]    0    0    0    0\n[4,]    0    0    0    0\n\n> A <- Matrix(0,4,4); A[c(1,2,1), 2] <- 1:3; A\n4 x 4 sparse Matrix of class \"dgCMatrix\"\n            \n[1,] . 4 . .\n[2,] . 2 . .\n[3,] . . . .\n[4,] . . . .\n------------------------------------------------------------\n\nso we see that multiple assignments are supposed to happen\nconsecutively such that \"the last wins\".\n\n\n    Tony> The documentation reads:\n\n    Tony> \" Most of the time, the function works via a traditional (_full_)\n    Tony> 'matrix'.  However, 'Matrix(0, nrow,ncol)' directly constructs an\n    Tony> \"empty\" sparseMatrix, as does 'Matrix(FALSE, *)'.\"\n\n    Tony> So is this when an exception comes,\nno\n\n    Tony> and if so can someone explain to me why we get the 2?\n    Tony> It would seem that it should just reassign the 1 to a\n    Tony> 1 not add the number of times it is assigning a 1.\n\nIf you are interested: Things go via TsparseMatrix, i.e. the\ntriplet representation.  and there the convention is the\nfollowing: an index pair (i_0,j_0) can appear more than once. If\nit does it *means* that all the 'x' values are summed up.\n\n  ?dgTMatrix-class\n\ndoes explain that, too.\n\nHere's an example - using the auxiliary function I had posted a\nwhile ago on R-help:\n\nspMatrix <- function(nrow, ncol, i,j,x) {\n    ## Purpose: User friendly construction of sparse \"Matrix\" from triple\n    ## ----------------------------------------------------------------------\n    ## Arguments: (i,j,x): 2 integer and 1 numeric vector of the same length:\n    ##\n    ##\tThe matrix M will have\n    ##       M[i[k], j[k]] == x[k] , for k = 1,2,..., length(i)\n    ##    and M[ i', j' ]  ==  0  for `` all other pairs (i',j')\n    ## ----------------------------------------------------------------------\n    ## Author: Martin Maechler, Date:  8 Jan 2007, 18:46\n    dim <- c(as.integer(nrow), as.integer(ncol))\n    ## The conformability of (i,j,x) with itself and with 'dim'\n    ## will be checked automatically\n    ## by an internal \"validObject()\" which is part of new(.):\n    new(\"dgTMatrix\", x = as.double(x), Dim = dim,\n        ## our \"Tsparse\" Matrices use  0-based indices :\n        i = as.integer(i - 1:1),\n        j = as.integer(j - 1:1))\n}\n\nand now uses this lower-level construction of Tsparse Matrices:\n\n> (A <- spMatrix(3,4, i= c(1:3, 1:2), j = c(2:4, 3:4), x = 1:5))\n3 x 4 sparse Matrix of class \"dgTMatrix\"\n            \n[1,] . 1 4 .\n[2,] . . 2 5\n[3,] . . . 3\n\n## ok\n\n> (B <- spMatrix(3,4, i= c(1:3, 1:2), j = c(2:4, 2:3), x = 1:5))\n3 x 4 sparse Matrix of class \"dgTMatrix\"\n            \n[1,] . 5 . .\n[2,] . . 7 .\n[3,] . . . 3\n\n## oops!\n\n> str(B)\nFormal class 'dgTMatrix' [package \"Matrix\"] with 6 slots\n  ..@ i       : int [1:5] 0 1 2 0 1\n  ..@ j       : int [1:5] 1 2 3 1 2\n  ..@ Dim     : int [1:2] 3 4\n  ..@ Dimnames:List of 2\n  .. ..$ : NULL\n  .. ..$ : NULL\n  ..@ x       : num [1:5] 1 2 3 4 5\n  ..@ factors : list()\n\n## which shows that you have 5 entries in B, with the \"sum those\n## with equal index\" convention mentioned above.\n\n\nThank you for the report, Tony.\nThis will be fixed in the next release of Matrix.\n\nMartin Maechler, ETH Zurich\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}