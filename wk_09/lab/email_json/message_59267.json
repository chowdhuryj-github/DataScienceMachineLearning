{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23667 - in branches: SAMBA_3_0/source/registry\n\tSAMBA_3_0_26/source/registry", "body": "Author: obnox\nDate: 2007-06-30 22:31:13 +0000 (Sat, 30 Jun 2007)\nNew Revision: 23667\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23667\n\nLog:\nPrevent storing of forbidden parameter names in registry\nconfiguration as values. I would really like to check whether\nthe valuename is a valid parameter name (with lp_parameter_is_valid)\nhere, but unfortunately, regedit cereates new values as\n\"New Value #1\" (and so on) first, before dropping into the\nrename box. So this is impossible here.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0/source/registry/reg_smbconf.c\n   branches/SAMBA_3_0_26/source/registry/reg_smbconf.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/registry/reg_smbconf.c\n===================================================================\n--- branches/SAMBA_3_0/source/registry/reg_smbconf.c\t2007-06-30 21:35:39 UTC (rev 23666)\n+++ branches/SAMBA_3_0/source/registry/reg_smbconf.c\t2007-06-30 22:31:13 UTC (rev 23667)\n@@ -42,6 +42,19 @@\n \n static BOOL smbconf_store_values( const char *key, REGVAL_CTR *val )\n {\n+\tint i;\n+\tint num_values = regval_ctr_numvals(val);\n+\n+\tfor (i=0; i < num_values; i++) {\n+\t\tREGISTRY_VALUE *theval = regval_ctr_specific_value(val, i);\n+\t\tconst char *valname = regval_name(theval);\n+\n+\t\tif (registry_smbconf_valname_forbidden(valname)) {\n+\t\t\tDEBUG(0, (\"smbconf_store_values: value '%s' forbidden \"\n+\t\t\t      \"in registry.\\n\", valname));\n+\t\t\treturn False;\n+\t\t}\n+\t}\n \treturn regdb_ops.store_values(key, val);\n }\n \n\nModified: branches/SAMBA_3_0_26/source/registry/reg_smbconf.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/registry/reg_smbconf.c\t2007-06-30 21:35:39 UTC (rev 23666)\n+++ branches/SAMBA_3_0_26/source/registry/reg_smbconf.c\t2007-06-30 22:31:13 UTC (rev 23667)\n@@ -42,6 +42,19 @@\n \n static BOOL smbconf_store_values( const char *key, REGVAL_CTR *val )\n {\n+\tint i;\n+\tint num_values = regval_ctr_numvals(val);\n+\n+\tfor (i=0; i < num_values; i++) {\n+\t\tREGISTRY_VALUE *theval = regval_ctr_specific_value(val, i);\n+\t\tconst char *valname = regval_name(theval);\n+\n+\t\tif (registry_smbconf_valname_forbidden(valname)) {\n+\t\t\tDEBUG(0, (\"smbconf_store_values: value '%s' forbidden \"\n+\t\t\t      \"in registry.\\n\", valname));\n+\t\t\treturn False;\n+\t\t}\n+\t}\n \treturn regdb_ops.store_values(key, val);\n }\n \n\n"}