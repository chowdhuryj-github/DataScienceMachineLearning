{"category": "ham", "to_address": "Frank E Harrell Jr <f.harrell@vanderbilt.edu>", "from_address": "Keith Wong <keithw@med.usyd.edu.au>", "subject": "Re: [R] Nicely formatted summary table with mean,\n standard  deviation or number and proportion", "body": "Prof Harrell\n\nThanks for the hint!\n\nI am using Hmisc 3.3-2, on R version 2.5.0 with windows XP.\n\nI saw the argument \"prmsd = T\" in the help for summary.formula(), and \ncouldn't understand how to make it work, but just now realised that it \nshould be applied to the latex() function, and not to summary.formula() itself:\n\noptions(digits = 2)\n(x = summary(treatment ~ age + sex, method = \"reverse\") )\nlatex(x, prmsd = T)\n\n\nThat's what I needed, thank you.\n\nKeith\n\n\nAt 12:11 PM 14/05/2007, Frank E Harrell Jr wrote:\n>Keith Wong wrote:\n>>Dear all,\n>>The incredibly useful Hmisc package provides a method to generate summary \n>>tables that can be typeset in latex. The Alzola and Harrell book   \"An \n>>introduction to S and the Hmisc and Design libraries\" provides an example \n>>that generates mean and quartiles for continuous variables, and numbers \n>>and percentages for count variables: summary() with method = 'reverse'.\n>>I wonder if there is a way to change it so the mean and standard \n>>deviation are reported instead for continuous variables.\n>>I illustrate my question below using an example from the book.\n>>Thank you.\n>>Keith\n>\n>Newer versions of Hmisc have an option to add mean and SD for \n>method='reverse'.  Quartiles are always there.\n>\n>Frank\n>\n>>\n>>  > ####\n>>  > library(Hmisc)\n>>  >\n>>  > set.seed(173)\n>>  > sex = factor(sample(c(\"m\", \"f\"), 500, rep = T))\n>>  > age = rnorm(500, 50, 5)\n>>  > treatment = factor(sample(c(\"Drug\", \"Placebo\"), 500, rep = T))\n>>  > summary(sex ~ treatment, fun = table)\n>>sex    N=500\n>>+---------+-------+---+---+---+\n>>|         |       |N  |f  |m  |\n>>+---------+-------+---+---+---+\n>>|treatment|Drug   |263|140|123|\n>>|         |Placebo|237|133|104|\n>>+---------+-------+---+---+---+\n>>|Overall  |       |500|273|227|\n>>+---------+-------+---+---+---+\n>>  >\n>>  >\n>>  >\n>>  > (x = summary(treatment ~ age + sex, method = \"reverse\"))\n>>  > # generates quartiles for continuous variables\n>>\n>>Descriptive Statistics by treatment\n>>+-------+--------------+--------------+\n>>|       |Drug          |Placebo       |\n>>|       |(N=263)       |(N=237)       |\n>>+-------+--------------+--------------+\n>>|age    |46.5/49.9/53.2|46.7/50.0/53.4|\n>>+-------+--------------+--------------+\n>>|sex : m|   47% (123)  |   44% (104)  |\n>>+-------+--------------+--------------+\n>>  >\n>>  >\n>>  > # latex(x) generates a very nicely formatted table\n>>  > # but I'd like \"mean (standard deviation)\" instead of quartiles.\n>>\n>>  > # this function from \n>> http://tolstoy.newcastle.edu.au/R/e2/help/06/11/4713.html\n>>  > g <- function(y) {\n>>+   s <- apply(y, 2,\n>>+              function(z) {\n>>+                z <- z[!is.na(z)]\n>>+                n <- length(z)\n>>+                if(n==0) c(NA,NA,NA,0) else\n>>+                if(n==1) c(z, NA,NA,1) else {\n>>+                  m <- mean(z)\n>>+                  s <- sd(z)\n>>+                  c(N=n, Mean=m, SD=s)\n>>+                }\n>>+              })\n>>+   w <- as.vector(s)\n>>+   names(w) <-  as.vector(outer(rownames(s), colnames(s), paste, sep=''))\n>>+   w\n>>+ }\n>>  >\n>>  > summary(treatment ~ age + sex, method = \"reverse\", fun = g)\n>>  > # does not work, 'fun' or 'FUN\" argument is ignored.\n>>\n>>Descriptive Statistics by treatment\n>>+-------+--------------+--------------+\n>>|       |Drug          |Placebo       |\n>>|       |(N=263)       |(N=237)       |\n>>+-------+--------------+--------------+\n>>|age    |46.5/49.9/53.2|46.7/50.0/53.4|\n>>+-------+--------------+--------------+\n>>|sex : m|   47% (123)  |   44% (104)  |\n>>+-------+--------------+--------------+\n>>  >\n>>  >\n>>  > (x1 = summarize(cbind(age), llist(treatment), FUN = g, \n>> stat.name=c(\"n\", \"mean\", \"sd\")))\n>>    treatment   n mean   sd\n>>1      Drug 263 49.9 4.94\n>>2   Placebo 237 50.1 4.97\n>>  >\n>>  > # this works but table is rotated, and it count data has to be\n>>  > # treated separately.\n>>\n>\n>\n>--\n>Frank E Harrell Jr   Professor and Chair           School of Medicine\n>                      Department of Biostatistics   Vanderbilt University\n\n\nKeith Wong\nClinical Epidemiology Fellow\nSleep & Circadian Research Group, NHMRC CCRE in Respiratory and Sleep\nWoolcock Institute of Medical Research\n\n| leaders in breathing and sleep research |\n\n\nPO Box M77\nMissenden Road NSW 2050, Australia\n\nT   61 2 9515 8981\nF   61 2 9515 7070\nE   keithw@woolcock.org.au\nW  www.woolcock.org.au\n\nPlease consider the environment before printing this email.\n\nThis  email  and  any  files transmitted with it are intended for the named \nrecipient  only.\nThe  information  contained  in  this  message  may  be \nconfidential,  legally privileged\nor commercially sensitive. If you are not the intended recipient you must \nnot reproduce\nor distribute any part of the email,  disclose  its  contents  to  any \nother party, or take any\naction in reliance  on  it. If you have received this email in error, \nplease contact the\nsender  immediately  by return email and delete this message from your \ncomputer.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}