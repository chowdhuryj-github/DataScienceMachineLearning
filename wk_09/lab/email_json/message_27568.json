{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r22801 - in branches: SAMBA_3_0/source/libgpo\n\tSAMBA_3_0_26/source/libgpo", "body": "Author: gd\nDate: 2007-05-11 13:37:51 +0000 (Fri, 11 May 2007)\nNew Revision: 22801\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22801\n\nLog:\nPass down the token to add_gplink_to_gpo_list().\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\n   branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\n===================================================================\n--- branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\t2007-05-11 13:33:37 UTC (rev 22800)\n+++ branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\t2007-05-11 13:37:51 UTC (rev 22801)\n@@ -524,7 +524,8 @@\n \t\t\t\t  const char *link_dn,\n \t\t\t\t  struct GP_LINK *gp_link,\n \t\t\t\t  enum GPO_LINK_TYPE link_type,\n-\t\t\t\t  BOOL only_add_forced_gpos)\n+\t\t\t\t  BOOL only_add_forced_gpos,\n+\t\t\t\t  struct GPO_SID_TOKEN *token)\n {\n \tADS_STATUS status;\n \tint i;\n@@ -646,6 +647,7 @@\n \t\n \tADS_STATUS status;\n \tstruct GP_LINK gp_link;\n+\tstruct GPO_SID_TOKEN *token = NULL;\n \tconst char *parent_dn, *site_dn, *tmp_dn;\n \tBOOL add_only_forced_gpos = False;\n \n@@ -653,6 +655,11 @@\n \n \tDEBUG(10,(\"ads_get_gpo_list: getting GPO list for [%s]\\n\", dn));\n \n+\tstatus = ads_get_gpo_sid_token(ads, mem_ctx, dn, &token);\n+\tif (!ADS_ERR_OK(status)) {\n+\t\treturn status;\n+\t}\n+\n \t/* (L)ocal */\n \t/* not yet... */\n \t\n@@ -677,7 +684,8 @@\n \t\t\t\n \t\t\tstatus = add_gplink_to_gpo_list(ads, mem_ctx, gpo_list, \n \t\t\t\t\t\t\tsite_dn, &gp_link, GP_LINK_SITE, \n-\t\t\t\t\t\t\tadd_only_forced_gpos);\n+\t\t\t\t\t\t\tadd_only_forced_gpos,\n+\t\t\t\t\t\t\ttoken);\n \t\t\tif (!ADS_ERR_OK(status)) {\n \t\t\t\treturn status;\n \t\t\t}\n@@ -717,7 +725,8 @@\n \t\t\t\tstatus = add_gplink_to_gpo_list(ads, mem_ctx, \n \t\t\t\t\t\t\t\tgpo_list, parent_dn, \n \t\t\t\t\t\t\t\t&gp_link, GP_LINK_DOMAIN, \n-\t\t\t\t\t\t\t\tadd_only_forced_gpos);\n+\t\t\t\t\t\t\t\tadd_only_forced_gpos,\n+\t\t\t\t\t\t\t\ttoken);\n \t\t\t\tif (!ADS_ERR_OK(status)) {\n \t\t\t\t\treturn status;\n \t\t\t\t}\n@@ -756,7 +765,8 @@\n \t\t\t\tstatus = add_gplink_to_gpo_list(ads, mem_ctx, \n \t\t\t\t\t\t\t\tgpo_list, parent_dn, \n \t\t\t\t\t\t\t\t&gp_link, GP_LINK_OU, \n-\t\t\t\t\t\t\t\tadd_only_forced_gpos);\n+\t\t\t\t\t\t\t\tadd_only_forced_gpos,\n+\t\t\t\t\t\t\t\ttoken);\n \t\t\t\tif (!ADS_ERR_OK(status)) {\n \t\t\t\t\treturn status;\n \t\t\t\t}\n\nModified: branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\t2007-05-11 13:33:37 UTC (rev 22800)\n+++ branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\t2007-05-11 13:37:51 UTC (rev 22801)\n@@ -524,7 +524,8 @@\n \t\t\t\t  const char *link_dn,\n \t\t\t\t  struct GP_LINK *gp_link,\n \t\t\t\t  enum GPO_LINK_TYPE link_type,\n-\t\t\t\t  BOOL only_add_forced_gpos)\n+\t\t\t\t  BOOL only_add_forced_gpos,\n+\t\t\t\t  struct GPO_SID_TOKEN *token)\n {\n \tADS_STATUS status;\n \tint i;\n@@ -646,6 +647,7 @@\n \t\n \tADS_STATUS status;\n \tstruct GP_LINK gp_link;\n+\tstruct GPO_SID_TOKEN *token = NULL;\n \tconst char *parent_dn, *site_dn, *tmp_dn;\n \tBOOL add_only_forced_gpos = False;\n \n@@ -653,6 +655,11 @@\n \n \tDEBUG(10,(\"ads_get_gpo_list: getting GPO list for [%s]\\n\", dn));\n \n+\tstatus = ads_get_gpo_sid_token(ads, mem_ctx, dn, &token);\n+\tif (!ADS_ERR_OK(status)) {\n+\t\treturn status;\n+\t}\n+\n \t/* (L)ocal */\n \t/* not yet... */\n \t\n@@ -677,7 +684,8 @@\n \t\t\t\n \t\t\tstatus = add_gplink_to_gpo_list(ads, mem_ctx, gpo_list, \n \t\t\t\t\t\t\tsite_dn, &gp_link, GP_LINK_SITE, \n-\t\t\t\t\t\t\tadd_only_forced_gpos);\n+\t\t\t\t\t\t\tadd_only_forced_gpos,\n+\t\t\t\t\t\t\ttoken);\n \t\t\tif (!ADS_ERR_OK(status)) {\n \t\t\t\treturn status;\n \t\t\t}\n@@ -717,7 +725,8 @@\n \t\t\t\tstatus = add_gplink_to_gpo_list(ads, mem_ctx, \n \t\t\t\t\t\t\t\tgpo_list, parent_dn, \n \t\t\t\t\t\t\t\t&gp_link, GP_LINK_DOMAIN, \n-\t\t\t\t\t\t\t\tadd_only_forced_gpos);\n+\t\t\t\t\t\t\t\tadd_only_forced_gpos,\n+\t\t\t\t\t\t\t\ttoken);\n \t\t\t\tif (!ADS_ERR_OK(status)) {\n \t\t\t\t\treturn status;\n \t\t\t\t}\n@@ -756,7 +765,8 @@\n \t\t\t\tstatus = add_gplink_to_gpo_list(ads, mem_ctx, \n \t\t\t\t\t\t\t\tgpo_list, parent_dn, \n \t\t\t\t\t\t\t\t&gp_link, GP_LINK_OU, \n-\t\t\t\t\t\t\t\tadd_only_forced_gpos);\n+\t\t\t\t\t\t\t\tadd_only_forced_gpos,\n+\t\t\t\t\t\t\t\ttoken);\n \t\t\t\tif (!ADS_ERR_OK(status)) {\n \t\t\t\t\treturn status;\n \t\t\t\t}\n\n"}