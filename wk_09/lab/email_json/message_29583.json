{"category": "ham", "to_address": "Peter Dalgaard <P.Dalgaard@biostat.ku.dk>", "from_address": "Prof Brian Ripley <ripley@stats.ox.ac.uk>", "subject": "Re: [R] Problem with R CMD BATCH on R-2.5.0 due to Sys.unsetenv not\n available", "body": "On Mon, 14 May 2007, Peter Dalgaard wrote:\n\n> Simon Penel wrote:\n>> Hello,\n>>\n>> I am working on an unix SunOS machine ( sun4u sparc) and since the last\n>> release  of R  -R version 2.5.0 (2007-04-23) - ,\n>> I have got troubles during the execution of batch command.\n>>\n>>\n>> For example with the instruction file multic.in\n>> >cat  multic.in\n>> install.packages(\"multic\",\"/bge/penel/R_install/R_2.5.0/lib/R/library\",repos=\"http://cran.at.r-project.org\")\n>>\n>>\n>> When  I use the BATCH command, I get an error :\n>>\n>> >R_2.5.0/bin/R  CMD BATCH multic.in\n>>\n>> creates the multic.in.Rout file :\n>>\n>> >cat multic.in.Rout\n>> Error in Sys.unsetenv(\"R_BATCH\") : 'Sys.unsetenv' is not available on\n>> this system\n>> Execution halted\n>>\n>>\n>> Effectiveley,  Sys.unsetenv is not available on unix\n>> When running R :\n>> >  Sys.unsetenv(\"toto\")\n>> Error in Sys.unsetenv(\"toto\") : 'Sys.unsetenv' is not available on this\n>> system\n>>\n>>\n>> Does that mean that it is not possible anymore to use R CMD BATCH on\n>> unix OS ?\n>>\n> Hmm, if so, nobody did the platform testing sufficiently well...\n\nMy 'SunOS machine' (Solaris 10) has it working.  What version of SunOS was \nthis?  Sys.unsetenv is using POSIX API functions, so any reasonably modern \nUnix should support it.\n\n> The code in question seems to be at the end of\n>\n> src/library/profile/Common.R\n>\n> which ends up in the  system-wide\n>\n> library/base/R/Rprofile\n>\n> ----------------------------------\n>\n> if(Sys.getenv(\"R_BATCH\") != \"\") {\n>    .Last.sys <- function()\n>    {\n>        cat(\"> proc.time()\\n\")\n>        print(proc.time())\n>    }\n>    ## avoid passing on to spawned R processes\n>    Sys.unsetenv(\"R_BATCH\")\n> }\n>\n>\n>\n>> This is very recent, since it was working fine with the R-patched\n>> version :R version 2.5.0 Under development (unstable) (2007-03-18 r40854)\n\nHmm, that would have to be R-devel.\n\n> Yes, svn praise has this:\n>\n> 40621     ripley if(Sys.getenv(\"R_BATCH\") != \"\") {\n> 40621     ripley     .Last.sys <- function()\n> 40621     ripley     {\n> 40621     ripley         cat(\"> proc.time()\\n\")\n> 40621     ripley         print(proc.time())\n> 40621     ripley     }\n> 40972     ripley     ## avoid passing on to spawned R processes\n> 40972     ripley     Sys.unsetenv(\"R_BATCH\")\n> 40621     ripley }\n\nand 40971 (which is what it says in the trunk) was on 2007-03-30, so \nat the beginning of the test process for 2.5.0.\n\n> Does Sys.setenv work? If so, you might replace the offending line by\n>\n> Sys.setenv(\"\")\n>\n> (or remove it entirely and avoid spawning R processes....)\n\nThe internals of Sys.unsetenv() try several possibilities.  But as the \nhelp page says\n\n      Not all systems need support 'Sys.setenv' (although all known\n      current platforms do) nor 'Sys.unsetenv'.\n\nUsing Sys.setenv(R_BATCH=\"\") might be more portable.\n\n-- \nBrian D. Ripley,                  ripley@stats.ox.ac.uk\nProfessor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/\nUniversity of Oxford,             Tel:  +44 1865 272861 (self)\n1 South Parks Road,                     +44 1865 272866 (PA)\nOxford OX1 3TG, UK                Fax:  +44 1865 272595\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}