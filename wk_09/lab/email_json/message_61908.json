{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "svn commit: samba r23702 - in branches/SAMBA_4_0/source/smbd: .", "body": "Author: tridge\nDate: 2007-07-04 07:45:41 +0000 (Wed, 04 Jul 2007)\nNew Revision: 23702\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23702\n\nLog:\n\nfixed a \"falling back to select\" error in the standard process\nmodel. It's much cleaner to get the event system to close the fd,\nespecially with the complexity of forks\n\nModified:\n   branches/SAMBA_4_0/source/smbd/service_stream.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/smbd/service_stream.c\n===================================================================\n--- branches/SAMBA_4_0/source/smbd/service_stream.c\t2007-07-04 07:43:26 UTC (rev 23701)\n+++ branches/SAMBA_4_0/source/smbd/service_stream.c\t2007-07-04 07:45:41 UTC (rev 23702)\n@@ -289,9 +289,13 @@\n \t\treturn status;\n \t}\n \n+\t/* we will close the socket using the events system */\n+\tsocket_set_flags(stream_socket->sock, SOCKET_FLAG_NOCLOSE);\n+\n \tevent_add_fd(event_context, stream_socket->sock, \n \t\t     socket_get_fd(stream_socket->sock), \n-\t\t     EVENT_FD_READ, stream_accept_handler, stream_socket);\n+\t\t     EVENT_FD_READ|EVENT_FD_AUTOCLOSE, \n+\t\t     stream_accept_handler, stream_socket);\n \n \tstream_socket->private          = talloc_reference(stream_socket, private);\n \tstream_socket->ops              = stream_ops;\n\n"}