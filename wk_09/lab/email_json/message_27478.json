{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22792 - in\n\tbranches/SAMBA_4_0/source/wrepl_server: .", "body": "Author: metze\nDate: 2007-05-11 10:13:10 +0000 (Fri, 11 May 2007)\nNew Revision: 22792\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22792\n\nLog:\nonly don't free on success\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/wrepl_server/wrepl_apply_records.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/wrepl_server/wrepl_apply_records.c\n===================================================================\n--- branches/SAMBA_4_0/source/wrepl_server/wrepl_apply_records.c\t2007-05-11 10:05:13 UTC (rev 22791)\n+++ branches/SAMBA_4_0/source/wrepl_server/wrepl_apply_records.c\t2007-05-11 10:13:10 UTC (rev 22792)\n@@ -1012,11 +1012,14 @@\n \t}\n \n \tif (!old_is_subset) {\n-\t\tr_do_late_release_demand(state);\n+\t\tstatus = r_do_late_release_demand(state);\n \t\t/* \n-\t\t * don't free state here, because we pass it down,\n+\t\t * only free state on error, because we pass it down,\n \t\t * and r_do_late_release_demand() will free it\n \t\t */\n+\t\tif (!NT_STATUS_IS_OK(status)) {\n+\t\t\ttalloc_free(state);\n+\t\t}\n \t\treturn;\n \t}\n \n\n"}