{"category": "ham", "to_address": "r-help@r-project.org", "from_address": "\"Zack Weinberg\" <zackw@panix.com>", "subject": "[R] still trying to wrap xyplot - ignore previous", "body": "As you may not be surprised to hear, no sooner did I post the previous\nmessage than I realized I had a really dumb mistake.  I've now gotten\na bit farther but am still stuck.  New code:\n\ngraph <- function (x, data, groups, xlab) {\n  pg <- function(x, y, group.number, ...) fnord\n  body(pg) <- substitute({\n    panel.xyplot(x, y, ..., group.number=group.number)\n    panel.text(2, unique(y[x==2]),\n               levels(G)[group.number],\n               pos=4, cex=0.5)\n  }, list(G=eval(substitute(groups), data, parent.frame())))\n\n  print(xyplot(x, data=data, groups=substitute(groups),\n               type='l',\n               ylab=list(cex=1.1, label='Mean RT (ms)'),\n               xlab=list(cex=1.1, label=xlab),\n               scales=list(\n                 x=list(alternating=c(1,1), tck=c(1,0)),\n                 y=list(alternating=c(1,0))\n                 ),\n               panel=panel.superpose,\n               panel.groups=pg\n              ))\n}\n\nQuestions:\n1) The \"groups=substitute(groups)\" bit (in the call to xyplot) still\ndoesn't work.  As far as I can tell, xyplot wants the *symbol* which\nis the name of the factor (in the data frame) to group by.\nThe above seems to wind up passing it the symbol \"groups\", which\ncauses the prepanel function to barf.  I have not been able to find\nany way to evaluate one layer of \"groups\" to get me the symbol passed\nin, rather than the value of that symbol.  Am I right?  How do I give\nit what it wants?\n\n2) Why do I have to do that stupid dance with replacing the body of\npg?  The documentation leads me to believe this is a lexically scoped\nlanguage, shouldn't it be able to pick G out of the enclosing frame?\n\nzw\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}