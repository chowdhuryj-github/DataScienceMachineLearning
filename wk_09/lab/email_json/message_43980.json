{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r23372 - in branches: SAMBA_3_0/source/rpcclient\n\tSAMBA_3_0_25/source/rpcclient SAMBA_3_0_26/source/rpcclient", "body": "Author: jra\nDate: 2007-06-07 01:13:43 +0000 (Thu, 07 Jun 2007)\nNew Revision: 23372\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23372\n\nLog:\nRemove restriction on string length for rpcclient commands.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/rpcclient/rpcclient.c\n   branches/SAMBA_3_0_25/source/rpcclient/rpcclient.c\n   branches/SAMBA_3_0_26/source/rpcclient/rpcclient.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/rpcclient/rpcclient.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpcclient/rpcclient.c\t2007-06-07 00:14:06 UTC (rev 23371)\n+++ branches/SAMBA_3_0/source/rpcclient/rpcclient.c\t2007-06-07 01:13:43 UTC (rev 23372)\n@@ -108,9 +108,9 @@\n \treturn matches;\n }\n \n-static char* next_command (char** cmdstr)\n+static char *next_command (char **cmdstr)\n {\n-\tstatic pstring \t\tcommand;\n+\tchar *command;\n \tchar\t\t\t*p;\n \t\n \tif (!cmdstr || !(*cmdstr))\n@@ -119,7 +119,7 @@\n \tp = strchr_m(*cmdstr, ';');\n \tif (p)\n \t\t*p = '\\0';\n-\tpstrcpy(command, *cmdstr);\n+\tcommand = SMB_STRDUP(*cmdstr);\n \tif (p)\n \t\t*cmdstr = p + 1;\n \telse\n@@ -868,6 +868,7 @@\n  \n                 while((cmd=next_command(&p)) != NULL) {\n                         NTSTATUS cmd_result = process_cmd(cli, cmd);\n+\t\t\tSAFE_FREE(cmd);\n \t\t\tresult = NT_STATUS_IS_ERR(cmd_result);\n                 }\n \t\t\n\nModified: branches/SAMBA_3_0_25/source/rpcclient/rpcclient.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/rpcclient/rpcclient.c\t2007-06-07 00:14:06 UTC (rev 23371)\n+++ branches/SAMBA_3_0_25/source/rpcclient/rpcclient.c\t2007-06-07 01:13:43 UTC (rev 23372)\n@@ -107,9 +107,9 @@\n \treturn matches;\n }\n \n-static char* next_command (char** cmdstr)\n+static char *next_command (char **cmdstr)\n {\n-\tstatic pstring \t\tcommand;\n+\tchar *command;\n \tchar\t\t\t*p;\n \t\n \tif (!cmdstr || !(*cmdstr))\n@@ -118,7 +118,7 @@\n \tp = strchr_m(*cmdstr, ';');\n \tif (p)\n \t\t*p = '\\0';\n-\tpstrcpy(command, *cmdstr);\n+\tcommand = SMB_STRDUP(*cmdstr);\n \tif (p)\n \t\t*cmdstr = p + 1;\n \telse\n@@ -828,6 +828,7 @@\n  \n                 while((cmd=next_command(&p)) != NULL) {\n                         NTSTATUS cmd_result = process_cmd(cli, cmd);\n+\t\t\tSAFE_FREE(cmd);\n \t\t\tresult = NT_STATUS_IS_ERR(cmd_result);\n                 }\n \t\t\n\nModified: branches/SAMBA_3_0_26/source/rpcclient/rpcclient.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpcclient/rpcclient.c\t2007-06-07 00:14:06 UTC (rev 23371)\n+++ branches/SAMBA_3_0_26/source/rpcclient/rpcclient.c\t2007-06-07 01:13:43 UTC (rev 23372)\n@@ -108,9 +108,9 @@\n \treturn matches;\n }\n \n-static char* next_command (char** cmdstr)\n+static char *next_command (char **cmdstr)\n {\n-\tstatic pstring \t\tcommand;\n+\tchar *command;\n \tchar\t\t\t*p;\n \t\n \tif (!cmdstr || !(*cmdstr))\n@@ -119,7 +119,7 @@\n \tp = strchr_m(*cmdstr, ';');\n \tif (p)\n \t\t*p = '\\0';\n-\tpstrcpy(command, *cmdstr);\n+\tcommand = SMB_STRDUP(*cmdstr);\n \tif (p)\n \t\t*cmdstr = p + 1;\n \telse\n@@ -866,6 +866,7 @@\n  \n                 while((cmd=next_command(&p)) != NULL) {\n                         NTSTATUS cmd_result = process_cmd(cli, cmd);\n+\t\t\tSAFE_FREE(cmd);\n \t\t\tresult = NT_STATUS_IS_ERR(cmd_result);\n                 }\n \t\t\n\n"}