{"category": "ham", "to_address": "samba-technical@lists.samba.org", "from_address": "boyang <yyyeer.bo@gmail.com>", "subject": "netlogon failure detection on samba-3.0.25a", "body": "problem: samba as domain member, and there are several NT4-style DCs, if\nnetlogon service on PDC is disabled, domain users cannot login.\n\nproposed solution:\n1. add get_all_rpc_dc_name in source/libsmb/namequery_dc.c to get all\nNT4-style DCs whose node status response is NT_STAUS_OK. waste node\nstatus query RTTs. in source/auth/auth_domain.c:check_ntdomain_security,\nwalk on the DCs' list and try to logon, if return is\nNT_STATUS_NETLOGON_NOT_STARTED, try next until failure or success.\n2. before call rpc_dc_name, pass the dcname & dcip\nthat client try to logon, but failed with\nNT_STATUS_NETLOGON_NOT_STARTED, and rpc_dc_name\nsearch the domain DCs' list from position after that dcname, and returns\none DC whose node status response is ok.\n\ndoest it make sense?\n\n"}