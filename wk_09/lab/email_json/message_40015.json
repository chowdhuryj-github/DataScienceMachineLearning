{"category": "ham", "to_address": "Jacques Wagnor <jacques.wagnor@gmail.com>", "from_address": "\"Charles C. Berry\" <cberry@tajo.ucsd.edu>", "subject": "Re: [R] R keeps crashing when executing 'rlogspline'", "body": "On Thu, 31 May 2007, Jacques Wagnor wrote:\n\n> Dear List,\n>\n> I have a simple model as follows:\n>\n> x <- rnorm(500)\n> library(logspline)\n> fit <- logspline(x)\n> n <- 1000000\n> y <- replicate(n, sum(rlogspline(rpois(1,10), fit))) # last line\n>\n\nWhat you do not see in RGui is this:\n\n\n  *** caught segfault ***\naddress (nil), cause 'memory not mapped'\n\nTraceback:\n  1: .C(\"rpqlsd\", as.double(c(fit$coef.pol, fit$coef.kts)), \nas.double(fit$knots),     as.double(fit$bound), as.integer(0), qq = \nas.double(p), as.integer(length(fit$knots)),     as.integer(length(p)), \nPACKAGE = \"logspline\")\n  2: qlogspline(pp, fit)\n[rest deleted]\n\nI think you are getting zero from rpois(1,10) with larger values of n.\n\nrlogspline does not check for n==0\n\nThis results in calling qlogspline( numeric(0), fit ) and generates the \nsegfault, I guess.\n\nSo figure out what should happen when rpois(1,10) returns zero and avoid \ncalling rlogspline in those cases.\n\nIf 'zero.value' is a suitable value, then this will work:\n\n> library(logspline)\n> x <- rnorm(500)\n> fit <- logspline(x)\n> res <- sapply(1:50, function(x) sum(rlogspline(x, fit)))\n> n <- 1000000\n> rp <- rpois(n,10)\n> y <- c( zero.value, res )[ rp+1 ] ## table lookup is faster!\n\nChuck\n\n\n> The problem I keep getting is Rcrashes when doing the last line.  It\n> seems to be fine if n is small, but not if n is 1000000.  The message\n> I keep getting is:\n>\n> \"R for Windows GUI front-end has encountered a problem and needs to\n> close.  We are sorry for the inconvenience.  If you were in the middle\n> of something, the information you were working on might be lost.\"\n>\n> Any insights would be appreciated,\n>\n> Jacques\n>\n> platform       i386-pc-mingw32\n> arch           i386\n> os             mingw32\n> system         i386, mingw32\n> status\n> major          2\n> minor          5.0\n> year           2007\n> month          04\n> day            23\n> svn rev        41293\n> language       R\n> version.string R version 2.5.0 (2007-04-23)\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\nCharles C. Berry                        (858) 534-2098\n                                          Dept of Family/Preventive Medicine\nE mailto:cberry@tajo.ucsd.edu\t         UC San Diego\nhttp://biostat.ucsd.edu/~cberry/         La Jolla, San Diego 92093-0901\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}