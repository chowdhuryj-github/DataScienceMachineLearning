{"category": "ham", "to_address": "\"Alfonso Sammassimo\" <cincinattikid@bigpond.com>", "from_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "subject": "Re: [R] Yearly statistics", "body": "Here are a couple of solutions:\n\n1. using zoo package\n\nFirst add Date to the header so there\nare the same number of column headers as columns and\nthen read in using read.zoo.  Then aggregate over years\nusing mean.  For more on zoo try library(zoo); vignette(\"zoo\")\nand for more on dates see the R News 4/1 help desk article.\n\n# added Date to the header\nLines <- \"Date open  high   low    close  hc  lc\n2004-12-29 4135 4135 4106  4116  8 -21\n2004-12-30 4120 4131 4115  4119 15  -1\n2004-12-31 4123 4124 4114  4117  5  -5\n2005-01-04 4106 4137 4103  4137 20 -14\n2005-01-06 4085 4110 4085  4096 10 -15\n2005-01-10 4133 4148 4122  4139 15 -11\n2005-01-11 4142 4158 4127  4130 19 -12\n2005-01-12 4113 4138 4112  4127  18  8\n\"\n\nlibrary(zoo)\n\n# z <- read.zoo(\"myfile.dat\", header = TRUE)\nz <- read.zoo(textConnection(Lines), header = TRUE)\n\naggregate(z[,\"hc\"] > 0 & z[,\"lc\"] < 0, function(x) format(x, \"%Y\"), mean)\n\n\n2. Using data frames and tapply\n\nRead in as a data frame, calculate year and tapply the mean\nby year:\n\n# Lines is from above\n\n# dat <- read.table(\"myfile.dat\", header = TRUE)\ndat <- read.table(textConnection(Lines), header = TRUE)\n\nyear <- as.numeric(format(as.Date(dat$Date), \"%Y\"))\ntapply(dat$hc > 0 & dat$lc < 0, year, mean)\n\nOn 5/27/07, Alfonso Sammassimo  wrote:\n> Dear R-experts,\n>\n> Sorry if I've overlooked a simple solution here. I have calculated a\n> proportion of the number of observations which meet a criteria, applied to\n> five years of data. How can I break down this proportion statistic for each\n> year?\n>\n> For example (data in zoo format):\n>\n>                    open  high   low    close  hc  lc\n> 2004-12-29 4135 4135 4106  4116  8 -21\n> 2004-12-30 4120 4131 4115  4119 15  -1\n> 2004-12-31 4123 4124 4114  4117  5  -5\n> 2005-01-04 4106 4137 4103  4137 20 -14\n> 2005-01-06 4085 4110 4085  4096 10 -15\n> 2005-01-10 4133 4148 4122  4139 15 -11\n> 2005-01-11 4142 4158 4127  4130 19 -12\n> 2005-01-12 4113 4138 4112  4127  18  8\n>\n> Statistic of interest is proportion of times that sign of \"hc\" is positive\n> and sign of \"lc\" is negative on any given day. Looking to return something\n> like:\n>\n> Yr        Prop\n> 2004    1.0\n> 2005    0.8\n>\n> Along these lines, if I have datasets A and B, where B is a subset of A, can\n> I use the number of matching dates to calculate the yearly proportions in\n> question?\n>\n> Thanks,\n> Alfonso Sammassimo\n> Melbourne Australia\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}