{"category": "ham", "to_address": "Karl Knoblick <karlknoblich@yahoo.de>", "from_address": "Prof Brian Ripley <ripley@stats.ox.ac.uk>", "subject": "Re: [R] Result depends on order of factors in unbalanced designs\n (lme, anova)?", "body": "'anova' is rather a misnomer here.  In terms of the description in \n?anova.lme, you have\n\n      When only one fitted model object is present, a data frame with\n      the sums of squares, numerator degrees of freedom, denominator\n      degrees of freedom, F-values, and P-values for Wald tests for the\n      terms in the model ...\n\nbut there are no 'sums of squares' shown.  However, the crucial part of \nthat help page is\n\n     type: an optional character string specifying the type of sum of\n           squares to be used in F-tests for the terms in the model. If\n           '\"sequential\"', the sequential sum of squares obtained by\n           including the terms in the order they appear in the model is\n           used; else, if '\"marginal\"', the marginal sum of squares\n           obtained by deleting a term from the model at a time is used.\n           This argument is only used when a single fitted object is\n           passed to the function. Partial matching of arguments is\n           used, so only the first character needs to be provided.\n           Defaults to '\"sequential\"'.\n\nso these are sequential fits (just like anova for an lm fit), and yes, \nsequential fits do in general depend on the sequence of terms.\n\nThe issues of interpretation are exactly those of unbalanced linear \nmodels, and you will find advice on that in many places, e.g. in MASS.\n\n\nOn Thu, 21 Jun 2007, Karl Knoblick wrote:\n\n> Dear R-Community!\n>\n> For example I have a study with 4 treatment groups (10 subjects per group) and 4 visits. Additionally, the gender is taken into account. I think - and hope this is a goog idea (!) - this data can be analysed using lme as below.\n>\n> In a balanced design everything is fine, but in an unbalanced design there are differences depending on fitting y~visit*treat*gender or y~gender*visit*treat - at least with anova (see example). Does this make sense? Which ordering might be the correct one?\n>\n> Here the example script:\n> library(nlme)\n> set.seed(123)\n> # Random generation of data:\n> NSubj<-40 # No. of subjects\n> set.seed(1234)\n> id<-factor(rep(c(1:NSubj),4)) # ID of subjects\n> treat<-factor(rep(rep(1:4,each=5),4)) # Treatment 4 Levels\n> gender<-factor(rep(rep(1:2, each=20),4))\n> visit<-factor(rep(1:4, each=NSubj))\n> y<-runif(4*NSubj) # Results\n> # Add effects\n> y<-y+0.01*as.integer(visit)\n> y<-y+0.02*as.integer(gender)\n> y<-y+0.024*as.integer(treat)\n> df<-data.frame(id, treat, gender, visit, y)\n> # groupedData object for lme\n> gdat<-groupedData(y ~ visit|id, data=df)\n> # fits - different ordering of factors\n> fit1<-lme(y ~ visit*treat*gender, data=gdat, random = ~visit|id)\n> anova(fit1)\n> fit2<-lme(y ~ gender*treat*visit, data=gdat, random = ~visit|id)\n> anova(fit2)\n> # Result: identical (balanced design so far), ok\n> # Now change gender of subject 1\n> gdat$gender[c(1,41,81,121)]<-2\n> # onece more fits with different ordering of factors\n> fit1<-lme(y ~ visit*treat*gender, data=gdat, random = ~visit|id)\n> anova(fit1)\n> fit2<-lme(y ~ gender*treat*visit, data=gdat, random = ~visit|id)\n> anova(fit2)\n> # Result: There are differences!!\n>\n> Hope anybody can help or give me advice how to interpret these results correctly or how to avoid this problem! Is there a better possibility to analyse these data than lme?\n>\n> Thanks!\n> Karl\n\n-- \nBrian D. Ripley,                  ripley@stats.ox.ac.uk\nProfessor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/\nUniversity of Oxford,             Tel:  +44 1865 272861 (self)\n1 South Parks Road,                     +44 1865 272866 (PA)\nOxford OX1 3TG, UK                Fax:  +44 1865 272595\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}