{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 523: ignore arp on loopback in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 523\nrevision-id: tridge@samba.org-20070609115747-u1bcpt53aa1sff1j\nparent: tridge@samba.org-20070609114706-yyeee2n33bdie2jb\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-06-09 21:57:47 +1000\nmessage:\n  ignore arp on loopback\nmodified:\n  takeover/system.c              system.c-20070525071636-a5n1ihghjtppy08r-3\n=== modified file 'takeover/system.c'\n--- a/takeover/system.c\t2007-06-06 03:45:12 +0000\n+++ b/takeover/system.c\t2007-06-09 11:57:47 +0000\n@@ -66,9 +66,16 @@\n \t\tDEBUG(0,(__location__ \" ioctl failed\\n\"));\n \t\treturn -1;\n \t}\n+\tif (ARPHRD_LOOPBACK == if_hwaddr.ifr_hwaddr.sa_family) {\n+\t\tDEBUG(3,(\"Ignoring loopback arp request\\n\"));\n+\t\tclose(s);\n+\t\treturn 0;\n+\t}\n \tif (if_hwaddr.ifr_hwaddr.sa_family != AF_LOCAL) {\n \t\tclose(s);\n-\t\tDEBUG(0,(__location__ \" not an ethernet address\\n\"));\n+\t\terrno = EINVAL;\n+\t\tDEBUG(0,(__location__ \" not an ethernet address family (0x%x)\\n\",\n+\t\t\t if_hwaddr.ifr_hwaddr.sa_family));\n \t\treturn -1;\n \t}\n \n\n"}