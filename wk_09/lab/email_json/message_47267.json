{"category": "ham", "to_address": "\"hadley wickham\" <h.wickham@GMAIL.COM>", "from_address": "\"Patnaik, Tirthankar \" <tirthankar.patnaik@citi.com>", "subject": "Re: [R] Confusion with sapply", "body": "Hi,\n\tMany thanks for this Hadley, and Uwe, the packages I used were\nchron, and zoo. Later I'm also using Hadley's reshape.\n\nI was able to run the code for a vector thus:\n\n> dc <- seq(as.Date(\"2006-01-01\"),len=10,by=\"month\")\n> dc\n [1] \"2006-01-01\" \"2006-02-01\" \"2006-03-01\" \"2006-04-01\" \"2006-05-01\"\n\"2006-06-01\" \"2006-07-01\" \"2006-08-01\"\n [9] \"2006-09-01\" \"2006-10-01\"\n> as.Date(sapply(dc,function(x)Set2March(as.Date(x))))\n [1] \"2006-01-31\" \"2006-02-28\" \"2006-03-31\" \"2006-04-30\" \"2006-05-31\"\n\"2006-03-31\" \"2006-07-31\" \"2006-08-31\"\n [9] \"2006-03-31\" \"2006-10-31\"\nWarning messages:\n1: No Changes made to the month, since month is not one of (6,9,12) in:\nSet2March(as.Date(x)) \n2: No Changes made to the month, since month is not one of (6,9,12) in:\nSet2March(as.Date(x)) \n3: No Changes made to the month, since month is not one of (6,9,12) in:\nSet2March(as.Date(x)) \n4: No Changes made to the month, since month is not one of (6,9,12) in:\nSet2March(as.Date(x)) \n5: No Changes made to the month, since month is not one of (6,9,12) in:\nSet2March(as.Date(x)) \n6: No Changes made to the month, since month is not one of (6,9,12) in:\nSet2March(as.Date(x)) \n7: No Changes made to the month, since month is not one of (6,9,12) in:\nSet2March(as.Date(x)) \n8: No Changes made to the month, since month is not one of (6,9,12) in:\nSet2March(as.Date(x)) \n> \n\nBasically I ran as.Date on the vector elements (Why?, since the elements\nare dates anyway?), and then afterwards use as.Date again on the\nreturned vector. Got the answer, but it would be great if I could\nunderstand exactly how.\n\nTIA and Best,\n-Tir\n\n\n\n> -----Original Message-----\n> From: hadley wickham [mailto:h.wickham@gmail.com] \n> Sent: Wednesday, June 13, 2007 2:35 PM\n> To: Patnaik, Tirthankar [GWM-CIR]\n> Cc: r-help@stat.math.ethz.ch\n> Subject: Re: [R] Confusion with sapply\n> \n> On 6/13/07, Patnaik, Tirthankar  wrote:\n> > Hi,\n> >  I have some confusion in applying a function over a column.\n> >\n> > Here's my function. I just need to shift non-March \n> month-ends to March \n> > month-ends. Initially I tried seq.dates, but one cannot give a \n> > negative increment (decrement) here.\n> >\n> > \n> return(as.Date(seq.dates(format(xdate,\"%m/%d/%Y\"),by=\"months\",len=4)[4\n> > ])\n> > )\n> >\n> > Hence this simple function:\n> >\n> > > mydate <- as.Date(\"2006-01-01\")\n> > >\n> > > # Function to shift non-March company-reporting dates to March.\n> > > Set2March <- function(xdate){\n> > + # Combines non-March months into March months:\n> > + # Dec2006 -> Mar2007\n> > + # Mar2006 -> Mar2006\n> > + # Jun2006 -> Mar2006\n> > + # Sep2006 -> Mar2006\n> > + # VERY Specific code.\n> > +     Month <- format(xdate,\"%m\")\n> > +     wDate <- month.day.year(julian(xdate))\n> > +     if (Month==\"12\"){\n> > +         wDate$year <- wDate$year + 1\n> > +         wDate$month <- 3\n> > +     }else\n> > +     if (Month==\"06\"){\n> > +         wDate$month <- 3\n> > +     }else\n> > +     if (Month==\"09\"){\n> > +         wDate$month <- 3\n> > +         wDate$day <- wDate$day + 1\n> > +     }else warning (\"No Changes made to the month, since \n> month is not\n> > one of (6,9,12)\")\n> > +     cDate <- \n> chron(paste(wDate$month,wDate$day,wDate$year,sep=\"/\"))\n> > +     return(as.Date(as.yearmon(as.Date(cDate,\"%m/%d/%y\")),frac=1))\n> > + }\n> > > Set2March(as.Date(\"2006-06-30\"))\n> > [1] \"2006-03-31\"\n> > > Set2March(mydate)\n> > [1] \"2006-01-31\"\n> > Warning message:\n> > No Changes made to the month, since month is not one of (6,9,12) in:\n> > Set2March(mydate)\n> > >\n> >\n> > Works well when I use it on a single date. Then I try it on \n> a vector:\n> >\n> >\n> > > dc <- seq(as.Date(\"2006-01-01\"),len=10, by=\"month\") dc\n> >  [1] \"2006-01-01\" \"2006-02-01\" \"2006-03-01\" \"2006-04-01\" \n> \"2006-05-01\"\n> > \"2006-06-01\" \"2006-07-01\" \"2006-08-01\"\n> >  [9] \"2006-09-01\" \"2006-10-01\"\n> >\n> >\n> > > sapply(as.vector(dc),Set2March)\n> > Error in prettyNum(.Internal(format(x, trim, digits, \n> nsmall, width, 3,\n> > :\n> >         unimplemented type 'character' in 'asLogical'\n> > >\n> >\n> > What am I missing here? Shouldn't the function work with the sapply \n> > working on each entry?\n> \n> You can considerable simplify your code with some helper functions:\n> \n> month <- function(x) as.POSIXlt(x)$mon + 1 \"month<-\" <- \n> function(x, value) {\n> \tISOdatetime(year(x) + (value - 1) %/% 12,  (value - 1) \n> %% 12 + 1 , mday(x), hour(x), minute(x), second(x), tz(x)) } \n> year <- function(x) as.POSIXlt(x)$year + 1900 \"year<-\" <- \n> function(x, value) {\n> \tISOdatetime(value,  month(x), mday(x), hour(x), \n> minute(x), second(x), tz(x)) }\n> \n> marchise <- function(x) {\n> \tif (month(x) == 12) year(x) <- year(x)\n> \tif (month(x) %in% c(6, 9, 12)) month(x) <- 3\n> \tx\n> }\n> \n> dc <- seq(as.Date(\"2006-01-01\"),len=10, by=\"month\")\n> marchise(dc[[1]])\n> \n> \n> However, that doesn't work with sapply because the date class \n> seems to get stripped off - I'm not completely why, but \n> perhaps because the date class is a property of the entire \n> vector not the individual\n> values:\n> \n> sapply(marchise, dc)\n> \n> Hadley\n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}