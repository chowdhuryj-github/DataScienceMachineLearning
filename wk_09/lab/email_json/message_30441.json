{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "derrell@samba.org", "subject": "svn commit: samba r22916 - in\n\tbranches/SAMBA_3_0_25/examples/libsmbclient: .", "body": "Author: derrell\nDate: 2007-05-15 19:17:16 +0000 (Tue, 15 May 2007)\nNew Revision: 22916\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22916\n\nLog:\n\n- Fixes bug 4599.  A missing if statement forced subseqeuent\n  attempts to set attributes to fail.\n\n- I also noticed that missing attributes were setting an invalid return string\n  by getxattr(), e.g. if there was not group, the return string had \"GROUP:;\"\n  instead of excluding the GROUP attribute entirely as it should.  The big\n  problem with the way it was, is that the string could not then be passed to\n  setxattr() and parsed.\n\nAdded:\n   branches/SAMBA_3_0_25/examples/libsmbclient/testacl2.c\n\n\nChangeset:\nAdded: branches/SAMBA_3_0_25/examples/libsmbclient/testacl2.c\n===================================================================\n--- branches/SAMBA_3_0_25/examples/libsmbclient/testacl2.c\t2007-05-15 19:14:34 UTC (rev 22915)\n+++ branches/SAMBA_3_0_25/examples/libsmbclient/testacl2.c\t2007-05-15 19:17:16 UTC (rev 22916)\n@@ -0,0 +1,78 @@\n+#include \n+#include \n+#include \n+#include \n+#include \"libsmbclient.h\"\n+#include \"get_auth_data_fn.h\"\n+\n+enum acl_mode\n+{\n+    SMB_ACL_GET,\n+    SMB_ACL_SET,\n+    SMB_ACL_DELETE,\n+    SMB_ACL_MODIFY,\n+    SMB_ACL_ADD,\n+    SMB_ACL_CHOWN,\n+    SMB_ACL_CHGRP\n+};\n+\n+\n+int main(int argc, const char *argv[])\n+{\n+    int i;\n+    int opt;\n+    int flags;\n+    int debug = 0;\n+    int numeric = 0;\n+    int full_time_names = 0;\n+    enum acl_mode mode = SMB_ACL_GET;\n+    static char *the_acl = NULL;\n+    int ret;\n+    char *p;\n+    char *debugstr;\n+    char value[1024];\n+\n+    if (smbc_init(get_auth_data_fn, debug) != 0)\n+    {\n+        printf(\"Could not initialize smbc_ library\\n\");\n+        return 1;\n+    }\n+\n+    SMBCCTX *context = smbc_set_context(NULL);\n+    smbc_option_set(context, \"full_time_names\", 1);\n+    \n+    the_acl = strdup(\"system.nt_sec_desc.*\");\n+    ret = smbc_getxattr(argv[1], the_acl, value, sizeof(value));\n+    if (ret < 0)\n+    {\n+        printf(\"Could not get attributes for [%s] %d: %s\\n\",\n+               argv[1], errno, strerror(errno));\n+        return 1;\n+    }\n+    \n+    printf(\"Attributes for [%s] are:\\n%s\\n\", argv[1], value);\n+\n+    flags = 0;\n+    debugstr = \"set attributes (1st time)\";\n+        \n+    ret = smbc_setxattr(argv[1], the_acl, value, strlen(value), flags);\n+    if (ret < 0)\n+    {\n+        printf(\"Could not %s for [%s] %d: %s\\n\",\n+               debugstr, argv[1], errno, strerror(errno));\n+        return 1;\n+    }\n+    \n+    flags = 0;\n+    debugstr = \"set attributes (2nd time)\";\n+        \n+    ret = smbc_setxattr(argv[1], the_acl, value, strlen(value), flags);\n+    if (ret < 0)\n+    {\n+        printf(\"Could not %s for [%s] %d: %s\\n\",\n+               debugstr, argv[1], errno, strerror(errno));\n+        return 1;\n+    }\n+    \n+    return 0;\n+}\n\n"}