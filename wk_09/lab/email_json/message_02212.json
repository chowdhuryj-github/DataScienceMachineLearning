{"category": "ham", "to_address": "\"Taj Khattra\" <taj.khattra@gmail.com>", "from_address": "tridge@samba.org", "subject": "Re: tdb_transaction_cancel", "body": "Taj,\n\n > here's a contrived test case.  it aborts with the latest tdb in svn,\n > but works ok with the tdb in samba4-tp4.\n > \n > could someone please confirm if this is a bug, or a\n > misunderstanding/misuse of the tdb api on my part?\n\nyou are absolutely right.\n\nVolker, this seems to have been broken by r21303 in Samba3. Can you\nremember why you removed the \n   tdb->locked[h].count = 0;\nline in that commit? Without that line the tdb still thinks the tdb is\nlocked after a transaction cancel.\n\nI know the code has to change, as lockrecs is now dynamic, but I think\nwe need something equivalent there. Perhaps we can just deleting the\nlist? You are not allowed to start a transaction when locks are held,\nso we should be able to wipe the lock list when the transaction is\ncancelled.\n\nCheers, Tridge\n\n"}