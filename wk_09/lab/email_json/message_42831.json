{"category": "ham", "to_address": "\"Stefan (metze) Metzmacher\" <metze@samba.org>", "from_address": "\"Stefan (metze) Metzmacher\" <metze@samba.org>", "subject": "Re: samba3 crash", "body": "-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA1\n\nStefan (metze) Metzmacher schrieb:\n> Stefan (metze) Metzmacher schrieb:\n>> Stefan (metze) Metzmacher schrieb:\n>>> Hi,\n>>> I just noticed this while manually run make test in samba3\n>>> on host hape HP-UX 11.00. Maybe the build-farm will show this\n>>> also in the next run...\n>> strange that BASE-LOCK-LOCK3 from samba4 smbtorture doesn't trigger this...\n> \n>> a backtrace with smbd/*.o locking/*.o lib/talloc/*.o and lib/fault.o\n>> lib/util.o compiled with -g1:\n> \n>> I'll try with -g now:\n> \n> here it is using -ggdb3\n> \n> warning: reading `r3' register: No data\n> 0xc01f5b78 in _waitpid_sys+0x10 () from /usr/lib/libc.2\n> #0  0xc01f5b78 in _waitpid_sys+0x10 () from /usr/lib/libc.2\n> No symbol table info available.\n> #1  0xc0202d04 in waitpid+0x64 () from /usr/lib/libc.2\n> No symbol table info available.\n> #2  0xc01ec760 in _system_sys+0x1b0 () from /usr/lib/libc.2\n> No symbol table info available.\n> #3  0xc0202714 in system+0x5c () from /usr/lib/libc.2\n> No symbol table info available.\n> #4  0x3fa5d4 in smb_panic (why=) at lib/util.c:1658\n>         cmd = 0x40164ac8\n> \"/home/build/build_farm/samba_3_0.metze/source/script/tests/../../script/tests/gdb_backtrace\n> 3768 /\n> home/build/build_farm/samba_3_0.metze/source/bin/smbd\"\n>         result = 1696625253\n> #5  0x374ecc in byte_range_lock_destructor (br_lck=0x40164868) at\n> locking/brlock.c:1578\n>         data = {dptr = 0x401b90c8 \"\", dsize = 8832}\n>         status = {v = 3221225473}\n>         key = {dptr = 0x40164878 \"\", dsize = 16}\n> #6  0x3c862c in _talloc_free (ptr=0x40164868) at lib/talloc/talloc.c:0\n> No locals.\n> #7  0x3c9630 in talloc_free (ptr=0x40164868) at lib/talloc/talloc.c:0\n\nthis is not a crash it's smb_panic() in action:-)\nand status == NT_STATUS_UNSUCCESSFUL == NT_STATUS(0xC0000000 | 0x0001)\n== 3221225473\n\n        } else {\n                TDB_DATA data;\n                NTSTATUS status;\n\n                data.dptr = (uint8 *)br_lck->lock_data;\n                data.dsize = br_lck->num_locks * sizeof(struct lock_struct);\n\n                status = br_lck->record->store(br_lck->record, data,\n                                               TDB_REPLACE);\n                if (!NT_STATUS_IS_OK(status)) {\n                        DEBUG(0, (\"store returned %s\\n\",\nnt_errstr(status)));\n                        smb_panic(\"Could not store byte range mode\nentry\\n\");\n                }\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1.4.5 (GNU/Linux)\nComment: Using GnuPG with SUSE - http://enigmail.mozdev.org\n\niD8DBQFGZVUsm70gjA5TCD8RAqFaAJ9yMg40noDGxUlTUVUqXJ7xx9k+ggCfXyk4\n/+8ipHEwMUA1KUcHFg+kaWE=\n=aB9E\n-----END PGP SIGNATURE-----\n\n"}