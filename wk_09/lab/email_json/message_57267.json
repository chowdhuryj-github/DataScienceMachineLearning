{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23641 - in branches: SAMBA_3_0/source/lib\n\tSAMBA_3_0/source/param SAMBA_3_0_26/source/lib\n\tSAMBA_3_0_26/source/param", "body": "Author: obnox\nDate: 2007-06-28 10:32:52 +0000 (Thu, 28 Jun 2007)\nNew Revision: 23641\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23641\n\nLog:\nPut check for forbidden values in smbconf into a function.\n(This will be used in a next step to prevent storing these\nvalues in reg_smbconf.c.)\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0/source/lib/util_reg.c\n   branches/SAMBA_3_0/source/param/loadparm.c\n   branches/SAMBA_3_0_26/source/lib/util_reg.c\n   branches/SAMBA_3_0_26/source/param/loadparm.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/util_reg.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/util_reg.c\t2007-06-27 22:45:08 UTC (rev 23640)\n+++ branches/SAMBA_3_0/source/lib/util_reg.c\t2007-06-28 10:32:52 UTC (rev 23641)\n@@ -117,3 +117,25 @@\n \tstring_sub(key, \"\\\\\", \"/\", len+1);\n \tstrupper_m(key);\n }\n+\n+/*\n+ * check whether a given value name is forbidden in registry (smbconf)\n+ */\n+BOOL registry_smbconf_valname_forbidden(const char *valname)\n+{\n+\t/* hard code the list of forbidden names here for now */\n+\tconst char *forbidden_valnames[] = {\n+\t\t\"include\",\n+\t\t\"lock directory\",\n+\t\t\"lock dir\",\n+\t\tNULL\n+\t};\n+\tconst char **forbidden = NULL;\n+\n+\tfor (forbidden = forbidden_valnames; *forbidden != NULL; forbidden++) {\n+\t\tif (strwicmp(valname, *forbidden) == 0) {\n+\t\t\treturn True;\n+\t\t}\n+\t}\n+\treturn False;\n+}\n\nModified: branches/SAMBA_3_0/source/param/loadparm.c\n===================================================================\n--- branches/SAMBA_3_0/source/param/loadparm.c\t2007-06-27 22:45:08 UTC (rev 23640)\n+++ branches/SAMBA_3_0/source/param/loadparm.c\t2007-06-28 10:32:52 UTC (rev 23641)\n@@ -3165,10 +3165,7 @@\n \t\t\t\t  &type,\n \t\t\t\t  &size,\n \t\t\t\t  &data_p);\n-\t\tif ((strwicmp(valname,\"include\") == 0) ||\n-\t\t    (strwicmp(valname, \"lock directory\") == 0) ||\n-\t\t    (strwicmp(valname, \"lock dir\") == 0)) \n-\t\t{\n+\t\tif (registry_smbconf_valname_forbidden(valname)) {\n \t\t\tDEBUG(10, (\"process_registry_globals: Ignoring \"\n \t\t\t\t   \"parameter '%s' in registry.\\n\", valname));\n \t\t\tcontinue;\n\nModified: branches/SAMBA_3_0_26/source/lib/util_reg.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/util_reg.c\t2007-06-27 22:45:08 UTC (rev 23640)\n+++ branches/SAMBA_3_0_26/source/lib/util_reg.c\t2007-06-28 10:32:52 UTC (rev 23641)\n@@ -117,3 +117,25 @@\n \tstring_sub(key, \"\\\\\", \"/\", len+1);\n \tstrupper_m(key);\n }\n+\n+/*\n+ * check whether a given value name is forbidden in registry (smbconf)\n+ */\n+BOOL registry_smbconf_valname_forbidden(const char *valname)\n+{\n+\t/* hard code the list of forbidden names here for now */\n+\tconst char *forbidden_valnames[] = {\n+\t\t\"include\",\n+\t\t\"lock directory\",\n+\t\t\"lock dir\",\n+\t\tNULL\n+\t};\n+\tconst char **forbidden = NULL;\n+\n+\tfor (forbidden = forbidden_valnames; *forbidden != NULL; forbidden++) {\n+\t\tif (strwicmp(valname, *forbidden) == 0) {\n+\t\t\treturn True;\n+\t\t}\n+\t}\n+\treturn False;\n+}\n\nModified: branches/SAMBA_3_0_26/source/param/loadparm.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/param/loadparm.c\t2007-06-27 22:45:08 UTC (rev 23640)\n+++ branches/SAMBA_3_0_26/source/param/loadparm.c\t2007-06-28 10:32:52 UTC (rev 23641)\n@@ -3166,10 +3166,7 @@\n \t\t\t\t  &type,\n \t\t\t\t  &size,\n \t\t\t\t  &data_p);\n-\t\tif ((strwicmp(valname,\"include\") == 0) ||\n-\t\t    (strwicmp(valname, \"lock directory\") == 0) ||\n-\t\t    (strwicmp(valname, \"lock dir\") == 0)) \n-\t\t{\n+\t\tif (registry_smbconf_valname_forbidden(valname)) {\n \t\t\tDEBUG(10, (\"process_registry_globals: Ignoring \"\n \t\t\t\t   \"parameter '%s' in registry.\\n\", valname));\n \t\t\tcontinue;\n\n"}