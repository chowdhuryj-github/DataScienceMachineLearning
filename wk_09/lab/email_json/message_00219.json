{"category": "ham", "to_address": "samba-technical@lists.samba.org, Jeremy Allison <jra@samba.org>", "from_address": "James Peach <jpeach@samba.org>", "subject": "Re: svn commit: samba r22132 - in branches:\n\tSAMBA_3_0/source/modules SAMBA_3_0/source/smbd\n\tSAMBA_3_0_25/source/modules SAMBA_3_0_25/source/smbd", "body": "On 08/04/2007, at 4:54 PM, Jeremy Allison wrote:\n\n> On Sun, Apr 08, 2007 at 03:25:55PM -0700, James Peach wrote:\n>> On 08/04/2007, at 12:41 PM, jra@samba.org wrote:\n>>\n>>> Author: jra\n>>> Date: 2007-04-08 19:41:47 +0000 (Sun, 08 Apr 2007)\n>>> New Revision: 22132\n>>>\n>>> WebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?\n>>> view=rev&root=samba&rev=22132\n>>>\n>>> Log:\n>>> I hate inefficiency. Don't call conv_str_size()\n>>> on every pread/sendfile call, initialize these\n>>> variables in an allocated struct at connection\n>>> time and just refer to them directly.\n>>\n>> This code is so close to vfs_cacheprime that I'm tempted to suggest\n>> they should be merged. Was there a particular reason you didn't do  \n>> this?\n>\n> Yes - mine is much simpler :-). I was just doing\n> the minimal thing that works for Vista.\n>\n> Doing cacheprime isn't the same as the readahead()\n> system call on Linux. posix_fadvise is close enough\n> that I could squeeze it in....\n\nYou could add this to vfs_cacheprime, and just have an option that  \ndetermines whether it does a readahead (ie. I/O hint) or an actual  \nread(2).\n\n> This code gives a marked speed increase for Vista\n> clients when using explorer against Linux servers.\n\nSure, but 2 modules that do *almost* the same thing is just confusing.\n\n--\nJames Peach | jpeach@samba.org\n\n\n"}