{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r23257 - in branches/SAMBA_4_0/source/selftest: .", "body": "Author: abartlet\nDate: 2007-05-31 00:00:19 +0000 (Thu, 31 May 2007)\nNew Revision: 23257\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23257\n\nLog:\nNewer OpenLDAP versions don't seem to need this, so simplfy.  \n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/selftest/Samba4.pm\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/selftest/Samba4.pm\n===================================================================\n--- branches/SAMBA_4_0/source/selftest/Samba4.pm\t2007-05-30 23:06:48 UTC (rev 23256)\n+++ branches/SAMBA_4_0/source/selftest/Samba4.pm\t2007-05-31 00:00:19 UTC (rev 23257)\n@@ -204,9 +204,9 @@\n \treturn ($fedora_ds_dir, $pidfile);\n }\n \n-sub mk_openldap($$$$$)\n+sub mk_openldap($$$)\n {\n-\tmy ($self, $ldapdir, $configuration, $basedn, $dnsname, $password) = @_;\n+\tmy ($self, $ldapdir, $configuration) = @_;\n \n \tmy $slapd_conf = \"$ldapdir/slapd.conf\";\n \tmy $pidfile = \"$ldapdir/slapd.pid\";\n@@ -233,8 +233,6 @@\n \t}\n \n \tsystem(\"slaptest -u -f $slapd_conf\") == 0 or die(\"slaptest still fails after adding modules\");\n-\tsystem(\"slapadd -b cn=Configuration,$basedn -f $slapd_conf -l $ldapdir/$dnsname-config.ldif >/dev/null\") == 0 or die(\"slapadd failed\");\n-\tsystem(\"slapadd -b cn=Schema,cn=Configuration,$basedn -f $slapd_conf -l $ldapdir/$dnsname-schema.ldif >/dev/null\") == 0 or die(\"slapadd failed\");\n \n     \n \t$ENV{PATH} = $oldpath;\n@@ -438,7 +436,7 @@\n \t        system(\"$self->{bindir}/smbscript $self->{setupdir}/provision-backend $configuration --ldap-manager-pass=$password --root=$root --realm=$dnsname --host-name=$netbiosname --ldap-backend-type=$self->{ldap}>&2\") == 0 or die(\"backend provision failed\");\n \n \t        if ($self->{ldap} eq \"openldap\") {\n-\t\t       ($ret->{SLAPD_CONF}, $ret->{OPENLDAP_PIDFILE}) = $self->mk_openldap($ldapdir, $configuration, $basedn, $dnsname, $password) or die(\"Unable to create openldap directories\");\n+\t\t       ($ret->{SLAPD_CONF}, $ret->{OPENLDAP_PIDFILE}) = $self->mk_openldap($ldapdir, $configuration) or die(\"Unable to create openldap directories\");\n \t        } elsif ($self->{ldap} eq \"fedora-ds\") {\n \t\t       ($ret->{FEDORA_DS_DIR}, $ret->{FEDORA_DS_PIDFILE}) = $self->mk_fedora_ds($ldapdir, $configuration) or die(\"Unable to create fedora ds directories\");\n \t\t       push (@provision_options, \"--ldap-module=nsuniqueid\");\n\n"}