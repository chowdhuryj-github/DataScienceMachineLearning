{"category": "ham", "to_address": "Jeremy Kister <perl-04@jeremykister.com>, beginners@perl.org", "from_address": "Jeff Pang <pangj@earthlink.net>", "subject": "Re: forking problem with dbd::mysql", "body": "\n\n-----Original Message-----\n>From: Jeremy Kister \n>Sent: May 9, 2007 11:05 AM\n>To: beginners@perl.org\n>Subject: forking problem with dbd::mysql\n>\n>I'm am having an issue with a mysql connection that displays itself when\n>there's forking going on which I can't track down.\n>\n>I've made a test program at http://jeremy.kister.net/code/ftest.pl to\n>demonstrate. I expect this program to print 'SQL RESULT: 1' for as long\n>as it can.\n>\n>But instead:\n>\n>SQL RESULT: 1\n>SQL RESULT: 1\n>SQL RESULT: 1\n>DBD::mysql::st execute failed: MySQL server has gone away at ftest.pl\n>line 36,  line 3.\n>DBD::mysql::st execute failed: MySQL server has gone away at ftest.pl\n>line 36,  line 3.\n>\n>\n>What's gone wrong?\n>\n\n\nHello,\n\nI don't clearly know what's wrong.But maybe due to the two reasons,\n\n1) too less timeout setting in my.cnf? see /etc/my.cnf and look for this line:\n\nwait_timeout = ...\n\n2) as we know,child exiting would return a SIGCHLD signal to parent,maybe this break the dbh connection?try to add these 2 lines in parent code:\n\nuse POSIX qw(:signal_h WNOHANG);\n$SIG{CHLD}=sub {while((my $child=waitpid(-1,WNOHANG))>0){}};\n\n\nHope this helps.\n\n--\nmailto:pangj@earthlink.net\nhttp://home.arcor.de/jeffpang/\n\n-- \nTo unsubscribe, e-mail: beginners-unsubscribe@perl.org\nFor additional commands, e-mail: beginners-help@perl.org\nhttp://learn.perl.org/\n\n\n"}