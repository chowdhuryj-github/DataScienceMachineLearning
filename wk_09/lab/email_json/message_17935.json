{"category": "ham", "to_address": "\"GOUACHE David\" <D.GOUACHE@arvalisinstitutduvegetal.fr>", "from_address": "\"Deepayan Sarkar\" <deepayan.sarkar@gmail.com>", "subject": "Re: [R] add arrows to barchart with groups", "body": "On 4/27/07, GOUACHE David  wrote:\n> Hello Rhelpers,\n>\n> I am trying to represent the following data (hereafter named donnees) in a barchart with a grouping variable :\n>\n>\n> site    traitement      date    s       res\n> 1       NT      17/10/2005      normal  76.2\n> 1       T       17/10/2005      normal  103.2\n> 1       NT      23/11/2005      tardif  81.6\n> 1       T       23/11/2005      tardif  98\n> 2       NT      15/10/2005      normal  72.71\n> 2       T       15/10/2005      normal  94.47\n> 2       NT      15/11/2005      tardif  79.65\n> 2       T       15/11/2005      tardif  94.7\n>\n> barchart(res~s|site,groups=traitement,data=donnees)\n>\n> What I'd like to do is for each site represent with an arrow the difference in value of variable res between normal and tardif values of variable s.\n> I've found one way of doing it:\n>\n>\n> trellis.focus(\"panel\",1,1)\n> xx<-trellis.panelArgs()$x\n> yy<-trellis.panelArgs()$y\n> panel.arrows(as.numeric(xx)[c(1,3)]-0.1,yy[c(1,3)],as.numeric(xx)[c(1,3)]-0.1,yy[c(2,4)],lwd=2,code=3)\n> panel.text(as.numeric(xx)[c(1,3)]-0.35,c(87,87),paste(yy[c(2,4)]-yy[c(1,3)],\"\\nq/ha\"),font=2)\n> trellis.focus(\"panel\",2,1)\n> xx<-trellis.panelArgs()$x\n> yy<-trellis.panelArgs()$y\n> panel.arrows(as.numeric(xx)[c(1,3)]-0.1,yy[c(1,3)],as.numeric(xx)[c(1,3)]-0.1,yy[c(2,4)],lwd=2,code=3)\n> panel.text(as.numeric(xx)[c(1,3)]-0.35,c(87,87),paste(yy[c(2,4)]-yy[c(1,3)],\"\\nq/ha\"),font=2)\n> trellis.unfocus()\n>\n> But I would prefer doing this within a custom panel function so I can apply it more generally, and I haven't been able to figure out how...\n> Could anyone give me a hand?\n\nThe obvious analog (just copy/pasting your code) is:\n\nmy.panel <- function(x, y, ...)\n{\n    panel.barchart(x, y, ...)\n    xx <- x\n    yy <- y\n    panel.arrows(as.numeric(xx)[c(1,3)]-0.1, yy[c(1,3)],\n                 as.numeric(xx)[c(1,3)]-0.1, yy[c(2,4)],\n                 lwd = 2, code = 3)\n    panel.text(as.numeric(xx)[c(1,3)] - 0.35, c(87,87),\n               paste(yy[c(2,4)] - yy[c(1,3)], \"\\nq/ha\"),\n               font=2)\n}\n\nand this seems to work:\n\nbarchart(res~s|site,groups=traitement,data=donnees,\n         panel = my.panel)\n\nbarchart(res~s|site,groups=traitement,data=donnees,\n         panel = my.panel,\n         origin = 0)\n\nI'm not sure what else you are looking for and what you mean by \"more\ngeneral\". For example, it's not clear what you want to happen If you\nhave more than 2 levels in 'groups', or if the second bar is not\nalways higher than the first.\n\n-Deepayan\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}