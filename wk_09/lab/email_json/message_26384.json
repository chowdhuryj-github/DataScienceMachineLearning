{"category": "ham", "to_address": "pangj@earthlink.net, chas.owens@gmail.com", "from_address": "<tom@tacocat.net>", "subject": "Re: forking problem with dbd::mysql", "body": "\nThis is an interesting point, but I think a database might be more\nsimilar to a network socket than a file handle.\n\nI have this same observed behaviour under Oracle and PostgreSQL, so it's\nnot limited to mysql (and shouldn't be fixed with mysql specific flags).\n\nOn 5/9/2007, \"Jeff Pang\"  wrote:\n\n>\n>\n>-----Original Message-----\n>>From: Chas Owens \n>>Sent: May 10, 2007 12:02 AM\n>>To: Jeff Pang \n>>Cc: beginners-list \n>>Subject: Re: forking problem with dbd::mysql\n>>\n>>On 5/9/07, Jeff Pang  wrote:\n>>snip\n>>> But still has a question for me.We may see this similiar destroy method on DBI class,\n>>>\n>>> sub DESTROY\n>>> {\n>>>     my $self = shift;\n>>>     my $dbh = $self->{'dbh'};\n>>>     if ($dbh) {\n>>>         local $SIG{'__WARN__'} = sub {};\n>>>         $dbh->disconnect();\n>>>     }\n>>> }\n>>>\n>>> Ok where in child when going out of scope the $dbh should get disconnected.\n>>> But why this would affect the $dbh in parent?As we know,when forking child get a\n>>> full copy of $dbh from parent and it's separate to parent's $dbh.\n>>snip\n>>\n>>But the connection information in the $dbh is the same, so when the\n>>child disconnects it tells the MySQL server to destroy the connection.\n>> This means that the parent loses its connection unexpectedly.\n>\n>\n>Yes but I think is this maybe a bug in DBI class?For example,open a file handle and after forking child close that handle,this would not affect parent's handle.\n>The codes below show the case,\n>\n>use strict;\n>use warnings;\n>\n>open HDW,\">\",\"test.txt\" or die;\n>select HDW;$|++;select STDOUT;\n>my $pid = fork;\n>die \"can't fork\" unless defined $pid;\n>\n>unless ($pid) {\n>    for (1..10) {\n>        print HDW \"child $_\\n\";\n>        sleep 1;\n>     }\n>    exit 0;\n>\n>} else {\n>    for (1..100) {\n>        print HDW \"parent $_\\n\";\n>        sleep 1;\n>     }\n>}\n>\n>__END__\n>\n>parent would continue to write till end at 100.\n>\n>\n>--\n>mailto:pangj@earthlink.net\n>http://home.arcor.de/jeffpang/\n>\n>--\n>To unsubscribe, e-mail: beginners-unsubscribe@perl.org\n>For additional commands, e-mail: beginners-help@perl.org\n>http://learn.perl.org/\n>\n>\n\n-- \nTo unsubscribe, e-mail: beginners-unsubscribe@perl.org\nFor additional commands, e-mail: beginners-help@perl.org\nhttp://learn.perl.org/\n\n\n\n"}