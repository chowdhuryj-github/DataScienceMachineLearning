{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 92: use the new connect_wait code in the ctdb_messaging test in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 92\nrevision-id: tridge@samba.org-20070411050922-59469f0a8a24cf4b\nparent: tridge@samba.org-20070411045447-b201f3449504949a\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Wed 2007-04-11 15:09:22 +1000\nmessage:\n  use the new connect_wait code in the ctdb_messaging test\nmodified:\n  tests/ctdb_messaging.c         ctdb_messaging.c-20070411034205-6d6vne56pbih2x1p-1\n=== modified file 'tests/ctdb_messaging.c'\n--- a/tests/ctdb_messaging.c\t2007-04-11 03:43:15 +0000\n+++ b/tests/ctdb_messaging.c\t2007-04-11 05:09:22 +0000\n@@ -35,7 +35,7 @@\n static void message_handler(struct ctdb_context *ctdb, uint32_t srvid, \n \t\t\t\t TDB_DATA data, void *private)\n {\n-printf(\"client vnn:%d received a message to srvid:%d\\n\",ctdb_get_vnn(ctdb),srvid);\n+\tprintf(\"client vnn:%d received a message to srvid:%d\\n\",ctdb_get_vnn(ctdb),srvid);\n }\n \n /*\n@@ -142,8 +142,6 @@\n \t/* start the protocol running */\n \tret = ctdb_start(ctdb);\n \n-/*XXX why does this block forever?\tctdb_connect_wait(ctdb);*/\n-\n \tpid=fork();\n \tif (pid) {\n \t\tsrvid=0;\n@@ -157,8 +155,11 @@\n \tdata.dsize=0;\n \tctdb_set_message_handler(ctdb, srvid, message_handler, NULL);\n \n-sleep(3);\n-printf(\"sending message from vnn:%d to vnn:%d/srvid:%d\\n\",ctdb_get_vnn(ctdb),ctdb_get_vnn(ctdb), 1-srvid);\n+\tctdb_connect_wait(ctdb);\n+\n+\tsleep(2);\n+\n+\tprintf(\"sending message from vnn:%d to vnn:%d/srvid:%d\\n\",ctdb_get_vnn(ctdb),ctdb_get_vnn(ctdb), 1-srvid);\n \tctdb_send_message(ctdb, ctdb_get_vnn(ctdb), 1-srvid, data);\n \n \twhile(1){\n\n"}