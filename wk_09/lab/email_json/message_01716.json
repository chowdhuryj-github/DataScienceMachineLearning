{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22152 - in\n\tbranches/SAMBA_4_0/source/lib/replace: . test", "body": "Author: metze\nDate: 2007-04-10 16:00:13 +0000 (Tue, 10 Apr 2007)\nNew Revision: 22152\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22152\n\nLog:\nmerge from samba3:\n\nremove netgr functions from libreplace they're not used\nin samba4 currently and samba3 has explicit configure checks for them.\n\nshould fix bug #4496\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/lib/replace/README\n   branches/SAMBA_4_0/source/lib/replace/libreplace.m4\n   branches/SAMBA_4_0/source/lib/replace/replace.c\n   branches/SAMBA_4_0/source/lib/replace/test/testsuite.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/lib/replace/README\n===================================================================\n--- branches/SAMBA_4_0/source/lib/replace/README\t2007-04-10 15:59:39 UTC (rev 22151)\n+++ branches/SAMBA_4_0/source/lib/replace/README\t2007-04-10 16:00:13 UTC (rev 22152)\n@@ -12,7 +12,6 @@\n strlcat\n mktime\n rename\n-innetgr\n initgroups\n memmove\n strdup\n@@ -89,5 +88,4 @@\n Prerequisites:\n memset (for bzero)\n syslog (for vsyslog)\n-setnetgrent, getnetgrent, endnetgrent (for innetgr)\n mktemp (for mkstemp and mkdtemp)\n\nModified: branches/SAMBA_4_0/source/lib/replace/libreplace.m4\n===================================================================\n--- branches/SAMBA_4_0/source/lib/replace/libreplace.m4\t2007-04-10 15:59:39 UTC (rev 22151)\n+++ branches/SAMBA_4_0/source/lib/replace/libreplace.m4\t2007-04-10 16:00:13 UTC (rev 22152)\n@@ -150,7 +150,7 @@\n \n AC_CHECK_FUNCS(seteuid setresuid setegid setresgid chroot bzero strerror)\n AC_CHECK_FUNCS(vsyslog setlinebuf mktime ftruncate chsize rename)\n-AC_CHECK_FUNCS(waitpid strlcpy strlcat innetgr initgroups memmove strdup)\n+AC_CHECK_FUNCS(waitpid strlcpy strlcat initgroups memmove strdup)\n AC_CHECK_FUNCS(pread pwrite strndup strcasestr strtok_r mkdtemp socketpair)\n AC_HAVE_DECL(setresuid, [#include ])\n AC_HAVE_DECL(setresgid, [#include ])\n@@ -331,8 +331,7 @@\n m4_include(timegm.m4)\n m4_include(repdir.m4)\n \n-AC_CHECK_FUNCS([syslog memset setnetgrent getnetgrent endnetgrent memcpy],,\n-\t\t\t   [AC_MSG_ERROR([Required function not found])])\n+AC_CHECK_FUNCS([syslog memset memcpy],,[AC_MSG_ERROR([Required function not found])])\n \n echo \"LIBREPLACE_BROKEN_CHECKS: END\"\n ]) dnl end AC_LIBREPLACE_BROKEN_CHECKS\n\nModified: branches/SAMBA_4_0/source/lib/replace/replace.c\n===================================================================\n--- branches/SAMBA_4_0/source/lib/replace/replace.c\t2007-04-10 15:59:39 UTC (rev 22151)\n+++ branches/SAMBA_4_0/source/lib/replace/replace.c\t2007-04-10 16:00:13 UTC (rev 22152)\n@@ -154,33 +154,6 @@\n #endif /* !HAVE_MKTIME */\n \n \n-#ifndef HAVE_INNETGR\n-#if defined(HAVE_SETNETGRENT) && defined(HAVE_GETNETGRENT) && defined(HAVE_ENDNETGRENT)\n-/*\n- * Search for a match in a netgroup. This replaces it on broken systems.\n- */\n-int rep_innetgr(const char *group, const char *host, const char *user, \n-\t\t\t\tconst char *dom)\n-{\n-\tchar *hst, *usr, *dm;\n-  \n-\tsetnetgrent(group);\n-\twhile (getnetgrent(&hst, &usr, &dm)) {\n-\t\tif (((host == 0) || (hst == 0) || !strcmp(host, hst)) &&\n-\t\t    ((user == 0) || (usr == 0) || !strcmp(user, usr)) &&\n-\t\t    ((dom == 0) || (dm == 0) || !strcmp(dom, dm))) {\n-\t\t\tendnetgrent();\n-\t\t\treturn (1);\n-\t\t}\n-\t}\n-\tendnetgrent();\n-\treturn (0);\n-}\n-#endif /* HAVE_SETNETGRENT HAVE_GETNETGRENT HAVE_ENDNETGRENT */\n-#endif /* HAVE_INNETGR */\n-\n-\n-\n #ifndef HAVE_INITGROUPS\n /****************************************************************************\n  some systems don't have an initgroups call \n\nModified: branches/SAMBA_4_0/source/lib/replace/test/testsuite.c\n===================================================================\n--- branches/SAMBA_4_0/source/lib/replace/test/testsuite.c\t2007-04-10 15:59:39 UTC (rev 22151)\n+++ branches/SAMBA_4_0/source/lib/replace/test/testsuite.c\t2007-04-10 16:00:13 UTC (rev 22152)\n@@ -125,12 +125,6 @@\n \treturn true;\n }\n \n-static int test_innetgr(void)\n-{\n-\t/* FIXME */\n-\treturn true;\n-}\n-\n static int test_initgroups(void)\n {\n \t/* FIXME */\n@@ -480,7 +474,6 @@\n \tret &= test_strlcpy();\n \tret &= test_strlcat();\n \tret &= test_mktime();\n-\tret &= test_innetgr();\n \tret &= test_initgroups();\n \tret &= test_memmove();\n \tret &= test_strdup();\n\n"}