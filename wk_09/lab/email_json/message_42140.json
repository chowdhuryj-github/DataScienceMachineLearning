{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 461: don't crash doing ctdb ip when not doing takeover in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 461\nrevision-id: tridge@samba.org-20070604122852-z351kj9m6s28x08f\nparent: tridge@samba.org-20070604121359-iyitumtjbhllb84j\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Mon 2007-06-04 22:28:52 +1000\nmessage:\n  don't crash doing ctdb ip when not doing takeover\nmodified:\n  takeover/ctdb_takeover.c       ctdb_takeover.c-20070525071636-a5n1ihghjtppy08r-2\n=== modified file 'takeover/ctdb_takeover.c'\n--- a/takeover/ctdb_takeover.c\t2007-06-04 12:13:59 +0000\n+++ b/takeover/ctdb_takeover.c\t2007-06-04 12:28:52 +0000\n@@ -692,7 +692,7 @@\n \n \n /*\n-  \n+  get list of public IPs\n  */\n int32_t ctdb_control_get_public_ips(struct ctdb_context *ctdb, struct ctdb_req_control *c, TDB_DATA *outdata)\n {\n@@ -701,7 +701,7 @@\n \n \tlen = offsetof(struct ctdb_all_public_ips, ips) + ctdb->num_nodes*sizeof(struct ctdb_public_ip);\n \n-\tips = talloc_size(outdata, len);\n+\tips = talloc_zero_size(outdata, len);\n \tCTDB_NO_MEMORY(ctdb, ips);\n \n \toutdata->dsize = len;\n@@ -712,7 +712,9 @@\n \t\tips->ips[i].vnn = i;\n \t\tips->ips[i].takeover_vnn = ctdb->nodes[i]->takeover_vnn;\n \t\tips->ips[i].sin.sin_family = AF_INET;\n-\t\tinet_aton(ctdb->nodes[i]->public_address, &ips->ips[i].sin.sin_addr);\n+\t\tif (ctdb->nodes[i]->public_address) {\n+\t\t\tinet_aton(ctdb->nodes[i]->public_address, &ips->ips[i].sin.sin_addr);\n+\t\t}\n \t}\n \n \treturn 0;\n\n"}