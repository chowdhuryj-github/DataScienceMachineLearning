{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22192 - in\n\tbranches/SAMBA_4_0/source/torture/rpc: .", "body": "Author: metze\nDate: 2007-04-12 11:24:51 +0000 (Thu, 12 Apr 2007)\nNew Revision: 22192\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22192\n\nLog:\nfix compiler warnings\n\nClearEventLog test is compiled in but disabled now\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/torture/rpc/eventlog.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/torture/rpc/eventlog.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/rpc/eventlog.c\t2007-04-12 11:23:58 UTC (rev 22191)\n+++ branches/SAMBA_4_0/source/torture/rpc/eventlog.c\t2007-04-12 11:24:51 UTC (rev 22192)\n@@ -77,7 +77,7 @@\n \t\t\tdcerpc_eventlog_GetNumRecords(p, tctx, &r), \n \t\t\t\"GetNumRecords failed\");\n \n-\ttorture_comment(tctx, talloc_asprintf(tctx, \"%d records\\n\", *r.out.number));\n+\ttorture_comment(tctx, \"%d records\\n\", *r.out.number);\n \n \tcr.in.handle = cr.out.handle = &handle\n \n@@ -186,12 +186,17 @@\n \treturn true;\n }\n \n-static bool test_ClearEventLog(struct dcerpc_pipe *p, TALLOC_CTX *tctx)\n+static bool test_ClearEventLog(struct torture_context *tctx, \n+\t\t\t       struct dcerpc_pipe *p)\n {\n \tstruct eventlog_ClearEventLogW r;\n \tstruct eventlog_CloseEventLog cr;\n \tstruct policy_handle handle;\n \n+\tif (!torture_setting_bool(tctx, \"dangerous\", false)) {\n+\t\ttorture_skip(tctx, \"ClearEventLog test disabled - enable dangerous tests to use\");\n+\t}\n+\n \tif (!get_policy_handle(tctx, p, &handle))\n \t\treturn false;\n \n@@ -236,15 +241,10 @@\n \n \tsuite = torture_suite_create(talloc_autofree_context(), \"EVENTLOG\");\n \ttcase = torture_suite_add_rpc_iface_tcase(suite, \"eventlog\", \n-\t\t\t\t\t\t\t\t\t\t\t  &dcerpc_table_eventlog);\n+\t\t\t\t\t\t  &dcerpc_table_eventlog);\n \n \ttorture_rpc_tcase_add_test(tcase, \"OpenEventLog\", test_OpenEventLog);\n-\n-#if 0\n-\t/* Destructive test */\n \ttorture_rpc_tcase_add_test(tcase, \"ClearEventLog\", test_ClearEventLog);\n-#endif\n-\t\n \ttorture_rpc_tcase_add_test(tcase, \"GetNumRecords\", test_GetNumRecords);\n \ttorture_rpc_tcase_add_test(tcase, \"ReadEventLog\", test_ReadEventLog);\n \ttorture_rpc_tcase_add_test(tcase, \"FlushEventLog\", test_FlushEventLog);\n\n"}