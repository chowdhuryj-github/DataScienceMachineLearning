{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r22411 - in branches/SAMBA_3_0/source/smbd: .", "body": "Author: obnox\nDate: 2007-04-20 12:06:38 +0000 (Fri, 20 Apr 2007)\nNew Revision: 22411\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22411\n\nLog:\nFix the build:\n\nPrototype of create_aio_ex_read, set_message and definition of\nUNIXERROR have changed in r22389 and r22391? to require an additional\n\"inbuf\" argument. Some places in smbd/aio.c had not been adapted.\n\nThis patch fixes the build.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0/source/smbd/aio.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/smbd/aio.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/aio.c\t2007-04-20 11:44:45 UTC (rev 22410)\n+++ branches/SAMBA_3_0/source/smbd/aio.c\t2007-04-20 12:06:38 UTC (rev 22411)\n@@ -242,7 +242,7 @@\n \tbufsize = PTR_DIFF(smb_buf(outbuf),outbuf) + smb_maxcnt;\n \n \tif ((aio_ex = create_aio_ex_read(fsp, bufsize,\n-\t\t\t\t\t SVAL(inbuf,smb_mid))) == NULL) {\n+\t\t\t\t\t SVAL(inbuf,smb_mid), inbuf)) == NULL) {\n \t\tDEBUG(10,(\"schedule_aio_read_and_X: malloc fail.\\n\"));\n \t\treturn False;\n \t}\n@@ -382,6 +382,7 @@\n \tint ret = 0;\n \tint outsize;\n \tchar *outbuf = aio_ex->outbuf;\n+\tchar *inbuf = aio_ex->inbuf;\n \tchar *data = smb_buf(outbuf);\n \tssize_t nread = SMB_VFS_AIO_RETURN(aio_ex->fsp,&aio_ex->acb);\n \n@@ -405,7 +406,7 @@\n \t\toutsize = (UNIXERROR(ERRDOS,ERRnoaccess));\n \t\tret = errno;\n \t} else {\n-\t\toutsize = set_message(outbuf,12,nread,False);\n+\t\toutsize = set_message(inbuf,outbuf,12,nread,False);\n \t\tSSVAL(outbuf,smb_vwv2,0xFFFF); /* Remaining - must be * -1. */\n \t\tSSVAL(outbuf,smb_vwv5,nread);\n \t\tSSVAL(outbuf,smb_vwv6,smb_offset(data,outbuf));\n@@ -418,7 +419,7 @@\n \t\t\t    aio_ex->acb.aio_nbytes, (int)nread ) );\n \n \t}\n-\tsmb_setlen(aio_ex->inbuf,outbuf,outsize - 4);\n+\tsmb_setlen(inbuf,outbuf,outsize - 4);\n \tshow_msg(outbuf);\n \tif (!send_smb(smbd_server_fd(),outbuf)) {\n \t\texit_server_cleanly(\"handle_aio_read_complete: send_smb \"\n@@ -443,6 +444,7 @@\n \tint ret = 0;\n \tfiles_struct *fsp = aio_ex->fsp;\n \tchar *outbuf = aio_ex->outbuf;\n+\tchar *inbuf = aio_ex->inbuf;\n \tssize_t numtowrite = aio_ex->acb.aio_nbytes;\n \tssize_t nwritten = SMB_VFS_AIO_RETURN(fsp,&aio_ex->acb);\n \n\n"}