{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r23402 - in branches: SAMBA_3_0/source/rpc_server\n\tSAMBA_3_0_25/source/rpc_server SAMBA_3_0_26/source/rpc_server", "body": "Author: jra\nDate: 2007-06-09 00:27:28 +0000 (Sat, 09 Jun 2007)\nNew Revision: 23402\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23402\n\nLog:\nGot bitten by a talloc hierarchy. Make sure we alloc\noff the pipe ctx now ->names is part of the containing\nstruct.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/rpc_server/srv_lsa_nt.c\n   branches/SAMBA_3_0_25/source/rpc_server/srv_lsa_nt.c\n   branches/SAMBA_3_0_26/source/rpc_server/srv_lsa_nt.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/rpc_server/srv_lsa_nt.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_server/srv_lsa_nt.c\t2007-06-09 00:18:07 UTC (rev 23401)\n+++ branches/SAMBA_3_0/source/rpc_server/srv_lsa_nt.c\t2007-06-09 00:27:28 UTC (rev 23402)\n@@ -420,7 +420,7 @@\n \tif (names->num_entries) {\n \t\tint i;\n \n-\t\toldnames->name = TALLOC_ARRAY(oldnames, LSA_TRANS_NAME, names->num_entries);\n+\t\toldnames->name = TALLOC_ARRAY(mem_ctx, LSA_TRANS_NAME, names->num_entries);\n \n \t\tif (!oldnames->name) {\n \t\t\treturn NT_STATUS_NO_MEMORY;\n@@ -838,8 +838,8 @@\n \t\treturn status;\n \t}\n \n-\tnames->name = TALLOC_ARRAY(names, LSA_TRANS_NAME2, num_sids);\n-\tnames->uni_name = TALLOC_ARRAY(names, UNISTR2, num_sids);\n+\tnames->name = TALLOC_ARRAY(p->mem_ctx, LSA_TRANS_NAME2, num_sids);\n+\tnames->uni_name = TALLOC_ARRAY(p->mem_ctx, UNISTR2, num_sids);\n \tif ((names->name == NULL) || (names->uni_name == NULL)) {\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n\nModified: branches/SAMBA_3_0_25/source/rpc_server/srv_lsa_nt.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/rpc_server/srv_lsa_nt.c\t2007-06-09 00:18:07 UTC (rev 23401)\n+++ branches/SAMBA_3_0_25/source/rpc_server/srv_lsa_nt.c\t2007-06-09 00:27:28 UTC (rev 23402)\n@@ -420,7 +420,7 @@\n \tif (names->num_entries) {\n \t\tint i;\n \n-\t\toldnames->name = TALLOC_ARRAY(oldnames, LSA_TRANS_NAME, names->num_entries);\n+\t\toldnames->name = TALLOC_ARRAY(mem_ctx, LSA_TRANS_NAME, names->num_entries);\n \n \t\tif (!oldnames->name) {\n \t\t\treturn NT_STATUS_NO_MEMORY;\n@@ -839,8 +839,8 @@\n \t\treturn status;\n \t}\n \n-\tnames->name = TALLOC_ARRAY(names, LSA_TRANS_NAME2, num_sids);\n-\tnames->uni_name = TALLOC_ARRAY(names, UNISTR2, num_sids);\n+\tnames->name = TALLOC_ARRAY(p->mem_ctx, LSA_TRANS_NAME2, num_sids);\n+\tnames->uni_name = TALLOC_ARRAY(p->mem_ctx, UNISTR2, num_sids);\n \tif ((names->name == NULL) || (names->uni_name == NULL)) {\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n\nModified: branches/SAMBA_3_0_26/source/rpc_server/srv_lsa_nt.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_server/srv_lsa_nt.c\t2007-06-09 00:18:07 UTC (rev 23401)\n+++ branches/SAMBA_3_0_26/source/rpc_server/srv_lsa_nt.c\t2007-06-09 00:27:28 UTC (rev 23402)\n@@ -420,7 +420,7 @@\n \tif (names->num_entries) {\n \t\tint i;\n \n-\t\toldnames->name = TALLOC_ARRAY(oldnames, LSA_TRANS_NAME, names->num_entries);\n+\t\toldnames->name = TALLOC_ARRAY(mem_ctx, LSA_TRANS_NAME, names->num_entries);\n \n \t\tif (!oldnames->name) {\n \t\t\treturn NT_STATUS_NO_MEMORY;\n@@ -838,8 +838,8 @@\n \t\treturn status;\n \t}\n \n-\tnames->name = TALLOC_ARRAY(names, LSA_TRANS_NAME2, num_sids);\n-\tnames->uni_name = TALLOC_ARRAY(names, UNISTR2, num_sids);\n+\tnames->name = TALLOC_ARRAY(p->mem_ctx, LSA_TRANS_NAME2, num_sids);\n+\tnames->uni_name = TALLOC_ARRAY(p->mem_ctx, UNISTR2, num_sids);\n \tif ((names->name == NULL) || (names->uni_name == NULL)) {\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n\n"}