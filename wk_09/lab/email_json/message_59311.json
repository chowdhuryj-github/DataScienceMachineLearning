{"category": "ham", "to_address": "samba-technical@lists.samba.org", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: svn commit: samba r23668 - in branches: SAMBA_3_0/source/lib\n\tSAMBA_3_0_26/source/lib", "body": "On Sat, Jun 30, 2007 at 11:52:24PM +0000, obnox@samba.org wrote:\n> Author: obnox\n> Date: 2007-06-30 23:52:23 +0000 (Sat, 30 Jun 2007)\n> New Revision: 23668\n> \n> WebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23668\n> \n> Log:\n> When creating a new string value, win2k regedit delivers\n> one byte of data despite characters being two-byte.\n> \n> This modifies registry_pull_value, to change the data\n> to the correct two-byte version of the empty string,\n> (as delivered by winxp), when only one byte of data is\n> received.\n\n> +\t\t\tif (!(tmp = SMB_MALLOC_ARRAY(smb_ucs2_t, num_ucs2+1))) {\n> +\t\t\t\terr = WERR_NOMEM;\n> +\t\t\t\tgoto error;\n> +\t\t\t}\n>  \n> -\t\tif (!(tmp = SMB_MALLOC_ARRAY(smb_ucs2_t, num_ucs2+1))) {\n\nDANGER DANGER !!!!! Does num_ucs2 come from the client ?\n\nYou must check for integer wrap here otherwise you've\njust added a security hole !!!!\n\nJeremy.\n\n"}