{"category": "ham", "to_address": "derrell@samba.org", "from_address": "Henrik Zagerholm <henke@mac.se>", "subject": "Re: Samba 3.0.25rc2 error in libsmbclient.so", "body": "Hi Derrell,\n\nWelcome back. :)\n\nYes, I can confirm that Simo's patch with the Makefile.in solved the  \nbelow issues.\n\nI had my suspicions that there something wrong with the compile but  \ncouldn't figure out what. :)\n\nCheers,\nHenrik\n\n25 apr 2007 kl. 18:38 skrev derrell@samba.org:\n\n> Henrik, I just returned and was about to look into your problems,  \n> but see that\n> a patch from Simo has been successful for you.  Please confirm that  \n> all issues\n> addressed in your messages (copied below) are resolved and that  \n> libsmbclient\n> works properly for you.\n>\n> Thanks,\n>\n> Derrell\n>\n>\n> Henrik Zagerholm  writes:\n>\n>> Hello,\n>>\n>> We are trying to compile samba_3.0.25. ./configure, make, make   \n>> install all\n>> seems to work and runs without any errors.\n>> The problems starts when we try to use libsmbclient.so.\n>> We have a program that links with libsmbclient.so and after  \n>> upgrading  from\n>> SAMBA_3_0 revision 18029 to \"Version 3.0.25rc2-SVN-build-22402\"  I  \n>> get lots of\n>> different error messages similar to \"undefined  reference to  \n>> `smbc_open'\" when\n>> I compile our program.\n>>\n>> We did a test program and compared our old libsmbcilent.so with  \n>> the  new\n>> one. It basically opens it (using dlopen) and searches for a   \n>> symbol (using\n>> dlsym) for example \"smbc_open\". The test program  succeeds in  \n>> opening both\n>> files, but it will only find the symbols in  the old one.\n>>\n>> I've included our test program called sotest.\n>>\n>>\n>>\n>>\n>>\n>> Regards,\n>> Henrik\n>\n> Henrik Zagerholm  writes:\n>\n>> 21 apr 2007 kl. 23:24 skrev derrell@samba.org:\n>>\n>>> Henrik Zagerholm  writes:\n>>>\n>>>> Hello list,\n>>>>\n>>>> I get the following errors when compiling the examples in   \n>>>> libsmbclient.\n>>>> The make && make install of samba itself works but no examples.\n>>>\n>>> Jeremy/Jerry, I don't see these errors in my test environment,  \n>>> but  I suspect\n>>> that it has to do with what configure finds available.  This is  \n>>> almost\n>>> certainly caused by the recent changes to link the example  \n>>> programs  with the\n>>> libsmbclient library in the ../source/bin directory rather than   \n>>> with\n>>> whatever\n>>> happens to be \"installed\".\n>>>\n>> I would also like to mention that all my old apps that uses   \n>> libsmbclient\n>> can't compile any more.\n>> See my post \"Samba 3.0.25rc2 error in libsmbclient.so\" sent 2 days  \n>> ago.\n>> There is even a small test app attached.\n>>\n>> Cheers,\n>> Henrik\n>>\n>>\n>>> Is there a mechanism in the current build system to determine  \n>>> the  static\n>>> libraries (.a) needed to link an executable given what configure   \n>>> found?  If\n>>> not (or maybe even if so), I should probably just explicitly link\n>>> libsmbclient.a but leave the remainder of the example  \n>>> dynamically  linked.\n>>> That's really not what I wanted, but if there are going to be   \n>>> environment-\n>>> specific issues, that's probalby the best I can get.\n>>>\n>>> Derrell\n>>>\n>>>\n>>>> Enclosed are the error messages.\n>>>>\n>>>> cubiq-debian:~/downloads/SAMBA_3_0/examples/libsmbclient# make\n>>>> gcc -O0 -g -I../../source/include -I/usr/include/gtk-1.2 -I/usr/\n>>>> include/glib-1.2 -I/usr/lib/glib/include -D_LARGEFILE64_SOURCE -\n>>>> D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE   -c -o testsmbc.o testsmbc.c\n>>>> Linking testsmbc\n>>>> gcc -O0 -g -I../../source/include -I/usr/include/gtk-1.2 -I/usr/\n>>>> include/glib-1.2 -I/usr/lib/glib/include -D_LARGEFILE64_SOURCE -\n>>>> D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -L/usr/local/samba/lib -o    \n>>>> testsmbc\n>>>> testsmbc.o ../../source/bin/libsmbclient.a -ldl -lresolv\n>>>> ../../source/bin/libsmbclient.a(cliconnect.o): In function\n>>>> `cli_session_setup_spnego':\n>>>> cliconnect.c:(.text+0x29b5): undefined reference to `error_message'\n>>>> cliconnect.c:(.text+0x2ac3): undefined reference to `error_message'\n>>>> ../../source/bin/libsmbclient.a(smb_seal.o): In function\n>>>> `common_free_enc_buffer':\n>>>> smb_seal.c:(.text+0x132): undefined reference to  \n>>>> `gss_release_buffer'\n>>>> ../../source/bin/libsmbclient.a(smb_seal.o): In function\n>>>> `common_free_encryption_state':\n>>>> smb_seal.c:(.text+0x1e4): undefined reference to `gss_release_cred'\n>>>> smb_seal.c:(.text+0x200): undefined reference to    \n>>>> `gss_delete_sec_context'\n>>>> ../../source/bin/libsmbclient.a(smb_seal.o): In function\n>>>> `common_encrypt_buffer':\n>>>>\n>>>> -------------------------------- SNIP\n>>>> --------------------------------------\n>>>>\n>>>> clikrb5.c:(.text+0x17dc): undefined reference to `error_message'\n>>>> clikrb5.c:(.text+0x1895): undefined reference to  \n>>>> `krb5_set_real_time'\n>>>> clikrb5.c:(.text+0x18b0): undefined reference to `krb5_cc_get_type'\n>>>> clikrb5.c:(.text+0x1914): undefined reference to `krb5_cc_get_name'\n>>>> clikrb5.c:(.text+0x19ec): undefined reference to   \n>>>> `krb5_cc_remove_cred'\n>>>> clikrb5.c:(.text+0x1a33): undefined reference to `error_message'\n>>>> clikrb5.c:(.text+0x1abd): undefined reference to `krb5_cc_get_name'\n>>>> clikrb5.c:(.text+0x1adb): undefined reference to `krb5_cc_get_type'\n>>>> clikrb5.c:(.text+0x1b52): undefined reference to   \n>>>> `krb5_mk_req_extended'\n>>>> clikrb5.c:(.text+0x1b99): undefined reference to `error_message'\n>>>> clikrb5.c:(.text+0x1bc0): undefined reference to `krb5_free_creds'\n>>>> clikrb5.c:(.text+0x1bd8): undefined reference to    \n>>>> `krb5_free_cred_contents'\n>>>> clikrb5.c:(.text+0x1bed): undefined reference to   \n>>>> `krb5_free_principal'\n>>>> clikrb5.c:(.text+0x1c7a): undefined reference to `krb5_cc_close'\n>>>> clikrb5.c:(.text+0x1c90): undefined reference to  \n>>>> `krb5_auth_con_free'\n>>>> clikrb5.c:(.text+0x1c9b): undefined reference to  \n>>>> `krb5_free_context'\n>>>> clikrb5.c:(.text+0x1cb2): undefined reference to   \n>>>> `krb5_free_principal'\n>>>> collect2: ld returned 1 exit status\n>>>> make: *** [testsmbc] Error 1\n>>>>\n>>>>\n>>>> Regards,\n>>>> Henrik\n>>>>\n>>>\n>>> -- \n>>\n>\n> idra@samba.org writes:\n>\n>> On Sun, Apr 22, 2007 at 12:50:54PM +0200, Henrik Zagerholm wrote:\n>>> I would also like to mention that all my old apps that uses\n>>> libsmbclient can't compile any more.\n>>> See my post \"Samba 3.0.25rc2 error in libsmbclient.so\" sent 2  \n>>> days ago.\n>>> There is even a small test app attached.\n>>\n>> Tihs patch may fix your problem. We found out that we were using -pie\n>> with -shared which is not exactly a good thing:\n>>\n>> http://viewcvs.samba.org/cgi-bin/viewcvs.cgi/branches/SAMBA_3_0_25/ \n>> source/Makefile.in? \n>> rev=22482&r1=22321&r2=22482&makepatch=1&diff_format=u\n>>\n>> Can you test it ?\n>>\n>> Thanks,\n>> Simo.\n>>\n>> -- \n>> Simo Sorce       idra@samba.org\n>> -------------------------------\n>> Samba Team http://www.samba.org\n>>\n>\n> Henrik Zagerholm  writes:\n>\n>> 23 apr 2007 kl. 11:59 skrev idra@samba.org:\n>>\n>>> On Sun, Apr 22, 2007 at 12:50:54PM +0200, Henrik Zagerholm wrote:\n>>>> I would also like to mention that all my old apps that uses\n>>>> libsmbclient can't compile any more.\n>>>> See my post \"Samba 3.0.25rc2 error in libsmbclient.so\" sent 2  \n>>>> days  ago.\n>>>> There is even a small test app attached.\n>>>\n>>> Tihs patch may fix your problem. We found out that we were using - \n>>> pie\n>>> with -shared which is not exactly a good thing:\n>>>\n>>> http://viewcvs.samba.org/cgi-bin/viewcvs.cgi/branches/SAMBA_3_0_25/\n>>> source/Makefile.in?  \n>>> rev=22482&r1=22321&r2=22482&makepatch=1&diff_format=u\n>>>\n>>> Can you test it ?\n>>\n>> Looks like we have a winner!\n>> Great work Simo, thanks.\n>> //Henrik\n>>\n>>>\n>>> Thanks,\n>>> Simo.\n>>>\n>>> -- \n>>> Simo Sorce       idra@samba.org\n>>> -------------------------------\n>>> Samba Team http://www.samba.org\n>>\n>\n> -- \n\n"}