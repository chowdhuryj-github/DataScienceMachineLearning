{"category": "ham", "to_address": "James Peach <jpeach@samba.org>", "from_address": "Peter Somogyi <psomogyi@gamax.hu>", "subject": "Re: ctdb debug vasprintf memory overwrite in ib", "body": "> >    ret = vsnprintf(NULL, 0, format, tmp_ap);\n>\n> Note that you can't rely on this returning the number of characters\n> that would have been output if the buffer were large enough until C99\n> or UNIX98 IIRC.\n\nI've just found another solution: I've just changed my bzr to use \ntalloc_vasprintf:\n\nvoid do_debug(const char *format, ...)\n...\n        va_start(ap, format);\n        s = talloc_vasprintf(NULL, format, ap);\n        va_end(ap);\n...\n        talloc_free(s);\n\nAnd now it seems to work fine, and I don't have to worry about va_copy \ncompatibility any more... (talloc does it...)\n\n[+ hopefully my bzr commits should be visible on samba-cvs soon...]\n\nPeter\n\n"}