{"category": "ham", "to_address": "samba-technical@lists.samba.org", "from_address": "simo <idra@samba.org>", "subject": "Re: svn commit: samba r22743 - in\n\tbranches/SAMBA_4_0/source/lib/charset: .", "body": "On Mon, 2007-05-07 at 13:32 +0000, metze@samba.org wrote:\n> Author: metze\n> Date: 2007-05-07 13:32:34 +0000 (Mon, 07 May 2007)\n> New Revision: 22743\n> \n> WebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22743\n> \n> Log:\n> set the talloc name to the string...\n\nMetze this will horribly break as soon as you realloc() the string and\nthe glibc returns a different pointer. As soon as that happens, tc->name\nwill be an invalid pointer.\n\nYou really don't want this into a generic function that returns char *\n(without const).\n\nAlso the comment makes it clear that we do in fact use the return to\nappend strings (which means we do realloc it routinely).\n\ntalloc_set_name_const() must be used _only_ with real const values as\nthe name suggests. And copying the value would be a waste of memory and\nwill get outdated after further manipulation.\n\nCan you revert?\n\nSimo.\n\n-- \nSimo Sorce\nSamba Team GPL Compliance Officer\nemail: idra@samba.org\nhttp://samba.org\n\n"}