{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "svn commit: samba r23058 - in\n\tbranches/SAMBA_4_0/source/libcli/cldap: .", "body": "Author: tridge\nDate: 2007-05-22 00:43:10 +0000 (Tue, 22 May 2007)\nNew Revision: 23058\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23058\n\nLog:\n\nthe cldap code was getting too intimate with the internals of struct\nasn1_context. A hangover from when it wasn't a allocated structure\n\nModified:\n   branches/SAMBA_4_0/source/libcli/cldap/cldap.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/libcli/cldap/cldap.c\n===================================================================\n--- branches/SAMBA_4_0/source/libcli/cldap/cldap.c\t2007-05-21 23:35:14 UTC (rev 23057)\n+++ branches/SAMBA_4_0/source/libcli/cldap/cldap.c\t2007-05-22 00:43:10 UTC (rev 23058)\n@@ -100,7 +100,6 @@\n \t\ttalloc_free(tmp_ctx);\n \t\treturn;\n \t}\n-\ttalloc_steal(tmp_ctx, asn1->data);\n \n \tldap_msg = talloc(tmp_ctx, struct ldap_message);\n \tif (ldap_msg == NULL) {\n@@ -129,8 +128,7 @@\n \t\treturn;\n \t}\n \n-\treq->asn1 = asn1;\n-\ttalloc_steal(req, asn1->data);\n+\treq->asn1 = talloc_steal(req, asn1);\n \treq->asn1->ofs = 0;\n \n \treq->state = CLDAP_REQUEST_DONE;\n@@ -312,6 +310,10 @@\n \treq->timeout     = io->in.timeout;\n \treq->num_retries = io->in.retries;\n \treq->is_reply    = False;\n+\treq->asn1        = asn1_init(req);\n+\tif (!req->asn1) {\n+\t\tgoto failed;\n+\t}\n \n \treq->dest = socket_address_from_strings(req, cldap->sock->backend_name,\n \t\t\t\t\t\tio->in.dest_address, lp_cldap_port());\n@@ -376,6 +378,10 @@\n \treq->cldap       = cldap;\n \treq->state       = CLDAP_REQUEST_SEND;\n \treq->is_reply    = True;\n+\treq->asn1        = asn1_init(req);\n+\tif (!req->asn1) {\n+\t\tgoto failed;\n+\t}\n \n \treq->dest        = io->dest;\n \tif (talloc_reference(req, io->dest) == NULL) goto failed;\n\n"}