{"category": "ham", "to_address": "samba-technical@lists.samba.org", "from_address": "Frank Gruman <fgatwork@verizon.net>", "subject": "Samba4 TP5 as PDC with Win2k3 as BDC", "body": "Hello all,\n\nI've got a home network with 3 Windows machines and 4 Linux machines.\nRather than take up valuable work time playing with Samba 4, I am trying\nto set up some different scenarios at home...\n\nMy first scenario was a Samba 4 PDC standalone.  This worked ok, but I\nhad some issues with speed of logins and general user maintenance.  But\nit was GREAT for a pre-Alpha product.\n\nThe second scenario is where I am stuck - Samba 4 PDC with Win2k3 BDC.\nI currently receive the following error when I try to create the server\nas a BDC:\n\n        Failed to modify SPNs on\n        cn=brokenbox,cn=computers,dc=myhome,dc=int: kludge_acl_change:\n        attempted database modify not permitted. User MYHOME\\BROKENBOX$\n        is not SYSTEM or an administrator\n        EPOLL_CTL_ADD failed (Bad file descriptor) - falling back to\n        select()\n        EPOLL_CTL_ADD failed (Bad file descriptor) - falling back to\n        select()\n        EPOLL_CTL_ADD failed (Bad file descriptor) - falling back to\n        select()\n        \nThe Windows server name is brokenbox and begins this process as a\nnon-domain server.  My Samba4 PDC is running on openSUSE 10.3 Alpha 4+.\nI am logging in with the domain administrator account.  After the\ninstallation has failed the server then belongs to the domain, but not\nas a BDC.  If I start the wizard again, it performs the same steps and\nfails with the same error.\n\nI looked in the code and found the calling procedure\n(samba4/source/dsdb/samdb/ldb_modules/kludge_acl.c)\n\n        static int kludge_acl_change(struct ldb_module *module, struct\n        ldb_request *req)\n        {\n        \tenum user_is user_type = what_is_user(module);\n        \tswitch (user_type) {\n        \tcase SYSTEM:\n        \tcase ADMINISTRATOR:\n        \t\treturn ldb_next_request(module, req);\n        \tdefault:\n        \t\tldb_asprintf_errstring(module->ldb,\n        \t\t\t\t       \"kludge_acl_change: \"\n        \t\t\t\t       \"attempted database modify not permitted. \"\n        \t\t\t\t       \"User %s is not SYSTEM or an administrator\",\n        \t\t\t\t       user_name(req, module));\n        \t\treturn LDB_ERR_INSUFFICIENT_ACCESS_RIGHTS;\n        \t}\n        }\n\nAnd I can trace this back to how and where in the code you are setting\nthe user_type.  The part I don't understand is how / where does the\nvalue for user_is change from the domain username to the new machine\naccount?\n\nAny help would be much appreciated.\n\nRegards,\nFrank\n\n"}