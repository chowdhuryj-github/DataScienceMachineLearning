{"category": "ham", "to_address": "\"David Daniel\" <ddaniel@nmsu.edu>", "from_address": "\"Spielas Bates\" <bates@stat.wisc.edu>", "subject": "Re: [R] lme() doesn't converge on IGF example", "body": "On 6/13/07, David Daniel  wrote:\n> Running the Chapter 4 examples in Pinheiro & Bates' \"Mixed-Effects\n> Models in S and S-PLUS\" (2000), I get a message that the default\n> optimizer doesn't converge, but using \"optim\" for the optimizer\n> results in convergence:\n>\n> > > library(nlme)\n> > > fm1IGF.lis <- lmList(IGF)\n> > > fm1IGF.lme <- lme(fm1IGF.lis)\n> > Error in lme.formula(fixed = conc ~ age, data = IGF, random = list\n> > (Lot = c(-0.741604809797216,  :\n> >       nlminb problem, convergence error code = 1; message = iteration\n> > limit reached without convergence (9)\n> > >\n> > > fm1IGF.lme <- lme(fm1IGF.lis, control= list(opt=\"optim\"))\n>\n> I wouldn't have expected the default optimizer to not work with an\n> example from this text.  Not knowing anything about the optimizers,\n> I'm wondering if this is expected or known behavior, or if there are\n> tips for getting it to converge other than changing optimizers?\n\nThat model fit corresponds to a singular variance-covariance matrix\nfor the random effects (notice that the correlation is -1).  The way\nthat the model was written in lme this corresponds to an infinite\nvalue of one of the parameters so it is actually an advantage that the\nnlminb optimizer doesn't declare convergence.\n\nIn the lmer2 function from the lme4 package the model is defined in\nsuch a way that the singular variance-covariance matrix corresponds to\na value of zero for one of the parameters that is constrained to be\nnonnegative.   Try\n\nlibrary(lme4)\ndata(IGF, package = \"nlme\")\nfm1IGF.lmer <- lmer2(conc ~ age + (age|Lot), IGF, control =\nlist(msVerbose = TRUE))\n\nand you will see that the second parameter is exactly zero at\nconvergence (or, at least it is on my amd_64 Linux system).\n\nCurrently I do not flag this for the user in the \"show\" method for the\nfitted model.  I should.  Depending on your point of view such a\nfitted model is either a boundary case or not a legitimate mixed\nmodel.\n\nThe ability to converge to a singular model is actually the big\ndifference between the lmer and the lmer2 functions in the lme4\npackage.  For the lmer2 function the model is expressed in such a way\nthat the log-likelihood or the REML criterion can be evaluated for\nsingular variance-covariance matrices.  Furthermore such evaluations\napproach the boundary evaluations smoothly.  The lmer function\nevaluates the log-likelihood using the precision matrix (i.e. the\ninverse of the variance-covariance) which, by definition, cannot be\nevaluated when the variance-covariance matrix is singular.\n\n>\n> nlme Version:       3.1-80\n>\n> > > R.Version()\n> > $platform\n> > [1] \"i386-apple-darwin8.9.1\"\n> >\n> > $arch\n> > [1] \"i386\"\n> >\n> > $os\n> > [1] \"darwin8.9.1\"\n> >\n> > $system\n> > [1] \"i386, darwin8.9.1\"\n> >\n> > $status\n> > [1] \"\"\n> >\n> > $major\n> > [1] \"2\"\n> >\n> > $minor\n> > [1] \"5.0\"\n> >\n> > $year\n> > [1] \"2007\"\n> >\n> > $month\n> > [1] \"04\"\n> >\n> > $day\n> > [1] \"23\"\n> >\n> > $`svn rev`\n> > [1] \"41293\"\n> >\n> > $language\n> > [1] \"R\"\n> >\n> > $version.string\n> > [1] \"R version 2.5.0 (2007-04-23)\"\n>\n> ----------------------------------\n> David Daniel\n> Associate Professor\n> University Statistics Center\n> New Mexico State University\n>\n> ddaniel@nmsu.edu\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}