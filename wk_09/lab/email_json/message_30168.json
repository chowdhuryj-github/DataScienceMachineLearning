{"category": "ham", "to_address": "\"Benilton Carvalho\" <bcarvalh@jhsph.edu>", "from_address": "\"Dimitris Rizopoulos\" <dimitris.rizopoulos@med.kuleuven.be>", "subject": "Re: [R] Efficient computation of trimmed stats?", "body": "the following seems a bit better:\n\nset.seed(1)\nnc <- 30\nnr <- 25000\nx <- matrix(rnorm(nc*nr), ncol = nc)\ng <- matrix(sample(1:3, nr*nc, rep = TRUE), ncol = nc)\n\n#################################\n\ntrimmedMeanByGroup1 <- function(y, grp, trim=.05)\n   tapply(y, factor(grp, levels=1:3), mean, trim=trim)\n\ntrimmedMeanByGroup2 <- function(y, grp, trim = .05){\n   unlist(lapply(split(y, grp), mean, trim = trim))\n}\n\nout1 <- out2 <- matrix(0, nr, 3)\nsystem.time(for(i in 1:nr) out1[i, ] <- trimmedMeanByGroup1(x[i, ], \ng[i, ]))\nsystem.time(for(i in 1:nr) out2[i, ] <- trimmedMeanByGroup2(x[i, ], \ng[i, ]))\n\nall.equal(out1, out2)\n\n\nI hope it helps.\n\nBest,\nDimitris\n\n----\nDimitris Rizopoulos\nPh.D. Student\nBiostatistical Centre\nSchool of Public Health\nCatholic University of Leuven\n\nAddress: Kapucijnenvoer 35, Leuven, Belgium\nTel: +32/(0)16/336899\nFax: +32/(0)16/337015\nWeb: http://med.kuleuven.be/biostat/\n     http://www.student.kuleuven.be/~m0390867/dimitris.htm\n\n----- Original Message ----- \nFrom: \"Benilton Carvalho\" \nTo: \"r-help@lists.r-project.org server posting\" \n\nSent: Monday, May 14, 2007 6:58 PM\nSubject: [R] Efficient computation of trimmed stats?\n\n\n> Hi everyone,\n>\n> I was wondering if there is anything already implemented for\n> efficient (\"row-wise\") computation of group-specific trimmed stats\n> (mean and sd on the trimmed vector) on large matrices.\n>\n> For example:\n>\n> set.seed(1)\n> nc = 300\n> nr = 250000\n> x = matrix(rnorm(nc*nr), ncol=nc)\n> g = matrix(sample(1:3, nr*nc, rep=T), ncol=nc)\n>\n> trimmedMeanByGroup <- function(y, grp, trim=.05)\n>   tapply(y, factor(grp, levels=1:3), mean, trim=trim)\n>\n> sapply(1:10, function(i) trimmedMeanByGroup(x[i,], g[i,]))\n>\n> works fine... but:\n>\n> > system.time(sapply(1:nr, function(i) trimmedMeanByGroup(x[i,], g\n> [i,])))\n>    user  system elapsed\n> 399.928   0.019 399.988\n>\n> does not look interesting for me.\n>\n> Maybe some package has some implementation of the above?\n>\n> Thank you very much,\n> -b\n>\n> --\n> Benilton Carvalho\n> PhD Candidate\n> Department of Biostatistics\n> Bloomberg School of Public Health\n> Johns Hopkins University\n> bcarvalh@jhsph.edu\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide \n> http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n> \n\n\nDisclaimer: http://www.kuleuven.be/cwis/email_disclaimer.htm\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}