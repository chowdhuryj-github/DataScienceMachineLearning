{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r23448 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_25/source/nsswitch SAMBA_3_0_26/source/nsswitch", "body": "Author: jra\nDate: 2007-06-12 19:53:51 +0000 (Tue, 12 Jun 2007)\nNew Revision: 23448\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23448\n\nLog:\nDoh ! Don't call winbind_child_died() *before* the\nkill call as that sets pid = 0 ! :-).\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\n   branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\t2007-06-12 19:47:33 UTC (rev 23447)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\t2007-06-12 19:53:51 UTC (rev 23448)\n@@ -178,19 +178,18 @@\n \n \tasync_reply_recv(private_data, False);\n \n-\t/* \n-\t * Close the socket to the child. Should cause the\n-\t * child to exit.\n-\t */\n-\n \tDEBUG(0,(\"async_request_timeout_handler: child pid %u is not responding. \"\n \t\t\"Closing connection to it.\\n\",\n \t\tstate->child->pid ));\n \n-\twinbind_child_died(state->child->pid);\n-\n \t/* Send kill signal to child. */\n \tkill(state->child->pid, SIGTERM);\n+\n+\t/* \n+\t * Close the socket to the child.\n+\t */\n+\n+\twinbind_child_died(state->child->pid);\n }\n \n static void async_request_sent(void *private_data_data, BOOL success)\n\nModified: branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\t2007-06-12 19:47:33 UTC (rev 23447)\n+++ branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\t2007-06-12 19:53:51 UTC (rev 23448)\n@@ -178,19 +178,18 @@\n \n \tasync_reply_recv(private_data, False);\n \n-\t/* \n-\t * Close the socket to the child. Should cause the\n-\t * child to exit.\n-\t */\n-\n \tDEBUG(0,(\"async_request_timeout_handler: child pid %u is not responding. \"\n \t\t\"Closing connection to it.\\n\",\n \t\tstate->child->pid ));\n \n-\twinbind_child_died(state->child->pid);\n-\n \t/* Send kill signal to child. */\n \tkill(state->child->pid, SIGTERM);\n+\n+\t/* \n+\t * Close the socket to the child.\n+\t */\n+\n+\twinbind_child_died(state->child->pid);\n }\n \n static void async_request_sent(void *private_data_data, BOOL success)\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\t2007-06-12 19:47:33 UTC (rev 23447)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\t2007-06-12 19:53:51 UTC (rev 23448)\n@@ -178,19 +178,18 @@\n \n \tasync_reply_recv(private_data, False);\n \n-\t/* \n-\t * Close the socket to the child. Should cause the\n-\t * child to exit.\n-\t */\n-\n \tDEBUG(0,(\"async_request_timeout_handler: child pid %u is not responding. \"\n \t\t\"Closing connection to it.\\n\",\n \t\tstate->child->pid ));\n \n-\twinbind_child_died(state->child->pid);\n-\n \t/* Send kill signal to child. */\n \tkill(state->child->pid, SIGTERM);\n+\n+\t/* \n+\t * Close the socket to the child.\n+\t */\n+\n+\twinbind_child_died(state->child->pid);\n }\n \n static void async_request_sent(void *private_data_data, BOOL success)\n\n"}