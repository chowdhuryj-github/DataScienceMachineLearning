{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r23710 - in branches: SAMBA_3_0/source/libsmb\n\tSAMBA_3_0_26/source/libsmb", "body": "Author: vlendec\nDate: 2007-07-04 22:30:25 +0000 (Wed, 04 Jul 2007)\nNew Revision: 23710\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23710\n\nLog:\nRemove some code duplication, we do have a random number generator\nModified:\n   branches/SAMBA_3_0/source/libsmb/namequery.c\n   branches/SAMBA_3_0_26/source/libsmb/namequery.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libsmb/namequery.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/namequery.c\t2007-07-04 22:28:04 UTC (rev 23709)\n+++ branches/SAMBA_3_0/source/libsmb/namequery.c\t2007-07-04 22:30:25 UTC (rev 23710)\n@@ -145,15 +145,11 @@\n \n static int generate_trn_id(void)\n {\n-\tstatic int trn_id;\n+\tuint16 id;\n \n-\tif (trn_id == 0) {\n-\t\tsys_srandom(sys_getpid());\n-\t}\n+\tgenerate_random_buffer((uint8 *)&id, sizeof(id));\n \n-\ttrn_id = sys_random();\n-\n-\treturn trn_id % (unsigned)0x7FFF;\n+\treturn id % (unsigned)0x7FFF;\n }\n \n /****************************************************************************\n\nModified: branches/SAMBA_3_0_26/source/libsmb/namequery.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libsmb/namequery.c\t2007-07-04 22:28:04 UTC (rev 23709)\n+++ branches/SAMBA_3_0_26/source/libsmb/namequery.c\t2007-07-04 22:30:25 UTC (rev 23710)\n@@ -145,15 +145,11 @@\n \n static int generate_trn_id(void)\n {\n-\tstatic int trn_id;\n+\tuint16 id;\n \n-\tif (trn_id == 0) {\n-\t\tsys_srandom(sys_getpid());\n-\t}\n+\tgenerate_random_buffer((uint8 *)&id, sizeof(id));\n \n-\ttrn_id = sys_random();\n-\n-\treturn trn_id % (unsigned)0x7FFF;\n+\treturn id % (unsigned)0x7FFF;\n }\n \n /****************************************************************************\n\n"}