{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "\"Earl F. Glynn\" <efg@stowers-institute.org>", "subject": "Re: [R] Read Windows-like .INI files into R data structure?", "body": " wrote in message \nnews:<0946E293C7C22A45A0E33BA14FAA8D88F38818@500MAIL.goldbox.com>...\n> .Ini files are, for lack of a better description, ancient.\n\nIn this case a device is creating the INI files as part of an experiment, so \nthe file format cannot be changed (at least easily).\n\nI've looked at XML files from time to time and I'm amazed more don't \ncomplain how bloated, if not wasteful, they are.  I've seen XML files that \nwere megabytes long when they held kilobytes worth of data.  INI files may \nbe ancient, but they can be efficient and effective compared with XML.  In \nsome cases, \"newer\" may not really be better (but \"newer\" may have the \n\"momentum\" behind it).\n\n\n\"Gabor Grothendieck\"  wrote in message \nnews:<971536df0706121623p14725cbbp82610f2d3149a9e7@mail.gmail.com>...\n> In thinking about this a bit more here is an even shorter solution where\n> Lines.raw is as before:\n>\n> # Lines <- readLines(\"myfile.ini\")\n> Lines <- readLines(textConnection(Lines.raw))\n> Lines2 <- chartr(\"[]\", \"==\", Lines)\n> DF <- read.table(textConnection(Lines2), as.is = TRUE, sep = \"=\", fill = \n> TRUE)\n> L <- DF$V1 == \"\"\n> subset(transform(DF, V3 = V2[which(L)[cumsum(L)]])[1:3], V1 != \"\")\n\nThanks for your helpful suggestions, Gabor.  Perhaps your \"zoo\" option is \nmore elegant, but I try to use as few packages as possible, so this option \nseemed the best for me.\n\nSince in my problem the structure of the INI sections is almost static and \nalways present, I extended your example to create an in-memory list of \neverything in the INI file with this function:\n\n# Prototype of how to read INI files to process olfactometer data\n# efg, 13 June 2007\n# Thanks to Gabor Grothendieck for helpful suggestions in the R-Help\n# mailing list on how to parse the INI file.\nParse.INI <- function(INI.filename)\n{\n  connection <- file(INI.filename)\n  Lines  <- readLines(connection)\n  close(connection)\n\n  Lines <- chartr(\"[]\", \"==\", Lines)  # change section headers\n\n  connection <- textConnection(Lines)\n  d <- read.table(connection, as.is = TRUE, sep = \"=\", fill = TRUE)\n  close(connection)\n\n  L <- d$V1 == \"\"                    # location of section breaks\n  d <- subset(transform(d, V3 = V2[which(L)[cumsum(L)]])[1:3],\n                           V1 != \"\")\n\n  ToParse  <- paste(\"INI.list$\", d$V3, \"$\",  d$V1, \" <- '\",\n                    d$V2, \"'\", sep=\"\")\n\n  INI.list <- list()\n  eval(parse(text=ToParse))\n\n  return(INI.list)\n}\n\n\nHere's an example of using the above function (I'll put the sample input \nfile below):\n\nINI1 <- Parse.INI(\"sample.ini\")\n\n# Explore INI contents\nsummary(INI1)\n\nINI1$SystemSetup$OlfactometerCode\nINI1$DefaultLevels\nunlist(INI1$DefaultLevels)\nINI1$Map\n\nINI1$Map$port1\nas.integer( unlist( strsplit(INI1$Map$port1, \",\") ) )\n\n= = = = =\nSample output:\n\n> INI1 <- Parse.INI(\"sample.ini\")\n>\n> # Explore INI contents\n> summary(INI1)\n              Length Class  Mode\nSystemSetup   1      -none- list\nFiles         8      -none- list\nDefaultLevels 4      -none- list\nOdorNames     2      -none- list\nMap           3      -none- list\n>\n> INI1$SystemSetup$OlfactometerCode\n[1] \"3\"\n> INI1$DefaultLevels\n$FC00\n[1] \"50\"\n\n$FC01\n[1] \"100\"\n\n$FC02\n[1] \"50\"\n\n$FC10\n[1] \"50\"\n\n> unlist(INI1$DefaultLevels)\n FC00  FC01  FC02  FC10\n \"50\" \"100\"  \"50\"  \"50\"\n> INI1$Map\n$port0\n[1] \"0,0,0,0,0,0,0,0,0,0,0,0\"\n\n$port1\n[1] \"0,0,0,0,0,0,0,0,0,0,0,0\"\n\n$port2\n[1] \"0,0,0,0,0,0,0,0,0,0,0,0\"\n\n>\n> INI1$Map$port1\n[1] \"0,0,0,0,0,0,0,0,0,0,0,0\"\n> as.integer( unlist( strsplit(INI1$Map$port1, \",\") ) )\n [1] 0 0 0 0 0 0 0 0 0 0 0 0\n\n= = = = =\nSample input file, sample.ini:\n\n[SystemSetup]\nOlfactometerCode=3\n[Files]\nprelog0=Part0.txt\ndate0=2:06:27.461 PM 6/9/2007\nnote0=group1-1\nname0=group1\nprelog1=Part1.txt\ndate1=2:09:16.809 PM 6/9/2007\nnote1=group1-1\nname1=group1-1\n[DefaultLevels]\nFC00=50\nFC01=100\nFC02=50\nFC10=50\n[OdorNames]\nport0=None\nport1=None\n[Map]\nport0=0,0,0,0,0,0,0,0,0,0,0,0\nport1=0,0,0,0,0,0,0,0,0,0,0,0\nport2=0,0,0,0,0,0,0,0,0,0,0,0\n\n= = = = =\n\nThanks again, Gabor!\n\nefg\n\nEarl F. Glynn\nScientific Programmer\nStowers Institute for Medical Research\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}