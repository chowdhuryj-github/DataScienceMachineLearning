{"category": "ham", "to_address": "\"Patnaik, Tirthankar \" <tirthankar.patnaik@citi.com>", "from_address": "Prof Brian Ripley <ripley@stats.ox.ac.uk>", "subject": "Re: [R] Problems with Merge", "body": "Take a look at the help for merge(): in all the examples by.x is a \ncharacter string, not a one-column data frame which is what \nrhistory[\"Date\"] would appear to be.\n\nPlease note the trailer of this messsage.\n\nOn Tue, 5 Jun 2007, Patnaik, Tirthankar  wrote:\n\n> Hi,\n> I have a history dataset, a matrix with about 1590 obs, and 242 cols,\n> and I need to update this matrix with an 'update' matrix that has about\n> 30 rows, and roughly similar number of columns as the history ds (but\n> not necessarily equal). The update dataset is read from an Excel ODBC\n> connection. When I try and merge these datasets, I get counter-intuitive\n> results.\n>\n> library(RODBC)\n>   chn <- odbcConnectExcel(UpdateFile)\n>   sqlTables(chn)\n>   UpdateData <- sqlFetch(chn,\"MCap243\")\n>   colnames(UpdateData) <- gsub(\"#\",\".\",colnames(UpdateData))\n>   close(chn)\n>   # specify just how many rows we need from the Update file. We'd only\n> read five\n>   # rows at a time.\n>   UpdateRows = 20\n>   UpdateData <- UpdateData[1:UpdateRows,]\n>\n>   # Delete Unwanted stocks.\n>   UpdateData <- UpdateData[,!names(UpdateData) %in% ToBeDeleted]\n>   x <- tail(UpdateData[c(\"Date\",\"ABAN.BO\")],n=50)\n>   print(x)\n>\n>\n> Gives x as:\n>\n>         Date  ABAN.BO\n> 1  2007-04-30 96448.40\n> 2  2007-05-01 96448.40\n> 3  2007-05-02 96448.40\n> 4  2007-05-03 96300.44\n> 5  2007-05-04 93718.52\n> 6  2007-05-05 93718.52\n> 7  2007-05-06 93718.52\n> 8  2007-05-07 92743.82\n> 9  2007-05-08 90374.60\n> 10 2007-05-09 89126.18\n> 11 2007-05-10 87082.47\n> 12 2007-05-11 85493.73\n> 13 2007-05-12 85493.73\n> 14 2007-05-13 85493.73\n> 15 2007-05-14 85033.21\n> 16 2007-05-15 89209.41\n> 17 2007-05-16 89089.19\n> 18 2007-05-17 90472.62\n> 19 2007-05-18 90326.51\n> 20 2007-05-19 90326.51\n>\n> But when I merge this file with the history dataset, I get the dates\n> misaligned by one row.\n>\n> whistory <- merge(rhistory,UpdateData,by.x=rhistory[\"Date\"],all=TRUE)\n>\n> tail(WHist4[c(\"Date\",\"ABAN.BO\")],n=30)\n>\n>          Date  ABAN.BO\n> 1581 2007-04-19 83632.60\n> 1582 2007-04-20 85942.00\n> 1583 2007-04-23 88244.00\n> 1584 2007-04-24 90309.50\n> 1585 2007-04-25 92048.00\n> 1586 2007-04-26 92051.70\n> 1587 2007-04-27 95863.10\n> 1588 2007-04-29 96448.40\n> 1589 2007-04-30 96448.40\n> 1590 2007-04-30 96343.40\n> 1591 2007-05-01 96448.40\n> 1592 2007-05-02 96300.44\n> 1593 2007-05-03 93718.52\n> 1594 2007-05-03 96195.60\n> 1595 2007-05-04 93718.52\n> 1596 2007-05-04 93616.50\n> 1597 2007-05-05 93718.52\n> 1598 2007-05-06 92743.82\n> 1599 2007-05-07 90374.60\n> 1600 2007-05-08 89126.18\n> 1601 2007-05-09 87082.47\n> 1602 2007-05-10 85493.73\n> 1603 2007-05-11 85493.73\n> 1604 2007-05-12 85493.73\n> 1605 2007-05-13 85033.21\n> 1606 2007-05-14 89209.41\n> 1607 2007-05-15 89089.19\n> 1608 2007-05-16 90472.62\n> 1609 2007-05-17 90326.51\n> 1610 2007-05-18 90326.51\n>\n> Any reasons why the dates are shifted by one date? Am I missing some\n> parameters in the merge statement?\n>\n> TIA and best,\n> -Tir\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\n-- \nBrian D. Ripley,                  ripley@stats.ox.ac.uk\nProfessor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/\nUniversity of Oxford,             Tel:  +44 1865 272861 (self)\n1 South Parks Road,                     +44 1865 272866 (PA)\nOxford OX1 3TG, UK                Fax:  +44 1865 272595\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}