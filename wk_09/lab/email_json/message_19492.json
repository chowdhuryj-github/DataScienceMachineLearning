{"category": "ham", "to_address": "perl6-internals@perl.org", "from_address": "Leopold Toetsch <lt@toetsch.at>", "subject": "Re: [perl #42768] [PATCH] Enum cleanups", "body": "Am Freitag, 27. April 2007 22:10 schrieb chromatic:\n> This part bothers me:\n\nIndeed, your feeling is totally legitimate.\n\n> +++ src/mmd.c \u00a0 (working copy)\n> @@ -1703,7 +1703,12 @@\n\n> +#ifndef __INTEL_COMPILER\n> \u00a0 \u00a0 \u00a0 \u00a0 \u00a0assert((PTR2UINTVAL(mmd_table[i].func_ptr) & 3) == 0);\n\nThe assert is of course there for some reason. The lower bit(s) are used for \nflagging the contents of the MMD table:\n\n>From mmd.c:147 ff\n\n    *is_pmc = (UINTVAL)func & 3;\n    func_ = (funcptr_t)((UINTVAL)func & ~3);\n#ifndef PARROT_HAS_ALIGNED_FUNCPTR\n\n... and as the snippet reveals, there's also alternate code to deal with \ncompilers which don't align function pointers (ususally there is a compiler \nflag to achieve this too).\n\nBackground:\n\nThe mmd_table is a huge cache of known binary MMD functions, which are coded \nin C or are PMCs. But as the table is quadratic (per function) and very \nsparse, it should be replaced with some better structures e.g. per PMC or by \nsome compressed table.\n\nleo\n\n"}