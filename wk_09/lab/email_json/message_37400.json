{"category": "ham", "to_address": "ronggui <ronggui.huang@gmail.com>", "from_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "subject": "Re: [R] Question about \"evalq\"", "body": "On 5/27/07, ronggui  wrote:\n> Hi,Gabor Grothendieck, Thanks very much.\n>\n> On 5/27/07, Gabor Grothendieck  wrote:\n> > evalq looks like this:\n> >\n> >    > evalq\n> >    function (expr, envir, enclos)\n> >    eval.parent(substitute(eval(quote(expr), envir, enclos)))\n> >    \n> >\n> > so it seems the difference is that\n> >\n> > - eval(quote(), envir, enclos) evaluates envir and enclos\n> >   in the current frame but\n> > - evalq evaluates them in the parent.frame.\n> >\n> > This may be easier to see in the following example:\n>\n> Yeah, This example make the question easier to understand.\n>\n> >    x <- \"G\"\n> >    f1 <- function() eval(quote(x), parent.frame())\n> >    f2 <- function() evalq(x, parent.frame())\n> >    f11 <- function() {\n> >         x <- \"a\"\n> >         f1()\n> >    }\n> >    f22 <- function() {\n> >         x <- \"b\"\n> >         f2()\n> >    }\n> >    f11() # a\n> >    f22() # G\n> >\n> > To avoid this problem pass a variable whose value is\n> > to be enclos= rather than an expression to compute it:\n>\n> --This is a good idea.\n> --If \"evalq evaluates them in the parent.frame\", I expected that if I\n> change parent.frame(2) to parent.frame(1), I will get the answer.But I\n> can not actually. So what's wrong with my understanding?\n>\n>    f1 <- function(x,digits=5) lapply(x, f2)\n>    f2 <- function(x) {\n>       evalq(print(digits), list(x=x), parent.frame(1))\n>    }\n>    f1(list(x1=1)) ##Error in print(digits) : object \"digits\" not found\n\n\nGood point.  Insert a browser statement where the parent.frame\ncall was and when it stops do a traceback.  That will show you\nwhat the call stack looks like at that point in time.\n\n\n> f1 <- function(x,digits=5) lapply(x, f2)\n> f2 <- function(x) evalq(print(digits), list(x=x), { browser() } )\n> f1(list(x1=1)) ##Error in print(digits) : object \"digits\" not found\nCalled from: eval(quote(print(digits)), list(x = x), {\n    browser()\n})\nBrowse[1]> traceback()\n10: print(digits)\n9: eval(expr, envir, enclos)\n8: eval(quote(print(digits)), list(x = x), browser())\n7: eval(expr, envir, enclos)\n6: eval(expr, p)\n5: eval.parent(substitute(eval(quote(expr), envir, enclos)))\n4: evalq(print(digits), list(x = x), browser())\n3: FUN(X[[1L]], ...)\n2: lapply(x, f2)\n1: f1(list(x1 = 1))\nBrowse[1]>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}