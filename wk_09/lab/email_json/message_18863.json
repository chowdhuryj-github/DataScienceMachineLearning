{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "sfrench@samba.org", "subject": "svn commit: samba r22560 - in branches/SAMBA_3_0/source/client: .", "body": "Author: sfrench\nDate: 2007-04-28 16:56:35 +0000 (Sat, 28 Apr 2007)\nNew Revision: 22560\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22560\n\nLog:\nClean up frees of realloc memory in mount.cifs (thanks to Alex for\nreminding me how to use Valgrind).\n\nModified:\n   branches/SAMBA_3_0/source/client/mount.cifs.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/client/mount.cifs.c\n===================================================================\n--- branches/SAMBA_3_0/source/client/mount.cifs.c\t2007-04-28 16:39:24 UTC (rev 22559)\n+++ branches/SAMBA_3_0/source/client/mount.cifs.c\t2007-04-28 16:56:35 UTC (rev 22560)\n@@ -618,6 +618,7 @@\n nocopy:\n \t\tdata = next_keyword;\n \t}\n+\tfree(*optionsp);\n \t*optionsp = out;\n \treturn 0;\n }\n@@ -1233,14 +1234,11 @@\n \t\t\t\t}\n \t\t\t}\n \t\tdefault:\n-\t\t\t\n \t\t\tprintf(\"mount error %d = %s\\n\",errno,strerror(errno));\n \t\t}\n \t\tprintf(\"Refer to the mount.cifs(8) manual page (e.g.man mount.cifs)\\n\");\n-\t\tif(mountpassword) {\n-\t\t\tmemset(mountpassword,0,64);\n-\t\t}\n-\t\treturn -1;\n+\t\trc = -1;\n+\t\tgoto mount_exit;\n \t} else {\n \t\tpmntfile = setmntent(MOUNTED, \"a+\");\n \t\tif(pmntfile) {\n@@ -1283,6 +1281,8 @@\n \t\t    printf(\"could not update mount table\\n\");\n \t\t}\n \t}\n+\trc = 0;\n+mount_exit:\n \tif(mountpassword) {\n \t\tint len = strlen(mountpassword);\n \t\tmemset(mountpassword,0,len);\n@@ -1305,6 +1305,6 @@\n \tif(free_share_name) {\n \t\tfree(share_name);\n \t\t}\n-\treturn 0;\n+\treturn rc;\n }\n \n\n"}