{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23381 - in branches/SAMBA_4_0/source:\n\tlibcli/util librpc/idl rpc_server/netlogon torture/rpc", "body": "Author: gd\nDate: 2007-06-08 10:32:29 +0000 (Fri, 08 Jun 2007)\nNew Revision: 23381\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23381\n\nLog:\nMerge netr_GetDcName WERROR return and WERROR_DOMAIN_CONTROLLER_NOT_FOUND from\nSAMBA_3_0.\n\nGuenther\n\nModified:\n   branches/SAMBA_4_0/source/libcli/util/doserr.c\n   branches/SAMBA_4_0/source/libcli/util/doserr.h\n   branches/SAMBA_4_0/source/librpc/idl/netlogon.idl\n   branches/SAMBA_4_0/source/rpc_server/netlogon/dcerpc_netlogon.c\n   branches/SAMBA_4_0/source/torture/rpc/netlogon.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/libcli/util/doserr.c\n===================================================================\n--- branches/SAMBA_4_0/source/libcli/util/doserr.c\t2007-06-08 10:29:46 UTC (rev 23380)\n+++ branches/SAMBA_4_0/source/libcli/util/doserr.c\t2007-06-08 10:32:29 UTC (rev 23381)\n@@ -63,6 +63,7 @@\n \t{ \"WERR_JOB_NOT_FOUND\", WERR_JOB_NOT_FOUND },\n \t{ \"WERR_DEST_NOT_FOUND\", WERR_DEST_NOT_FOUND },\n \t{ \"WERR_NOT_LOCAL_DOMAIN\", WERR_NOT_LOCAL_DOMAIN },\n+\t{ \"WERR_DOMAIN_CONTROLLER_NOT_FOUND\", WERR_DOMAIN_CONTROLLER_NOT_FOUND },\n \t{ \"WERR_DEVICE_NOT_AVAILABLE\", WERR_DEVICE_NOT_AVAILABLE },\n \t{ \"WERR_PRINTER_DRIVER_IN_USE\", WERR_PRINTER_DRIVER_IN_USE },\n \t{ \"WERR_STATUS_MORE_ENTRIES\", WERR_STATUS_MORE_ENTRIES },\n\nModified: branches/SAMBA_4_0/source/libcli/util/doserr.h\n===================================================================\n--- branches/SAMBA_4_0/source/libcli/util/doserr.h\t2007-06-08 10:29:46 UTC (rev 23380)\n+++ branches/SAMBA_4_0/source/libcli/util/doserr.h\t2007-06-08 10:32:29 UTC (rev 23381)\n@@ -214,6 +214,7 @@\n #define WERR_SESSION_NOT_FOUND W_ERROR(2312)\n #define WERR_FID_NOT_FOUND W_ERROR(2314)\n #define WERR_NOT_LOCAL_DOMAIN W_ERROR(2320)\n+#define WERR_DOMAIN_CONTROLLER_NOT_FOUND W_ERROR(2453)\n #define WERR_DEVICE_NOT_AVAILABLE W_ERROR(4319)\n #define WERR_STATUS_MORE_ENTRIES   W_ERROR(0x0105)\n \n\nModified: branches/SAMBA_4_0/source/librpc/idl/netlogon.idl\n===================================================================\n--- branches/SAMBA_4_0/source/librpc/idl/netlogon.idl\t2007-06-08 10:29:46 UTC (rev 23380)\n+++ branches/SAMBA_4_0/source/librpc/idl/netlogon.idl\t2007-06-08 10:32:29 UTC (rev 23381)\n@@ -756,7 +756,7 @@\n \t/*****************/\n \t/* Function 0x0B */\n \n-\tNTSTATUS netr_GetDcName(\n+\tWERROR netr_GetDcName(\n \t\t[in]  [string,charset(UTF16)] uint16 logon_server[],\n \t\t[in]  [string,charset(UTF16)] uint16 *domainname,\n \t\t[out] [string,charset(UTF16)] uint16 *dcname\n\nModified: branches/SAMBA_4_0/source/rpc_server/netlogon/dcerpc_netlogon.c\n===================================================================\n--- branches/SAMBA_4_0/source/rpc_server/netlogon/dcerpc_netlogon.c\t2007-06-08 10:29:46 UTC (rev 23380)\n+++ branches/SAMBA_4_0/source/rpc_server/netlogon/dcerpc_netlogon.c\t2007-06-08 10:32:29 UTC (rev 23381)\n@@ -692,7 +692,7 @@\n /* \n   netr_GetDcName \n */\n-static NTSTATUS dcesrv_netr_GetDcName(struct dcesrv_call_state *dce_call, TALLOC_CTX *mem_ctx,\n+static WERROR dcesrv_netr_GetDcName(struct dcesrv_call_state *dce_call, TALLOC_CTX *mem_ctx,\n \t\t       struct netr_GetDcName *r)\n {\n \tDCESRV_FAULT(DCERPC_FAULT_OP_RNG_ERROR);\n\nModified: branches/SAMBA_4_0/source/torture/rpc/netlogon.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/rpc/netlogon.c\t2007-06-08 10:29:46 UTC (rev 23380)\n+++ branches/SAMBA_4_0/source/torture/rpc/netlogon.c\t2007-06-08 10:32:29 UTC (rev 23381)\n@@ -839,8 +839,8 @@\n \tprintf(\"Testing GetDcName\\n\");\n \n \tstatus = dcerpc_netr_GetDcName(p, mem_ctx, &r);\n-\tif (!NT_STATUS_IS_OK(status)) {\n-\t\tprintf(\"GetDcName - %s\\n\", nt_errstr(status));\n+\tif (!NT_STATUS_IS_OK(status) || !W_ERROR_IS_OK(r.out.result)) {\n+\t\tprintf(\"GetDcName - %s/%s\\n\", nt_errstr(status), win_errstr(r.out.result));\n \t\treturn False;\n \t}\n \n\n"}