{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 296: don't allow setvnnmap while not frozen in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 296\nrevision-id: tridge@samba.org-20070514034840-njb68t1bfrmcbhtl\nparent: tridge@samba.org-20070514034814-tfzpg9mzglmbr2s6\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Mon 2007-05-14 13:48:40 +1000\nmessage:\n  don't allow setvnnmap while not frozen\nmodified:\n  common/ctdb_recover.c          ctdb_recover.c-20070503002147-admmfgt1oj6gexfo-1\n=== modified file 'common/ctdb_recover.c'\n--- a/common/ctdb_recover.c\t2007-05-12 11:25:26 +0000\n+++ b/common/ctdb_recover.c\t2007-05-14 03:48:40 +0000\n@@ -91,6 +91,11 @@\n {\n \tstruct ctdb_vnn_map_wire *map = (struct ctdb_vnn_map_wire *)indata.dptr;\n \n+\tif (ctdb->freeze_mode != CTDB_FREEZE_FROZEN) {\n+\t\tDEBUG(0,(\"Attempt to set vnnmap when not frozen\\n\"));\n+\t\treturn -1;\n+\t}\n+\n \ttalloc_free(ctdb->vnn_map);\n \n \tctdb->vnn_map = talloc(ctdb, struct ctdb_vnn_map);\n\n"}