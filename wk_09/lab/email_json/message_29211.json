{"category": "ham", "to_address": "\"Patnaik, Tirthankar \" <tirthankar.patnaik@citi.com>", "from_address": "gyadav@ccilindia.co.in", "subject": "Re: [R] Conditional Sums for Index creation", "body": "\nHello\n\nMy dear friend.... the problem is not very heavy its very light, but you \nhave to assume somethings.\nas you say that any new stock can come anytime and go anytime, further, \nany time NA can come .....\n\nboth statements are so close that it would be nearly impossible to know \nwhich one is NA (of before the start of series and which one is end of \nseries ) and \nwhich one is NA of series of genuine data which is missing for one day or \ntwo.\n\nThere can be n number of workarounds depending on the propersties of \ndataset.\nfor e.g.\n\n\n1.\nGiven that genuine data is not having not more than two NA consequtively\nWork around : Check for past two days that NAs are there or not\nFlaw: Will be a lagged kind of computation\n\n2. \nGiven that series will have continuously NAs \nWork around : you can go for checking for whole of the past data whether \nthere was any number or all NAs\nFlaw : Based on backward looking hence will never know that new stock has \ncome or not.\ne,g, stock may have come but the observation was not recorded hence NA\n\netc etc\n\nclarify more of your stand, do you get information before hand that today \nstock will get added or deleted.\nmeaning any exogenous information which will help to optimize it\n\n\n\n\nRegards,\n\nGaurav Yadav\n+++++++++++\nAssistant Manager, CCIL, Mumbai (India)\nMob: +919821286118 Email: mailtogauravyadav@gmail.com\nBhagavad Gita:  Man is made by his belief, as He believes, so He is\n\n\n\n\n\n\"Patnaik, Tirthankar \"  \nSent by: r-help-bounces@stat.math.ethz.ch\n05/14/2007 11:53 AM\n\nTo\n\ncc\n\nSubject\n[R] Conditional Sums for Index creation\n\n\n\n\n\n\nHi,\n                 Apologies for the long mail. I have a data.frame with \ncolumns of\nprice/mcap data for a portfolio of stocks, and the date. To get the\ntotal value of the portfolio on a daily basis, I calculate rowSums of\nthe data.frame. \n\n> set.seed(1)\n> ab <- matrix(round(runif(100)*100),nrow=20,ncol=5)\n> ab[1:5,4:5] <- NA\n> ab[6:10,5] <- NA\n> ac <- as.data.frame(ifelse(ab <= 7,NA,ab))\n> ac\n   V1 V2 V3 V4 V5\n1  27 93 82 NA NA\n2  37 21 65 NA NA\n3  57 65 78 NA NA\n4  91 13 55 NA NA\n5  20 27 53 NA NA\n6  90 39 79 26 NA\n7  94 NA NA 48 NA\n8  66 38 48 77 NA\n9  63 87 73  8 NA\n10 NA 34 69 88 NA\n11 21 48 48 34 24\n12 18 60 86 84 NA\n13 69 49 44 35 64\n14 38 19 24 33 88\n15 77 83 NA 48 78\n16 50 67 10 89 80\n17 72 79 32 86 46\n18 99 11 52 39 41\n19 38 72 66 78 81\n20 78 41 41 96 60\n> \n\nHere the rows 1:20 are dates (also in my data.frame). \n\nSince some of the prices have NA, the rowSums is made to ignore these\nentries. \n\n> rowSums(ac,na.rm=TRUE)\n  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18\n19  20 \n202 123 200 159 100 234 142 229 231 191 175 248 261 202 286 296 315 242\n335 316 \n> \n\nStocks are being added to the portfolio too. So from date=6 (or row=6)\nwe have the 4th stock V4, and from date=11, we have the 5th stock V5. My\nproblem is that I need to calculate the rowSums for row=6 (When a new\nstock was added), _with_ and _without_ the new stock. So my answer for\nrow=6 would be 234 for the plain row-sum, and 234 - 26 = 208 for the\noriginal set of stocks (without V4). Similarly, my answer for row=11\nwould be 175 for the plain sum, and 175 - 24 = 151 for the original sum\n(without V5). \n\nBasically I'm interested in finding out the value of the portfolio with\nand without the new stock for the purposes of creating an index. It's\npossible that some stocks my get dropped later, in which case there\nwould be an NA series starting for say V1 at row=18 and so on. In that\ncase, the aim would be to find the sum at row=18 with and without the\nvalue of V1. \n\nIs there any way I can get the sum over columns, deleting specific\ncolums? To get the columns that are NA in any row, I tried (shown for\nthe first 12 rows):\n\n> apply(ac[1:12,],1,function(y)which(is.na(y)))\n\nWhich correctly gives \n\n$`1`\nV4 V5 \n 4  5 \n\n$`2`\nV4 V5 \n 4  5 \n\n$`3`\nV4 V5 \n 4  5 \n\n$`4`\nV4 V5 \n 4  5 \n\n$`5`\nV4 V5 \n 4  5 \n\n$`6`\nV5 \n 5 \n\n$`7`\nV2 V3 V5 \n 2  3  5 \n\n$`8`\nV5 \n 5 \n\n$`9`\nV5 \n 5 \n\n$`10`\nV1 V5 \n 1  5 \n\n$`11`\ninteger(0)\n\n$`12`\nV5 \n 5 \n\n> \n\nBut now I'm stuck. I don't how to use this list of indices at each row\nto exclude my columns. \n\nAny pointers please? Would such an exercise be easier if I use a\ntime-series based object, like a zoo.\n\n\nTIA and best,\n-Tir\n\nTirthankar Patnaik\nIndia Strategy\nCitigroup Investment Research\n+91-22-6631 9887\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide \nhttp://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n\n\n============================================================================================\nDISCLAIMER AND CONFIDENTIALITY CAUTION:\\ \\ This message and ...{{dropped}}\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}