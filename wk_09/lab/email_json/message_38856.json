{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23240 - in branches/SAMBA_4_0/source: librpc/idl\n\trpc_server/netlogon torture/rpc", "body": "Author: gd\nDate: 2007-05-30 10:24:40 +0000 (Wed, 30 May 2007)\nNew Revision: 23240\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23240\n\nLog:\nFill in netr_DsrGetDcSiteCoverageW.\n\nGuenther\n\nModified:\n   branches/SAMBA_4_0/source/librpc/idl/netlogon.idl\n   branches/SAMBA_4_0/source/rpc_server/netlogon/dcerpc_netlogon.c\n   branches/SAMBA_4_0/source/torture/rpc/netlogon.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/librpc/idl/netlogon.idl\n===================================================================\n--- branches/SAMBA_4_0/source/librpc/idl/netlogon.idl\t2007-05-30 09:54:19 UTC (rev 23239)\n+++ branches/SAMBA_4_0/source/librpc/idl/netlogon.idl\t2007-05-30 10:24:40 UTC (rev 23240)\n@@ -1145,8 +1145,17 @@\n \n \t/****************/\n \t/* Function 0x26 */\n-\tWERROR netr_DSRGETDCSITECOVERAGEW();\n \n+\ttypedef struct {\n+\t\tuint32 num_sites;\n+\t\t[size_is(num_sites)] [unique] lsa_String *sites;\n+\t} DcSitesCtr;\n+\n+\tWERROR netr_DsrGetDcSiteCoverageW(\n+\t\t[in] [string,charset(UTF16)] uint16 *server_name,\n+\t\t[out] DcSitesCtr *ctr\n+\t\t);\n+\n \t/****************/\n \t/* Function 0x27 */\n \tNTSTATUS netr_LogonSamLogonEx(\n\nModified: branches/SAMBA_4_0/source/rpc_server/netlogon/dcerpc_netlogon.c\n===================================================================\n--- branches/SAMBA_4_0/source/rpc_server/netlogon/dcerpc_netlogon.c\t2007-05-30 09:54:19 UTC (rev 23239)\n+++ branches/SAMBA_4_0/source/rpc_server/netlogon/dcerpc_netlogon.c\t2007-05-30 10:24:40 UTC (rev 23240)\n@@ -1119,10 +1119,10 @@\n \n \n /* \n-  netr_DSRGETDCSITECOVERAGEW \n+  netr_DsrGetDcSiteCoverageW\n */\n-static WERROR dcesrv_netr_DSRGETDCSITECOVERAGEW(struct dcesrv_call_state *dce_call, TALLOC_CTX *mem_ctx,\n-\t\t       struct netr_DSRGETDCSITECOVERAGEW *r)\n+static WERROR dcesrv_netr_DsrGetDcSiteCoverageW(struct dcesrv_call_state *dce_call, TALLOC_CTX *mem_ctx,\n+\t\t       struct netr_DsrGetDcSiteCoverageW *r)\n {\n \tDCESRV_FAULT(DCERPC_FAULT_OP_RNG_ERROR);\n }\n\nModified: branches/SAMBA_4_0/source/torture/rpc/netlogon.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/rpc/netlogon.c\t2007-05-30 09:54:19 UTC (rev 23239)\n+++ branches/SAMBA_4_0/source/torture/rpc/netlogon.c\t2007-05-30 10:24:40 UTC (rev 23240)\n@@ -594,7 +594,6 @@\n \n \t}\n \n-\n \treturn ret;\n }\n \n@@ -1318,6 +1317,30 @@\n \treturn ret;\n }\n \n+static BOOL test_netr_DsrGetDcSiteCoverageW(struct dcerpc_pipe *p, TALLOC_CTX *mem_ctx) \n+{\n+\tNTSTATUS status;\n+\tstruct netr_DsrGetDcSiteCoverageW r;\n+\tBOOL ret = True;\n+\n+\tif (lp_parm_bool(-1, \"torture\", \"samba4\", False)) {\n+\t\tprintf(\"skipping DsrGetDcSiteCoverageW test against Samba4\\n\");\n+\t\treturn True;\n+\t}\n+\n+\tr.in.server_name = \"\";\n+\tprintf(\"Testing netr_DsrGetDcSiteCoverageW\\n\");\n+\n+\tstatus = dcerpc_netr_DsrGetDcSiteCoverageW(p, mem_ctx, &r);\n+\tif (!NT_STATUS_IS_OK(status) || !W_ERROR_IS_OK(r.out.result)) {\n+\t\tprintf(\"netr_DsrGetDcSiteCoverageW - %s/%s\\n\", \n+\t\t       nt_errstr(status), win_errstr(r.out.result));\n+\t\tret = False;\n+\t}\n+\treturn ret;\n+}\n+\n+\n static BOOL test_GetDomainInfo(struct dcerpc_pipe *p, TALLOC_CTX *mem_ctx)\n {\n \tNTSTATUS status;\n@@ -1605,6 +1628,7 @@\n \tret &= test_netr_DsRGetDCName(p, mem_ctx);\n \tret &= test_netr_DsRGetDCNameEx(p, mem_ctx);\n \tret &= test_netr_DsRGetDCNameEx2(p, mem_ctx);\n+\tret &= test_netr_DsrGetDcSiteCoverageW(p, mem_ctx);\n \n \ttalloc_free(mem_ctx);\n \n\n"}