{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23575 - in branches: SAMBA_3_0/source/param\n\tSAMBA_3_0_26/source/param", "body": "Author: obnox\nDate: 2007-06-21 20:56:56 +0000 (Thu, 21 Jun 2007)\nNew Revision: 23575\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23575\n\nLog:\nFix a segfault when lp_load is called before init_registry.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0/source/param/loadparm.c\n   branches/SAMBA_3_0_26/source/param/loadparm.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/param/loadparm.c\n===================================================================\n--- branches/SAMBA_3_0/source/param/loadparm.c\t2007-06-21 19:40:51 UTC (rev 23574)\n+++ branches/SAMBA_3_0/source/param/loadparm.c\t2007-06-21 20:56:56 UTC (rev 23575)\n@@ -3071,6 +3071,7 @@\n \tif (!reg_tdb) {\n \t\tDEBUG(0, (\"lp_regdb_open: failed to open %s: %s\\n\",\n \t\t\t lock_path(\"registry.tdb\"), strerror(errno)));\n+\t\tgoto done;\n \t}\n \telse {\n \t\tDEBUG(10, (\"lp_regdb_open: reg tdb opened.\\n\"));\n@@ -3085,6 +3086,7 @@\n \t\t/* this is apparently not implemented in the tdb */\n \t}\n \n+done:\n \treturn reg_tdb;\n }\n \n\nModified: branches/SAMBA_3_0_26/source/param/loadparm.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/param/loadparm.c\t2007-06-21 19:40:51 UTC (rev 23574)\n+++ branches/SAMBA_3_0_26/source/param/loadparm.c\t2007-06-21 20:56:56 UTC (rev 23575)\n@@ -3072,6 +3072,7 @@\n \tif (!reg_tdb) {\n \t\tDEBUG(0, (\"lp_regdb_open: failed to open %s: %s\\n\",\n \t\t\t lock_path(\"registry.tdb\"), strerror(errno)));\n+\t\tgoto done;\n \t}\n \telse {\n \t\tDEBUG(10, (\"lp_regdb_open: reg tdb opened.\\n\"));\n@@ -3086,6 +3087,7 @@\n \t\t/* this is apparently not implemented in the tdb */\n \t}\n \n+done:\n \treturn reg_tdb;\n }\n \n\n"}