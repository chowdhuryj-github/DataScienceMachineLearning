{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 157: avoid a deadlock the fetch_lock code. The deadlock could\n\thappen when in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 157\nrevision-id: tridge@samba.org-20070419000320-386ec684420aa0f6\nparent: tridge@samba.org-20070418235823-f4d1ef1f0f3ac9d6\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Thu 2007-04-19 10:03:20 +1000\nmessage:\n  avoid a deadlock the fetch_lock code. The deadlock could happen when\n  a client held the chainlock, and the daemon received a dmaster reply\n  at the same time. The daemon would not be able to process the dmaster\n  reply, due to the lock, but the fetch lock cannot make progres until\n  the dmaster reply is processed.\n  \n  The solution is to not hold the lock in the client while talking to\n  the daemon. The client has to retry the lock after the record has\n  migrated. This means that forward progress is not guaranteed. We'll\n  have to see if that matters in practice.\nmodified:\n  .bzrignore                     bzrignore-20061117235536-slq8jlz2b5161dfm-1\n  common/ctdb.c                  ctdb.c-20061127094323-t50f58d65iaao5of-2\n  common/ctdb_call.c             ctdb_call.c-20061128065342-to93h6eejj5kon81-1\n  common/ctdb_client.c           ctdb_client.c-20070411010216-3kd8v37k61steeya-1\n  common/ctdb_daemon.c           ctdb_daemon.c-20070409200331-3el1kqgdb9m4ib0g-1\n  include/ctdb_private.h         ctdb_private.h-20061117234101-o3qt14umlg9en8z0-13\n\nDiff too large for email (376, the limit is 200).\n\n"}