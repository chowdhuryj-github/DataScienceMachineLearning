{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "Iestyn Lewis <ilewis@pharm.emory.edu>", "subject": "[R] Fastest way to repeatedly subset a data frame?", "body": "Hi -\n\n I have a data frame with a large number of observations (62,000 rows, \nbut only 2 columns - a character ID and a result list). \n\nSample:\n\n > my.df <- data.frame(id=c(\"ID1\", \"ID2\", \"ID3\"), result=1:3)\n > my.df\n   id result\n1 ID1      1\n2 ID2      2\n3 ID3      3\n\nI have a list of ID vectors.  This list will have anywhere from 100 to \n1000 members, and each member will have anywhere from 10 to 5000 id entries.\n\nSample:\n\n > my.idlist[[\"List1\"]] <- c(\"ID1\", \"ID3\")\n > my.idlist[[\"List2\"]] <- c(\"ID2\")\n > my.idlist\n$List1\n[1] \"ID1\" \"ID3\"\n\n$List2\n[1] \"ID2\"\n\n\nI need to subset that data frame by the list of IDs in each vector, to \nend up with vectors that contain just the results for the IDs found in \neach vector in the list.  My current approach is to create new columns \nin the original data frame with the names of the list items, and any \nresults that don't match replaced with NA.  Here is what I've done so far:\n\ncreateSubsets <- function(res, slib) {\n    for(i in 1:length(slib)) {\n        res[ ,names(slib)[i]] <- replace(res$result, \nwhich(!is.element(res$sid, slib[[i]])), NA)\n        return (res)\n    }\n}\n\nI have 2 problems:\n\n1)  My function only works for the first item in the list:\n\n > my.df <- createSubsets(my.df, my.idlist)\n > my.df\n   id result List1\n1 ID1      1     1\n2 ID2      2    NA\n3 ID3      3     3\n\nIn order to get all results, I have to copy the loop out of the function \nand paste it into R directly.\n\n2)  It is very, very slow.  For a dataset of 62,000 rows and 253 list \nentries, it takes probably 5 minutes on a pentium D.  An implementation \nof this kind of subsetting using hashtables in C# takes a neglible \namount of time. \n\nI am open to any suggestions about data format, methods, anything. \n\nThanks,\n\nIestyn Lewis\nEmory University\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}