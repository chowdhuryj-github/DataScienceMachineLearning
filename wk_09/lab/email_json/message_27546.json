{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r22796 - in branches: SAMBA_3_0/source/include\n\tSAMBA_3_0/source/libgpo SAMBA_3_0_26/source/include\n\tSAMBA_3_0_26/source/libgpo", "body": "Author: gd\nDate: 2007-05-11 12:41:11 +0000 (Fri, 11 May 2007)\nNew Revision: 22796\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22796\n\nLog:\nAdd security descriptor to GROUP_POLICY_OBJECT structure (in preparation of\nadding GPO security filtering for libgpo).\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/include/gpo.h\n   branches/SAMBA_3_0/source/include/includes.h\n   branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\n   branches/SAMBA_3_0_26/source/include/gpo.h\n   branches/SAMBA_3_0_26/source/include/includes.h\n   branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/include/gpo.h\n===================================================================\n--- branches/SAMBA_3_0/source/include/gpo.h\t2007-05-11 12:02:33 UTC (rev 22795)\n+++ branches/SAMBA_3_0/source/include/gpo.h\t2007-05-11 12:41:11 UTC (rev 22796)\n@@ -49,6 +49,7 @@\n \tuint32 link_type; /* GPO_LINK_TYPE */\n \tconst char *user_extensions;\n \tconst char *machine_extensions;\n+\tSEC_DESC *security_descriptor;\n \tstruct GROUP_POLICY_OBJECT *next, *prev;\n };\n \n\nModified: branches/SAMBA_3_0/source/include/includes.h\n===================================================================\n--- branches/SAMBA_3_0/source/include/includes.h\t2007-05-11 12:02:33 UTC (rev 22795)\n+++ branches/SAMBA_3_0/source/include/includes.h\t2007-05-11 12:41:11 UTC (rev 22796)\n@@ -643,7 +643,6 @@\n \n #include \"nt_status.h\"\n #include \"ads.h\"\n-#include \"gpo.h\"\n #include \"ads_dns.h\"\n #include \"interfaces.h\"\n #include \"trans2.h\"\n@@ -668,6 +667,7 @@\n #include \"mapping.h\"\n #include \"passdb.h\"\n #include \"rpc_secdes.h\"\n+#include \"gpo.h\"\n #include \"authdata.h\"\n #include \"msdfs.h\"\n #include \"rap.h\"\n\nModified: branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\n===================================================================\n--- branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\t2007-05-11 12:02:33 UTC (rev 22795)\n+++ branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\t2007-05-11 12:41:11 UTC (rev 22796)\n@@ -434,6 +434,9 @@\n \tgpo->machine_extensions = ads_pull_string(ads, mem_ctx, res, \"gPCMachineExtensionNames\");\n \tgpo->user_extensions = ads_pull_string(ads, mem_ctx, res, \"gPCUserExtensionNames\");\n \n+\tads_pull_sd(ads, mem_ctx, res, \"ntSecurityDescriptor\", &gpo->security_descriptor);\n+\tADS_ERROR_HAVE_NO_MEMORY(gpo->security_descriptor);\n+\n \treturn ADS_ERROR(LDAP_SUCCESS);\n }\n \n@@ -455,7 +458,7 @@\n \tconst char *attrs[] = { \"cn\", \"displayName\", \"flags\", \"gPCFileSysPath\", \n \t\t\t\t\"gPCFunctionalityVersion\", \"gPCMachineExtensionNames\", \n \t\t\t\t\"gPCUserExtensionNames\", \"gPCWQLFilter\", \"name\", \n-\t\t\t\t\"versionNumber\", NULL};\n+\t\t\t\t\"versionNumber\", \"ntSecurityDescriptor\", NULL};\n \n \tZERO_STRUCTP(gpo);\n \n\nModified: branches/SAMBA_3_0_26/source/include/gpo.h\n===================================================================\n--- branches/SAMBA_3_0_26/source/include/gpo.h\t2007-05-11 12:02:33 UTC (rev 22795)\n+++ branches/SAMBA_3_0_26/source/include/gpo.h\t2007-05-11 12:41:11 UTC (rev 22796)\n@@ -49,6 +49,7 @@\n \tuint32 link_type; /* GPO_LINK_TYPE */\n \tconst char *user_extensions;\n \tconst char *machine_extensions;\n+\tSEC_DESC *security_descriptor;\n \tstruct GROUP_POLICY_OBJECT *next, *prev;\n };\n \n\nModified: branches/SAMBA_3_0_26/source/include/includes.h\n===================================================================\n--- branches/SAMBA_3_0_26/source/include/includes.h\t2007-05-11 12:02:33 UTC (rev 22795)\n+++ branches/SAMBA_3_0_26/source/include/includes.h\t2007-05-11 12:41:11 UTC (rev 22796)\n@@ -644,7 +644,6 @@\n \n #include \"nt_status.h\"\n #include \"ads.h\"\n-#include \"gpo.h\"\n #include \"ads_dns.h\"\n #include \"interfaces.h\"\n #include \"trans2.h\"\n@@ -669,6 +668,7 @@\n #include \"mapping.h\"\n #include \"passdb.h\"\n #include \"rpc_secdes.h\"\n+#include \"gpo.h\"\n #include \"authdata.h\"\n #include \"msdfs.h\"\n #include \"rap.h\"\n\nModified: branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\t2007-05-11 12:02:33 UTC (rev 22795)\n+++ branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\t2007-05-11 12:41:11 UTC (rev 22796)\n@@ -434,6 +434,9 @@\n \tgpo->machine_extensions = ads_pull_string(ads, mem_ctx, res, \"gPCMachineExtensionNames\");\n \tgpo->user_extensions = ads_pull_string(ads, mem_ctx, res, \"gPCUserExtensionNames\");\n \n+\tads_pull_sd(ads, mem_ctx, res, \"ntSecurityDescriptor\", &gpo->security_descriptor);\n+\tADS_ERROR_HAVE_NO_MEMORY(gpo->security_descriptor);\n+\n \treturn ADS_ERROR(LDAP_SUCCESS);\n }\n \n@@ -455,7 +458,7 @@\n \tconst char *attrs[] = { \"cn\", \"displayName\", \"flags\", \"gPCFileSysPath\", \n \t\t\t\t\"gPCFunctionalityVersion\", \"gPCMachineExtensionNames\", \n \t\t\t\t\"gPCUserExtensionNames\", \"gPCWQLFilter\", \"name\", \n-\t\t\t\t\"versionNumber\", NULL};\n+\t\t\t\t\"versionNumber\", \"ntSecurityDescriptor\", NULL};\n \n \tZERO_STRUCTP(gpo);\n \n\n"}