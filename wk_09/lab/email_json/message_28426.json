{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r22819 - in branches: SAMBA_3_0/source/auth\n\tSAMBA_3_0_25/source/auth SAMBA_3_0_26/source/auth", "body": "Author: vlendec\nDate: 2007-05-12 19:53:47 +0000 (Sat, 12 May 2007)\nNew Revision: 22819\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22819\n\nLog:\nFix Bug 4613. We just dumped the must change & friends. With the\npass_last_changed == 0 we now return \"Change now!\" instead of \"Change\nnever\"\n\nModified:\n   branches/SAMBA_3_0/source/auth/auth_util.c\n   branches/SAMBA_3_0_25/source/auth/auth_util.c\n   branches/SAMBA_3_0_26/source/auth/auth_util.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/auth/auth_util.c\n===================================================================\n--- branches/SAMBA_3_0/source/auth/auth_util.c\t2007-05-12 19:34:39 UTC (rev 22818)\n+++ branches/SAMBA_3_0/source/auth/auth_util.c\t2007-05-12 19:53:47 UTC (rev 22819)\n@@ -1484,6 +1484,30 @@\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \n+\tif (!pdb_set_pass_last_set_time(\n+\t\t    sam_account,\n+\t\t    nt_time_to_unix(info3->pass_last_set_time),\n+\t\t    PDB_CHANGED)) {\n+\t\tTALLOC_FREE(sam_account);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n+\tif (!pdb_set_pass_can_change_time(\n+\t\t    sam_account,\n+\t\t    nt_time_to_unix(info3->pass_can_change_time),\n+\t\t    PDB_CHANGED)) {\n+\t\tTALLOC_FREE(sam_account);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n+\tif (!pdb_set_pass_must_change_time(\n+\t\t    sam_account,\n+\t\t    nt_time_to_unix(info3->pass_must_change_time),\n+\t\t    PDB_CHANGED)) {\n+\t\tTALLOC_FREE(sam_account);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n \tresult = make_server_info(NULL);\n \tif (result == NULL) {\n \t\tDEBUG(4, (\"make_server_info failed!\\n\"));\n\nModified: branches/SAMBA_3_0_25/source/auth/auth_util.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/auth/auth_util.c\t2007-05-12 19:34:39 UTC (rev 22818)\n+++ branches/SAMBA_3_0_25/source/auth/auth_util.c\t2007-05-12 19:53:47 UTC (rev 22819)\n@@ -1874,6 +1874,30 @@\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \n+\tif (!pdb_set_pass_last_set_time(\n+\t\t    sam_account,\n+\t\t    nt_time_to_unix(info3->pass_last_set_time),\n+\t\t    PDB_CHANGED)) {\n+\t\tTALLOC_FREE(sam_account);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n+\tif (!pdb_set_pass_can_change_time(\n+\t\t    sam_account,\n+\t\t    nt_time_to_unix(info3->pass_can_change_time),\n+\t\t    PDB_CHANGED)) {\n+\t\tTALLOC_FREE(sam_account);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n+\tif (!pdb_set_pass_must_change_time(\n+\t\t    sam_account,\n+\t\t    nt_time_to_unix(info3->pass_must_change_time),\n+\t\t    PDB_CHANGED)) {\n+\t\tTALLOC_FREE(sam_account);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n \tresult = make_server_info(NULL);\n \tif (result == NULL) {\n \t\tDEBUG(4, (\"make_server_info failed!\\n\"));\n\nModified: branches/SAMBA_3_0_26/source/auth/auth_util.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/auth/auth_util.c\t2007-05-12 19:34:39 UTC (rev 22818)\n+++ branches/SAMBA_3_0_26/source/auth/auth_util.c\t2007-05-12 19:53:47 UTC (rev 22819)\n@@ -1874,6 +1874,30 @@\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \n+\tif (!pdb_set_pass_last_set_time(\n+\t\t    sam_account,\n+\t\t    nt_time_to_unix(info3->pass_last_set_time),\n+\t\t    PDB_CHANGED)) {\n+\t\tTALLOC_FREE(sam_account);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n+\tif (!pdb_set_pass_can_change_time(\n+\t\t    sam_account,\n+\t\t    nt_time_to_unix(info3->pass_can_change_time),\n+\t\t    PDB_CHANGED)) {\n+\t\tTALLOC_FREE(sam_account);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n+\tif (!pdb_set_pass_must_change_time(\n+\t\t    sam_account,\n+\t\t    nt_time_to_unix(info3->pass_must_change_time),\n+\t\t    PDB_CHANGED)) {\n+\t\tTALLOC_FREE(sam_account);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n \tresult = make_server_info(NULL);\n \tif (result == NULL) {\n \t\tDEBUG(4, (\"make_server_info failed!\\n\"));\n\n"}