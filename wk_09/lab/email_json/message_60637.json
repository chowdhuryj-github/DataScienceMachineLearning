{"category": "ham", "to_address": "James Peach <jpeach@samba.org>", "from_address": "\"Gerald (Jerry) Carter\" <jerry@samba.org>", "subject": "Re: [patch] hide libsmbclient's private symbols", "body": "-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA1\n\nJames,\n\n>> The rules might look like this for a gcc-based toolchain. The only\n>> problem remaining is how to express the DSO version number in a generic\n>> way.\n> \n>> DSO_EXPORTS = -Wl,--version-script,exports/`basename $@ |\\\n>> \tsed -e/@SHLIBEXT@/syms/`\n>> SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS) \\\n>> \t@SONAMEFLAG@`basename $@`.$(XXXXXX_MAJOR)\n> \n>> bin/libsmbclient.@SHLIBEXT@: $(BINARY_PREREQS) $(LIBSMBCLIENT_OBJ)\n>>    @echo Linking libsmbclient shared library $@\n>>    @$(SHLD_DSO) $(LIBSMBCLIENT_OBJ) $(LIBS) $(KRB5LIBS) \\\n>>     $(LDAP_LIBS) $(NSCD_LIBS)\n> \n> I poked around and the only thing I could think of was\n> was to store the library versions outside of the Makefile\n> and read them from the file. For example,\n> \n>   DSO_EXPORTS = -Wl,--version-script,exports/`basename $@ |\\\n> \tsed -e/@SHLIBEXT@/syms/`\n>   SONAME_VER = `grep $@ $(srcdir)/library-versions | cut -d: -t2`\n>   SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS) \\\n> \t@SONAMEFLAG@`basename $@`.$(SONAME_VER)\n\nI just realized why this won't work.  On some platforms\nthe @SONAMEFLAG@ just becomes '#' and comments out the remainder\nof the line.\n\nSO this is good:\n\n  SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS)\n\nbut you have to add the @SONAMEFLAG@ last in the list\nI still like moving the major and minor numbers of the\nMakefile thought.  What do you think?\n\n\n\ncheers, jerry\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1.4.6 (GNU/Linux)\nComment: Using GnuPG with Mozilla - http://enigmail.mozdev.org\n\niD8DBQFGiWfCIR7qMdg1EfYRAv/0AKCMajZ8dRwrjcK94PMiUQfrdk3eagCeNr6R\nn1zg65KSc9Fa5mXEyf1AyKQ=\n=ucqG\n-----END PGP SIGNATURE-----\n\n"}