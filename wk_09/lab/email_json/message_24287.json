{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r22719 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_26/source/nsswitch", "body": "Author: jerry\nDate: 2007-05-06 21:23:40 +0000 (Sun, 06 May 2007)\nNew Revision: 22719\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22719\n\nLog:\nMissed change for one-way trust support.  Ignore password policy \nsettings from one trusted domain with no incoming trust path.\n\nGuenther, I think this is ok as we only need the pw policy\nto give feedback on upcoming expiration times.\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\t2007-05-06 21:19:22 UTC (rev 22718)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\t2007-05-06 21:23:40 UTC (rev 22719)\n@@ -1534,11 +1534,15 @@\n \n \t\tresult = fillup_password_policy(domain, state);\n \n-\t\tif (!NT_STATUS_IS_OK(result)) {\n+\t\tif (!NT_STATUS_IS_OK(result) \n+\t\t    && !NT_STATUS_EQUAL(result, NT_STATUS_NOT_SUPPORTED) ) \n+\t\t{\n \t\t\tDEBUG(10,(\"Failed to get password policies: %s\\n\", nt_errstr(result)));\n \t\t\tgoto done;\n \t\t}\n \n+\t\tresult = NT_STATUS_OK;\t\t\n+\n \t\tif (state->request.flags & WBFLAG_PAM_UNIX_NAME) {\n \t\t\t/* We've been asked to return the unix username, per \n \t\t\t   'winbind use default domain' settings and the like */\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\t2007-05-06 21:19:22 UTC (rev 22718)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\t2007-05-06 21:23:40 UTC (rev 22719)\n@@ -1534,11 +1534,15 @@\n \n \t\tresult = fillup_password_policy(domain, state);\n \n-\t\tif (!NT_STATUS_IS_OK(result)) {\n+\t\tif (!NT_STATUS_IS_OK(result) \n+\t\t    && !NT_STATUS_EQUAL(result, NT_STATUS_NOT_SUPPORTED) ) \n+\t\t{\n \t\t\tDEBUG(10,(\"Failed to get password policies: %s\\n\", nt_errstr(result)));\n \t\t\tgoto done;\n \t\t}\n \n+\t\tresult = NT_STATUS_OK;\t\t\n+\n \t\tif (state->request.flags & WBFLAG_PAM_UNIX_NAME) {\n \t\t\t/* We've been asked to return the unix username, per \n \t\t\t   'winbind use default domain' settings and the like */\n\n"}