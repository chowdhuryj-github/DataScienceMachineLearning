{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23694 - in branches: SAMBA_3_0/source\n\tSAMBA_3_0_26/source", "body": "Author: jerry\nDate: 2007-07-04 00:41:58 +0000 (Wed, 04 Jul 2007)\nNew Revision: 23694\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23694\n\nLog:\nMake sure that when builddir != srcdir, we can still find the exports \nfiles and library-versions file.  \n\nAlso move the \"-o $@\" from the individual targets and into the SHLD_DSO \ncommand.\n\n\nModified:\n   branches/SAMBA_3_0/source/Makefile.in\n   branches/SAMBA_3_0_26/source/Makefile.in\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0/source/Makefile.in\t2007-07-04 00:34:16 UTC (rev 23693)\n+++ branches/SAMBA_3_0/source/Makefile.in\t2007-07-04 00:41:58 UTC (rev 23694)\n@@ -22,10 +22,10 @@\n SHLD=@SHLD@\n \n ## Dynamic shared libraries build settings\n-DSO_EXPORTS_CMD=-Wl,--version-script,exports/`basename $@ | sed 's/@SHLIBEXT@$$/syms/'`\n+DSO_EXPORTS_CMD=-Wl,--version-script,$(srcdir)/exports/`basename $@ | sed 's/@SHLIBEXT@$$/syms/'`\n DSO_EXPORTS=@DSO_EXPORTS@\n-SONAME_VER=`grep ^$@ $(srcdir)/library-versions | cut -d: -f2`\n-SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS) \n+SONAME_VER=`grep ^$@ $(builddir)/library-versions | cut -d: -f2`\n+SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS) -o $@\n \n # Add $(DEVELOPER_CFLAGS) to $(CFLAGS) to enable extra compiler\n # (GCC) warnings. This is done automtically for --enable-developer\n@@ -1352,7 +1352,7 @@\n \n bin/libaddns.@SHLIBEXT@: $(BINARY_PREREQS) $(LIBADDNS_OBJ)\n \t@echo Linking libaddns shared library $@\n-\t@$(SHLD_DSO) -o $@ $(LIBADDNS_OBJ) $(LDFLAGS) $(LIBS) \\\n+\t@$(SHLD_DSO) $(LIBADDNS_OBJ) $(LDFLAGS) $(LIBS) \\\n \t\t$(KRB5LIBS) $(UUID_LIBS)\\\n \t\t@SONAMEFLAG@`basename $@`.$(SONAME_VER)\n \n@@ -1362,7 +1362,7 @@\n \n bin/libsmbclient.@SHLIBEXT@: $(BINARY_PREREQS) $(LIBSMBCLIENT_OBJ)\n \t@echo Linking libsmbclient shared library $@\n-\t@$(SHLD_DSO) -o $@ $(LIBSMBCLIENT_OBJ) $(LDFLAGS) $(LIBS) \\\n+\t@$(SHLD_DSO) $(LIBSMBCLIENT_OBJ) $(LDFLAGS) $(LIBS) \\\n \t\t$(KRB5LIBS) $(LDAP_LIBS) $(NSCD_LIBS) \\\n \t\t@SONAMEFLAG@`basename $@`.$(SONAME_VER)\n \n@@ -1372,7 +1372,7 @@\n \n bin/libsmbsharemodes.@SHLIBEXT@: $(BINARY_PREREQS) $(LIBSMBSHAREMODES_OBJ)\n \t@echo Linking libsmbsharemodes shared library $@\n-\t@$(SHLD_DSO) -o $@ $(LIBSMBSHAREMODES_OBJ) $(LDFLAGS) $(LIBS) \\\n+\t@$(SHLD_DSO) $(LIBSMBSHAREMODES_OBJ) $(LDFLAGS) $(LIBS) \\\n \t\t$(KRB5LIBS) $(LDAP_LIBS) \\\n \t\t@SONAMEFLAG@`basename $@`.$(SONAME_VER)\n \n@@ -1382,7 +1382,7 @@\n \n bin/libmsrpc.@SHLIBEXT@: $(BINARY_PREREQS) $(CAC_OBJ)\n \t@echo Linking libmsrpc shared library $@\n-\t@$(SHLD_DSO) -o $@ $(CAC_OBJ) $(LDFLAGS) $(LIBS) \\\n+\t@$(SHLD_DSO) $(CAC_OBJ) $(LDFLAGS) $(LIBS) \\\n \t\t@SONAMEFLAG@`basename $@`.$(SONAME_VER)\n \n bin/libmsrpc.a: $(BINARY_PREREQS) $(CAC_OBJ)\n\nModified: branches/SAMBA_3_0_26/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0_26/source/Makefile.in\t2007-07-04 00:34:16 UTC (rev 23693)\n+++ branches/SAMBA_3_0_26/source/Makefile.in\t2007-07-04 00:41:58 UTC (rev 23694)\n@@ -22,10 +22,10 @@\n SHLD=@SHLD@\n \n ## Dynamic shared libraries build settings\n-DSO_EXPORTS_CMD=-Wl,--version-script,exports/`basename $@ | sed 's/@SHLIBEXT@$$/syms/'`\n+DSO_EXPORTS_CMD=-Wl,--version-script,$(srcdir)/exports/`basename $@ | sed 's/@SHLIBEXT@$$/syms/'`\n DSO_EXPORTS=@DSO_EXPORTS@\n-SONAME_VER=`grep ^$@ $(srcdir)/library-versions | cut -d: -f2`\n-SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS) \n+SONAME_VER=`grep ^$@ $(builddir)/library-versions | cut -d: -f2`\n+SHLD_DSO = $(SHLD) $(LDSHFLAGS) $(DSO_EXPORTS) -o $@\n \n # Add $(DEVELOPER_CFLAGS) to $(CFLAGS) to enable extra compiler\n # (GCC) warnings. This is done automtically for --enable-developer\n@@ -1310,7 +1310,7 @@\n \n bin/libaddns.@SHLIBEXT@: $(BINARY_PREREQS) $(LIBADDNS_OBJ)\n \t@echo Linking libaddns shared library $@\n-\t@$(SHLD_DSO) -o $@ $(LIBADDNS_OBJ) $(LDFLAGS) $(LIBS) \\\n+\t@$(SHLD_DSO) $(LIBADDNS_OBJ) $(LDFLAGS) $(LIBS) \\\n \t\t$(KRB5LIBS) $(UUID_LIBS)\\\n \t\t@SONAMEFLAG@`basename $@`.$(SONAME_VER)\n \n@@ -1320,7 +1320,7 @@\n \n bin/libsmbclient.@SHLIBEXT@: $(BINARY_PREREQS) $(LIBSMBCLIENT_OBJ)\n \t@echo Linking libsmbclient shared library $@\n-\t@$(SHLD_DSO) -o $@ $(LIBSMBCLIENT_OBJ) $(LDFLAGS) $(LIBS) \\\n+\t@$(SHLD_DSO) $(LIBSMBCLIENT_OBJ) $(LDFLAGS) $(LIBS) \\\n \t\t$(KRB5LIBS) $(LDAP_LIBS) $(NSCD_LIBS) \\\n \t\t@SONAMEFLAG@`basename $@`.$(SONAME_VER)\n \n@@ -1330,7 +1330,7 @@\n \n bin/libsmbsharemodes.@SHLIBEXT@: $(BINARY_PREREQS) $(LIBSMBSHAREMODES_OBJ)\n \t@echo Linking libsmbsharemodes shared library $@\n-\t@$(SHLD_DSO) -o $@ $(LIBSMBSHAREMODES_OBJ) $(LDFLAGS) $(LIBS) \\\n+\t@$(SHLD_DSO) $(LIBSMBSHAREMODES_OBJ) $(LDFLAGS) $(LIBS) \\\n \t\t$(KRB5LIBS) $(LDAP_LIBS) \\\n \t\t@SONAMEFLAG@`basename $@`.$(SONAME_VER)\n \n\n"}