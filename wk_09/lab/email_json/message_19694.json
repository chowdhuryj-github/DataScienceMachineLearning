{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22576 - in branches: SAMBA_3_0/source/rpc_parse\n\tSAMBA_3_0_25/source/rpc_parse", "body": "Author: jra\nDate: 2007-04-29 20:57:04 +0000 (Sun, 29 Apr 2007)\nNew Revision: 22576\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22576\n\nLog:\nFix marshalling bug in aliasmem.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/rpc_parse/parse_samr.c\n   branches/SAMBA_3_0_25/source/rpc_parse/parse_samr.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/rpc_parse/parse_samr.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_parse/parse_samr.c\t2007-04-29 20:37:59 UTC (rev 22575)\n+++ branches/SAMBA_3_0/source/rpc_parse/parse_samr.c\t2007-04-29 20:57:04 UTC (rev 22576)\n@@ -4834,9 +4834,15 @@\n \t\tif(!prs_uint32(\"num_sids1\", ps, depth, &r_u->num_sids1))\n \t\t\treturn False;\n \n-\t\tptr_sid = TALLOC_ARRAY(ps->mem_ctx, uint32, r_u->num_sids1);\n-\t\tif (!ptr_sid) {\n-\t\t\treturn False;\n+\t\tif (UNMARSHALLING(ps)) {\n+\t\t\tif (r_u->num_sids1) {\n+\t\t\t\tptr_sid = TALLOC_ARRAY(ps->mem_ctx, uint32, r_u->num_sids1);\n+\t\t\t\tif (!ptr_sid) {\n+\t\t\t\t\treturn False;\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tptr_sid = NULL;\n+\t\t\t}\n \t\t}\n \t\t\n \t\tfor (i = 0; i < r_u->num_sids1; i++) {\n@@ -4846,7 +4852,14 @@\n \t\t}\n \t\t\n \t\tif (UNMARSHALLING(ps)) {\n-\t\t\tr_u->sid = TALLOC_ARRAY(ps->mem_ctx, DOM_SID2, r_u->num_sids1);\n+\t\t\tif (r_u->num_sids1) {\n+\t\t\t\tr_u->sid = TALLOC_ARRAY(ps->mem_ctx, DOM_SID2, r_u->num_sids1);\n+\t\t\t\tif (!r_u->sid) {\n+\t\t\t\t\treturn False;\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tr_u->sid = NULL;\n+\t\t\t}\n \t\t}\n \t\t\n \t\tfor (i = 0; i < r_u->num_sids1; i++) {\n\nModified: branches/SAMBA_3_0_25/source/rpc_parse/parse_samr.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/rpc_parse/parse_samr.c\t2007-04-29 20:37:59 UTC (rev 22575)\n+++ branches/SAMBA_3_0_25/source/rpc_parse/parse_samr.c\t2007-04-29 20:57:04 UTC (rev 22576)\n@@ -4764,9 +4764,15 @@\n \t\tif(!prs_uint32(\"num_sids1\", ps, depth, &r_u->num_sids1))\n \t\t\treturn False;\n \n-\t\tptr_sid = TALLOC_ARRAY(ps->mem_ctx, uint32, r_u->num_sids1);\n-\t\tif (!ptr_sid) {\n-\t\t\treturn False;\n+\t\tif (UNMARSHALLING(ps)) {\n+\t\t\tif (r_u->num_sids1) {\n+\t\t\t\tptr_sid = TALLOC_ARRAY(ps->mem_ctx, uint32, r_u->num_sids1);\n+\t\t\t\tif (!ptr_sid) {\n+\t\t\t\t\treturn False;\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tptr_sid = NULL;\n+\t\t\t}\n \t\t}\n \t\t\n \t\tfor (i = 0; i < r_u->num_sids1; i++) {\n@@ -4776,7 +4782,14 @@\n \t\t}\n \t\t\n \t\tif (UNMARSHALLING(ps)) {\n-\t\t\tr_u->sid = TALLOC_ARRAY(ps->mem_ctx, DOM_SID2, r_u->num_sids1);\n+\t\t\tif (r_u->num_sids1) {\n+\t\t\t\tr_u->sid = TALLOC_ARRAY(ps->mem_ctx, DOM_SID2, r_u->num_sids1);\n+\t\t\t\tif (!r_u->sid) {\n+\t\t\t\t\treturn False;\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tr_u->sid = NULL;\n+\t\t\t}\n \t\t}\n \t\t\n \t\tfor (i = 0; i < r_u->num_sids1; i++) {\n\n"}