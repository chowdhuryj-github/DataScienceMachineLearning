{"category": "ham", "to_address": "samba-technical@samba.org", "from_address": "tridge@samba.org", "subject": "a way to disable ADS in winbind in samba3", "body": "I've sometimes come across sites where a w2k or w2k3 DC is in use but\nADS is totally broken. It used to be that in a pinch you could use rpc\ninstead, but now winbind insists on working out for itself if ADS is\nsupported and using ADS anyway. Unfortunately sometimes this doesn't\nwork, and ADS is just too badly broken on the DC to work. Windows\nclients cope with this, but winbind doesn't.\n\nIt would be great to improve the auto-detection, but I'd also like to\nsuggest the following override:\n\n--- source/nsswitch/winbindd_cm.c       2007-04-11 15:41:35 +0000\n+++ source/nsswitch/winbindd_cm.c       2007-05-22 05:50:36 +0000\n@@ -1641,6 +1641,15 @@\n        DEBUG(5,(\"set_dc_type_and_flags: domain %s is %srunning active directory.\\n\",\n                  domain->name, domain->active_directory ? \"\" : \"NOT \"));\n\n+       /* allow override for using ads - a last ditch approach for domain controllers\n+          that are terminally broken */\n+       if (domain->active_directory &&\n+           !lp_parm_bool(-1, \"winbind\", \"ads\", True)) {\n+               domain->active_directory = False;\n+               domain->native_mode = False;\n+               DEBUG(0,(\"Overriding active directory detecting - disabling ADS\\n\"));\n+       }\n+\n\n\nso when you are pulling your hair out and can't get an admin to fix a\nbroken DC, you can at least get something working by setting\n\"winbind:ads = no\" as a last desperate measure.\n\nThe world is full of broken DCs. We need a way to work with them, sad\nas that may be.\n\nCheers, Tridge\n\n"}