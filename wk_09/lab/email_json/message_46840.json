{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r23446 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_26/source/nsswitch", "body": "Author: vlendec\nDate: 2007-06-12 19:19:35 +0000 (Tue, 12 Jun 2007)\nNew Revision: 23446\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23446\n\nLog:\nRestore Jeremy's original formatting, just fix the comment.\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\t2007-06-12 18:14:16 UTC (rev 23445)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\t2007-06-12 19:19:35 UTC (rev 23446)\n@@ -192,7 +192,7 @@\n \n static void async_request_sent(void *private_data_data, BOOL success)\n {\n-\tuint32_t timeout;\n+\tuint32_t timeout = 30;\n \tstruct winbindd_async_request *state =\n \t\ttalloc_get_type_abort(private_data_data, struct winbindd_async_request);\n \n@@ -212,35 +212,31 @@\n \t\t\t sizeof(state->response->result),\n \t\t\t async_reply_recv, state);\n \n-\ttimeout = 30;\n+\t/* \n+\t * Normal timeouts are 30s, but auth requests may take a long\n+\t * time to timeout.\n+\t */\n \n-\tif (state->request->cmd == WINBINDD_PAM_AUTH\n-\t    || state->request->cmd == WINBINDD_PAM_AUTH_CRAP ) {\n+\tif (state->request->cmd == WINBINDD_PAM_AUTH ||\n+\t\t\tstate->request->cmd == WINBINDD_PAM_AUTH_CRAP ) {\n \n-\t\t/* \n-\t\t * Normal timeouts are 30s, but auth requests may take a long\n-\t\t * time to timeout.\n-\t\t */\n-\n \t\ttimeout = 300;\n \t}\n \n \t/* \n-\t * Set up a timeout of for the response. If we don't get it close the\n-\t * child socket and report failure.\n+\t * Set up a timeout of 30 seconds for the response.\n+\t * If we don't get it close the child socket and\n+\t * report failure.\n \t */\n \n-\tstate->reply_timeout_event = event_add_timed(\n-\t\twinbind_event_context(),\n-\t\tNULL,\n-\t\ttimeval_current_ofs(timeout,0),\n-\t\t\"async_request_timeout\",\n-\t\tasync_request_timeout_handler,\n-\t\tstate);\n-\n+\tstate->reply_timeout_event = event_add_timed(winbind_event_context(),\n+\t\t\t\t\t\t\tNULL,\n+\t\t\t\t\t\t\ttimeval_current_ofs(timeout,0),\n+\t\t\t\t\t\t\t\"async_request_timeout\",\n+\t\t\t\t\t\t\tasync_request_timeout_handler,\n+\t\t\t\t\t\t\tstate);\n \tif (!state->reply_timeout_event) {\n-\t\tsmb_panic(\"async_request_sent: failed to add timeout \"\n-\t\t\t  \"handler.\\n\");\n+\t\tsmb_panic(\"async_request_sent: failed to add timeout handler.\\n\");\n \t}\n }\n \n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\t2007-06-12 18:14:16 UTC (rev 23445)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\t2007-06-12 19:19:35 UTC (rev 23446)\n@@ -192,7 +192,7 @@\n \n static void async_request_sent(void *private_data_data, BOOL success)\n {\n-\tuint32_t timeout;\n+\tuint32_t timeout = 30;\n \tstruct winbindd_async_request *state =\n \t\ttalloc_get_type_abort(private_data_data, struct winbindd_async_request);\n \n@@ -212,35 +212,31 @@\n \t\t\t sizeof(state->response->result),\n \t\t\t async_reply_recv, state);\n \n-\ttimeout = 30;\n+\t/* \n+\t * Normal timeouts are 30s, but auth requests may take a long\n+\t * time to timeout.\n+\t */\n \n-\tif (state->request->cmd == WINBINDD_PAM_AUTH\n-\t    || state->request->cmd == WINBINDD_PAM_AUTH_CRAP ) {\n+\tif (state->request->cmd == WINBINDD_PAM_AUTH ||\n+\t\t\tstate->request->cmd == WINBINDD_PAM_AUTH_CRAP ) {\n \n-\t\t/* \n-\t\t * Normal timeouts are 30s, but auth requests may take a long\n-\t\t * time to timeout.\n-\t\t */\n-\n \t\ttimeout = 300;\n \t}\n \n \t/* \n-\t * Set up a timeout of for the response. If we don't get it close the\n-\t * child socket and report failure.\n+\t * Set up a timeout of 30 seconds for the response.\n+\t * If we don't get it close the child socket and\n+\t * report failure.\n \t */\n \n-\tstate->reply_timeout_event = event_add_timed(\n-\t\twinbind_event_context(),\n-\t\tNULL,\n-\t\ttimeval_current_ofs(timeout,0),\n-\t\t\"async_request_timeout\",\n-\t\tasync_request_timeout_handler,\n-\t\tstate);\n-\n+\tstate->reply_timeout_event = event_add_timed(winbind_event_context(),\n+\t\t\t\t\t\t\tNULL,\n+\t\t\t\t\t\t\ttimeval_current_ofs(timeout,0),\n+\t\t\t\t\t\t\t\"async_request_timeout\",\n+\t\t\t\t\t\t\tasync_request_timeout_handler,\n+\t\t\t\t\t\t\tstate);\n \tif (!state->reply_timeout_event) {\n-\t\tsmb_panic(\"async_request_sent: failed to add timeout \"\n-\t\t\t  \"handler.\\n\");\n+\t\tsmb_panic(\"async_request_sent: failed to add timeout handler.\\n\");\n \t}\n }\n \n\n"}