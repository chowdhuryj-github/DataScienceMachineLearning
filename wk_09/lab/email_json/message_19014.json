{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22562 - in branches/SAMBA_3_0_25/source/smbd: .", "body": "Author: jra\nDate: 2007-04-28 20:56:32 +0000 (Sat, 28 Apr 2007)\nNew Revision: 22562\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22562\n\nLog:\nQucik fix for session memory leak (vl's talloc\nfix is probably better in the long run). Jerry - your\ncall whether this makes 3.0.25 or not.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0_25/source/smbd/lanman.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_25/source/smbd/lanman.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/smbd/lanman.c\t2007-04-28 18:16:33 UTC (rev 22561)\n+++ branches/SAMBA_3_0_25/source/smbd/lanman.c\t2007-04-28 20:56:32 UTC (rev 22562)\n@@ -4189,7 +4189,7 @@\n \tchar *p = skip_string(param,tpscnt,str2);\n \tint uLevel;\n \tstruct pack_desc desc;\n-\tstruct sessionid *session_list;\n+\tstruct sessionid *session_list = NULL;\n \tint i, num_sessions;\n \n \tif (!str1 || !str2 || !p) {\n@@ -4217,6 +4217,7 @@\n \tif (mdrcnt > 0) {\n \t\t*rdata = SMB_REALLOC_LIMIT(*rdata,mdrcnt);\n \t\tif (!*rdata) {\n+\t\t\tSAFE_FREE(session_list);\n \t\t\treturn False;\n \t\t}\n \t}\n@@ -4225,6 +4226,7 @@\n \tdesc.buflen = mdrcnt;\n \tdesc.format = str2;\n \tif (!init_package(&desc,num_sessions,0)) {\n+\t\tSAFE_FREE(session_list);\n \t\treturn False;\n \t}\n \n@@ -4245,6 +4247,7 @@\n \t*rparam_len = 8;\n \t*rparam = SMB_REALLOC_LIMIT(*rparam,*rparam_len);\n \tif (!*rparam) {\n+\t\tSAFE_FREE(session_list);\n \t\treturn False;\n \t}\n \tSSVALS(*rparam,0,desc.errcode);\n@@ -4253,6 +4256,7 @@\n \n \tDEBUG(4,(\"RNetSessionEnum: errorcode %d\\n\",desc.errcode));\n \n+\tSAFE_FREE(session_list);\n \treturn True;\n }\n \n\n"}