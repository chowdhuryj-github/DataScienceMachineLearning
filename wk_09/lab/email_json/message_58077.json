{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23648 - in branches: SAMBA_3_0/source/libads\n\tSAMBA_3_0/source/utils SAMBA_3_0_26/source/libads\n\tSAMBA_3_0_26/source/utils", "body": "Author: gd\nDate: 2007-06-29 09:01:29 +0000 (Fri, 29 Jun 2007)\nNew Revision: 23648\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23648\n\nLog:\nAllow to list a custom krb5 keytab file with:\n\n\tnet ads keytab list /path/to/krb5.keytab\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/libads/kerberos_keytab.c\n   branches/SAMBA_3_0/source/utils/net_ads.c\n   branches/SAMBA_3_0_26/source/libads/kerberos_keytab.c\n   branches/SAMBA_3_0_26/source/utils/net_ads.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libads/kerberos_keytab.c\n===================================================================\n--- branches/SAMBA_3_0/source/libads/kerberos_keytab.c\t2007-06-29 08:58:03 UTC (rev 23647)\n+++ branches/SAMBA_3_0/source/libads/kerberos_keytab.c\t2007-06-29 09:01:29 UTC (rev 23648)\n@@ -801,7 +801,7 @@\n  List system keytab.\n ***********************************************************************/\n \n-int ads_keytab_list(void)\n+int ads_keytab_list(const char *keytab_name)\n {\n \tkrb5_error_code ret = 0;\n \tkrb5_context context = NULL;\n@@ -819,7 +819,7 @@\n \t\treturn ret;\n \t}\n \n-\tret = smb_krb5_open_keytab(context, NULL, False, &keytab);\n+\tret = smb_krb5_open_keytab(context, keytab_name, False, &keytab);\n \tif (ret) {\n \t\tDEBUG(1,(\"ads_keytab_list: smb_krb5_open_keytab failed (%s)\\n\", error_message(ret)));\n \t\tgoto out;\n\nModified: branches/SAMBA_3_0/source/utils/net_ads.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/net_ads.c\t2007-06-29 08:58:03 UTC (rev 23647)\n+++ branches/SAMBA_3_0/source/utils/net_ads.c\t2007-06-29 09:01:29 UTC (rev 23648)\n@@ -2423,12 +2423,13 @@\n \"  FLUSH     Flushes out all keytab entries\\n\"\\\n \"  HELP      Prints this help message\\n\"\\\n \"  LIST      List the keytab\\n\"\\\n-\"The ADD command will take arguments, the other commands\\n\"\\\n+\"The ADD and LIST command will take arguments, the other commands\\n\"\\\n \"will not take any arguments.   The arguments given to ADD\\n\"\\\n \"should be a list of principals to add.  For example, \\n\"\\\n \"   net ads keytab add srv1 srv2\\n\"\\\n \"will add principals for the services srv1 and srv2 to the\\n\"\\\n \"system's keytab.\\n\"\\\n+\"The LIST command takes a keytabname.\\n\"\\\n \"\\n\"\n \t\t);\n \treturn -1;\n@@ -2479,15 +2480,21 @@\n \n static int net_ads_keytab_list(int argc, const char **argv)\n {\n-\treturn ads_keytab_list();\n+\tconst char *keytab = NULL;\n+\n+\tif (argc >= 1) {\n+\t\tkeytab = argv[0];\n+\t}\n+\n+\treturn ads_keytab_list(keytab);\n }\n \n \n int net_ads_keytab(int argc, const char **argv)\n {\n \tstruct functable func[] = {\n+\t\t{\"ADD\", net_ads_keytab_add},\n \t\t{\"CREATE\", net_ads_keytab_create},\n-\t\t{\"ADD\", net_ads_keytab_add},\n \t\t{\"FLUSH\", net_ads_keytab_flush},\n \t\t{\"HELP\", net_ads_keytab_usage},\n \t\t{\"LIST\", net_ads_keytab_list},\n\nModified: branches/SAMBA_3_0_26/source/libads/kerberos_keytab.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libads/kerberos_keytab.c\t2007-06-29 08:58:03 UTC (rev 23647)\n+++ branches/SAMBA_3_0_26/source/libads/kerberos_keytab.c\t2007-06-29 09:01:29 UTC (rev 23648)\n@@ -801,7 +801,7 @@\n  List system keytab.\n ***********************************************************************/\n \n-int ads_keytab_list(void)\n+int ads_keytab_list(const char *keytab_name)\n {\n \tkrb5_error_code ret = 0;\n \tkrb5_context context = NULL;\n@@ -819,7 +819,7 @@\n \t\treturn ret;\n \t}\n \n-\tret = smb_krb5_open_keytab(context, NULL, False, &keytab);\n+\tret = smb_krb5_open_keytab(context, keytab_name, False, &keytab);\n \tif (ret) {\n \t\tDEBUG(1,(\"ads_keytab_list: smb_krb5_open_keytab failed (%s)\\n\", error_message(ret)));\n \t\tgoto out;\n\nModified: branches/SAMBA_3_0_26/source/utils/net_ads.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/net_ads.c\t2007-06-29 08:58:03 UTC (rev 23647)\n+++ branches/SAMBA_3_0_26/source/utils/net_ads.c\t2007-06-29 09:01:29 UTC (rev 23648)\n@@ -2423,12 +2423,13 @@\n \"  FLUSH     Flushes out all keytab entries\\n\"\\\n \"  HELP      Prints this help message\\n\"\\\n \"  LIST      List the keytab\\n\"\\\n-\"The ADD command will take arguments, the other commands\\n\"\\\n+\"The ADD and LIST command will take arguments, the other commands\\n\"\\\n \"will not take any arguments.   The arguments given to ADD\\n\"\\\n \"should be a list of principals to add.  For example, \\n\"\\\n \"   net ads keytab add srv1 srv2\\n\"\\\n \"will add principals for the services srv1 and srv2 to the\\n\"\\\n \"system's keytab.\\n\"\\\n+\"The LIST command takes a keytabname.\\n\"\\\n \"\\n\"\n \t\t);\n \treturn -1;\n@@ -2479,15 +2480,21 @@\n \n static int net_ads_keytab_list(int argc, const char **argv)\n {\n-\treturn ads_keytab_list();\n+\tconst char *keytab = NULL;\n+\n+\tif (argc >= 1) {\n+\t\tkeytab = argv[0];\n+\t}\n+\n+\treturn ads_keytab_list(keytab);\n }\n \n \n int net_ads_keytab(int argc, const char **argv)\n {\n \tstruct functable func[] = {\n+\t\t{\"ADD\", net_ads_keytab_add},\n \t\t{\"CREATE\", net_ads_keytab_create},\n-\t\t{\"ADD\", net_ads_keytab_add},\n \t\t{\"FLUSH\", net_ads_keytab_flush},\n \t\t{\"HELP\", net_ads_keytab_usage},\n \t\t{\"LIST\", net_ads_keytab_list},\n\n"}