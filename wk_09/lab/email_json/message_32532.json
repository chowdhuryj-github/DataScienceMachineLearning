{"category": "ham", "to_address": "\"Tyler Smith\" <tyler.smith@mail.mcgill.ca>", "from_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "subject": "Re: [R] my ugly apply/sweep code needs help", "body": "Please include test data in your posts.  We define\nsweep.med to perform the sweep on an entire matrix.  Then\nwe lapply f over group.sel where f(g) combines a column of all\ng with sweep.med applied to the submatrix of data.mat whose\nrows correspond to group.vec of g.\n\nsweep.median2 <- function(data.mat, group.vec, group.sel) {\n   sweep.med <- function(x) sweep(x, 2, apply(x, 2, median))\n   f <- function(g) cbind(g+0, sweep.med(data.mat[group.vec == g,,drop\n= FALSE ]))\n   do.call(rbind, lapply(group.sel, f))\n}\n\n# test\nmat <- matrix(1:24, 6)\ngroup.sel <- 1:2\ngroup.vec <- rep(1:3, 2)\n\nsweep.median(data.mat, group.vec, group.sel)\nsweep.median2(data.mat, group.vec, group.sel)\n\n\nOn 5/18/07, Tyler Smith  wrote:\n> Hi,\n>\n> I have a matrix of data from from several groups. I need to center the\n> data by group, subtracting the group median from each value, initially\n> for two groups at a time. I have a working function to do this, but it\n> looks quite inelegant. There must be a more straightforward way to do\n> this, but I always get tangled up in apply/sweep/subset\n> operations. Any suggestions welcome!\n>\n> Thanks,\n>\n> Tyler\n>\n> My code:\n>\n> Notes: data.mat is an nxm matrix of data. group.vec is a vector of\n> length n with grouping factors. group.sel is a vector of length 2 of\n> the groups to include in the analysis.\n>\n> sweep.median <- function (data.mat, group.vec, group.sel) {\n>\n>  data.sub1 <- data.mat[group.vec %in% group.sel[1],]\n>  data.sub2 <- data.mat[group.vec %in% group.sel[2],]\n>\n>  data.sub1.med <- apply(data.sub1, MAR=2, median)\n>  data.sub1.cent <- sweep(data.sub1, MARGIN=2, data.sub1.med)\n>\n>  data.sub2.med <- apply(data.sub2, MAR=2, median)\n>  data.sub2.cent <- sweep(data.sub2, MARGIN=2, data.sub2.med)\n>\n>  data.comb <- rbind(data.sub1.cent, data.sub2.cent)\n>  data.comb <- cbind(c(rep(group.sel[1],nrow(data.sub1.cent)),\n>                       rep(group.sel[2],nrow(data.sub2.cent))),\n>                     data.comb)\n>\n>  return(data.comb)\n> }\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}