{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "Jelmer Vernooij <jelmer@samba.org>", "subject": "Rev 11875: Convert mksamba4server script to perl. in\n\tfile:///home/jelmer/bzr.samba/SAMBA_4_0/", "body": "At file:///home/jelmer/bzr.samba/SAMBA_4_0/\n\n------------------------------------------------------------\nrevno: 11875\nrevision-id: jelmer@samba.org-20070416203519-154364q13fgzj42f\nparent: svn-v2:22260@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0\ncommitter: Jelmer Vernooij \nbranch nick: SAMBA_4_0\ntimestamp: Mon 2007-04-16 22:35:19 +0200\nmessage:\n  Convert mksamba4server script to perl.\nrenamed:\n  source/script/tests/mksamba4server.sh => source/script/tests/mksamba4server.pl svn-v2:22260@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fscript%2ftests%2fmksamba4server.sh\nmodified:\n  source/script/tests/Samba4.pm  svn-v2:21707@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fscript%2ftests%2fSamba4.pm\n  source/script/tests/mk-fedora-ds.sh svn-v2:21069@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fscript%2ftests%2fmk%2dfedora%2dds.sh\n  source/script/tests/mk-keyblobs.sh svn-v2:21069@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fscript%2ftests%2fmk%2dkeyblobs.sh\n  source/script/tests/mk-openldap.sh svn-v2:21069@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fscript%2ftests%2fmk%2dopenldap.sh\n  source/torture/local/torture.c svn-v2:16518@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2ftorture%2flocal%2ftorture.c\n  source/script/tests/mksamba4server.pl svn-v2:22260@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fscript%2ftests%2fmksamba4server.sh\n=== renamed file 'source/script/tests/mksamba4server.sh' => 'source/script/tests/mksamba4server.pl'\n--- a/source/script/tests/mksamba4server.sh\t2007-04-16 10:44:26 +0000\n+++ b/source/script/tests/mksamba4server.pl\t2007-04-16 20:35:19 +0000\n@@ -1,86 +1,89 @@\n-#!/bin/sh\n+#!/usr/bin/perl\n # Build a test environment for running Samba\n \n-if [ $# -lt 1 ]\n-then\n-\techo \"$0 PREFIX\"\n-\texit 1\n-fi\n-\n-PREFIX=$1\n-\n-if test -z \"$SHARE_BACKEND\"; then\n-\tSHARE_BACKEND=classic\n-fi\n-\n-if test -z \"$SMBD_LOGLEVEL\"; then\n-\tSMBD_LOGLEVEL=1\n-fi\n-\n-if test -z \"$SERVER_ROLE\"; then\n-\tSERVER_ROLE=\"domain controller\"\n-fi\n-\n-DOMAIN=SAMBADOMAIN\n-USERNAME=administrator\n-REALM=SAMBA.EXAMPLE.COM\n-DNSNAME=\"samba.example.com\"\n-BASEDN=\"dc=samba,dc=example,dc=com\"\n-PASSWORD=penguin\n-SRCDIR=`pwd`\n-ROOT=$USER\n-SERVER=localhost\n-NETBIOSNAME=localtest\n-if test -z \"$ROOT\"; then\n-    ROOT=$LOGNAME\n-fi\n-if test -z \"$ROOT\"; then\n-    ROOT=`whoami`\n-fi\n-\n-oldpwd=`pwd`\n-srcdir=`dirname $0`/../..\n-mkdir -p $PREFIX || exit $?\n-cd $PREFIX\n-PREFIX_ABS=`pwd`\n-cd $oldpwd\n-\n-TMPDIR=$PREFIX_ABS/tmp\n-ETCDIR=$PREFIX_ABS/etc\n-PIDDIR=$PREFIX_ABS/pid\n-CONFFILE=$ETCDIR/smb.conf\n-KRB5_CONFIG=$ETCDIR/krb5.conf\n-PRIVATEDIR=$PREFIX_ABS/private\n-NCALRPCDIR=$PREFIX_ABS/ncalrpc\n-LOCKDIR=$PREFIX_ABS/lockdir\n-\n-WINBINDD_SOCKET_DIR=$PREFIX_ABS/winbind_socket\n-CONFIGURATION=\"--configfile=$CONFFILE\"\n-LDAPDIR=$PREFIX_ABS/ldap\n-\n-rm -rf $PREFIX/*\n-mkdir -p $PRIVATEDIR $ETCDIR $PIDDIR $NCALRPCDIR $LOCKDIR $TMPDIR $LDAPDIR/db $LDAPDIR/db/bdb-logs $LDAPDIR/db/tmp\n-\n-cat >$CONFFILE< \\$opt_help,\n+\t'server-role:s' => \\$server_role,\n+\t'ldap:s' => \\$opt_ldap,\n+\t'domain:s' => \\$domain,\n+\t'netbios-name:s' => \\$netbiosname,\n+);\n+\n+if (not $result) {\n+\texit(1);\n+}\n+\n+if (scalar(@ARGV) == 0) {\n+\tprint \"Usage: $Script [OPTIONS] \\n\";\n+\texit(1);\n+}\n+\n+my $prefix = shift @ARGV;\n+\n+my $share_backend = \"classic\";\n+my $smbd_loglevel = 1;\n+my $username = \"administrator\";\n+my $realm = \"SAMBA.EXAMPLE.COM\";\n+my $dnsname = \"samba.example.com\";\n+my $basedn = \"dc=samba,dc=example,dc=com\";\n+my $password = \"penguin\";\n+my $root = ($ENV{USER} or $ENV{LOGNAME} or `whoami`);\n+my $server = \"localhost\";\n+my $srcdir=\"$RealBin/../..\";\n+-d $prefix or mkdir($prefix) or die(\"Unable to create $prefix\");\n+my $prefix_abs = getcwd().\"/\".$prefix;\n+\n+my $tmpdir = \"$prefix_abs/tmp\";\n+my $etcdir = \"$prefix_abs/etc\";\n+my $piddir = \"$prefix_abs/pid\";\n+my $conffile = \"$etcdir/smb.conf\";\n+my $krb5_config = \"$etcdir/krb5.conf\";\n+my $privatedir = \"$prefix_abs/private\";\n+my $ncalrpcdir = \"$prefix_abs/ncalrpc\";\n+my $lockdir= \"$prefix_abs/lockdir\";\n+\n+my $winbindd_socket_dir = \"$prefix_abs/winbind_socket\";\n+my $configuration = \"--configfile=$conffile\";\n+my $ldapdir = \"$prefix_abs/ldap\";\n+\n+my $tlsdir = \"$privatedir/tls\";\n+\n+(system(\"rm -rf $prefix/*\") == 0) or die(\"Unable to clean up\");\n+mkdir($_) foreach ($privatedir, $etcdir, $piddir, $ncalrpcdir, $lockdir, \n+\t$tmpdir);\n+\n+open(CONFFILE, \">$conffile\");\n+print CONFFILE \"\n [global]\n-\tnetbios name = $NETBIOSNAME\n-\tnetbios aliases = $SERVER\n-\tworkgroup = $DOMAIN\n-\trealm = $REALM\n-\tprivate dir = $PRIVATEDIR\n-\tpid directory = $PIDDIR\n-\tncalrpc dir = $NCALRPCDIR\n-\tlock dir = $LOCKDIR\n-\tshare backend = $SHARE_BACKEND\n-\tsetup directory = $SRCDIR/setup\n-\tjs include = $SRCDIR/scripting/libjs\n-\twinbindd socket directory = $WINBINDD_SOCKET_DIR\n+\tnetbios name = $netbiosname\n+\tnetbios aliases = $server\n+\tworkgroup = $domain\n+\trealm = $realm\n+\tprivate dir = $privatedir\n+\tpid directory = $piddir\n+\tncalrpc dir = $ncalrpcdir\n+\tlock dir = $lockdir\n+\tshare backend = $share_backend\n+\tsetup directory = $srcdir/setup\n+\tjs include = $srcdir/scripting/libjs\n+\twinbindd socket directory = $winbindd_socket_dir\n \tname resolve order = bcast\n \tinterfaces = 127.0.0.1/8\n-\ttls dh params file = $DHFILE\n-\tpanic action = $SRCDIR/script/gdb_backtrace %PID% %PROG%\n+\ttls dh params file = $tlsdir/dhparms.pem\n+\tpanic action = $srcdir/script/gdb_backtrace \\%PID% \\%PROG%\n \twins support = yes\n-\tserver role = $SERVER_ROLE\n+\tserver role = $server_role\n \tmax xmit = 32K\n \tserver max protocol = SMB2\n \tnotify:inotify = false\n@@ -88,42 +91,44 @@\n \tsystem:anonymous = true\n #We don't want to pass our self-tests if the PAC code is wrong\n \tgensec:require_pac = true\n-\tlog level = $SMBD_LOGLEVEL\n+\tlog level = $smbd_loglevel\n \n [tmp]\n-\tpath = $TMPDIR\n+\tpath = $tmpdir\n \tread only = no\n \tntvfs handler = posix\n \tposix:sharedelay = 100000\n-\tposix:eadb = $LOCKDIR/eadb.tdb\n+\tposix:eadb = $lockdir/eadb.tdb\n \n [cifs]\n \tread only = no\n \tntvfs handler = cifs\n-\tcifs:server = $SERVER\n-\tcifs:user = $USERNAME\n-\tcifs:password = $PASSWORD\n-\tcifs:domain = $DOMAIN\n+\tcifs:server = $server\n+\tcifs:user = $username\n+\tcifs:password = $password\n+\tcifs:domain = $domain\n \tcifs:share = tmp\n \n [simple]\n-\tpath = $TMPDIR\n+\tpath = $tmpdir\n \tread only = no\n \tntvfs handler = simple\n \n [cifsposixtestshare]\n \tcopy = simple\n \tntvfs handler = cifsposix   \n-EOF\n+\";\n+close(CONFFILE);\n \n ## Override default share.ldb file\n-rm -f $PRIVATEDIR/share.ldb\n-cat >$PRIVATEDIR/share.ldif<$privatedir/share.ldif\");\n+print LDIF \"\n ### Shares basedn\n-dn: @INDEXLIST\n-@IDXATTR: name\n+dn: \\@INDEXLIST\n+\\@IDXATTR: name\n \n-dn: @ATTRIBUTES\n+dn: \\@ATTRIBUTES\n cn: CASE_INSENSITIVE\n dc: CASE_INSENSITIVE\n name: CASE_INSENSITIVE\n@@ -135,12 +140,12 @@\n objectClass: organizationalUnit\n cn: Shares\n \n-### Default IPC$ Share\n-dn: CN=IPC$,CN=Shares\n+### Default IPC\\$ Share\n+dn: CN=IPC\\$,CN=Shares\n objectClass: top\n objectClass: share\n-cn: IPC$\n-name: IPC$\n+cn: IPC\\$\n+name: IPC\\$\n type: IPC\n path: /tmp\n comment: Remote IPC\n@@ -150,12 +155,12 @@\n browseable: False\n ntvfs-handler: default\n \n-### Default ADMIN$ Share\n-dn: CN=ADMIN$,CN=Shares\n+### Default ADMIN\\$ Share\n+dn: CN=ADMIN\\$,CN=Shares\n objectClass: top\n objectClass: share\n-cn: ADMIN$\n-name: ADMIN$\n+cn: ADMIN\\$\n+name: ADMIN\\$\n type: DISK\n path: /tmp\n comment: Remote Admin\n@@ -171,12 +176,12 @@\n cn: tmp\n name: tmp\n type: DISK\n-path: $TMPDIR\n+path: $tmpdir\n comment: Temp Dir for Tests\n readonly: False\n ntvfs-handler: posix\n posix-sharedelay: 100000\n-posix-eadb: $LOCKDIR/eadb.tdb\n+posix-eadb: $lockdir/eadb.tdb\n \n dn: CN=cifs,CN=Shares\n objectClass: top\n@@ -186,86 +191,97 @@\n type: DISK\n readonly: False\n ntvfs-handler: cifs\n-cifs-server: $SERVER\n-cifs-user: $USERNAME\n-cifs-password: $PASSWORD\n-cifs-domain: $DOMAIN\n+cifs-server: $server\n+cifs-user: $username\n+cifs-password: $password\n+cifs-domain: $domain\n cifs-share: tmp\n-EOF\n-\n-$srcdir/bin/ldbadd -H $PRIVATEDIR/share.ldb < $PRIVATEDIR/share.ldif >/dev/null || exit 1\n-\n-. `dirname $0`/mk-keyblobs.sh\n-\n-cat >$KRB5_CONFIG</dev/null\") == 0 or die(\"Unable to add share ldif\");\n+\n+die (\"Unable to create key blobs\") if\n+\t(system(\"TLSDIR=$tlsdir $RealBin/mk-keyblobs.sh\") != 0);\n+\n+open(KRB5CONF, \">$krb5_config\");\n+print KRB5CONF \"\n+#Generated krb5.conf for $realm\n \n [libdefaults]\n- default_realm = $REALM\n+ default_realm = $realm\n  dns_lookup_realm = false\n  dns_lookup_kdc = false\n  ticket_lifetime = 24h\n  forwardable = yes\n \n [realms]\n- $REALM = {\n-  kdc = 127.0.0.1:88\n-  admin_server = 127.0.0.1:88\n-  default_domain = $DNSNAME\n- }\n- $DNSNAME = {\n-  kdc = 127.0.0.1:88\n-  admin_server = 127.0.0.1:88\n-  default_domain = $DNSNAME\n- }\n- $DOMAIN = {\n-  kdc = 127.0.0.1:88\n-  admin_server = 127.0.0.1:88\n-  default_domain = $DNSNAME\n+ $realm = {\n+  kdc = 127.0.0.1:88\n+  admin_server = 127.0.0.1:88\n+  default_domain = $dnsname\n+ }\n+ $dnsname = {\n+  kdc = 127.0.0.1:88\n+  admin_server = 127.0.0.1:88\n+  default_domain = $dnsname\n+ }\n+ $domain = {\n+  kdc = 127.0.0.1:88\n+  admin_server = 127.0.0.1:88\n+  default_domain = $dnsname\n  }\n \n [appdefaults]\n-\tpkinit_anchors = FILE:$CAFILE\n+\tpkinit_anchors = FILE:$tlsdir/ca.pem\n \n [kdc]\n \tenable-pkinit = true\n-\tpkinit_identity = FILE:$KDCCERTFILE,$KEYFILE\n-\tpkinit_anchors = FILE:$CAFILE\n+\tpkinit_identity = FILE:$tlsdir/kdc.pem,$tlsdir/key.pem\n+\tpkinit_anchors = FILE:$tlsdir/ca.pem\n \n [domain_realm]\n- .$DNSNAME = $REALM\n-EOF\n+ .$dnsname = $realm\n+\";\n+close(KRB5CONF);\n \n #Ensure the config file is valid before we start\n-$srcdir/bin/testparm $CONFIGURATION -v --suppress-prompt >/dev/null 2>&1 || {\n-    echo \"\">&2\n-    echo \"Failed to create configuration!\" >&2\n-    $srcdir/bin/testparm $CONFIGURATION  >&2\n-    exit 1\n-}\n-\n-( $srcdir/bin/testparm $CONFIGURATION -v --suppress-prompt --parameter-name=\"netbios name\" --section-name=global 2> /dev/null | grep -i ^$NETBIOSNAME ) >/dev/null 2>&1 || {\n-    echo \"$?\" >&2\n-    $srcdir/bin/testparm $CONFIGURATION -v --suppress-prompt --parameter-name=\"netbios name\" --section-name=global --suppress-prompt 2> /dev/null | grep -i ^$NETBIOSNAME >&2\n-    echo \"Failed to create configuration!\" >&2\n-    exit 1\n-}\n-\n-PROVISION_OPTIONS=\"$CONFIGURATION --host-name=$NETBIOSNAME --host-ip=127.0.0.1\"\n-PROVISION_OPTIONS=\"$PROVISION_OPTIONS --quiet --domain $DOMAIN --realm $REALM\"\n-PROVISION_OPTIONS=\"$PROVISION_OPTIONS --adminpass $PASSWORD --root=$ROOT\"\n-PROVISION_OPTIONS=\"$PROVISION_OPTIONS --simple-bind-dn=cn=Manager,$BASEDN --password=$PASSWORD --root=$ROOT\"\n-$srcdir/bin/smbscript $srcdir/setup/provision $PROVISION_OPTIONS >&2\n-\n-LDAP_URI=\"ldapi://\"`echo $LDAPDIR/ldapi | sed 's|/|%2F|g'`\n-\n-. `dirname $0`/mk-openldap.sh\n-\n-test -z \"$FEDORA_DS_PREFIX\" || {\n-    . `dirname $0`/mk-fedora-ds.sh\n-}\n-\n-cat >$PRIVATEDIR/wins_config.ldif</dev/null 2>&1\") != 0) {\n+    system(\"$srcdir/bin/testparm $configuration >&2\");\n+    die(\"Failed to create configuration!\");\n+}\n+\n+(system(\"($srcdir/bin/testparm $configuration -v --suppress-prompt --parameter-name=\\\"netbios name\\\" --section-name=global 2> /dev/null | grep -i ^$netbiosname ) >/dev/null 2>&1\") == 0) or die(\"Failed to create configuration!\");\n+\n+my @provision_options = ($configuration);\n+push (@provision_options, \"--host-name=$netbiosname\");\n+push (@provision_options, \"--host-ip=127.0.0.1\");\n+push (@provision_options, \"--quiet\");\n+push (@provision_options, \"--domain $domain\");\n+push (@provision_options, \"--realm $realm\");\n+push (@provision_options, \"--adminpass $password\");\n+push (@provision_options, \"--root=$root\");\n+push (@provision_options, \"--simple-bind-dn=cn=Manager,$basedn\");\n+push (@provision_options, \"--password=$password\");\n+push (@provision_options, \"--root=$root\");\n+\n+(system(\"$srcdir/bin/smbscript $srcdir/setup/provision \" .  join(' ', @provision_options) . \">&2\") == 0) or die(\"Unable to provision\");\n+\n+my $ldap_uri=\"ldapi://\" . `echo $ldapdir/ldapi | sed 's|/|%2F|g'`;\n+my $provision_aci = \"\";\n+\n+if (not defined($opt_ldap)) {\n+} elsif ($opt_ldap eq \"openldap\") {\n+\tmkdir($_) foreach ($ldapdir, \"$ldapdir/db\", \"$ldapdir/db/bdb-logs\", \n+\t\"$ldapdir/db/tmp\");\n+\tsystem(\"$RealBin/mk-openldap.sh\") == 0 or die(\"Unable to create openldap directories\");\n+} elsif ($opt_ldap eq \"fedora\") {\n+    system(\"$RealBin/mk-fedora-ds.sh\") == 0 or die(\"Unable to create fedora ds directories\");\n+\tpush (@provision_options, \"--ldap-module=nsuniqueid\");\n+}\n+\n+open(LDIF, \">$privatedir/wins_config.ldif\");\n+print LDIF \"\n dn: name=TORTURE_6,CN=PARTNERS\n objectClass: wreplPartner\n name: TORTURE_6\n@@ -273,29 +289,29 @@\n pullInterval: 0\n pushChangeCount: 0\n type: 0x3\n-EOF\n-\n-$srcdir/bin/ldbadd -H $PRIVATEDIR/wins_config.ldb < $PRIVATEDIR/wins_config.ldif >/dev/null || exit 1\n-\n-echo \"KRB5_CONFIG=$KRB5_CONFIG\"\n-echo \"PREFIX_ABS=$PREFIX_ABS\"\n-echo \"SLAPD_CONF=$SLAPD_CONF\"\n-echo \"PIDDIR=$PIDDIR\"\n-echo \"SERVER=$SERVER\"\n-echo \"NETBIOSNAME=$NETBIOSNAME\"\n-echo \"LDAP_URI=$LDAP_URI\"\n-echo \"DOMAIN=$DOMAIN\"\n-echo \"USERNAME=$USERNAME\"\n-echo \"REALM=$REALM\"\n-echo \"DNSNAME=$DNSNAME\"\n-echo \"BASEDN=$BASEDN\"\n-echo \"PASSWORD=$PASSWORD\"\n-echo \"SRCDIR=$SRCDIR\"\n-echo \"PREFIX=$PREFIX\"\n-echo \"LDAPDIR=$LDAPDIR\"\n-echo \"CONFFILE=$CONFFILE\"\n-echo \"PROVISION_OPTIONS=$PROVISION_OPTIONS\"\n-echo \"PROVISION_ACI=$PROVISION_ACI\"\n-echo \"WINBINDD_SOCKET_DIR=$WINBINDD_SOCKET_DIR\"\n-echo \"NCALRPCDIR=$NCALRPCDIR\"\n-echo \"CONFIGURATION=$CONFIGURATION\"\n+\";\n+close(LDIF);\n+\n+system(\"$srcdir/bin/ldbadd -H $privatedir/wins_config.ldb < $privatedir/wins_config.ldif >/dev/null\") == 0 or die(\"Unable to add wins configuration\");\n+;\n+print \"KRB5_CONFIG=$krb5_config\\n\";\n+print \"PREFIX_ABS=$prefix_abs\\n\";\n+print \"SLAPD_CONF=$slapd_conf\\n\";\n+print \"PIDDIR=$piddir\\n\";\n+print \"SERVER=$server\\n\";\n+print \"NETBIOSNAME=$netbiosname\\n\";\n+print \"LDAP_URI=$ldap_uri\\n\";\n+print \"DOMAIN=$domain\\n\";\n+print \"USERNAME=$username\\n\";\n+print \"REALM=$realm\\n\";\n+print \"DNSNAME=$dnsname\\n\";\n+print \"BASEDN=$basedn\\n\";\n+print \"PASSWORD=$password\\n\";\n+print \"SRCDIR=$srcdir\\n\";\n+print \"PREFIX=$prefix\\n\";\n+print \"LDAPDIR=$ldapdir\\n\";\n+print \"CONFFILE=$conffile\\n\";\n+print \"PROVISION_OPTIONS=\".join(' ', @provision_options) . \"\\n\";\n+print \"WINBINDD_SOCKET_DIR=$winbindd_socket_dir\\n\";\n+print \"NCALRPCDIR=$ncalrpcdir\\n\";\n+print \"CONFIGURATION=$configuration\\n\";\n\n=== modified file 'source/script/tests/Samba4.pm'\n--- a/source/script/tests/Samba4.pm\t2007-04-16 10:44:26 +0000\n+++ b/source/script/tests/Samba4.pm\t2007-04-16 20:35:19 +0000\n@@ -140,7 +140,7 @@\n \tmy ($self, $prefix, $dcvars) = @_;\n \tmy %ret = ();\n \tprint \"PROVISIONING...\";\n-\topen(IN, \"SERVER_ROLE=\\\"member server\\\" $RealBin/mksamba4server.sh $prefix|\") or die(\"Unable to setup\");\n+\topen(IN, \"$RealBin/mksamba4server.pl --server-role=\\\"member server\\\" $prefix|\") or die(\"Unable to setup\");\n \twhile () {\n \t\tdie (\"Error parsing `$_'\") unless (/^([A-Z0-9a-z_]+)=(.*)$/);\n \t\t$ret{$1} = $2;\n@@ -160,7 +160,7 @@\n \tmy ($self, $prefix) = @_;\n \tmy %ret = ();\n \tprint \"PROVISIONING...\";\n-\topen(IN, \"$RealBin/mksamba4server.sh $prefix|\") or die(\"Unable to setup\");\n+\topen(IN, \"$RealBin/mksamba4server.pl $prefix|\") or die(\"Unable to setup\");\n \twhile () {\n \t\tdie (\"Error parsing `$_'\") unless (/^([A-Z0-9a-z_]+)=(.*)$/);\n \t\t$ret{$1} = $2;\n\n=== modified file 'source/script/tests/mk-fedora-ds.sh'\n--- a/source/script/tests/mk-fedora-ds.sh\t2007-04-04 12:39:44 +0000\n+++ b/source/script/tests/mk-fedora-ds.sh\t2007-04-16 20:35:19 +0000\n@@ -84,8 +84,7 @@\n \n $srcdir/bin/ad2oLschema $CONFIGURATION -H $PRIVATEDIR/sam.ldb --option=convert:target=fedora-ds -I $srcdir/setup/schema-map-fedora-ds-1.0 -O $FEDORA_DS_DIR/schema/99_ad.ldif >&2\n \n-PROVISION_OPTIONS=\"$PROVISION_OPTIONS --ldap-module=nsuniqueid\"\n #it is easier to base64 encode this than correctly escape it:\n # (targetattr = \"*\") (version 3.0;acl \"full access to all by all\";allow (all)(userdn = \"ldap:///anyone\");)\n-PROVISION_ACI=\"--aci=aci:: KHRhcmdldGF0dHIgPSAiKiIpICh2ZXJzaW9uIDMuMDthY2wgImZ1bGwgYWNjZXNzIHRvIGFsbCBieSBhbGwiO2FsbG93IChhbGwpKHVzZXJkbiA9ICJsZGFwOi8vL2FueW9uZSIpOykK\"\n+echo \"PROVISION_ACI=--aci=aci:: KHRhcmdldGF0dHIgPSAiKiIpICh2ZXJzaW9uIDMuMDthY2wgImZ1bGwgYWNjZXNzIHRvIGFsbCBieSBhbGwiO2FsbG93IChhbGwpKHVzZXJkbiA9ICJsZGFwOi8vL2FueW9uZSIpOykK\"\n \n\n=== modified file 'source/script/tests/mk-keyblobs.sh'\n--- a/source/script/tests/mk-keyblobs.sh\t2007-03-05 21:28:55 +0000\n+++ b/source/script/tests/mk-keyblobs.sh\t2007-04-16 20:35:19 +0000\n@@ -1,5 +1,4 @@\n #TLS and PKINIT crypto blobs\n-TLSDIR=$PRIVATEDIR/tls\n DHFILE=$TLSDIR/dhparms.pem\n CAFILE=$TLSDIR/ca.pem\n CERTFILE=$TLSDIR/cert.pem\n\n=== modified file 'source/script/tests/mk-openldap.sh'\n--- a/source/script/tests/mk-openldap.sh\t2007-04-11 05:01:02 +0000\n+++ b/source/script/tests/mk-openldap.sh\t2007-04-16 20:35:19 +0000\n@@ -1,5 +1,6 @@\n SLAPD_CONF=$LDAPDIR/slapd.conf\n export SLAPD_CONF\n+echo \"SLAPD_CONF=$SLAPD_CONF\"\n \n echo \"OPENLDAP_LOGLEVEL=0\"\n OPENLDAP_PIDFILE=$PIDDIR/slapd.pid\n@@ -121,4 +122,3 @@\n     \n PATH=$OLDPATH\n export PATH\n-\n\n=== modified file 'source/torture/local/torture.c'\n--- a/source/torture/local/torture.c\t2007-03-21 15:57:07 +0000\n+++ b/source/torture/local/torture.c\t2007-04-16 20:35:19 +0000\n@@ -47,7 +47,7 @@\n \n \ttorture_assert_ntstatus_ok(tctx, torture_setup_server(mem_ctx, \n \t\t\t\t\t\t\t\t\t\"setupserver-success\",\n-\t\t\t\t\t\t\t\t\t\"./script/tests/mktestdc.sh\",\n+\t\t\t\t\t\t\t\t\t\"./script/tests/mksamba4server.pl\",\n \t\t\t\t\t\t\t\t\t\"./bin/smbd\", &pid),\n \t\t\t\t\t\t\t   \"starting smbd failed\");\n \n\n"}