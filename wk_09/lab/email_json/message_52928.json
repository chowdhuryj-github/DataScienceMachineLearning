{"category": "ham", "to_address": "\"'Robin Hankin'\" <r.hankin@noc.soton.ac.uk>,\n   \"'RHelp help'\" <r-help@stat.math.ethz.ch>", "from_address": "\"Christos Hatzis\" <christos@nuverabio.com>", "subject": "Re: [R] vectorize a function", "body": "How about:\n\nsum(sapply(unique(a), function(x) {b <- which(a==x); sum(M[b, b])}))\n\nHTH\n-Christos\n\nChristos Hatzis, Ph.D.\nNuvera Biosciences, Inc.\n400 West Cummings Park\nSuite 5350\nWoburn, MA 01801\nTel: 781-938-3830\nwww.nuverabio.com\n \n\n> -----Original Message-----\n> From: r-help-bounces@stat.math.ethz.ch \n> [mailto:r-help-bounces@stat.math.ethz.ch] On Behalf Of Robin Hankin\n> Sent: Friday, June 22, 2007 9:28 AM\n> To: RHelp help\n> Subject: [R] vectorize a function\n> \n> Hello everyone\n> \n> suppose I have an integer vector \"a\" of length \"n\" and a \n> symmetric matrix \"M\" of size n-by-n.\n> \n> Vector \"a\" describes a partition of a set of \"n\" elements and \n> matrix M describes a penalty function: row i column j \n> represents the penalty if element i and element j are in the \n> same partition.\n> \n> Toy example follows; the real case is much larger and I need \n> to evaluate my penalty function many times.\n> \n> If a <- c(1,1,2,1,3)  then elements 1,2,4 are in the same \n> partition; element 3 is in a partition on its own and element \n> 5 is in a partition on its own.\n> \n> The total penalty  can be described by the following (ugly)\n> function:\n> \n> f <- function(a,M){\n>    out <- 0\n>    for(i in unique(a)){\n>      out <- out + sum(M[which(a==i),which(a==i)])\n>    }\n>    return(out)\n> }\n> \n> \n> so with\n> \n> M <- matrix(rpois(25,3),5,5)\n> M <- M+t(M)\n> diag(M) <- 0\n> a <- c(1,2,1,1,3)\n> \n> f(a,M) gives the total penalty.\n> \n> \n> QUESTION:  how to rewrite f() so that it has no loop?\n> \n> \n> \n> \n> \n> \n> --\n> Robin Hankin\n> Uncertainty Analyst\n> National Oceanography Centre, Southampton European Way, \n> Southampton SO14 3ZH, UK\n>   tel  023-8059-7743\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide \n> http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n> \n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}