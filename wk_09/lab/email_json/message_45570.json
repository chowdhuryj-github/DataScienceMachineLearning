{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r23406 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_25/source/nsswitch SAMBA_3_0_26/source/nsswitch", "body": "Author: idra\nDate: 2007-06-09 19:29:35 +0000 (Sat, 09 Jun 2007)\nNew Revision: 23406\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23406\n\nLog:\n\nEvn if not strictly currently necessary do check for correct\ninit also in idmap_nss and idmap_passdb for coherency and to\nprevent errors in future if we change the init functions to\nactually do something and not just return NT_STATUS_OK\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/idmap_nss.c\n   branches/SAMBA_3_0/source/nsswitch/idmap_passdb.c\n   branches/SAMBA_3_0_25/source/nsswitch/idmap_nss.c\n   branches/SAMBA_3_0_25/source/nsswitch/idmap_passdb.c\n   branches/SAMBA_3_0_26/source/nsswitch/idmap_nss.c\n   branches/SAMBA_3_0_26/source/nsswitch/idmap_passdb.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/idmap_nss.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/idmap_nss.c\t2007-06-09 19:25:54 UTC (rev 23405)\n+++ branches/SAMBA_3_0/source/nsswitch/idmap_nss.c\t2007-06-09 19:29:35 UTC (rev 23406)\n@@ -45,6 +45,10 @@\n \tTALLOC_CTX *ctx;\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tctx = talloc_new(dom);\n \tif ( ! ctx) {\n \t\tDEBUG(0, (\"Out of memory!\\n\"));\n@@ -131,6 +135,10 @@\n \tTALLOC_CTX *ctx;\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tctx = talloc_new(dom);\n \tif ( ! ctx) {\n \t\tDEBUG(0, (\"Out of memory!\\n\"));\n\nModified: branches/SAMBA_3_0/source/nsswitch/idmap_passdb.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/idmap_passdb.c\t2007-06-09 19:25:54 UTC (rev 23405)\n+++ branches/SAMBA_3_0/source/nsswitch/idmap_passdb.c\t2007-06-09 19:29:35 UTC (rev 23406)\n@@ -43,6 +43,10 @@\n {\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tfor (i = 0; ids[i]; i++) {\n \n \t\t/* unmapped by default */\n@@ -75,6 +79,10 @@\n {\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tfor (i = 0; ids[i]; i++) {\n \t\tenum lsa_SidType type;\n \t\tunion unid_t id;\n\nModified: branches/SAMBA_3_0_25/source/nsswitch/idmap_nss.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/idmap_nss.c\t2007-06-09 19:25:54 UTC (rev 23405)\n+++ branches/SAMBA_3_0_25/source/nsswitch/idmap_nss.c\t2007-06-09 19:29:35 UTC (rev 23406)\n@@ -45,6 +45,10 @@\n \tTALLOC_CTX *ctx;\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tctx = talloc_new(dom);\n \tif ( ! ctx) {\n \t\tDEBUG(0, (\"Out of memory!\\n\"));\n@@ -131,6 +135,10 @@\n \tTALLOC_CTX *ctx;\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tctx = talloc_new(dom);\n \tif ( ! ctx) {\n \t\tDEBUG(0, (\"Out of memory!\\n\"));\n\nModified: branches/SAMBA_3_0_25/source/nsswitch/idmap_passdb.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/idmap_passdb.c\t2007-06-09 19:25:54 UTC (rev 23405)\n+++ branches/SAMBA_3_0_25/source/nsswitch/idmap_passdb.c\t2007-06-09 19:29:35 UTC (rev 23406)\n@@ -43,6 +43,10 @@\n {\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tfor (i = 0; ids[i]; i++) {\n \n \t\t/* unmapped by default */\n@@ -75,6 +79,10 @@\n {\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tfor (i = 0; ids[i]; i++) {\n \t\tenum lsa_SidType type;\n \t\tunion unid_t id;\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/idmap_nss.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/idmap_nss.c\t2007-06-09 19:25:54 UTC (rev 23405)\n+++ branches/SAMBA_3_0_26/source/nsswitch/idmap_nss.c\t2007-06-09 19:29:35 UTC (rev 23406)\n@@ -45,6 +45,10 @@\n \tTALLOC_CTX *ctx;\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tctx = talloc_new(dom);\n \tif ( ! ctx) {\n \t\tDEBUG(0, (\"Out of memory!\\n\"));\n@@ -131,6 +135,10 @@\n \tTALLOC_CTX *ctx;\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tctx = talloc_new(dom);\n \tif ( ! ctx) {\n \t\tDEBUG(0, (\"Out of memory!\\n\"));\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/idmap_passdb.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/idmap_passdb.c\t2007-06-09 19:25:54 UTC (rev 23405)\n+++ branches/SAMBA_3_0_26/source/nsswitch/idmap_passdb.c\t2007-06-09 19:29:35 UTC (rev 23406)\n@@ -43,6 +43,10 @@\n {\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tfor (i = 0; ids[i]; i++) {\n \n \t\t/* unmapped by default */\n@@ -75,6 +79,10 @@\n {\n \tint i;\n \n+\tif (! dom->initialized) {\n+\t\treturn NT_STATUS_UNSUCCESSFUL;\n+\t}\n+\n \tfor (i = 0; ids[i]; i++) {\n \t\tenum lsa_SidType type;\n \t\tunion unid_t id;\n\n"}