{"category": "ham", "to_address": "Cody_Hamilton@Edwards.com", "from_address": "Frank E Harrell Jr <f.harrell@vanderbilt.edu>", "subject": "Re: [R] help comparing two median with R", "body": "Cody_Hamilton@Edwards.com wrote:\n> Has anyone proposed using a bootstrap for Pedro's problem?\n> \n> What about taking a boostrap sample from x, a boostrap sample from y, take\n> the difference in the medians for these two bootstrap samples, repeat the\n> process 1,000 times and calculate the 95th percentiles of the 1,000\n> computed differences?  You would get a CI on the difference between the\n> medians for these two groups, with which you could determine whether the\n> difference was greater/less than zero.  Too crude?\n> \n> Regards,\n>    -Cody\n\nAs hinted at by Brian Ripley, the following code will approximate that. \n  It gets the nonparametric confidence interval for the median and \nsolves for the variance that would give the same confidence interval \nwidth if normality of the median held.\n\n  g <- function(y) {\n     y <- sort(y[!is.na(y)])\n     n <- length(y)\n     if(n < 4) return(c(median=median(y),q1=NA,q3=NA,variance=NA))\n     qu <- quantile(y, c(.5,.25,.75))\n     names(qu) <- NULL\n     r <- pmin(qbinom(c(.025,.975), n, .5) + 1, n)  ## Exact 0.95 C.L.\n     w <- y[r[2]] - y[r[1]]                         ## Width of C.L.\n     var.med <- ((w/1.96)^2)/4      ## Approximate variance of median\n     c(median=qu[1], q1=qu[2], q3=qu[3], variance=var.med)\n   }\n\nRun g separately by group, add the two variances, and take the square \nroot to approximate the variance of the difference in medians and get a \nconfidence interval.\n\nFrank\n> \n> \n> \n> \n>                                                                            \n>              Frank E Harrell                                               \n>              Jr                                                            \n>                            bilt.edu>                 Thomas Lumley                       \n>              Sent by:                            \n>              r-help-bounces@st                                          cc \n>              at.math.ethz.ch           r-help@stat.math.ethz.ch            \n>                                                                    Subject \n>                                        Re: [R] help comparing two median   \n>              04/18/2007 05:02          with R                              \n>              AM                                                            \n>                                                                            \n>                                                                            \n>                                                                            \n>                                                                            \n>                                                                            \n> \n> \n> \n> \n> Thomas Lumley wrote:\n>> On Tue, 17 Apr 2007, Frank E Harrell Jr wrote:\n>>\n>>> The points that Thomas and Brian have made are certainly correct, if\n>>> one is truly interested in testing for differences in medians or\n>>> means.  But the Wilcoxon test provides a valid test of x > y more\n>>> generally.  The test is consonant with the Hodges-Lehmann estimator:\n>>> the median of all possible differences between an X and a Y.\n>>>\n>> Yes, but there is no ordering of distributions (taken one at a time)\n>> that agrees with the Wilcoxon two-sample test, only orderings of pairs\n>> of distributions.\n>>\n>> The Wilcoxon test provides a test of x>y if it is known a priori that\n>> the two distributions are stochastically ordered, but not under weaker\n>> assumptions.  Otherwise you can get x>y>z>x. This is in contrast to the\n>> t-test, which orders distributions (by their mean) whether or not they\n>> are stochastically ordered.\n>>\n>> Now, it is not unreasonable to say that the problems are unlikely to\n>> occur very often and aren't worth worrying too much about. It does imply\n>> that it cannot possibly be true that there is any summary of a single\n>> distribution that the Wilcoxon test tests for (and the same is true for\n>> other two-sample rank tests, eg the logrank test).\n>>\n>> I know Frank knows this, because I gave a talk on it at Vanderbilt, but\n>> most people don't know it. (I thought for a long time that the Wilcoxon\n>> rank-sum test was a test for the median pairwise mean, which is actually\n>> the R-estimator corresponding to the *one*-sample Wilcoxon test).\n>>\n>>\n>>     -thomas\n>>\n> \n> Thanks for your note Thomas.  I do feel that the problems you have\n> rightly listed occur infrequently and that often I only care about two\n> groups.  Rank tests generally are good at relatives, not absolutes.  We\n> have an efficient test (Wilcoxon) for relative shift but for estimating\n> an absolute one-sample quantity (e.g., median) the nonparametric\n> estimator is not very efficient.  Ironically there is an exact\n> nonparametric confidence interval for the median (unrelated to Wilcoxon)\n> but none exists for the mean.\n> \n> Cheers,\n> Frank\n> --\n> Frank E Harrell Jr   Professor and Chair           School of Medicine\n>                       Department of Biostatistics   Vanderbilt University\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide\n> http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n> \n\n\n-- \nFrank E Harrell Jr   Professor and Chair           School of Medicine\n                      Department of Biostatistics   Vanderbilt University\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}