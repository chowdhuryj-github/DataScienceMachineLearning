{"category": "ham", "to_address": "beginners@perl.org", "from_address": "\"John W. Krahn\" <krahnj@telus.net>", "subject": "Re: Query an IP from file", "body": "Jeff Pang wrote:\n\n> Hello,\n\nHello,\n\n> I have a text file which contains lots of IPs,like:\n> \n> 58.253.0.0/16;\n> 58.254.0.0/16;\n> 58.255.0.0/16;\n> 60.0.0.0/16;\n> 60.1.0.0/16;\n> 60.10.0.0/16;\n> 60.16.0.0/16;\n> 60.17.0.0/16;\n> 60.18.0.0/16;\n> 60.19.0.0/16;\n> 60.2.0.0/16;\n> 60.20.0.0/16;\n> 60.21.0.0/16;\n> 60.22.0.0/16;\n> 60.23.0.0/16;\n> 60.3.0.0/16;\n> \n> My question is,given an IP,ie 59.32.232.33,how can I know it exists in\n> this file or not?\n> Is there a module already?thanks.\n\nThis may help:\n\n$ perl -le'\nuse warnings;\nuse strict;\nuse Socket;\n\nmy $file = < ) {\n    next unless /^(\\d+\\.\\d+\\.\\d+\\.\\d+)\\/(\\d+)/;\n    my $mask = \"\\0\\0\\0\\0\";\n    vec( $mask, $_, 1 ) = 1 for 0 .. ( 31 - $2 );\n    push @ips, { ip => inet_aton( $1 ), mask => $mask };\n    }\n\nfor my $ip ( qw/ 59.32.232.33 60.19.232.33 / ) {\n    for my $cmp ( @ips ) {\n        if ( ( inet_aton( $ip ) & $cmp->{ mask } ) eq $cmp->{ ip } ) {\n            print \"$ip exists in file.\"\n            }\n        }\n    }\n'\n60.19.232.33 exists in file.\n\n\n\n\nJohn\n\n-- \nTo unsubscribe, e-mail: beginners-unsubscribe@perl.org\nFor additional commands, e-mail: beginners-help@perl.org\nhttp://learn.perl.org/\n\n\n"}