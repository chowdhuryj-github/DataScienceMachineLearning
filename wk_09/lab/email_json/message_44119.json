{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 494: validate vnn on node flags change in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 494\nrevision-id: tridge@samba.org-20070607081314-uvsnbz2gwbqsc0am\nparent: tridge@samba.org-20070607080738-9hj4i5vn18ur2987\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Thu 2007-06-07 18:13:14 +1000\nmessage:\n  validate vnn on node flags change\nmodified:\n  common/ctdb_daemon.c           ctdb_daemon.c-20070409200331-3el1kqgdb9m4ib0g-1\n=== modified file 'common/ctdb_daemon.c'\n--- a/common/ctdb_daemon.c\t2007-06-07 05:18:55 +0000\n+++ b/common/ctdb_daemon.c\t2007-06-07 08:13:14 +0000\n@@ -44,10 +44,16 @@\n \t\treturn;\n \t}\n \n+\tif (!ctdb_validate_vnn(ctdb, c->vnn)) {\n+\t\tDEBUG(0,(\"Bad vnn %u in flag_change_handler\\n\", c->vnn));\n+\t\treturn;\n+\t}\n+\n \t/* don't get the disconnected flag from the other node */\n \tctdb->nodes[c->vnn]->flags = \n \t\t(ctdb->nodes[c->vnn]->flags&NODE_FLAGS_DISCONNECTED) \n \t\t| (c->flags & ~NODE_FLAGS_DISCONNECTED);\t\n+\tDEBUG(2,(\"Node flags for node %u are now 0x%x\\n\", c->vnn, ctdb->nodes[c->vnn]->flags));\n }\n \n /* called when the \"startup\" event script has finished */\n\n"}