{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23244 - in branches: SAMBA_3_0/source/include\n\tSAMBA_3_0/source/nsswitch SAMBA_3_0/source/passdb\n\tSAMBA_3_0_26/source/include SAMBA_3_0_26/source/nsswitch\n\tSAMBA_3_0_26/source/passdb", "body": "Author: jerry\nDate: 2007-05-30 19:47:35 +0000 (Wed, 30 May 2007)\nNew Revision: 23244\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23244\n\nLog:\nFix loop with nscd and NSS recusive calls.\n\n> Here's the problem I hit:\n>\n> getgrnam(\"foo\") -> nscd -> NSS -> winbindd ->\n>   winbindd_passdb.c:nam_to_sid() -> lookup_global_sam_name() ->\n>   getgrnam(\"foo\") -> nscd -> ....\n>\n> This is in the SAMBA_3_0 specifically but in theory could happen\n> SAMBA_3_0_25 (or 26) for an unknown group.\n>\n> The attached patch passes down enough state for the\n> name_to_sid() call to be able to determine the originating\n> winbindd cmd that came into the parent.  So we can avoid\n> making more NSS calls if the original call came in trough NSS\n> so we don't deadlock ?  But you should still service\n> lookupname() calls which are needed for example when\n> doing the token access checks for a \"valid groups\" from\n> smb.conf.\n>\n> I've got this in testing now.  The problem has shown up with the\n> DsProvider on OS X and with nscd on SOlaris and Linux.\n\n\nModified:\n   branches/SAMBA_3_0/source/include/smb.h\n   branches/SAMBA_3_0/source/nsswitch/winbindd.h\n   branches/SAMBA_3_0/source/nsswitch/winbindd_async.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_group.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_nss.h\n   branches/SAMBA_3_0/source/nsswitch/winbindd_passdb.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_reconnect.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_rpc.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_sid.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_user.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_util.c\n   branches/SAMBA_3_0/source/passdb/lookup_sid.c\n   branches/SAMBA_3_0_26/source/include/smb.h\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd.h\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_async.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_cache.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_group.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_nss.h\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_passdb.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_reconnect.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_rpc.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_sid.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_user.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_util.c\n   branches/SAMBA_3_0_26/source/passdb/lookup_sid.c\n\n\nChangeset:\nSorry, the patch is too large (639 lines) to include; please use WebSVN to see it!\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23244\n\n"}