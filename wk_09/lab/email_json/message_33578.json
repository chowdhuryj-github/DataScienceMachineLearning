{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r23034 - in\n\tbranches/SAMBA_4_0/source/auth/credentials: .", "body": "Author: abartlet\nDate: 2007-05-21 11:57:56 +0000 (Mon, 21 May 2007)\nNew Revision: 23034\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23034\n\nLog:\nThanks to metze for providing some vital clues in the 'kerberos ccache\non credentials don't do anything' bug.\n\nThe problem was simple, we didn't set the ccache as having been\ninitialised, so we always created a new one.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/auth/credentials/credentials_krb5.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/auth/credentials/credentials_krb5.c\n===================================================================\n--- branches/SAMBA_4_0/source/auth/credentials/credentials_krb5.c\t2007-05-21 09:15:27 UTC (rev 23033)\n+++ branches/SAMBA_4_0/source/auth/credentials/credentials_krb5.c\t2007-05-21 11:57:56 UTC (rev 23034)\n@@ -247,6 +247,9 @@\n \t\t*_ccc = ccc;\n \t}\n \n+\tcred->ccache_obtained = (MAX(MAX(cred->principal_obtained, \n+\t\t\t\t\t cred->username_obtained), \n+\t\t\t\t     cred->password_obtained));\n \treturn ret;\n }\n \n@@ -259,8 +262,9 @@\n \t\tcli_credentials_set_machine_account(cred);\n \t}\n \n-\tif (cred->ccache_obtained >= (MAX(cred->principal_obtained, \n-\t\t\t\t\t  cred->username_obtained))) {\n+\tif (cred->ccache_obtained >=(MAX(MAX(cred->principal_obtained, \n+\t\t\t\t\t     cred->username_obtained), \n+\t\t\t\t\t cred->password_obtained))) {\n \t\t*ccc = cred->ccache;\n \t\treturn 0;\n \t}\n\n"}