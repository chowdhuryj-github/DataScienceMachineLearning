{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r23032 - in\n\tbranches/SAMBA_4_0/source/scripting/libjs: .", "body": "Author: abartlet\nDate: 2007-05-21 08:33:22 +0000 (Mon, 21 May 2007)\nNew Revision: 23032\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23032\n\nLog:\nRemove calls to println(), and ensure we print the ldb errstring().\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/scripting/libjs/provision.js\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/scripting/libjs/provision.js\n===================================================================\n--- branches/SAMBA_4_0/source/scripting/libjs/provision.js\t2007-05-21 07:27:24 UTC (rev 23031)\n+++ branches/SAMBA_4_0/source/scripting/libjs/provision.js\t2007-05-21 08:33:22 UTC (rev 23032)\n@@ -140,9 +140,9 @@\n /* the ldb is in bad shape, possibly due to being built from an\n    incompatible previous version of the code, so delete it\n    completely */\n-function ldb_delete(ldb)\n+function ldb_delete(info, ldb)\n {\n-\tprintln(\"Deleting \" + ldb.filename);\n+\tinfo.message(\"Deleting \" + ldb.filename + \"\\n\");\n \tvar lp = loadparm_init();\n \tsys.unlink(sprintf(\"%s/%s\", lp.get(\"private dir\"), ldb.filename));\n \tldb.transaction_cancel();\n@@ -155,7 +155,7 @@\n /*\n   erase an ldb, removing all records\n */\n-function ldb_erase(ldb)\n+function ldb_erase(info, ldb)\n {\n \tvar res;\n \n@@ -173,7 +173,7 @@\n      \tvar res = ldb.search(\"(&(|(objectclass=*)(dn=*))(!(dn=@BASEINFO)))\", basedn, ldb.SCOPE_SUBTREE, attrs);\n \tvar i;\n \tif (res.error != 0) {\n-\t\tldb_delete(ldb);\n+\t\tldb_delete(info, ldb);\n \t\treturn;\n \t}\n \tfor (i=0;i<res.msgs.length;i++) {\n@@ -182,7 +182,7 @@\n \n      \tvar res = ldb.search(\"(&(|(objectclass=*)(dn=*))(!(dn=@BASEINFO)))\", basedn, ldb.SCOPE_SUBTREE, attrs);\n \tif (res.error != 0 || res.msgs.length != 0) {\n-\t\tldb_delete(ldb);\n+\t\tldb_delete(info, ldb);\n \t\treturn;\n \t}\n \tassert(res.msgs.length == 0);\n@@ -260,7 +260,7 @@\n \tldb.transaction_start();\n \n \tif (erase) {\n-\t\tldb_erase(ldb);\t\n+\t\tldb_erase(info, ldb);\t\n \t}\n \treturn ldb;\n }\n@@ -571,7 +571,7 @@\n \tvar modify_ok = setup_ldb_modify(\"provision_basedn_modify.ldif\", info, samdb);\n \tif (!modify_ok) {\n \t\tif (!add_ok) {\n-\t\t\tmessage(\"Failed to both add and modify \" + subobj.DOMAINDN + \" in target \" + subobj.DOMAINDN_LDB + \"\\n\");\n+\t\t\tmessage(\"Failed to both add and modify \" + subobj.DOMAINDN + \" in target \" + subobj.DOMAINDN_LDB + \": \" + samdb.errstring() + \"\\n\");\n \t\t\tmessage(\"Perhaps you need to run the provision script with the --ldap-base-dn option, and add this record to the backend manually\\n\"); \n \t\t};\n \t\tassert(modify_ok);\n@@ -583,7 +583,8 @@\n \tvar modify_ok = setup_ldb_modify(\"provision_configuration_basedn_modify.ldif\", info, samdb);\n \tif (!modify_ok) {\n \t\tif (!add_ok) {\n-\t\t\tmessage(\"Failed to both add and modify the configuration container\\n\");\n+\t\t\tmessage(\"Failed to both add and modify configuration dn: \" + samdb.errstring() + \"\\n\");\n+\t\t\tmessage(\"Perhaps you need to run the provision script with the --ldap-base-dn option, and add this record to the backend manually\\n\"); \n \t\t\tassert(modify_ok);\n \t\t}\n \t\tassert(modify_ok);\n@@ -595,7 +596,8 @@\n \tvar modify_ok = setup_ldb_modify(\"provision_schema_basedn_modify.ldif\", info, samdb);\n \tif (!modify_ok) {\n \t\tif (!add_ok) {\n-\t\t\tmessage(\"Failed to both add and modify the schema container: \" + samdb.errstring() + \"\\n\");\n+\t\t\tmessage(\"Failed to both add and modify schema dn: + samdb.errstring() + \"\\n\");\n+\t\t\tmessage(\"Perhaps you need to run the provision script with the --ldap-base-dn option, and add this record to the backend manually\\n\"); \n \t\t\tassert(modify_ok);\n \t\t}\n \t\tmessage(\"Failed to modify the schema container: \" + samdb.errstring() + \"\\n\");\n\n"}