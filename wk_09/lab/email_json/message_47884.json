{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r23491 - in\n\tbranches/SAMBA_4_0/source/torture/raw: .", "body": "Author: vlendec\nDate: 2007-06-14 13:01:58 +0000 (Thu, 14 Jun 2007)\nNew Revision: 23491\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23491\n\nLog:\nSplit out the RENAME trans2 call into a separate test\n\nModified:\n   branches/SAMBA_4_0/source/torture/raw/setfileinfo.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/torture/raw/setfileinfo.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/raw/setfileinfo.c\t2007-06-14 12:33:40 UTC (rev 23490)\n+++ branches/SAMBA_4_0/source/torture/raw/setfileinfo.c\t2007-06-14 13:01:58 UTC (rev 23491)\n@@ -424,8 +424,71 @@\n \n \tCHECK_CALL_PATH(MODE_INFORMATION, NT_STATUS_OK);\n \tCHECK_VALUE(MODE_INFORMATION, mode_information, mode, 0);\n-#if 1\n-\tprintf(\"finally the rename_information level\\n\");\n+\n+#if 0\n+\tprintf(\"test unix_basic level\\n\");\n+\tCHECK_CALL_FNUM(UNIX_BASIC, NT_STATUS_OK);\n+\tCHECK_CALL_PATH(UNIX_BASIC, NT_STATUS_OK);\n+\n+\tprintf(\"test unix_link level\\n\");\n+\tCHECK_CALL_FNUM(UNIX_LINK, NT_STATUS_OK);\n+\tCHECK_CALL_PATH(UNIX_LINK, NT_STATUS_OK);\n+#endif\n+\n+done:\n+\tsmb_raw_exit(cli->session);\n+\tsmbcli_close(cli->tree, fnum);\n+\tif (NT_STATUS_IS_ERR(smbcli_unlink(cli->tree, fnum_fname))) {\n+\t\tprintf(\"Failed to delete %s - %s\\n\", fnum_fname, smbcli_errstr(cli->tree));\n+\t}\n+\tif (NT_STATUS_IS_ERR(smbcli_unlink(cli->tree, path_fname))) {\n+\t\tprintf(\"Failed to delete %s - %s\\n\", path_fname, smbcli_errstr(cli->tree));\n+\t}\n+\n+\ttorture_close_connection(cli);\n+\ttalloc_free(mem_ctx);\n+\treturn ret;\n+}\n+\n+/*\n+ * basic testing of all RAW_SFILEINFO_RENAME call\n+ */\n+BOOL torture_raw_sfileinfo_rename(struct torture_context *torture)\n+{\n+\tstruct smbcli_state *cli;\n+\tBOOL ret = True;\n+\tTALLOC_CTX *mem_ctx;\n+\tint fnum_saved, d_fnum, fnum2, fnum = -1;\n+\tchar *fnum_fname;\n+\tchar *fnum_fname_new;\n+\tchar *path_fname;\n+\tchar *path_fname_new;\n+\tunion smb_fileinfo finfo1, finfo2;\n+\tunion smb_setfileinfo sfinfo;\n+\tNTSTATUS status, status2;\n+\tconst char *call_name;\n+\tBOOL check_fnum;\n+\tint n = time(NULL) % 100;\n+\t\n+\tasprintf(&path_fname, BASEDIR \"\\\\fname_test_%d.txt\", n);\n+\tasprintf(&path_fname_new, BASEDIR \"\\\\fname_test_new_%d.txt\", n);\n+\tasprintf(&fnum_fname, BASEDIR \"\\\\fnum_test_%d.txt\", n);\n+\tasprintf(&fnum_fname_new, BASEDIR \"\\\\fnum_test_new_%d.txt\", n);\n+\n+\tif (!torture_open_connection(&cli, 0)) {\n+\t\treturn False;\n+\t}\n+\n+\tmem_ctx = talloc_init(\"torture_sfileinfo\");\n+\n+\tif (!torture_setup_dir(cli, BASEDIR)) {\n+\t\treturn False;\n+\t}\n+\n+\tRECREATE_BOTH;\n+\n+\tZERO_STRUCT(sfinfo);\n+\n \tsmbcli_close(cli->tree, create_complex_file(cli, mem_ctx, fnum_fname_new));\n \tsmbcli_close(cli->tree, create_complex_file(cli, mem_ctx, path_fname_new));\n \n@@ -506,18 +569,7 @@\n \tsfinfo.rename_information.in.root_fid = d_fnum;\n \tCHECK_CALL_FNUM(RENAME_INFORMATION, NT_STATUS_INVALID_PARAMETER);\n \tCHECK_STR(NAME_INFO, name_info, fname.s, fnum_fname);\n-#endif\n \n-#if 0\n-\tprintf(\"test unix_basic level\\n\");\n-\tCHECK_CALL_FNUM(UNIX_BASIC, NT_STATUS_OK);\n-\tCHECK_CALL_PATH(UNIX_BASIC, NT_STATUS_OK);\n-\n-\tprintf(\"test unix_link level\\n\");\n-\tCHECK_CALL_FNUM(UNIX_LINK, NT_STATUS_OK);\n-\tCHECK_CALL_PATH(UNIX_LINK, NT_STATUS_OK);\n-#endif\n-\n done:\n \tsmb_raw_exit(cli->session);\n \tsmbcli_close(cli->tree, fnum);\n@@ -533,7 +585,6 @@\n \treturn ret;\n }\n \n-\n /* \n    look for the w2k3 setpathinfo STANDARD bug\n */\n\n"}