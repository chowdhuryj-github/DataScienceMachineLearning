{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r22467 - in branches/SAMBA_3_0/source: .", "body": "Author: gd\nDate: 2007-04-22 21:17:49 +0000 (Sun, 22 Apr 2007)\nNew Revision: 22467\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22467\n\nLog:\nAdding configure check for -Werror-implicit-function-declaration and use it in\n-enable-developer.\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/configure.in\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/configure.in\n===================================================================\n--- branches/SAMBA_3_0/source/configure.in\t2007-04-22 20:15:00 UTC (rev 22466)\n+++ branches/SAMBA_3_0/source/configure.in\t2007-04-22 21:17:49 UTC (rev 22467)\n@@ -399,7 +399,7 @@\n AC_ARG_ENABLE(developer, [  --enable-developer      Turn on developer warnings and debugging (default=no)],\n     [if eval \"test x$enable_developer = xyes\"; then\n         developer=yes\n-    \tCFLAGS=\"${CFLAGS} -gstabs -Wall -Wshadow -Wstrict-prototypes -Wpointer-arith -Wcast-align -Wwrite-strings -DDEBUG_PASSWORD -DDEVELOPER\"\n+    \tDEVELOPER_CFLAGS=\"-gstabs -Wall -Wshadow -Wstrict-prototypes -Wpointer-arith -Wcast-align -Wwrite-strings -DDEBUG_PASSWORD -DDEVELOPER\"\n \t# Add -Wdeclaration-after-statement if compiler supports it\n \tAC_CACHE_CHECK(\n           [that the C compiler understands -Wdeclaration-after-statement],\n@@ -414,8 +414,25 @@\n \t    samba_cv_HAVE_Wdeclaration_after_statement=cross)\n        ])\n        if test x\"$samba_cv_HAVE_Wdeclaration_after_statement\" = x\"yes\"; then\n-\t    CFLAGS=\"${CFLAGS} -Wdeclaration-after-statement\"\n+\t    DEVELOPER_CFLAGS=\"${DEVELOPER_CFLAGS} -Wdeclaration-after-statement\"\n        fi\n+\t# here\n+\t#-Werror-implicit-function-declaration\n+\tAC_CACHE_CHECK(\n+          [that the C compiler understands -Werror-implicit-function-declaration],\n+          samba_cv_HAVE_Werror_implicit_function_declaration, [\n+\t  AC_TRY_RUN_STRICT([\n+\t    int main(void)\n+\t    {\n+\t    \treturn 0;\n+\t    }],[-Werror-implicit-function-declaration],[$CPPFLAGS],[$LDFLAGS],\n+\t    samba_cv_HAVE_Werror_implicit_function_declaration=yes,\n+\t    samba_cv_HAVE_Werror_implicit_function_declaration=no,\n+\t    samba_cv_HAVE_Werror_implicit_function_declaration=cross)\n+       ])\n+       if test x\"$samba_cv_HAVE_Werror_implicit_function_declaration\" = x\"yes\"; then\n+\t    DEVELOPER_CFLAGS=\"${DEVELOPER_CFLAGS} -Werror-implicit-function-declaration\"\n+       fi\n     fi])\n \n AC_ARG_ENABLE(krb5developer, [  --enable-krb5developer  Turn on developer warnings and debugging, except -Wstrict-prototypes (default=no)],\n@@ -6287,6 +6304,11 @@\n \t   AC_MSG_ERROR([summary failure. Aborting config]); exit 1;,\n \t   AC_MSG_WARN([cannot run when cross-compiling]))\n \n+dnl Merge in developer cflags from now on\n+if test x\"$developer\" = x\"yes\"; then\n+    CFLAGS=\"${CFLAGS} ${DEVELOPER_CFLAGS}\"\n+fi\n+\n builddir=`pwd`\n AC_SUBST(builddir)\n \n\n"}