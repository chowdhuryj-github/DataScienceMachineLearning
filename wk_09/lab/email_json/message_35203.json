{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r23107 - in branches: SAMBA_3_0/source/smbd\n\tSAMBA_3_0_25/source/smbd SAMBA_3_0_26/source/smbd", "body": "Author: jra\nDate: 2007-05-24 01:57:02 +0000 (Thu, 24 May 2007)\nNew Revision: 23107\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23107\n\nLog:\nFix renames on file descriptors that are supposed to overwrite the\ntarget. Needs merging for 3.0.25a (sorry).\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/smbd/reply.c\n   branches/SAMBA_3_0_25/source/smbd/reply.c\n   branches/SAMBA_3_0_26/source/smbd/reply.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/smbd/reply.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/reply.c\t2007-05-24 00:13:24 UTC (rev 23106)\n+++ branches/SAMBA_3_0/source/smbd/reply.c\t2007-05-24 01:57:02 UTC (rev 23107)\n@@ -4245,9 +4245,10 @@\n \tZERO_STRUCT(sbuf);\n \n \tstatus = unix_convert(conn, newname, False, newname_last_component, &sbuf);\n-\t/* We expect this to be NT_STATUS_OBJECT_PATH_NOT_FOUND */\n-\tif (!NT_STATUS_EQUAL(NT_STATUS_OBJECT_PATH_NOT_FOUND, status)) {\n-\t\treturn NT_STATUS_OBJECT_NAME_COLLISION;\n+\n+\t/* If an error we expect this to be NT_STATUS_OBJECT_PATH_NOT_FOUND */\n+\n+\tif (!NT_STATUS_IS_OK(status) && !NT_STATUS_EQUAL(NT_STATUS_OBJECT_PATH_NOT_FOUND, status)) {\n \t\treturn status;\n \t}\n \n\nModified: branches/SAMBA_3_0_25/source/smbd/reply.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/smbd/reply.c\t2007-05-24 00:13:24 UTC (rev 23106)\n+++ branches/SAMBA_3_0_25/source/smbd/reply.c\t2007-05-24 01:57:02 UTC (rev 23107)\n@@ -4195,9 +4195,10 @@\n \tZERO_STRUCT(sbuf);\n \n \tstatus = unix_convert(conn, newname, False, newname_last_component, &sbuf);\n-\t/* We expect this to be NT_STATUS_OBJECT_PATH_NOT_FOUND */\n-\tif (!NT_STATUS_EQUAL(NT_STATUS_OBJECT_PATH_NOT_FOUND, status)) {\n-\t\treturn NT_STATUS_OBJECT_NAME_COLLISION;\n+\n+\t/* If an error we expect this to be NT_STATUS_OBJECT_PATH_NOT_FOUND */\n+\n+\tif (!NT_STATUS_IS_OK(status) && !NT_STATUS_EQUAL(NT_STATUS_OBJECT_PATH_NOT_FOUND, status)) {\n \t\treturn status;\n \t}\n \n\nModified: branches/SAMBA_3_0_26/source/smbd/reply.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/smbd/reply.c\t2007-05-24 00:13:24 UTC (rev 23106)\n+++ branches/SAMBA_3_0_26/source/smbd/reply.c\t2007-05-24 01:57:02 UTC (rev 23107)\n@@ -4243,9 +4243,10 @@\n \tZERO_STRUCT(sbuf);\n \n \tstatus = unix_convert(conn, newname, False, newname_last_component, &sbuf);\n-\t/* We expect this to be NT_STATUS_OBJECT_PATH_NOT_FOUND */\n-\tif (!NT_STATUS_EQUAL(NT_STATUS_OBJECT_PATH_NOT_FOUND, status)) {\n-\t\treturn NT_STATUS_OBJECT_NAME_COLLISION;\n+\n+\t/* If an error we expect this to be NT_STATUS_OBJECT_PATH_NOT_FOUND */\n+\n+\tif (!NT_STATUS_IS_OK(status) && !NT_STATUS_EQUAL(NT_STATUS_OBJECT_PATH_NOT_FOUND, status)) {\n \t\treturn status;\n \t}\n \n\n"}