{"category": "ham", "to_address": "R-help@stat.math.ethz.ch", "from_address": "Keith Wong <keithw@med.usyd.edu.au>", "subject": "[R] Nicely formatted summary table with mean,\n standard deviation or number and proportion", "body": "Dear all,\n\nThe incredibly useful Hmisc package provides a method to generate \nsummary tables that can be typeset in latex. The Alzola and Harrell book \n  \"An introduction to S and the Hmisc and Design libraries\" provides an \nexample that generates mean and quartiles for continuous variables, and \nnumbers and percentages for count variables: summary() with method = \n'reverse'.\n\nI wonder if there is a way to change it so the mean and standard \ndeviation are reported instead for continuous variables.\n\nI illustrate my question below using an example from the book.\n\nThank you.\n\nKeith\n\n\n > ####\n > library(Hmisc)\n >\n > set.seed(173)\n > sex = factor(sample(c(\"m\", \"f\"), 500, rep = T))\n > age = rnorm(500, 50, 5)\n > treatment = factor(sample(c(\"Drug\", \"Placebo\"), 500, rep = T))\n > summary(sex ~ treatment, fun = table)\nsex    N=500\n\n+---------+-------+---+---+---+\n|         |       |N  |f  |m  |\n+---------+-------+---+---+---+\n|treatment|Drug   |263|140|123|\n|         |Placebo|237|133|104|\n+---------+-------+---+---+---+\n|Overall  |       |500|273|227|\n+---------+-------+---+---+---+\n >\n >\n >\n > (x = summary(treatment ~ age + sex, method = \"reverse\"))\n > # generates quartiles for continuous variables\n\n\nDescriptive Statistics by treatment\n\n+-------+--------------+--------------+\n|       |Drug          |Placebo       |\n|       |(N=263)       |(N=237)       |\n+-------+--------------+--------------+\n|age    |46.5/49.9/53.2|46.7/50.0/53.4|\n+-------+--------------+--------------+\n|sex : m|   47% (123)  |   44% (104)  |\n+-------+--------------+--------------+\n >\n >\n > # latex(x) generates a very nicely formatted table\n > # but I'd like \"mean (standard deviation)\" instead of quartiles.\n\n\n\n > # this function from \nhttp://tolstoy.newcastle.edu.au/R/e2/help/06/11/4713.html\n > g <- function(y) {\n+   s <- apply(y, 2,\n+              function(z) {\n+                z <- z[!is.na(z)]\n+                n <- length(z)\n+                if(n==0) c(NA,NA,NA,0) else\n+                if(n==1) c(z, NA,NA,1) else {\n+                  m <- mean(z)\n+                  s <- sd(z)\n+                  c(N=n, Mean=m, SD=s)\n+                }\n+              })\n+   w <- as.vector(s)\n+   names(w) <-  as.vector(outer(rownames(s), colnames(s), paste, sep=''))\n+   w\n+ }\n\n >\n > summary(treatment ~ age + sex, method = \"reverse\", fun = g)\n > # does not work, 'fun' or 'FUN\" argument is ignored.\n\n\nDescriptive Statistics by treatment\n\n+-------+--------------+--------------+\n|       |Drug          |Placebo       |\n|       |(N=263)       |(N=237)       |\n+-------+--------------+--------------+\n|age    |46.5/49.9/53.2|46.7/50.0/53.4|\n+-------+--------------+--------------+\n|sex : m|   47% (123)  |   44% (104)  |\n+-------+--------------+--------------+\n >\n >\n > (x1 = summarize(cbind(age), llist(treatment), FUN = g, \nstat.name=c(\"n\", \"mean\", \"sd\")))\n   treatment   n mean   sd\n1      Drug 263 49.9 4.94\n2   Placebo 237 50.1 4.97\n >\n > # this works but table is rotated, and it count data has to be\n > # treated separately.\n\n\n\n-- \nKeith Wong\nPhD candidate\nSleep & Circadian Research Group\nWoolcock Institute of Medical Research\n\nemail   keithw@med.usyd.edu.au\nPhone   +61 2 9515 8981\nFax     +61 2 9515 7070\nMail    PO Box M77, Missenden Road NSW 2050, Australia\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}