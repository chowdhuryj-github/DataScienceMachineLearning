{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 289: ensure we propogate the correct rsn for a request dmaster\n\tin http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 289\nrevision-id: tridge@samba.org-20070512095518-py0kxx2oypiqunse\nparent: tridge@samba.org-20070512095440-atc4dhk3kbgv6cxu\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-05-12 19:55:18 +1000\nmessage:\n  ensure we propogate the correct rsn for a request dmaster\nmodified:\n  common/ctdb_call.c             ctdb_call.c-20061128065342-to93h6eejj5kon81-1\n=== modified file 'common/ctdb_call.c'\n--- a/common/ctdb_call.c\t2007-05-12 08:08:50 +0000\n+++ b/common/ctdb_call.c\t2007-05-12 09:55:18 +0000\n@@ -390,6 +390,9 @@\n \t\treturn;\n \t}\n \n+\t/* use the rsn from the sending node */\n+\theader.rsn = c->rsn;\n+\n \t/* check if the new dmaster is the lmaster, in which case we\n \t   skip the dmaster reply */\n \tif (c->dmaster == ctdb->vnn) {\n@@ -649,6 +652,7 @@\n \tstate->c->hdr.destnode = ctdb->vnn;\n \n \tctdb_queue_packet(ctdb, &state->c->hdr);\n+\tDEBUG(0,(\"requeued ctdb_call after timeout\\n\"));\n }\n \n /*\n\n"}