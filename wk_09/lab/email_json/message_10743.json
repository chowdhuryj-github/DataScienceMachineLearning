{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "francogrex <francogrex@mail.com>", "subject": "Re: [R] Conditional power, predictive power", "body": "\nOr more elegantly the function below where a and b are the parameters of the\nbeta prior, xa and xb are the current number of events in group A and B\nrespectively; na and nb are the current total number of subjects in group A\nand B respectively; Na and Nb are the final total number of subject in group\nA and B respectively; and alpha is the alpha level (from 0 to 1).\nDon't forget to empty your folder: \"DATA/predictivepower\" (that you create\nin advance of course) after each computation.\n\n-----------------------------------------------------------------------------\n##Predictive Probability Interim Analysis, John Cook, 2006\npredictive.power=function (a,b,xa,xb,na,nb,Na,Nb,alpha){\nsetwd(\"C:/R-2.4.1/DATA/predictivepower\")\nprepower=function(a,b,s0,f0,s1,f1){\nfactorial(s1+f1)/ (factorial(s1)*factorial(f1))*\nbeta(s0+s1+a,f0+f1+b)/beta(s0+a,f0+b)}\n\nNta=Na-na\nfor(i in 0:Nta) {sink(\"pw.power1.txt\",append=TRUE);\nv=prepower(a,b,xa,(na-xa),i,Nta-i)\ndput(v)\nsink()\n}\nNtb=Nb-nb\nfor(i in 0:Ntb) {sink(\"pw.power2.txt\",append=TRUE);\nv=prepower(a,b,xb,(nb-xb),i,Ntb-i)\ndput(v)\nsink()\n}\n\nx=scan(file=\"pw.power1.txt\")\ny=scan(file=\"pw.power2.txt\")\n\nzth=function(xa,ya,Na,xb,yb,Nb){\ntha=(xa+ya)/Na\nthb=(xb+yb)/Nb\nth=(xa+xb+ya+yb)/(Na+Nb)\nz=(tha-thb)/sqrt(th*(1-th)*((1/Na)+(1/Nb)))\nz\n}\n\nfor(i in 0:Nta){sink(\"pw.zval.txt\",append=TRUE)\nzval=(zth(xa,i,Na,xb,0:Ntb,Nb))\ncat(zval,sep=\"\\n\")\nsink()\n}\nzz=scan(file=\"pw.zval.txt\")\n\nfor(i in 1:(Nta+1)){sink(\"pw.predict.txt\",append=TRUE)\npw=((x[i]*y[1:(Ntb+1)]))\ncat(pw,sep=\"\\n\")\nsink()\n}\np=scan(file=\"pw.predict.txt\")\nz=-qnorm(alpha)\nmdf <- cbind(zz, p) \nd1=subset(mdf,apply(mdf>(z),1,any))\nd2=subset(mdf,apply(mdf<(-z),1,any))\ns1=sum(d1[,2])\ns2=sum(d2[,2])\ns3=1-(s1+s2)\nprint(c(\"p A>B\"=s1,\"p B>A\"=s2, \"p A=B\"=s3))\n}\n-- \nView this message in context: http://www.nabble.com/Conditional-power%2C-predictive-power-tf3603396.html#a10094068\nSent from the R help mailing list archive at Nabble.com.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}