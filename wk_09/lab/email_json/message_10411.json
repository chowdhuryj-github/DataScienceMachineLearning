{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r22392 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_25/source/nsswitch", "body": "Author: idra\nDate: 2007-04-19 23:15:33 +0000 (Thu, 19 Apr 2007)\nNew Revision: 22392\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22392\n\nLog:\n\nRemove leftover potentially segfaulty code.\nCheck we are online before actually trying to connect anywhere\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/idmap_ad.c\n   branches/SAMBA_3_0_25/source/nsswitch/idmap_ad.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/idmap_ad.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/idmap_ad.c\t2007-04-19 22:40:32 UTC (rev 22391)\n+++ branches/SAMBA_3_0/source/nsswitch/idmap_ad.c\t2007-04-19 23:15:33 UTC (rev 22392)\n@@ -695,9 +695,6 @@\n \t\n \tad_map_type =  WB_POSIX_MAP_SFU;\t\n \n-\tif ( !ad_idmap_ads ) \n-\t\treturn idmap_ad_initialize(NULL);\n-\n \treturn NT_STATUS_OK;\n }\n \n@@ -716,9 +713,6 @@\n \t\n \tad_map_type =  WB_POSIX_MAP_RFC2307;\n \n-\tif ( !ad_idmap_ads ) \n-\t\treturn idmap_ad_initialize(NULL);\t\n-\n \treturn NT_STATUS_OK;\n }\n \n@@ -737,6 +731,11 @@\n {\n \tADS_STRUCT *ads_internal = NULL;\n \n+\t/* Only do query if we are online */\n+\tif (idmap_is_offline())\t{\n+\t\treturn NT_STATUS_FILE_IS_OFFLINE;\n+\t}\n+\n \t/* We are assuming that the internal ADS_STRUCT is for the \n \t   same forest as the incoming *ads pointer */\n \n\nModified: branches/SAMBA_3_0_25/source/nsswitch/idmap_ad.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/idmap_ad.c\t2007-04-19 22:40:32 UTC (rev 22391)\n+++ branches/SAMBA_3_0_25/source/nsswitch/idmap_ad.c\t2007-04-19 23:15:33 UTC (rev 22392)\n@@ -695,9 +695,6 @@\n \t\n \tad_map_type =  WB_POSIX_MAP_SFU;\t\n \n-\tif ( !ad_idmap_ads ) \n-\t\treturn idmap_ad_initialize(NULL);\n-\n \treturn NT_STATUS_OK;\n }\n \n@@ -716,9 +713,6 @@\n \t\n \tad_map_type =  WB_POSIX_MAP_RFC2307;\n \n-\tif ( !ad_idmap_ads ) \n-\t\treturn idmap_ad_initialize(NULL);\t\n-\n \treturn NT_STATUS_OK;\n }\n \n@@ -737,6 +731,11 @@\n {\n \tADS_STRUCT *ads_internal = NULL;\n \n+\t/* Only do query if we are online */\n+\tif (idmap_is_offline())\t{\n+\t\treturn NT_STATUS_FILE_IS_OFFLINE;\n+\t}\n+\n \t/* We are assuming that the internal ADS_STRUCT is for the \n \t   same forest as the incoming *ads pointer */\n \n\n"}