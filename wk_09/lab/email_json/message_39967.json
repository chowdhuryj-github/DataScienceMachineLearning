{"category": "ham", "to_address": "\"Mendiburu, Felipe \\(CIP\\)\" <F.MENDIBURU@CGIAR.ORG>", "from_address": "Frank E Harrell Jr <f.harrell@vanderbilt.edu>", "subject": "Re: [R] R's Spearman", "body": "Mendiburu, Felipe (CIP) wrote:\n> Dear Ray,\n> \n> The R's Spearman calculated by R is correct for ties or nonties, which is not correct is the probability for the case of ties. I send to you formulates it for the correlation with ties, that is equal to R. \n> \n> Regards,\n> \n> Felipe de Mendiburu\n> Statistician\n\nJust use midranks for ties (as with rank()) and compute the ordinary \ncorrelation on those (see also the spearman2 and rcorr functions in \nHmisc package).  No need to use complex formulas.  And the t \napproximation for p-values works pretty well.\n\nFrank Harrell\n\n> \n> \n> # Spearman correlation \"rs\" with ties or no ties\n> rs<-function(x,y) {\n> d<-rank(x)-rank(y)\n> tx<-as.numeric(table(x))\n> ty<-as.numeric(table(y))\n> Lx<-sum((tx^3-tx)/12)\n> Ly<-sum((ty^3-ty)/12)\n> N<-length(x)\n> SX2<- (N^3-N)/12 - Lx\n> SY2<- (N^3-N)/12 - Ly\n> rs<- (SX2+SY2-sum(d^2))/(2*sqrt(SX2*SY2))\n> return(rs)\n> }\n> \n> # Aplicacion\n>> cor(y[,1],y[,2],method=\"spearman\")\n> [1] 0.2319084\n>> rs(y[,1],y[,2])\n> [1] 0.2319084\n> \n> \n> \n> -----Original Message-----\n> From: r-help-bounces@stat.math.ethz.ch\n> [mailto:r-help-bounces@stat.math.ethz.ch]On Behalf Of Raymond Wan\n> Sent: Monday, May 28, 2007 10:29 PM\n> To: r-help@stat.math.ethz.ch\n> Subject: [R] R's Spearman\n> \n> \n> \n> Hi all,\n> \n> I am trying to figure out the formula used by R's Spearman rho (using \n> cor(method=\"spearman\")) because I can't seem to get the same value as by \n> calculating \"by hand\".  Perhaps I'm using \"cor\" wrong, but I don't know \n> where.  Basically, I am running these commands:\n> \n>  > y=read.table(file=\"tmp\",header=TRUE,sep=\"\\t\")\n>  > y\n>    IQ Hours\n> 1 106     7\n> 2  86     0\n> 3  97    20\n> 4 113    12\n> 5 120    12\n> 6 110    17\n>  > cor(y[1],y[2],method=\"spearman\")\n>        Hours\n> IQ 0.2319084\n> \n> [it's an abbreviated example of one I took from Wikipedia].  I \n> calculated by hand (apologies if the table looks strange when pasted \n> into e-mail):\n> \n>       IQ    Hours    rank(IQ)  rank(hours)    diff    diff^2\n> 1    106    7        3         2                 1    1\n> 2     86    0        1         1                 0    0\n> 3     97    20       2         6                -4    16\n> 4    113    12       5         3.5             1.5    2.25\n> 5    120    12       6         3.5             2.5    6.25\n> 6    110    17       4         5                -1    1\n>                                                       26.5\n>                            \n>                                               rho=    0.242857\n> \n> where rho = (1 - ((6 * 26.5) / 6 * (6^2 - 1))).  I kept modifying the \n> table and realized that the difference in result comes from ties.  i.e., \n> if I remove the tie in rows 4 and 5, I get the same result from both cor \n> and calculating by hand.  Perhaps I'm handling ties wrong...does anyone \n> know how R does it or perhaps I need to change how I'm using it?\n> \n> Thank you!\n> \n> Ray\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n> \n\n\n-- \nFrank E Harrell Jr   Professor and Chair           School of Medicine\n                      Department of Biostatistics   Vanderbilt University\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}