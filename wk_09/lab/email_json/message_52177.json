{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r23571 - in branches: SAMBA_3_0/source/client\n\tSAMBA_3_0_25/source/client SAMBA_3_0_26/source/client", "body": "Author: idra\nDate: 2007-06-21 17:05:59 +0000 (Thu, 21 Jun 2007)\nNew Revision: 23571\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23571\n\nLog:\n\nFix, parsing of multi byte share names.\nThanks to SATOH Fumiyasu\nFixes 4720\n\nJerry,\nthis is a showstopper for 3.0.25b, please grab it into\nSAMBA_3_0_RELEASE before cuting the tarballs.\n\nSimo.\n\n\nModified:\n   branches/SAMBA_3_0/source/client/client.c\n   branches/SAMBA_3_0_25/source/client/client.c\n   branches/SAMBA_3_0_26/source/client/client.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/client/client.c\n===================================================================\n--- branches/SAMBA_3_0/source/client/client.c\t2007-06-21 15:41:19 UTC (rev 23570)\n+++ branches/SAMBA_3_0/source/client/client.c\t2007-06-21 17:05:59 UTC (rev 23571)\n@@ -3970,14 +3970,6 @@\n \t\t/* if the service has not yet been specified lets see if it is available in the popt stack */\n \t\tif (!service_opt && poptPeekArg(pc)) {\n \t\t\tpstrcpy(service, poptGetArg(pc));\n-\t\t\t/* Convert any '/' characters in the service name to '\\' characters */\n-\t\t\tstring_replace(service, '/','\\\\');\n-\n-\t\t\tif (count_chars(service,'\\\\') < 3) {\n-\t\t\t\td_printf(\"\\n%s: Not enough '\\\\' characters in service\\n\",service);\n-\t\t\t\tpoptPrintUsage(pc, stderr, 0);\n-\t\t\t\texit(1);\n-\t\t\t}\n \t\t\tservice_opt = True;\n \t\t}\n \n@@ -4065,14 +4057,6 @@\n \t/* if the service has not yet been specified lets see if it is available in the popt stack */\n \tif (!service_opt && poptPeekArg(pc)) {\n \t\tpstrcpy(service, poptGetArg(pc));\n-\t\t/* Convert any '/' characters in the service name to '\\' characters */\n-\t\tstring_replace(service, '/','\\\\');\n-\n-\t\tif (count_chars(service,'\\\\') < 3) {\n-\t\t\td_printf(\"\\n%s: Not enough '\\\\' characters in service\\n\",service);\n-\t\t\tpoptPrintUsage(pc, stderr, 0);\n-\t\t\texit(1);\n-\t\t}\n \t\tservice_opt = True;\n \t}\n \n@@ -4111,6 +4095,16 @@\n \t}\n \t\n \tload_interfaces();\n+\n+\tif (service_opt) {\n+\t\t/* Convert any '/' characters in the service name to '\\' characters */\n+\t\tstring_replace(service, '/','\\\\');\n+\t\tif (count_chars(service,'\\\\') < 3) {\n+\t\t\td_printf(\"\\n%s: Not enough '\\\\' characters in service\\n\",service);\n+\t\t\tpoptPrintUsage(pc, stderr, 0);\n+\t\t\texit(1);\n+\t\t}\n+\t}\n \t\n \tif ( strlen(new_workgroup) != 0 )\n \t\tset_global_myworkgroup( new_workgroup );\n\nModified: branches/SAMBA_3_0_25/source/client/client.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/client/client.c\t2007-06-21 15:41:19 UTC (rev 23570)\n+++ branches/SAMBA_3_0_25/source/client/client.c\t2007-06-21 17:05:59 UTC (rev 23571)\n@@ -3921,14 +3921,6 @@\n \t\t/* if the service has not yet been specified lets see if it is available in the popt stack */\n \t\tif (!service_opt && poptPeekArg(pc)) {\n \t\t\tpstrcpy(service, poptGetArg(pc));\n-\t\t\t/* Convert any '/' characters in the service name to '\\' characters */\n-\t\t\tstring_replace(service, '/','\\\\');\n-\n-\t\t\tif (count_chars(service,'\\\\') < 3) {\n-\t\t\t\td_printf(\"\\n%s: Not enough '\\\\' characters in service\\n\",service);\n-\t\t\t\tpoptPrintUsage(pc, stderr, 0);\n-\t\t\t\texit(1);\n-\t\t\t}\n \t\t\tservice_opt = True;\n \t\t}\n \n@@ -4016,14 +4008,6 @@\n \t/* if the service has not yet been specified lets see if it is available in the popt stack */\n \tif (!service_opt && poptPeekArg(pc)) {\n \t\tpstrcpy(service, poptGetArg(pc));\n-\t\t/* Convert any '/' characters in the service name to '\\' characters */\n-\t\tstring_replace(service, '/','\\\\');\n-\n-\t\tif (count_chars(service,'\\\\') < 3) {\n-\t\t\td_printf(\"\\n%s: Not enough '\\\\' characters in service\\n\",service);\n-\t\t\tpoptPrintUsage(pc, stderr, 0);\n-\t\t\texit(1);\n-\t\t}\n \t\tservice_opt = True;\n \t}\n \n@@ -4062,6 +4046,16 @@\n \t}\n \t\n \tload_interfaces();\n+\n+\tif (service_opt) {\n+\t\t/* Convert any '/' characters in the service name to '\\' characters */\n+\t\tstring_replace(service, '/','\\\\');\n+\t\tif (count_chars(service,'\\\\') < 3) {\n+\t\t\td_printf(\"\\n%s: Not enough '\\\\' characters in service\\n\",service);\n+\t\t\tpoptPrintUsage(pc, stderr, 0);\n+\t\t\texit(1);\n+\t\t}\n+\t}\n \t\n \tif ( strlen(new_workgroup) != 0 )\n \t\tset_global_myworkgroup( new_workgroup );\n\nModified: branches/SAMBA_3_0_26/source/client/client.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/client/client.c\t2007-06-21 15:41:19 UTC (rev 23570)\n+++ branches/SAMBA_3_0_26/source/client/client.c\t2007-06-21 17:05:59 UTC (rev 23571)\n@@ -3921,14 +3921,6 @@\n \t\t/* if the service has not yet been specified lets see if it is available in the popt stack */\n \t\tif (!service_opt && poptPeekArg(pc)) {\n \t\t\tpstrcpy(service, poptGetArg(pc));\n-\t\t\t/* Convert any '/' characters in the service name to '\\' characters */\n-\t\t\tstring_replace(service, '/','\\\\');\n-\n-\t\t\tif (count_chars(service,'\\\\') < 3) {\n-\t\t\t\td_printf(\"\\n%s: Not enough '\\\\' characters in service\\n\",service);\n-\t\t\t\tpoptPrintUsage(pc, stderr, 0);\n-\t\t\t\texit(1);\n-\t\t\t}\n \t\t\tservice_opt = True;\n \t\t}\n \n@@ -4016,14 +4008,6 @@\n \t/* if the service has not yet been specified lets see if it is available in the popt stack */\n \tif (!service_opt && poptPeekArg(pc)) {\n \t\tpstrcpy(service, poptGetArg(pc));\n-\t\t/* Convert any '/' characters in the service name to '\\' characters */\n-\t\tstring_replace(service, '/','\\\\');\n-\n-\t\tif (count_chars(service,'\\\\') < 3) {\n-\t\t\td_printf(\"\\n%s: Not enough '\\\\' characters in service\\n\",service);\n-\t\t\tpoptPrintUsage(pc, stderr, 0);\n-\t\t\texit(1);\n-\t\t}\n \t\tservice_opt = True;\n \t}\n \n@@ -4062,6 +4046,16 @@\n \t}\n \t\n \tload_interfaces();\n+\n+\tif (service_opt) {\n+\t\t/* Convert any '/' characters in the service name to '\\' characters */\n+\t\tstring_replace(service, '/','\\\\');\n+\t\tif (count_chars(service,'\\\\') < 3) {\n+\t\t\td_printf(\"\\n%s: Not enough '\\\\' characters in service\\n\",service);\n+\t\t\tpoptPrintUsage(pc, stderr, 0);\n+\t\t\texit(1);\n+\t\t}\n+\t}\n \t\n \tif ( strlen(new_workgroup) != 0 )\n \t\tset_global_myworkgroup( new_workgroup );\n\n"}