{"category": "ham", "to_address": "Vittorio <vdemart1@tin.it>", "from_address": "Marc Schwartz <marc_schwartz@comcast.net>", "subject": "Re: [R] Reading a web page in pdf format", "body": "On Wed, 2007-05-09 at 10:55 -0500, Marc Schwartz wrote:\n> On Wed, 2007-05-09 at 15:47 +0100, Vittorio wrote:\n> > Each day the daily balance in the following link\n> > \n> > http://www.\n> > snamretegas.it/italiano/business/gas/bilancio/pdf/bilancio.pdf\n> > \n> > is \n> > updated.\n> > \n> > I would like to set up an R procedure to be run daily in a \n> > server able to read the figures in a couple of lines only \n> > (\"Industriale\" and \"Termoelettrico\", towards the end of the balance) \n> > and put the data in a table.\n> > \n> > Is that possible? If yes, what R-packages \n> > should I use?\n> > \n> > Ciao\n> > Vittorio\n> \n> Vittorio,\n> \n> Keep in mind that PDF files are typically text files. Thus you can read\n> it in using readLines():\n> \n> PDFFile <- readLines(\"http://www.snamretegas.it/italiano/business/gas/bilancio/pdf/bilancio.pdf\")\n> \n> # Clean up\n> unlink(\"http://www.snamretegas.it/italiano/business/gas/bilancio/pdf/bilancio.pdf\")\n> \n> \n> > str(PDFFile)\n>  chr [1:989] \"%PDF-1.2\" \"6 0 obj\" \"<<\" \"/Length 7 0 R\" ...\n> \n> \n> # Now find the lines containing the values you wish\n> # Use grep() with a regex for either term\n> Lines <- grep(\"(Industriale|Termoelettrico)\", PDFFile)\n> \n> > Lines\n> [1] 33 34\n> \n> > PDFFile[Lines]\n> [1] \"/F3 1 Tf 9 0 0 9 204 304 Tm (Industriale )Tj 9 0 0 9 420 304 Tm (       46,6)Tj\"\n> [2] \"9 0 0 9 204 283 Tm (Termoelettrico )Tj 9 0 0 9 420 283 Tm (       99,3)Tj\"      \n> \n> \n> # Now parse the values out of the lines\"\n> Vals <- sub(\".*\\\\((.*)\\\\).*\", \"\\\\1\", PDFFile[Lines])\n> \n> > Vals\n> [1] \"       46,6\" \"       99,3\"\n> \n> \n> # Now convert them to numeric\n> # need to change the ',' to a '.' at least in my locale\n>       \n> > as.numeric(gsub(\",\", \"\\\\.\", Vals))\n> [1] 46.6 99.3\n\nVittorio,\n\nJust a quick tweak here, given the possibility that the order of the\nvalues may be subject to change.\n\nAfter reading the file and getting the lines, use:\n\n# Use sub() with 2 back references, 1 for each value in the line\nVals <- sub(\".*\\\\((.*)\\\\).*\\\\((.*)\\\\).*\", \"\\\\1 \\\\2\", PDFFile[Lines])\n\n> Vals\n[1] \"Industriale         46,6\"    \"Termoelettrico         99,3\"\n\n\nThis gives us the labels and the values. Now convert to a data frame and\nthen coerce the values to numeric:\n\nDF <- read.table(textConnection(Vals))\n\n> DF\n              V1   V2\n1    Industriale 46,6\n2 Termoelettrico 99,3\n\n\nDF$V2 <- as.numeric(sub(\",\", \"\\\\.\", DF$V2))\n\n> DF\n              V1   V2\n1    Industriale 46.6\n2 Termoelettrico 99.3\n\n\n> str(DF)\n'data.frame':   2 obs. of  2 variables:\n $ V1: Factor w/ 2 levels \"Industriale\",..: 1 2\n $ V2: num  46.6 99.3\n\n\nHTH,\n\nMarc\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}