{"category": "ham", "to_address": "samba-technical <samba-technical@samba.org>,\n   \"'Jeremy Allison'\" <jra@samba.org>,\n   \"Gerald (Jerry) Carter\" <jerry@samba.org>,\n   Andrew Bartlett <abartlet@samba.org>", "from_address": "Todd Stecher <todd.stecher@isilon.com>", "subject": "High load server getting NTLM messages mixed?", "body": "A client with extremely high load on their Samba server is  \nintermittently hitting this code in smbd/sesssetup.c:\n\nif (!global_ntlmssp_state) {\n\t\t/* auth before negotiatiate? */\n\t\treturn ERROR_NT(NT_STATUS_INVALID_PARAMETER);\n\t}\n\n\nThis is 3.0.11 - apparently he tried this on a later version with  \nminimal problems (unfortunately, we have not as yet released a  \n\"newer\" version of Samba on our product :( ) - does anyone know if  \nthis was an issue that was specifically fixed?  I didn't see anything  \nobvious in bugzilla.samba.org.\n\nThere is a literal ton of NTLMSSP traffic against this server, and in  \nmany cases different auth contexts are interleaved in the wire - it  \nseems that the errors I'm seeing in the sniff occur when these  \nmessages get intertwined.\n\nGiven that, and the presence of a \"global\" static struct  \nauth_ntlmssp_state *global_ntlmssp_state, I suspect this was fixed by  \nrevision 8472 2 years ago (dang - we are dangerously out of date here).\n\nhttp://viewcvs.samba.org/cgi-bin/viewcvs.cgi?rev=8472&view=rev\n\n\nAndrew / Jerry - Can you confirm?  I could not find anything related  \nto parallel NTLM processing in bugzilla...\n\n\n\nTodd Stecher | Windows Interop Dev\nIsilon Systems    P +1-206-315-7500     F  +1-206-315-7501\nwww.isilon.com    D +1-206-315-7638    M +1-425-205-1180\n\n\n\n"}