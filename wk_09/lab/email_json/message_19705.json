{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22579 - in branches/SAMBA_4_0/source/torture:\n\tbasic ldap local nbt raw rpc", "body": "Author: metze\nDate: 2007-04-29 21:37:29 +0000 (Sun, 29 Apr 2007)\nNew Revision: 22579\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22579\n\nLog:\ndisable progress printing in the build-farm\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/torture/basic/base.c\n   branches/SAMBA_4_0/source/torture/basic/denytest.c\n   branches/SAMBA_4_0/source/torture/basic/mangle_test.c\n   branches/SAMBA_4_0/source/torture/basic/misc.c\n   branches/SAMBA_4_0/source/torture/basic/utable.c\n   branches/SAMBA_4_0/source/torture/ldap/cldapbench.c\n   branches/SAMBA_4_0/source/torture/local/iconv.c\n   branches/SAMBA_4_0/source/torture/nbt/query.c\n   branches/SAMBA_4_0/source/torture/nbt/winsbench.c\n   branches/SAMBA_4_0/source/torture/raw/composite.c\n   branches/SAMBA_4_0/source/torture/raw/lockbench.c\n   branches/SAMBA_4_0/source/torture/raw/openbench.c\n   branches/SAMBA_4_0/source/torture/raw/oplock.c\n   branches/SAMBA_4_0/source/torture/rpc/bench.c\n   branches/SAMBA_4_0/source/torture/rpc/rpc.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/torture/basic/base.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/basic/base.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/basic/base.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -567,7 +567,9 @@\n \t{\n \t\tsize_t buf_size = ((uint_t)random()%(sizeof(buf)-1))+ 1;\n \t\tif (i % 10 == 0) {\n-\t\t\ttorture_comment(tctx, \"%d\\r\", i); fflush(stdout);\n+\t\t\tif (torture_setting_bool(tctx, \"progress\", true)) {\n+\t\t\t\ttorture_comment(tctx, \"%d\\r\", i); fflush(stdout);\n+\t\t\t}\n \t\t}\n \n \t\tgenerate_random_buffer(buf, buf_size);\n\nModified: branches/SAMBA_4_0/source/torture/basic/denytest.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/basic/denytest.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/basic/denytest.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -1402,8 +1402,10 @@\n \n static void progress_bar(struct torture_context *tctx, uint_t i, uint_t total)\n {\n-\ttorture_comment(tctx, \"%5d/%5d\\r\", i, total);\n-\tfflush(stdout);\n+\tif (torture_setting_bool(tctx, \"progress\", true)) {\n+\t\ttorture_comment(tctx, \"%5d/%5d\\r\", i, total);\n+\t\tfflush(stdout);\n+\t}\n }\n \n /*\n\nModified: branches/SAMBA_4_0/source/torture/basic/mangle_test.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/basic/mangle_test.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/basic/mangle_test.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -184,8 +184,10 @@\n \t\t\tbreak;\n \t\t}\n \t\tif (total && total % 100 == 0) {\n-\t\t\tprintf(\"collisions %u/%u  - %.2f%%   (%u failures)\\r\",\n-\t\t\t       collisions, total, (100.0*collisions) / total, failures);\n+\t\t\tif (torture_setting_bool(torture, \"progress\", true)) {\n+\t\t\t\tprintf(\"collisions %u/%u  - %.2f%%   (%u failures)\\r\",\n+\t\t\t\t       collisions, total, (100.0*collisions) / total, failures);\n+\t\t\t}\n \t\t}\n \t}\n \n\nModified: branches/SAMBA_4_0/source/torture/basic/misc.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/basic/misc.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/basic/misc.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -71,7 +71,10 @@\n \tfor (i=0;itree, fname);\n \n \t\tif (c % 100 == 0) {\n-\t\t\ttorture_comment(tctx, \"%d (%d/%d)\\r\", c, chars_allowed, alt_allowed);\n+\t\t\tif (torture_setting_bool(tctx, \"progress\", true)) {\n+\t\t\t\ttorture_comment(tctx, \"%d (%d/%d)\\r\", c, chars_allowed, alt_allowed);\n+\t\t\t\tfflush(stdout);\n+\t\t\t}\n \t\t}\n \t}\n \ttorture_comment(tctx, \"%d (%d/%d)\\n\", c, chars_allowed, alt_allowed);\n\nModified: branches/SAMBA_4_0/source/torture/ldap/cldapbench.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/ldap/cldapbench.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/ldap/cldapbench.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -76,9 +76,12 @@\n \t\t\treq->async.fn = request_handler;\n \t\t\tnum_sent++;\n \t\t\tif (num_sent % 50 == 0) {\n-\t\t\t\tprintf(\"%.1f queries per second (%d failures)  \\r\", \n-\t\t\t\t       state->pass_count / timeval_elapsed(&tv),\n-\t\t\t\t       state->fail_count);\n+\t\t\t\tif (lp_parm_bool(-1, \"torture\", \"progress\", true)) {\n+\t\t\t\t\tprintf(\"%.1f queries per second (%d failures)  \\r\", \n+\t\t\t\t\t       state->pass_count / timeval_elapsed(&tv),\n+\t\t\t\t\t       state->fail_count);\n+\t\t\t\t\tfflush(stdout);\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \n\nModified: branches/SAMBA_4_0/source/torture/local/iconv.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/local/iconv.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/local/iconv.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -315,6 +315,7 @@\n \t\tif (codepoint % 1000 == 0) {\n \t\t\tif (torture_setting_bool(tctx, \"progress\", True)) {\n \t\t\t\ttorture_comment(tctx, \"codepoint=%u   \\r\", codepoint);\n+\t\t\t\tfflush(stdout);\n \t\t\t}\n \t\t}\n \n@@ -335,6 +336,7 @@\n \t\tif (i % 1000 == 0) {\n \t\t\tif (torture_setting_bool(tctx, \"progress\", true)) {\n \t\t\t\ttorture_comment(tctx, \"i=%u              \\r\", i);\n+\t\t\t\tfflush(stdout);\n \t\t\t}\n \t\t}\n \n\nModified: branches/SAMBA_4_0/source/torture/nbt/query.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/nbt/query.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/nbt/query.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -78,9 +78,12 @@\n \t\t\treq->async.private = result;\n \t\t\tnum_sent++;\n \t\t\tif (num_sent % 1000 == 0) {\n-\t\t\t\ttorture_comment(tctx, \"%.1f queries per second (%d failures)  \\r\", \n-\t\t\t\t       result->num_pass / timeval_elapsed(&tv),\n-\t\t\t\t       result->num_fail);\n+\t\t\t\tif (torture_setting_bool(tctx, \"progress\", true)) {\n+\t\t\t\t\ttorture_comment(tctx, \"%.1f queries per second (%d failures)  \\r\", \n+\t\t\t\t\t       result->num_pass / timeval_elapsed(&tv),\n+\t\t\t\t\t       result->num_fail);\n+\t\t\t\t\tfflush(stdout);\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \n\nModified: branches/SAMBA_4_0/source/torture/nbt/winsbench.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/nbt/winsbench.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/nbt/winsbench.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -254,9 +254,12 @@\n \t\t\tgenerate_request(nbtsock, state, num_sent % state->num_names);\n \t\t\tnum_sent++;\n \t\t\tif (num_sent % 50 == 0) {\n-\t\t\t\ttorture_comment(tctx, \"%.1f queries per second (%d failures)  \\r\", \n-\t\t\t\t       state->pass_count / timeval_elapsed(&tv),\n-\t\t\t\t       state->fail_count);\n+\t\t\t\tif (torture_setting_bool(tctx, \"progress\", true)) {\n+\t\t\t\t\ttorture_comment(tctx, \"%.1f queries per second (%d failures)  \\r\", \n+\t\t\t\t\t       state->pass_count / timeval_elapsed(&tv),\n+\t\t\t\t\t       state->fail_count);\n+\t\t\t\t\tfflush(stdout);\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \n\nModified: branches/SAMBA_4_0/source/torture/raw/composite.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/raw/composite.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/raw/composite.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -87,8 +87,10 @@\n \tprintf(\"waiting for completion\\n\");\n \twhile (*count != num_ops) {\n \t\tevent_loop_once(cli->transport->socket->event.ctx);\n-\t\tprintf(\"count=%d\\r\", *count);\n-\t\tfflush(stdout);\n+\t\tif (lp_parm_bool(-1, \"torture\", \"progress\", true)) {\n+\t\t\tprintf(\"count=%d\\r\", *count);\n+\t\t\tfflush(stdout);\n+\t\t}\n \t}\n \tprintf(\"count=%d\\n\", *count);\n \t\n@@ -175,8 +177,10 @@\n \n \twhile (*count != torture_numops) {\n \t\tevent_loop_once(event_ctx);\n-\t\tprintf(\"count=%d\\r\", *count);\n-\t\tfflush(stdout);\n+\t\tif (lp_parm_bool(-1, \"torture\", \"progress\", true)) {\n+\t\t\tprintf(\"count=%d\\r\", *count);\n+\t\t\tfflush(stdout);\n+\t\t}\n \t}\n \tprintf(\"count=%d\\n\", *count);\n \n@@ -293,8 +297,10 @@\n \tprintf(\"waiting for completion\\n\");\n \twhile (*count != num_ops) {\n \t\tevent_loop_once(event_ctx);\n-\t\tprintf(\"count=%d\\r\", *count);\n-\t\tfflush(stdout);\n+\t\tif (lp_parm_bool(-1, \"torture\", \"progress\", true)) {\n+\t\t\tprintf(\"count=%d\\r\", *count);\n+\t\t\tfflush(stdout);\n+\t\t}\n \t}\n \tprintf(\"count=%d\\n\", *count);\n \n@@ -358,8 +364,10 @@\n \n \twhile (*count < torture_numops) {\n \t\tevent_loop_once(event_ctx);\n-\t\tprintf(\"count=%d\\r\", *count);\n-\t\tfflush(stdout);\n+\t\tif (lp_parm_bool(-1, \"torture\", \"progress\", true)) {\n+\t\t\tprintf(\"count=%d\\r\", *count);\n+\t\t\tfflush(stdout);\n+\t\t}\n \t}\n \tprintf(\"count=%d\\n\", *count);\n \n\nModified: branches/SAMBA_4_0/source/torture/raw/lockbench.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/raw/lockbench.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/raw/lockbench.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -171,8 +171,11 @@\n \t\tfor (i=0;i<nprocs;i++) {\n \t\t\ttotal += state[i].count;\n \t\t}\n-\t\tprintf(\"%.2f ops/second\\r\", total/timeval_elapsed(&tv));\n-\t\tfflush(stdout);\n+\n+\t\tif (torture_setting_bool(torture, \"progress\", true)) {\n+\t\t\tprintf(\"%.2f ops/second\\r\", total/timeval_elapsed(&tv));\n+\t\t\tfflush(stdout);\n+\t\t}\n \t}\n \n \tprintf(\"%.2f ops/second\\n\", total/timeval_elapsed(&tv));\n\nModified: branches/SAMBA_4_0/source/torture/raw/openbench.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/raw/openbench.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/raw/openbench.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -209,9 +209,11 @@\n \n \t\tif (loops++ % 1000 != 0) continue;\n \n-\t\tprintf(\"%.2f ops/second (%d retries)\\r\", \n-\t\t       total/timeval_elapsed(&tv), open_retries);\n-\t\tfflush(stdout);\n+\t\tif (torture_setting_bool(torture, \"progress\", true)) {\n+\t\t\tprintf(\"%.2f ops/second (%d retries)\\r\", \n+\t\t\t       total/timeval_elapsed(&tv), open_retries);\n+\t\t\tfflush(stdout);\n+\t\t}\n \t}\n \n \tprintf(\"%.2f ops/second (%d retries)\\n\", \n\nModified: branches/SAMBA_4_0/source/torture/raw/oplock.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/raw/oplock.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/raw/oplock.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -827,7 +827,10 @@\n \t\t\tCHECK_STATUS(torture, status, NT_STATUS_OK);\n \t\t\tcount++;\n \t\t}\n-\t\ttorture_comment(torture, \"%.2f ops/second\\r\", count/timeval_elapsed(&tv));\n+\n+\t\tif (torture_setting_bool(torture, \"progress\", true)) {\n+\t\t\ttorture_comment(torture, \"%.2f ops/second\\r\", count/timeval_elapsed(&tv));\n+\t\t}\n \t}\n \n \ttorture_comment(torture, \"%.2f ops/second\\n\", count/timeval_elapsed(&tv));\n\nModified: branches/SAMBA_4_0/source/torture/rpc/bench.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/rpc/bench.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/rpc/bench.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -82,8 +82,10 @@\n \t\ttalloc_free(tmp_ctx);\n \t\tcount++;\n \t\tif (count % 50 == 0) {\n-\t\t\tprintf(\"%.1f queries per second  \\r\", \n-\t\t\t       count / timeval_elapsed(&tv));\n+\t\t\tif (lp_parm_bool(-1, \"torture\", \"progress\", true)) {\n+\t\t\t\tprintf(\"%.1f queries per second  \\r\", \n+\t\t\t\t       count / timeval_elapsed(&tv));\n+\t\t\t}\n \t\t}\n \t}\n \n\nModified: branches/SAMBA_4_0/source/torture/rpc/rpc.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/rpc/rpc.c\t2007-04-29 21:37:24 UTC (rev 22578)\n+++ branches/SAMBA_4_0/source/torture/rpc/rpc.c\t2007-04-29 21:37:29 UTC (rev 22579)\n@@ -175,6 +175,7 @@\n \ttorture_suite_add_suite(suite, torture_rpc_atsvc());\n \ttorture_suite_add_suite(suite, torture_rpc_wkssvc());\n \ttorture_suite_add_suite(suite, torture_rpc_handles());\n+//\ttorture_suite_add_suite(suite, torture_rpc_disconnect());\n \ttorture_suite_add_simple_test(suite, \"SPOOLSS\", torture_rpc_spoolss);\n \ttorture_suite_add_simple_test(suite, \"SAMR\", torture_rpc_samr);\n \ttorture_suite_add_simple_test(suite, \"SAMR-USERS\", torture_rpc_samr_users);\n\n"}