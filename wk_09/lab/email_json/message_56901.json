{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "D G Rossiter <rossiter@itc.nl>", "subject": "[R] Sweave bug? when writing figures / deleting variable in chunk", "body": "I have found a quite strange (to me) behaviour in Sweave. It only  \noccurs in the following situation:\n\n1. define a variable in one chunk\n2. use it within a subsequent figure-generating chunk\n3. delete it at the end of that same chunk\nThen the Sweave driver chokes, not finding the variable name when  \ngenerating the figure\n\nExample:\n\n% document bug2.Rnw\n\\documentclass{article}\n\\usepackage{Sweave}\n\\begin{document}\n\\SweaveOpts{eps=false}\n<<>>=\nsel <- 1:5\n@\n<>=\nplot(trees[sel,])\nrm(sel)\n@\n\\end{document}\n\nTry to sweave:\n\n > Sweave(\"bug2.Rnw\")\nWriting to file bug2.tex\nProcessing code chunks ...\n1 : echo term verbatim\n2 : echo term verbatim pdf\nError: no function to return from, jumping to top level\nError in plot(trees[sel, ]) : error in evaluating the argument 'x' in  \nselecting a method for function 'plot'\nError in driver$runcode(drobj, chunk, chunkopts) :\n\tError in plot(trees[sel, ]) : error in evaluating the argument 'x'  \nin selecting a method for function 'plot'\n\nThe generated .tex is complete up through the rm() but no figure is  \ngenerated. The file bug2-002.pdf is incomplete (corrupt).\n\n...\n\\begin{Schunk}\n\\begin{Sinput}\n > plot(trees[sel, ])\n > rm(sel)\n\\end{Sinput}\n\\end{Schunk}\n\nThe following ALL eliminate the problem:\n\n0. Executing the code directly, also with ESS\n1. <>\n2. moving rm(sel) to a separate, later code chunk\n3. Stangle the source and then source it\n4. don't use a variable, i.e. in this case:  plot(trees[1:5,])\n\nIt seems that Sweave is executing the rm(sel)  before it uses it in  \nthe trees[sel,].\n\nTechnical details: R 2.5.0, Mac OS X 10.4.10, PPC\nSame behaviour in stand-alone R for Mac and for R within Aquamacs  \nusing ESS\n\nWorkaround: I am putting any deletions into a later code chunk. This  \nonly has the disadvantage of making more chunks, so now that I know  \nwhat's happening it's no big deal. But it's driving me crazy... am I  \nmissing something? Thanks!\n\nD. G. Rossiter\nSenior University Lecturer\nDepartment of Earth Systems Analysis\nInternational Institute for Geo-Information Science and Earth  \nObservation (ITC)\nHengelosestraat 99\nPO Box 6, 7500 AA Enschede, The Netherlands\nPhone:\t+31-(0)53 4874 499\nFax:\t+31-(0)53 4874 336\nmailto:rossiter--at--itc.nl,  Internet: http://www.itc.nl/personal/ \nrossiter\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}