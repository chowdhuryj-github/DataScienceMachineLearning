{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22224 - in\n\tbranches/SAMBA_3_0/source/lib/replace/test: .", "body": "Author: metze\nDate: 2007-04-15 20:57:48 +0000 (Sun, 15 Apr 2007)\nNew Revision: 22224\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22224\n\nLog:\nmerge from samba4:\n\nmake comparing of struct tm more verbose and portable\n\nmetze\nModified:\n   branches/SAMBA_3_0/source/lib/replace/test/strptime.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/replace/test/strptime.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/replace/test/strptime.c\t2007-04-15 20:55:52 UTC (rev 22223)\n+++ branches/SAMBA_3_0/source/lib/replace/test/strptime.c\t2007-04-15 20:57:48 UTC (rev 22224)\n@@ -8,6 +8,10 @@\n #define true 1\n #define false 0\n \n+#ifndef __STRING\n+#define __STRING(x)    #x\n+#endif\n+\n /* make printf a no-op */\n #define printf if(0) printf\n \n@@ -24,6 +28,9 @@\n \tchar *ret;\n \tstruct tm t, t2;\n \n+\tmemset(&t, 0, sizeof(t));\n+\tmemset(&t2, 0, sizeof(t2));\n+\n \tprintf(\"test: strptime\\n\");\n \n \tret = strptime(s, \"%Y%m%d%H%M%S\", &t);\n@@ -56,13 +63,26 @@\n \t\treturn false;\n \t}\n \n-\tif (memcmp(&t, &t2, sizeof(t)) == 0) {\n-\t\tprintf(\"failure: strptime [\\n\"\n-\t\t       \"result differs if the format string has a 'Z' at the end\\n\"\n-\t\t       \"]\\n\");\n-\t\treturn false;\n+#define CMP_TM_ELEMENT(t1,t2,elem) \\\n+\tif (t1.elem != t2.elem) { \\\n+\t\tprintf(\"failure: strptime [\\n\" \\\n+\t\t       \"result differs if the format string has a 'Z' at the end\\n\" \\\n+\t\t       \"element: %s %d != %d\\n\" \\\n+\t\t       \"]\\n\", \\\n+\t\t       __STRING(elen), t1.elem, t2.elem); \\\n+\t\treturn false; \\\n \t}\n \n+\tCMP_TM_ELEMENT(t,t2,tm_sec);\n+\tCMP_TM_ELEMENT(t,t2,tm_min);\n+\tCMP_TM_ELEMENT(t,t2,tm_hour);\n+\tCMP_TM_ELEMENT(t,t2,tm_mday);\n+\tCMP_TM_ELEMENT(t,t2,tm_mon);\n+\tCMP_TM_ELEMENT(t,t2,tm_year);\n+\tCMP_TM_ELEMENT(t,t2,tm_wday);\n+\tCMP_TM_ELEMENT(t,t2,tm_yday);\n+\tCMP_TM_ELEMENT(t,t2,tm_isdst);\n+\n \tif (t.tm_sec != 46) {\n \t\tprintf(\"failure: strptime [\\n\"\n \t\t       \"tm_sec: expected: 46, got: %d\\n\"\n\n"}