{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r22905 - in branches: SAMBA_3_0/source/libsmb\n\tSAMBA_3_0/source/nsswitch SAMBA_3_0_26/source/libsmb\n\tSAMBA_3_0_26/source/nsswitch", "body": "Author: vlendec\nDate: 2007-05-15 13:56:00 +0000 (Tue, 15 May 2007)\nNew Revision: 22905\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22905\n\nLog:\ncli_send_mailslot had a message_send_pid inside\n\nModified:\n   branches/SAMBA_3_0/source/libsmb/clidgram.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_cm.c\n   branches/SAMBA_3_0_26/source/libsmb/clidgram.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_cm.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libsmb/clidgram.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/clidgram.c\t2007-05-15 13:47:25 UTC (rev 22904)\n+++ branches/SAMBA_3_0/source/libsmb/clidgram.c\t2007-05-15 13:56:00 UTC (rev 22905)\n@@ -26,7 +26,8 @@\n  * cli_send_mailslot, send a mailslot for client code ...\n  */\n \n-BOOL cli_send_mailslot(BOOL unique, const char *mailslot,\n+BOOL cli_send_mailslot(struct messaging_context *msg_ctx,\n+\t\t       BOOL unique, const char *mailslot,\n \t\t       uint16 priority,\n \t\t       char *buf, int len,\n \t\t       const char *srcname, int src_type, \n@@ -104,9 +105,10 @@\n \tDEBUGADD(4,(\"to %s IP %s\\n\", nmb_namestr(&dgram->dest_name),\n \t\t    inet_ntoa(dest_ip)));\n \n-\treturn NT_STATUS_IS_OK(message_send_pid(pid_to_procid(nmbd_pid),\n-\t\t\t\t\t\tMSG_SEND_PACKET, &p, sizeof(p),\n-\t\t\t\t\t\tFalse));\n+\treturn NT_STATUS_IS_OK(messaging_send_buf(msg_ctx,\n+\t\t\t\t\t\t  pid_to_procid(nmbd_pid),\n+\t\t\t\t\t\t  MSG_SEND_PACKET,\n+\t\t\t\t\t\t  (uint8 *)&p, sizeof(p)));\n }\n \n /*\n@@ -133,7 +135,8 @@\n \n static char cli_backup_list[1024];\n \n-int cli_get_backup_list(const char *myname, const char *send_to_name)\n+int cli_get_backup_list(struct messaging_context *msg_ctx,\n+\t\t\tconst char *myname, const char *send_to_name)\n {\n \tpstring outbuf;\n \tchar *p;\n@@ -160,7 +163,7 @@\n \tSIVAL(p, 0, 1); /* The sender's token ... */\n \tp += 4;\n \n-\tcli_send_mailslot(True, \"\\\\MAILSLOT\\\\BROWSE\", 1, outbuf, \n+\tcli_send_mailslot(msg_ctx, True, \"\\\\MAILSLOT\\\\BROWSE\", 1, outbuf, \n \t\t\t  PTR_DIFF(p, outbuf), myname, 0, send_to_name, \n \t\t\t  0x1d, sendto_ip);\n \n@@ -179,16 +182,18 @@\n  * cli_get_backup_server: Get the backup list and retrieve a server from it\n  */\n \n-int cli_get_backup_server(char *my_name, char *target, char *servername, int namesize)\n+int cli_get_backup_server(struct messaging_context *msg_ctx,\n+\t\t\t  char *my_name, char *target, char *servername,\n+\t\t\t  int namesize)\n {\n \n   /* Get the backup list first. We could pull this from the cache later */\n \n-  cli_get_backup_list(my_name, target);  /* FIXME: Check the response */\n+  cli_get_backup_list(msg_ctx, my_name, target);  /* FIXME: Check the response */\n \n   if (!cli_backup_list[0]) { /* Empty list ... try again */\n \n-    cli_get_backup_list(my_name, target);\n+    cli_get_backup_list(msg_ctx, my_name, target);\n \n   }\n \n\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_cm.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_cm.c\t2007-05-15 13:47:25 UTC (rev 22904)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_cm.c\t2007-05-15 13:56:00 UTC (rev 22905)\n@@ -975,7 +975,8 @@\n \tSSVAL(p, 6, 0xffff);\n \tp+=8;\n \n-\treturn cli_send_mailslot(False, \"\\\\MAILSLOT\\\\NET\\\\NTLOGON\", 0,\n+\treturn cli_send_mailslot(winbind_messaging_context(),\n+\t\t\t\t False, \"\\\\MAILSLOT\\\\NET\\\\NTLOGON\", 0,\n \t\t\t\t outbuf, PTR_DIFF(p, outbuf),\n \t\t\t\t global_myname(), 0, domain_name, 0x1c,\n \t\t\t\t dc_ip);\n\nModified: branches/SAMBA_3_0_26/source/libsmb/clidgram.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libsmb/clidgram.c\t2007-05-15 13:47:25 UTC (rev 22904)\n+++ branches/SAMBA_3_0_26/source/libsmb/clidgram.c\t2007-05-15 13:56:00 UTC (rev 22905)\n@@ -26,7 +26,8 @@\n  * cli_send_mailslot, send a mailslot for client code ...\n  */\n \n-BOOL cli_send_mailslot(BOOL unique, const char *mailslot,\n+BOOL cli_send_mailslot(struct messaging_context *msg_ctx,\n+\t\t       BOOL unique, const char *mailslot,\n \t\t       uint16 priority,\n \t\t       char *buf, int len,\n \t\t       const char *srcname, int src_type, \n@@ -104,9 +105,10 @@\n \tDEBUGADD(4,(\"to %s IP %s\\n\", nmb_namestr(&dgram->dest_name),\n \t\t    inet_ntoa(dest_ip)));\n \n-\treturn NT_STATUS_IS_OK(message_send_pid(pid_to_procid(nmbd_pid),\n-\t\t\t\t\t\tMSG_SEND_PACKET, &p, sizeof(p),\n-\t\t\t\t\t\tFalse));\n+\treturn NT_STATUS_IS_OK(messaging_send_buf(msg_ctx,\n+\t\t\t\t\t\t  pid_to_procid(nmbd_pid),\n+\t\t\t\t\t\t  MSG_SEND_PACKET,\n+\t\t\t\t\t\t  (uint8 *)&p, sizeof(p)));\n }\n \n /*\n@@ -133,7 +135,8 @@\n \n static char cli_backup_list[1024];\n \n-int cli_get_backup_list(const char *myname, const char *send_to_name)\n+int cli_get_backup_list(struct messaging_context *msg_ctx,\n+\t\t\tconst char *myname, const char *send_to_name)\n {\n \tpstring outbuf;\n \tchar *p;\n@@ -160,7 +163,7 @@\n \tSIVAL(p, 0, 1); /* The sender's token ... */\n \tp += 4;\n \n-\tcli_send_mailslot(True, \"\\\\MAILSLOT\\\\BROWSE\", 1, outbuf, \n+\tcli_send_mailslot(msg_ctx, True, \"\\\\MAILSLOT\\\\BROWSE\", 1, outbuf, \n \t\t\t  PTR_DIFF(p, outbuf), myname, 0, send_to_name, \n \t\t\t  0x1d, sendto_ip);\n \n@@ -179,16 +182,18 @@\n  * cli_get_backup_server: Get the backup list and retrieve a server from it\n  */\n \n-int cli_get_backup_server(char *my_name, char *target, char *servername, int namesize)\n+int cli_get_backup_server(struct messaging_context *msg_ctx,\n+\t\t\t  char *my_name, char *target, char *servername,\n+\t\t\t  int namesize)\n {\n \n   /* Get the backup list first. We could pull this from the cache later */\n \n-  cli_get_backup_list(my_name, target);  /* FIXME: Check the response */\n+  cli_get_backup_list(msg_ctx, my_name, target);  /* FIXME: Check the response */\n \n   if (!cli_backup_list[0]) { /* Empty list ... try again */\n \n-    cli_get_backup_list(my_name, target);\n+    cli_get_backup_list(msg_ctx, my_name, target);\n \n   }\n \n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_cm.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_cm.c\t2007-05-15 13:47:25 UTC (rev 22904)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_cm.c\t2007-05-15 13:56:00 UTC (rev 22905)\n@@ -975,7 +975,8 @@\n \tSSVAL(p, 6, 0xffff);\n \tp+=8;\n \n-\treturn cli_send_mailslot(False, \"\\\\MAILSLOT\\\\NET\\\\NTLOGON\", 0,\n+\treturn cli_send_mailslot(winbind_messaging_context(),\n+\t\t\t\t False, \"\\\\MAILSLOT\\\\NET\\\\NTLOGON\", 0,\n \t\t\t\t outbuf, PTR_DIFF(p, outbuf),\n \t\t\t\t global_myname(), 0, domain_name, 0x1c,\n \t\t\t\t dc_ip);\n\n"}