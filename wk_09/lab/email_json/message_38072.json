{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 390: don't block SIGCHLD,\n\tor we lose return values from system() ! in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 390\nrevision-id: tridge@samba.org-20070529072329-y1wnscebfnwlk63p\nparent: tridge@samba.org-20070529070008-jdte02ed9d9c8z4b\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Tue 2007-05-29 17:23:29 +1000\nmessage:\n  don't block SIGCHLD, or we lose return values from system() !\n  nicer log messages from events script\nmodified:\n  common/ctdb_daemon.c           ctdb_daemon.c-20070409200331-3el1kqgdb9m4ib0g-1\n  tools/events                   events-20070529030121-04fjh63cxfh8v1pj-1\n=== modified file 'common/ctdb_daemon.c'\n--- a/common/ctdb_daemon.c\t2007-05-29 03:58:41 +0000\n+++ b/common/ctdb_daemon.c\t2007-05-29 07:23:29 +0000\n@@ -734,7 +734,6 @@\n \t\tsetsid();\n \t}\n \tblock_signal(SIGPIPE);\n-\tblock_signal(SIGCHLD);\n \n \t/* try to set us up as realtime */\n \tctdb_set_realtime();\n\n=== modified file 'tools/events'\n--- a/tools/events\t2007-05-29 06:28:18 +0000\n+++ b/tools/events\t2007-05-29 07:23:29 +0000\n@@ -13,8 +13,11 @@\n \tiface=$1\n \tip=$2\n \tmaskbits=$3\n-\texec /sbin/ip addr add $ip/$maskbits dev $iface\n-\texit 1\n+\t/sbin/ip addr add $ip/$maskbits dev $iface || {\n+\t\t echo \"Failed to add $ip/$maskbits on dev $iface\"\n+\t\t exit 1\n+\t}\n+\texit 0\n \t;;\n \n      releaseip)\n@@ -25,8 +28,11 @@\n \tiface=$1\n \tip=$2\n \tmaskbits=$3\n-\texec /sbin/ip addr del $ip dev $iface\n-\texit 1\n+\t/sbin/ip addr del $ip dev $iface || {\n+\t\t echo \"Failed to del $ip on dev $iface\"\n+\t\t exit 1\n+\t}\n+\texit 0\n \t;;\n \n      recovered)\n\n"}