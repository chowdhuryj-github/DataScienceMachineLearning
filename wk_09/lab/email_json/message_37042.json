{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r23162 - in branches: SAMBA_3_0/source/locking\n\tSAMBA_3_0_26/source/locking", "body": "Author: vlendec\nDate: 2007-05-27 09:29:26 +0000 (Sun, 27 May 2007)\nNew Revision: 23162\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23162\n\nLog:\nMake use of messaging_send_buf\n\nModified:\n   branches/SAMBA_3_0/source/locking/locking.c\n   branches/SAMBA_3_0_26/source/locking/locking.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/locking/locking.c\n===================================================================\n--- branches/SAMBA_3_0/source/locking/locking.c\t2007-05-27 09:22:11 UTC (rev 23161)\n+++ branches/SAMBA_3_0/source/locking/locking.c\t2007-05-27 09:29:26 UTC (rev 23162)\n@@ -822,7 +822,6 @@\n \tsize_t msg_len;\n \tchar *frm = NULL;\n \tint i;\n-\tDATA_BLOB msg;\n \n \tif (!lck) {\n \t\treturn False;\n@@ -866,8 +865,6 @@\n \tsafe_strcpy(&frm[16], lck->servicepath, sp_len);\n \tsafe_strcpy(&frm[16 + sp_len + 1], lck->filename, fn_len);\n \n-\tmsg = data_blob_const(frm, msg_len);\n-\n \t/* Send the messages. */\n \tfor (i=0; inum_share_modes; i++) {\n \t\tstruct share_mode_entry *se = &lck->share_modes[i];\n@@ -885,7 +882,8 @@\n \t\t\t(unsigned int)lck->dev, (double)lck->ino,\n \t\t\tlck->servicepath, lck->filename ));\n \n-\t\tmessaging_send(msg_ctx, se->pid, MSG_SMB_FILE_RENAME, &msg);\n+\t\tmessaging_send_buf(msg_ctx, se->pid, MSG_SMB_FILE_RENAME,\n+\t\t\t\t   (uint8 *)frm, msg_len);\n \t}\n \n \treturn True;\n\nModified: branches/SAMBA_3_0_26/source/locking/locking.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/locking/locking.c\t2007-05-27 09:22:11 UTC (rev 23161)\n+++ branches/SAMBA_3_0_26/source/locking/locking.c\t2007-05-27 09:29:26 UTC (rev 23162)\n@@ -822,7 +822,6 @@\n \tsize_t msg_len;\n \tchar *frm = NULL;\n \tint i;\n-\tDATA_BLOB msg;\n \n \tif (!lck) {\n \t\treturn False;\n@@ -866,8 +865,6 @@\n \tsafe_strcpy(&frm[16], lck->servicepath, sp_len);\n \tsafe_strcpy(&frm[16 + sp_len + 1], lck->filename, fn_len);\n \n-\tmsg = data_blob_const(frm, msg_len);\n-\n \t/* Send the messages. */\n \tfor (i=0; inum_share_modes; i++) {\n \t\tstruct share_mode_entry *se = &lck->share_modes[i];\n@@ -885,7 +882,8 @@\n \t\t\t(unsigned int)lck->dev, (double)lck->ino,\n \t\t\tlck->servicepath, lck->filename ));\n \n-\t\tmessaging_send(msg_ctx, se->pid, MSG_SMB_FILE_RENAME, &msg);\n+\t\tmessaging_send_buf(msg_ctx, se->pid, MSG_SMB_FILE_RENAME,\n+\t\t\t\t   (uint8 *)frm, msg_len);\n \t}\n \n \treturn True;\n\n"}