{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23568 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_25/source/nsswitch SAMBA_3_0_26/source/nsswitch", "body": "Author: gd\nDate: 2007-06-21 14:32:09 +0000 (Thu, 21 Jun 2007)\nNew Revision: 23568\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23568\n\nLog:\nRemove last traces of Heimdal KCM support (and don't misuse wbinfo where a\ntorture test would be much more appropriate). Fix #4408.\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/wbinfo.c\n   branches/SAMBA_3_0_25/source/nsswitch/wbinfo.c\n   branches/SAMBA_3_0_26/source/nsswitch/wbinfo.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/wbinfo.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/wbinfo.c\t2007-06-21 14:30:40 UTC (rev 23567)\n+++ branches/SAMBA_3_0/source/nsswitch/wbinfo.c\t2007-06-21 14:32:09 UTC (rev 23568)\n@@ -1459,37 +1459,16 @@\n \t\t\t\tbreak;\n \t\t\t}\n \t\tcase 'K': {\n-\t\t\t\tBOOL got_error = False;\n \t\t\t\tuint32 flags =  WBFLAG_PAM_KRB5 |\n \t\t\t\t\t\tWBFLAG_PAM_CACHED_LOGIN |\n \t\t\t\t\t\tWBFLAG_PAM_FALLBACK_AFTER_KRB5 |\n \t\t\t\t\t\tWBFLAG_PAM_INFO3_TEXT;\n-\t\t\t\tfstring tok;\n-\t\t\t\tint i;\n-\t\t\t\tconst char *arg[] = { NULL, NULL };\n-\t\t\t\tconst char *cctypes[] = { \"FILE\", \n-\t\t\t\t\t\t\t  \"KCM\", \n-\t\t\t\t\t\t\t  \"KCM:0\", \n-\t\t\t\t\t\t\t  \"Garbage\", \n-\t\t\t\t\t\t\t  NULL, \n-\t\t\t\t\t\t\t  \"0\"};\n \n-\t\t\t\targ[0] = string_arg;\n-\n-\t\t\t\twhile (next_token(arg, tok, LIST_SEP, sizeof(tok))) {\n-\n-\t\t\t\t\tfor (i=0; i < ARRAY_SIZE(cctypes); i++) {\n-\t\t\t\t\t\tif (!wbinfo_auth_krb5(tok, cctypes[i], flags)) {\n-\t\t\t\t\t\t\td_fprintf(stderr, \"Could not authenticate user [%s] with \"\n-\t\t\t\t\t\t\t\t\"Kerberos (ccache: %s)\\n\", tok, cctypes[i]);\n-\t\t\t\t\t\t\tgot_error = True;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif (got_error)\n+\t\t\t\tif (!wbinfo_auth_krb5(string_arg, \"FILE\", flags)) {\n+\t\t\t\t\td_fprintf(stderr, \"Could not authenticate user [%s] with \"\n+\t\t\t\t\t\t\"Kerberos (ccache: %s)\\n\", string_arg, \"FILE\");\n \t\t\t\t\tgoto done;\n-\n+\t\t\t\t}\n \t\t\t\tbreak;\n \t\t\t}\n \t\tcase 'k':\n\nModified: branches/SAMBA_3_0_25/source/nsswitch/wbinfo.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/wbinfo.c\t2007-06-21 14:30:40 UTC (rev 23567)\n+++ branches/SAMBA_3_0_25/source/nsswitch/wbinfo.c\t2007-06-21 14:32:09 UTC (rev 23568)\n@@ -1459,37 +1459,16 @@\n \t\t\t\tbreak;\n \t\t\t}\n \t\tcase 'K': {\n-\t\t\t\tBOOL got_error = False;\n \t\t\t\tuint32 flags =  WBFLAG_PAM_KRB5 |\n \t\t\t\t\t\tWBFLAG_PAM_CACHED_LOGIN |\n \t\t\t\t\t\tWBFLAG_PAM_FALLBACK_AFTER_KRB5 |\n \t\t\t\t\t\tWBFLAG_PAM_INFO3_TEXT;\n-\t\t\t\tfstring tok;\n-\t\t\t\tint i;\n-\t\t\t\tconst char *arg[] = { NULL, NULL };\n-\t\t\t\tconst char *cctypes[] = { \"FILE\", \n-\t\t\t\t\t\t\t  \"KCM\", \n-\t\t\t\t\t\t\t  \"KCM:0\", \n-\t\t\t\t\t\t\t  \"Garbage\", \n-\t\t\t\t\t\t\t  NULL, \n-\t\t\t\t\t\t\t  \"0\"};\n \n-\t\t\t\targ[0] = string_arg;\n-\n-\t\t\t\twhile (next_token(arg, tok, LIST_SEP, sizeof(tok))) {\n-\n-\t\t\t\t\tfor (i=0; i < ARRAY_SIZE(cctypes); i++) {\n-\t\t\t\t\t\tif (!wbinfo_auth_krb5(tok, cctypes[i], flags)) {\n-\t\t\t\t\t\t\td_fprintf(stderr, \"Could not authenticate user [%s] with \"\n-\t\t\t\t\t\t\t\t\"Kerberos (ccache: %s)\\n\", tok, cctypes[i]);\n-\t\t\t\t\t\t\tgot_error = True;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif (got_error)\n+\t\t\t\tif (!wbinfo_auth_krb5(string_arg, \"FILE\", flags)) {\n+\t\t\t\t\td_fprintf(stderr, \"Could not authenticate user [%s] with \"\n+\t\t\t\t\t\t\"Kerberos (ccache: %s)\\n\", string_arg, \"FILE\");\n \t\t\t\t\tgoto done;\n-\n+\t\t\t\t}\n \t\t\t\tbreak;\n \t\t\t}\n \t\tcase 'k':\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/wbinfo.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/wbinfo.c\t2007-06-21 14:30:40 UTC (rev 23567)\n+++ branches/SAMBA_3_0_26/source/nsswitch/wbinfo.c\t2007-06-21 14:32:09 UTC (rev 23568)\n@@ -1459,37 +1459,16 @@\n \t\t\t\tbreak;\n \t\t\t}\n \t\tcase 'K': {\n-\t\t\t\tBOOL got_error = False;\n \t\t\t\tuint32 flags =  WBFLAG_PAM_KRB5 |\n \t\t\t\t\t\tWBFLAG_PAM_CACHED_LOGIN |\n \t\t\t\t\t\tWBFLAG_PAM_FALLBACK_AFTER_KRB5 |\n \t\t\t\t\t\tWBFLAG_PAM_INFO3_TEXT;\n-\t\t\t\tfstring tok;\n-\t\t\t\tint i;\n-\t\t\t\tconst char *arg[] = { NULL, NULL };\n-\t\t\t\tconst char *cctypes[] = { \"FILE\", \n-\t\t\t\t\t\t\t  \"KCM\", \n-\t\t\t\t\t\t\t  \"KCM:0\", \n-\t\t\t\t\t\t\t  \"Garbage\", \n-\t\t\t\t\t\t\t  NULL, \n-\t\t\t\t\t\t\t  \"0\"};\n \n-\t\t\t\targ[0] = string_arg;\n-\n-\t\t\t\twhile (next_token(arg, tok, LIST_SEP, sizeof(tok))) {\n-\n-\t\t\t\t\tfor (i=0; i < ARRAY_SIZE(cctypes); i++) {\n-\t\t\t\t\t\tif (!wbinfo_auth_krb5(tok, cctypes[i], flags)) {\n-\t\t\t\t\t\t\td_fprintf(stderr, \"Could not authenticate user [%s] with \"\n-\t\t\t\t\t\t\t\t\"Kerberos (ccache: %s)\\n\", tok, cctypes[i]);\n-\t\t\t\t\t\t\tgot_error = True;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tif (got_error)\n+\t\t\t\tif (!wbinfo_auth_krb5(string_arg, \"FILE\", flags)) {\n+\t\t\t\t\td_fprintf(stderr, \"Could not authenticate user [%s] with \"\n+\t\t\t\t\t\t\"Kerberos (ccache: %s)\\n\", string_arg, \"FILE\");\n \t\t\t\t\tgoto done;\n-\n+\t\t\t\t}\n \t\t\t\tbreak;\n \t\t\t}\n \t\tcase 'k':\n\n"}