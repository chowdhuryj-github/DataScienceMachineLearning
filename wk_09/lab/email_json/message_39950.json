{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23279 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_26/source/nsswitch", "body": "Author: obnox\nDate: 2007-05-31 22:02:49 +0000 (Thu, 31 May 2007)\nNew Revision: 23279\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23279\n\nLog:\nReplace occurrence of sid_binstring inside lookup_groupmem \nby sid_string_static.\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_ads.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_ads.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_ads.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_ads.c\t2007-05-31 21:15:53 UTC (rev 23278)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_ads.c\t2007-05-31 22:02:49 UTC (rev 23279)\n@@ -901,7 +901,6 @@\n \tADS_STRUCT *ads = NULL;\n \tchar *ldap_exp;\n \tNTSTATUS status = NT_STATUS_UNSUCCESSFUL;\n-\tchar *sidstr;\n \tchar **members = NULL;\n \tint i;\n \tsize_t num_members = 0;\n@@ -914,7 +913,6 @@\n \tchar **domains_nocache = NULL;     /* only needed for rpccli_lsa_lookup_sids */\n \tuint32 num_nocache = 0;\n \n-\n \tDEBUG(10,(\"ads: lookup_groupmem %s sid=%s\\n\", domain->name, \n \t\t  sid_string_static(group_sid)));\n \n@@ -933,19 +931,14 @@\n \t\tgoto done;\n \t}\n \n-\tif ((sidstr = sid_binstring(group_sid)) == NULL) {\n-\t\tstatus = NT_STATUS_NO_MEMORY;\n-\t\tgoto done;\n-\t}\n-\n \t/* search for all members of the group */\n-\tif (!(ldap_exp = talloc_asprintf(mem_ctx, \"(objectSid=%s)\",sidstr))) {\n-\t\tSAFE_FREE(sidstr);\n-\t\tDEBUG(1, (\"ads: lookup_groupmem: tallloc_asprintf for ldap_exp failed!\\n\"));\n+\tif (!(ldap_exp = talloc_asprintf(mem_ctx, \"(objectSid=%s)\",\n+\t\t\t\t\t sid_string_static(group_sid)))) \n+\t{\n+\t\tDEBUG(1, (\"ads: lookup_groupmem: talloc_asprintf for ldap_exp failed!\\n\"));\n \t\tstatus = NT_STATUS_NO_MEMORY;\n \t\tgoto done;\n \t}\n-\tSAFE_FREE(sidstr);\n \n \targs.control = ADS_EXTENDED_DN_OID;\n \targs.val = ADS_EXTENDED_DN_HEX_STRING;\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_ads.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_ads.c\t2007-05-31 21:15:53 UTC (rev 23278)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_ads.c\t2007-05-31 22:02:49 UTC (rev 23279)\n@@ -901,7 +901,6 @@\n \tADS_STRUCT *ads = NULL;\n \tchar *ldap_exp;\n \tNTSTATUS status = NT_STATUS_UNSUCCESSFUL;\n-\tchar *sidstr;\n \tchar **members = NULL;\n \tint i;\n \tsize_t num_members = 0;\n@@ -914,7 +913,6 @@\n \tchar **domains_nocache = NULL;     /* only needed for rpccli_lsa_lookup_sids */\n \tuint32 num_nocache = 0;\n \n-\n \tDEBUG(10,(\"ads: lookup_groupmem %s sid=%s\\n\", domain->name, \n \t\t  sid_string_static(group_sid)));\n \n@@ -933,19 +931,14 @@\n \t\tgoto done;\n \t}\n \n-\tif ((sidstr = sid_binstring(group_sid)) == NULL) {\n-\t\tstatus = NT_STATUS_NO_MEMORY;\n-\t\tgoto done;\n-\t}\n-\n \t/* search for all members of the group */\n-\tif (!(ldap_exp = talloc_asprintf(mem_ctx, \"(objectSid=%s)\",sidstr))) {\n-\t\tSAFE_FREE(sidstr);\n-\t\tDEBUG(1, (\"ads: lookup_groupmem: tallloc_asprintf for ldap_exp failed!\\n\"));\n+\tif (!(ldap_exp = talloc_asprintf(mem_ctx, \"(objectSid=%s)\",\n+\t\t\t\t         sid_string_static(group_sid)))) \n+\t{\n+\t\tDEBUG(1, (\"ads: lookup_groupmem: talloc_asprintf for ldap_exp failed!\\n\"));\n \t\tstatus = NT_STATUS_NO_MEMORY;\n \t\tgoto done;\n \t}\n-\tSAFE_FREE(sidstr);\n \n \targs.control = ADS_EXTENDED_DN_OID;\n \targs.val = ADS_EXTENDED_DN_HEX_STRING;\n\n"}