{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "\"Kevin E. Thorpe\" <kevin.thorpe@utoronto.ca>", "subject": "Re: [R] Tools For Preparing Data For Analysis", "body": "I am posting to this thread that has been quiet for some time because I\nremembered the following question.\n\nChristophe Pallier wrote:\n> Hi,\n> \n> Can you provide examples of data formats that are problematic to read and\n> clean with R ?\n\nToday I had a data manipulation problem that I don't know how to do in R\nso I solved it with perl.  Since I'm always interested in learning more\nabout complex data manipulation in R I am posting my problem in the\nhopes of receiving some hints for doing this in R.\n\nIf anyone has nothing better to do than play with other people's data,\nI would be happy to send the row files off-list.\n\nBackground:\n\nI have been given data that contains two measurements of left\nventricular ejection fraction.  One of the methods is echocardiogram\nwhich sometimes gives a true quantitative value and other times a\nsemi-quantitative value.  The desire is to compare echo with the\nother method (MUGA).  In most cases, patients had either quantitative\nor semi-quantitative.  Same patients had both.  The data came\nto me in excel files with, basically, no patient identifiers to link\nthe \"both\" with the semi-quantitative patients (the \"both\" patients\nwere in multiple data sets).\n\nWhat I wanted to do was extract from the semi-quantitative data file\nthose patients with only semi-quantitative.  All I have to link with\nare the semi-quantitative echo and the MUGA and these pairs of values\nare not unique.\n\nTo make this more concrete, here are some portions of the raw data.\n\n\"Both\"\n\n\"ID NUM\",\"ECHO\",\"MUGA\",\"Semiquant\",\"Quant\"\n\"B\",12,37,10,12\n\"D\",13,13,10,13\n\"E\",13,26,10,15\n\"F\",13,31,10,13\n\"H\",15,15,10,15\n\"I\",15,21,10,15\n\"J\",15,22,10,15\n\"K\",17,22,10,17\n\"N\",17.5,4,10,17.5\n\"P\",18,25,10,18\n\"R\",19,25,10,19\n\nSeimi-quantitative\n\n\"echo\",\"muga\",\"quant\"\n10,20,0      <-- keep\n10,20,0      <-- keep\n10,21,0      <-- remove\n10,21,0      <-- keep\n10,24,0      <-- keep\n10,25,0      <-- remove\n10,25,0      <-- remove\n10,25,0      <-- keep\n\nHere is the perl program I wrote for this.\n\n#!/usr/bin/perl\n\nopen(BOTH, \"quant_qual_echo.csv\") || die \"Can't open quant_qual_echo.csv\";\n# Discard first row;\n$_ = ;\nwhile() {\n    chomp;\n    ($id, $e, $m, $sq, $qu) = split(/,/);\n    $both{$sq,$m}++;\n}\nclose(BOTH);\n\nopen(OUT, \"> qual_echo_only.csv\") || die \"Can't open qual_echo_only.csv\";\nprint OUT \"pid,echo,muga,quant\\n\";\n$pid = 2001;\n\nopen(QUAL, \"qual_echo.csv\") || die \"Can't open qual_echo.csv\";\n# Discard first row\n$_ = ;\nwhile() {\n    chomp;\n    ($echo, $muga, $quant) = split(/,/);\n    if ($both{$echo,$muga} > 0) {\n        $both{$echo,$muga}--;\n    }\n    else {\n        print OUT \"$pid,$echo,$muga,$quant\\n\";\n        $pid++;\n    }\n}\nclose(QUAL);\nclose(OUT);\n\nopen(OUT, \"> both_echo.csv\") || die \"Can't open both_echo.csv\";\nprint OUT \"pid,echo,muga,quant\\n\";\n$pid = 3001;\n\nopen(BOTH, \"quant_qual_echo.csv\") || die \"Can't open quant_qual_echo.csv\";\n# Discard first row;\n$_ = ;\nwhile() {\n    chomp;\n    ($id, $e, $m, $sq, $qu) = split(/,/);\n    print OUT \"$pid,$sq,$m,0\\n\";\n    print OUT \"$pid,$qu,$m,1\\n\";\n    $pid++;\n}\nclose(BOTH);\nclose(OUT);\n\n\n-- \nKevin E. Thorpe\nBiostatistician/Trialist, Knowledge Translation Program\nAssistant Professor, Department of Public Health Sciences\nFaculty of Medicine, University of Toronto\nemail: kevin.thorpe@utoronto.ca  Tel: 416.864.5776  Fax: 416.864.6057\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}