{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 449: make the init scripts more portable about location of\n\tsystem config files in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 449\nrevision-id: tridge@samba.org-20070603120707-py0wul4gatwvkcer\nparent: tridge@samba.org-20070603105424-u3l4oixhczc2triy\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sun 2007-06-03 22:07:07 +1000\nmessage:\n  make the init scripts more portable about location of system config files\nmodified:\n  config/ctdb.init               ctdb.init-20070527204758-biuh7znabuwan3zn-6\n  config/events                  events-20070529030121-04fjh63cxfh8v1pj-1\n  config/events.d/nfs            nfs-20070601141008-hy3h4qgbk1jd2jci-1\n  config/events.d/nfslock        nfslock-20070601105340-vlcvnp6euoj3zdwy-2\n  config/events.d/samba          samba-20070601105340-vlcvnp6euoj3zdwy-3\n  config/functions               functions-20070601105405-gajwirydr5a9zd6x-1\n  config/statd-callout           statdcallout-20070531010857-6sdlz455vusye5y5-1\n=== modified file 'config/ctdb.init'\n--- a/config/ctdb.init\t2007-06-03 09:24:52 +0000\n+++ b/config/ctdb.init\t2007-06-03 12:07:07 +0000\n@@ -34,19 +34,15 @@\n # Avoid using root's TMPDIR\n unset TMPDIR\n \n+. /etc/ctdb/functions\n+loadconfig network\n+loadconfig ctdb\n+\n # check networking is up (for redhat)\n-[ -f /etc/sysconfig/network ] && {\n-    . /etc/sysconfig/network\n-    [ ${NETWORKING} = \"no\" ] && exit 0\n-}\n+[ ${NETWORKING} = \"no\" ] && exit 0\n \n CTDB_OPTIONS=\"\"\n \n-# pull in admin specified config for ctdb\n-if [ -f /etc/sysconfig/ctdb ]; then\n-   . /etc/sysconfig/ctdb \n-fi\n-\n [ -z \"$CTDB_RECOVERY_LOCK\" ] && {\n     echo \"You must configure the location of the CTDB_RECOVERY_LOCK\"\n     exit 1\n\n=== modified file 'config/events'\n--- a/config/events\t2007-06-02 09:40:07 +0000\n+++ b/config/events\t2007-06-03 12:07:07 +0000\n@@ -2,8 +2,8 @@\n ############################\n # main event script for ctdb\n \n-. /etc/sysconfig/ctdb\n . /etc/ctdb/functions\n+loadconfig ctdb\n \n cmd=\"$1\"\n shift\n\n=== modified file 'config/events.d/nfs'\n--- a/config/events.d/nfs\t2007-06-03 04:39:27 +0000\n+++ b/config/events.d/nfs\t2007-06-03 12:07:07 +0000\n@@ -1,8 +1,8 @@\n #!/bin/sh\n # script to manage nfs in a clustered environment\n \n-. /etc/sysconfig/nfs\n . /etc/ctdb/functions\n+loadconfig nfs\n \n [ -z $CTDB_MANAGES_NFS ] && exit 0\n [ $CTDB_MANAGES_NFS != \"yes\" ] && exit 0\n\n=== modified file 'config/events.d/nfslock'\n--- a/config/events.d/nfslock\t2007-06-03 04:39:27 +0000\n+++ b/config/events.d/nfslock\t2007-06-03 12:07:07 +0000\n@@ -1,8 +1,8 @@\n #!/bin/sh\n # event strict to manage lockd and statd in a cluster environment\n \n-. /etc/sysconfig/nfs\n . /etc/ctdb/functions\n+loadconfig nfs\n \n [ -z $CTDB_MANAGES_NFS ] && exit 0\n [ $CTDB_MANAGES_NFS != \"yes\" ] && exit 0\n\n=== modified file 'config/events.d/samba'\n--- a/config/events.d/samba\t2007-06-03 04:39:27 +0000\n+++ b/config/events.d/samba\t2007-06-03 12:07:07 +0000\n@@ -3,8 +3,8 @@\n \n PATH=/bin:/usr/bin:$PATH\n \n-. /etc/sysconfig/ctdb\n . /etc/ctdb/functions\n+loadconfig ctdb\n \n cmd=\"$1\"\n shift\n\n=== modified file 'config/functions'\n--- a/config/functions\t2007-06-02 09:40:07 +0000\n+++ b/config/functions\t2007-06-03 12:07:07 +0000\n@@ -1,5 +1,16 @@\n # utility functions for ctdb event scripts\n \n+#######################################\n+# pull in a system config file, if any\n+loadconfig() {\n+    name=\"$1\"\n+    if [ -f /etc/sysconfig/$name ]; then\n+\t. /etc/sysconfig/$name\n+    elif [ -f /etc/default/$name ]; then\n+\t. /etc/default/$name\n+    fi\n+}\n+\n \n ######################################################\n # simulate /sbin/service on platforms that don't have it\n\n=== modified file 'config/statd-callout'\n--- a/config/statd-callout\t2007-06-02 09:45:06 +0000\n+++ b/config/statd-callout\t2007-06-03 12:07:07 +0000\n@@ -5,8 +5,8 @@\n # /etc/sysconfig/nfs:\n #   STATD_HOSTNAME=\"myhostname -H /etc/ctdb/statd-callout\"\n \n-\n-. /etc/sysconfig/nfs\n+. /etc/ctdb/functions\n+loadconfig nfs\n \n [ -z \"$STATD_SHARED_DIRECTORY\" ] && exit 0\n \n\n"}