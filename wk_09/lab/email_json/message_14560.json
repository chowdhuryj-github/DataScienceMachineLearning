{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "Jelmer Vernooij <jelmer@samba.org>", "subject": "Rev 12001: Revive tim's swig code. in\n\tfile:///home/jelmer/bzr.samba/python/", "body": "At file:///home/jelmer/bzr.samba/python/\n\n------------------------------------------------------------\nrevno: 12001\nrevision-id: jelmer@samba.org-20070424154133-u0ap6lyl1de8la2m\nparent: jelmer@samba.org-20070424134531-39e76umhgztflk5b\ncommitter: Jelmer Vernooij \nbranch nick: python\ntimestamp: Tue 2007-04-24 17:41:33 +0200\nmessage:\n  Revive tim's swig code.\nremoved:\n  source/libcli/config.m4        svn-v2:15395@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2flibcli%2fconfig.m4\n  source/scripting/swig/config.m4 svn-v2:14906@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fscripting%2fswig%2fconfig.m4\nmodified:\n  .bzrignore                     svn-v2:17811@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-.bzrignore\n  source/build/smb_build/config_mk.pm svn-v2:3690@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fbuild%2fsmb_build%2fconfig_mk.pm\n  source/build/smb_build/input.pm svn-v2:3690@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fbuild%2fsmb_build%2finput.pm\n  source/build/smb_build/main.pl svn-v2:8826@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fbuild%2fsmb_build%2fmain.pl\n  source/configure.ac            svn-v2:15565@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fconfigure.ac\n  source/lib/ldb/config.mk       svn-v2:665@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2flib%2fldb%2fconfig.mk\n  source/lib/ldb/libldb.m4       svn-v2:18109@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2flib%2fldb%2flibldb.m4\n  source/lib/ldb/swig/ldb.i      svn-v2:14968@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2flib%2fldb%2fswig%2fldb.i\n  source/lib/python/config.m4    configure.in-20070423105804-3mrp9flhlt8pjj8v-11\n  source/lib/tdb/config.mk       svn-v2:728@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2flib%2ftdb%2fconfig.mk\n  source/libcli/config.mk        svn-v2:1436@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2flibcli%2fconfig.mk\n  source/scripting/swig/config.mk svn-v2:14906@0c0555d6-39d7-0310-84fc-f1cc0bd64818-branches%2fSAMBA_4_0-source%2fscripting%2fswig%2fconfig.mk\n=== removed file 'source/libcli/config.m4'\n--- a/source/libcli/config.m4\t2007-04-24 10:52:53 +0000\n+++ b/source/libcli/config.m4\t1970-01-01 00:00:00 +0000\n@@ -1,3 +0,0 @@\n-AC_MSG_CHECKING([for Python (libcli_nbt)])\n-\n-SMB_ENABLE(swig_libcli_nbt, NO)\n\n=== removed file 'source/scripting/swig/config.m4'\n--- a/source/scripting/swig/config.m4\t2007-04-24 10:52:53 +0000\n+++ b/source/scripting/swig/config.m4\t1970-01-01 00:00:00 +0000\n@@ -1,6 +0,0 @@\n-dnl # Scripting subsystem\n-\n-# Check for python support\n-\n-SMB_ENABLE(swig_dcerpc, NO)\n-\n\n=== modified file '.bzrignore'\n--- a/.bzrignore\t2007-04-23 17:05:15 +0000\n+++ b/.bzrignore\t2007-04-24 15:41:33 +0000\n@@ -176,3 +176,5 @@\n source/lib/python/Modules/Setup.local\n source/lib/python/Modules/Setup\n source/lib/python/Modules/Setup.config\n+lib/ldb/swig/ldb.py\n+source/lib/ldb/swig/ldb.py\n\n=== modified file 'source/build/smb_build/config_mk.pm'\n--- a/source/build/smb_build/config_mk.pm\t2007-04-22 10:37:51 +0000\n+++ b/source/build/smb_build/config_mk.pm\t2007-04-24 15:41:33 +0000\n@@ -19,6 +19,12 @@\n \t\t\"CPPFLAGS\"\t\t=> \"list\",\n \t\t\"LDFLAGS\"\t\t=> \"list\",\n \t\t},\n+\t\"SWIG\" => {\n+\t\tSWIG_FILE => \"string\",\n+\t\t\"PRIVATE_DEPENDENCIES\"\t=> \"list\",\n+\t\t\"PUBLIC_DEPENDENCIES\"\t=> \"list\",\n+\t\t\"ENABLE\"\t\t=> \"bool\",\n+\t},\n \t\"SUBSYSTEM\" => {\n \t\t\"OBJ_FILES\"\t\t=> \"list\",\n \n\n=== modified file 'source/build/smb_build/input.pm'\n--- a/source/build/smb_build/input.pm\t2007-04-22 11:40:11 +0000\n+++ b/source/build/smb_build/input.pm\t2007-04-24 15:41:33 +0000\n@@ -8,6 +8,7 @@\n use smb_build::config;\n use strict;\n package smb_build::input;\n+use File::Basename;\n \n my $srcdir = $config::config{srcdir};\n \n@@ -130,6 +131,22 @@\n \tadd_libreplace($lib);\n }\n \n+sub check_swig($$)\n+{\n+\tmy ($INPUT, $swig) = @_;\n+\n+\treturn if ($swig->{ENABLE} ne \"YES\");\n+\t\n+\tmy $dirname = dirname($swig->{SWIG_FILE});\n+\tmy $basename = basename($swig->{SWIG_FILE}, \".i\");\n+\n+\t$swig->{OUTPUT_TYPE} = [\"SHARED_LIBRARY\"];\n+\t$swig->{LIBRARY_REALNAME} = \"$dirname/_$basename.\\$(SHLIBEXT)\";\n+\t$swig->{OBJ_FILES} = [\"$dirname/$basename\\_wrap\\.o\"];\n+\n+\tcheck_library($INPUT, $swig, [\"SHARED_LIBRARY\"]);\n+}\n+\n sub check_binary($$)\n {\n \tmy ($INPUT, $bin) = @_;\n@@ -230,10 +247,20 @@\n \t\t$part->{LINK_FLAGS} = [];\n \t\t$part->{FULL_OBJ_LIST} = [\"\\$($part->{TYPE}_$part->{NAME}_OBJ_LIST)\"];\n \n-\t\tcheck_subsystem($INPUT, $part, $subsys_ot) if ($part->{TYPE} eq \"SUBSYSTEM\");\n-\t\tcheck_module($INPUT, $part, $module_ot) if ($part->{TYPE} eq \"MODULE\");\n-\t\tcheck_library($INPUT, $part, $lib_ot) if ($part->{TYPE} eq \"LIBRARY\");\n-\t\tcheck_binary($INPUT, $part) if ($part->{TYPE} eq \"BINARY\");\n+\t\tif ($part->{TYPE} eq \"SUBSYSTEM\") { \n+\t\t\tcheck_subsystem($INPUT, $part, $subsys_ot);\n+\t\t} elsif ($part->{TYPE} eq \"MODULE\") {\n+\t\t\tcheck_module($INPUT, $part, $module_ot);\n+\t\t} elsif ($part->{TYPE} eq \"LIBRARY\") {\n+\t\t\tcheck_library($INPUT, $part, $lib_ot);\n+\t\t} elsif ($part->{TYPE} eq \"BINARY\") {\n+\t\t\tcheck_binary($INPUT, $part);\n+\t\t} elsif ($part->{TYPE} eq \"SWIG\") {\n+\t\t\tcheck_swig($INPUT, $part);\n+\t\t} elsif ($part->{TYPE} eq \"EXT_LIB\") {\n+\t\t} else {\n+\t\t\tdie(\"Unknown type $part->{TYPE}\");\n+\t\t}\n \t}\n \n \tforeach my $part (values %$INPUT) {\n\n=== modified file 'source/build/smb_build/main.pl'\n--- a/source/build/smb_build/main.pl\t2007-04-02 17:11:36 +0000\n+++ b/source/build/smb_build/main.pl\t2007-04-24 15:41:33 +0000\n@@ -74,7 +74,6 @@\n cflags::create_cflags($OUTPUT, $config::config{srcdir},\n \t\t    $config::config{builddir}, \"extra_cflags.txt\");\n \n-\n summary::show($OUTPUT, \\%config::config);\n \n 1;\n\n=== modified file 'source/configure.ac'\n--- a/source/configure.ac\t2007-04-23 11:41:38 +0000\n+++ b/source/configure.ac\t2007-04-24 15:41:33 +0000\n@@ -37,7 +37,6 @@\n m4_include(lib/python/config.m4)\n m4_include(auth/gensec/config.m4)\n m4_include(smbd/process_model.m4)\n-m4_include(scripting/swig/config.m4)\n m4_include(ntvfs/posix/config.m4)\n m4_include(ntvfs/unixuid/config.m4)\n m4_include(lib/socket_wrapper/config.m4)\n@@ -46,7 +45,6 @@\n m4_include(ntvfs/sysdep/config.m4)\n m4_include(lib/appweb/config.m4)\n m4_include(nsswitch/config.m4)\n-m4_include(libcli/config.m4)\n \n #################################################\n # add *_CFLAGS only for the real build\n\n=== modified file 'source/lib/ldb/config.mk'\n--- a/source/lib/ldb/config.mk\t2007-04-20 11:00:20 +0000\n+++ b/source/lib/ldb/config.mk\t2007-04-24 15:41:33 +0000\n@@ -304,9 +304,9 @@\n \n #######################\n # Start LIBRARY swig_ldb\n-[LIBRARY::swig_ldb]\n-PUBLIC_DEPENDENCIES = ldb DYNCONFIG\n-LIBRARY_REALNAME = swig/_ldb.$(SHLIBEXT)\n-OBJ_FILES = swig/ldb_wrap.o\n+[SWIG::swig_ldb]\n+PUBLIC_DEPENDENCIES = ldb DYNCONFIG LIBPYTHON \n+PRIVATE_DEPENDENCIES = gensec\n+SWIG_FILE = swig/ldb.i\n # End LIBRARY swig_ldb\n #######################\n\n=== modified file 'source/lib/ldb/libldb.m4'\n--- a/source/lib/ldb/libldb.m4\t2007-04-24 10:52:53 +0000\n+++ b/source/lib/ldb/libldb.m4\t2007-04-24 15:41:33 +0000\n@@ -5,5 +5,3 @@\n if test x\"$with_sqlite3_support\" = x\"yes\"; then\n \tSMB_ENABLE(ldb_sqlite3, YES)\n fi\n-\n-SMB_ENABLE(swig_ldb, NO)\n\n=== modified file 'source/lib/ldb/swig/ldb.i'\n--- a/source/lib/ldb/swig/ldb.i\t2006-05-02 05:14:00 +0000\n+++ b/source/lib/ldb/swig/ldb.i\t2007-04-24 15:41:33 +0000\n@@ -31,14 +31,12 @@\n \n /* Some typedefs to help swig along */\n \n-typedef unsigned char uint8_t;\n-typedef unsigned long long uint64_t;\n-typedef long long int64_t;\n-\n /* Include headers */\n \n+#include \n+#include \n+#include \"lib/talloc/talloc.h\"\n #include \"lib/ldb/include/ldb.h\"\n-#include \"lib/talloc/talloc.h\"\n \n %}\n \n@@ -179,7 +177,6 @@\n \tstruct ldb_dn *dn;\n \tunsigned int num_elements;\n \tstruct ldb_message_element *elements;\n-\tvoid *private_data;\n };\n \n /*\n@@ -227,14 +224,8 @@\n \n struct ldb_message_element *ldb_msg_find_element(const struct ldb_message *msg, const char *attr_name);\n \n-int ldb_msg_add_value(struct ldb_message *msg, const char *attr_name, const struct ldb_val *INPUT);\n+int ldb_msg_add_value(struct ldb_message *msg, const char *attr_name, const struct ldb_val *INPUT, struct ldb_message_element **return_el);\n \n void ldb_msg_remove_attr(struct ldb_message *msg, const char *attr);\n \n-int ldb_msg_sanity_check(struct ldb_message *msg);\n-\n-/* DN operations */\n-\n-struct ldb_dn *ldb_dn_explode(void *mem_ctx, const char *dn);\n-\n-char *ldb_dn_linearize(void *mem_ctx, const struct ldb_dn *dn);\n+int ldb_msg_sanity_check(struct ldb_context *ctx, const struct ldb_message *msg);\n\n=== modified file 'source/lib/python/config.m4'\n--- a/source/lib/python/config.m4\t2007-04-24 10:52:53 +0000\n+++ b/source/lib/python/config.m4\t2007-04-24 15:41:33 +0000\n@@ -1519,7 +1519,7 @@\n fi\n \n AC_DEFINE_UNQUOTED(PLATFORM, $MACHDEP, [Platforms])\n-SMB_SUBSYSTEM(LIBPYTHON, [], [INTERNAL_PYTHON])\n+SMB_SUBSYSTEM(LIBPYTHON, [], [INTERNAL_PYTHON], [-Ilib/python/Include -Ilib/python])\n SMB_ENABLE(python)\n SMB_ENABLE(pgen)\n PYTHON=\"$builddir/bin/python\"\n\n=== modified file 'source/lib/tdb/config.mk'\n--- a/source/lib/tdb/config.mk\t2007-04-17 17:24:02 +0000\n+++ b/source/lib/tdb/config.mk\t2007-04-24 15:41:33 +0000\n@@ -60,9 +60,8 @@\n \n #######################\n # Start LIBRARY swig_tdb\n-[LIBRARY::swig_tdb]\n-LIBRARY_REALNAME = swig/_tdb.$(SHLIBEXT)\n-OBJ_FILES = swig/tdb_wrap.o\n+[SWIG::swig_tdb]\n+SWIG_FILE = swig/tdb.i\n PUBLIC_DEPENDENCIES = LIBTDB DYNCONFIG\n # End LIBRARY swig_tdb\n #######################\n\n=== modified file 'source/libcli/config.mk'\n--- a/source/libcli/config.mk\t2006-11-12 02:49:05 +0000\n+++ b/source/libcli/config.mk\t2007-04-24 15:41:33 +0000\n@@ -56,9 +56,8 @@\n PUBLIC_DEPENDENCIES = LIBNDR NDR_NBT LIBCLI_COMPOSITE LIBEVENTS \\\n \tNDR_SECURITY samba-socket LIBSAMBA-UTIL\n \n-[LIBRARY::swig_libcli_nbt]\n-LIBRARY_REALNAME = swig/_libcli_nbt.$(SHLIBEXT)\n-OBJ_FILES = swig/libcli_nbt_wrap.o\n+[SWIG::swig_libcli_nbt]\n+SWIG_FILE = swig/libcli_nbt.i\n PUBLIC_DEPENDENCIES = LIBCLI_NBT DYNCONFIG LIBSAMBA-CONFIG\n \n [SUBSYSTEM::LIBCLI_DGRAM]\n\n=== modified file 'source/scripting/swig/config.mk'\n--- a/source/scripting/swig/config.mk\t2007-02-26 16:18:23 +0000\n+++ b/source/scripting/swig/config.mk\t2007-04-24 15:41:33 +0000\n@@ -1,9 +1,8 @@\n #######################\n # Start LIBRARY swig_dcerpc\n-[LIBRARY::swig_dcerpc]\n-LIBRARY_REALNAME = _dcerpc.$(SHLIBEXT)\n+[SWIG::swig_dcerpc]\n+SWIG_FILE = dcerpc.i\n PUBLIC_DEPENDENCIES = LIBCLI_SMB NDR_MISC LIBSAMBA-UTIL LIBSAMBA-CONFIG dcerpc_samr RPC_NDR_LSA DYNCONFIG\n-OBJ_FILES = dcerpc_wrap.o\n # End LIBRARY swig_dcerpc\n #######################\n \n\n"}