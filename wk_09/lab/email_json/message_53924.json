{"category": "ham", "to_address": "openvpn-users@lists.sourceforge.net, samba-technical@lists.samba.org,\n   wireshark-users@wireshark.org", "from_address": "Gerhard Wiesinger <lists@wiesinger.com>", "subject": "Nasty problem on slow connection over OpenVPN with Samba", "body": "Hello!\n\nI'm running openvpn (latest stable with UDP) between 2 internet \nconnections (A:4MBit download, 512kBit upload and B:3MBit download and \n384kBit Upload). A is Linux (Fedora 7) and B is Windows XP SP2.\n\nOpenvpn normally runs without any problem for years.\n\nRunning netio (with some self written flushing patches for slow speed \nconnections for more accurate values) it gives the following performance:\nTCP connection established.\nPacket size  1k bytes:  33833 Byte/s Tx,  57856 Byte/s Rx.\nPacket size  2k bytes:  38690 Byte/s Tx,  57802 Byte/s Rx.\nPacket size  4k bytes:  37098 Byte/s Tx,  57936 Byte/s Rx.\nPacket size  8k bytes:  37923 Byte/s Tx,  58022 Byte/s Rx.\nPacket size 16k bytes:  37028 Byte/s Tx,  58070 Byte/s Rx.\nPacket size 32k bytes:  36081 Byte/s Tx,  58003 Byte/s Rx.\nDone.\n\nSo this is quite a good performance from A to B with a downstream of \naround 57kB/s. (At least sufficient for 320kBit/s downstream)\n\nI'm running Winamp to play MP3 files up to 320kBit/s (40kB/s). When \nBitrate gets high up to 320kBit I get very often some buffer underuns. (It \ndoesn't happen with 128kBit files). Stream is from A to B.\n\nSo I tracked down the problem with wireshark and tcpdump to:\nTCP MSS size is ok (1343 Bytes)\nCaptured on the Linux/Samba side:\n1.) Linux Samba Server sends a SMB Read Andx Response\n2.) 44ms later the correct tcp acknowledge is received (wireshark has no \nerror here)\n3.) 312ms later Linux sends out the packet (1) again. Why?\n4.) Afterwards a dup ack is received.\n\nWhy does Linux resend packet 1 at 3?\n\nThe dropouts happen when the retransmissions occour.\n\nSamba (3.0.25a) configuration looks like (relevant I think so):\nsocket options = TCP_NODELAY SO_RCVBUF=65536 SO_SNDBUF=8192\n\nIn general I would say that windows shares are slow over openvpn.\n\nIf you need any further information please let me know.\n\nAny ideas?\n\nThank you for the answer.\n\nCiao,\nGerhard\n\n--\nhttp://www.wiesinger.com/\n\n"}