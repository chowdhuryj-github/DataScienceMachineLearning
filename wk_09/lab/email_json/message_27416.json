{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r22785 - in branches: SAMBA_3_0_25/source/smbd\n\tSAMBA_3_0_26/source/smbd", "body": "Author: vlendec\nDate: 2007-05-11 08:27:00 +0000 (Fri, 11 May 2007)\nNew Revision: 22785\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22785\n\nLog:\nMerge Tridge's \"fixed change notify for delete on close\" r22784\n\nModified:\n   branches/SAMBA_3_0_25/source/smbd/close.c\n   branches/SAMBA_3_0_26/source/smbd/close.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_25/source/smbd/close.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/smbd/close.c\t2007-05-11 07:22:10 UTC (rev 22784)\n+++ branches/SAMBA_3_0_25/source/smbd/close.c\t2007-05-11 08:27:00 UTC (rev 22785)\n@@ -287,6 +287,10 @@\n \t\tstatus = map_nt_error_from_unix(errno);\n \t}\n \n+\tnotify_fname(conn, NOTIFY_ACTION_REMOVED,\n+\t\t     FILE_NOTIFY_CHANGE_FILE_NAME,\n+\t\t     fsp->fsp_name);\n+\n \t/* As we now have POSIX opens which can unlink\n  \t * with other open files we may have taken\n  \t * this code path with more than one share mode\n\nModified: branches/SAMBA_3_0_26/source/smbd/close.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/smbd/close.c\t2007-05-11 07:22:10 UTC (rev 22784)\n+++ branches/SAMBA_3_0_26/source/smbd/close.c\t2007-05-11 08:27:00 UTC (rev 22785)\n@@ -287,6 +287,10 @@\n \t\tstatus = map_nt_error_from_unix(errno);\n \t}\n \n+\tnotify_fname(conn, NOTIFY_ACTION_REMOVED,\n+\t\t     FILE_NOTIFY_CHANGE_FILE_NAME,\n+\t\t     fsp->fsp_name);\n+\n \t/* As we now have POSIX opens which can unlink\n  \t * with other open files we may have taken\n  \t * this code path with more than one share mode\n\n"}