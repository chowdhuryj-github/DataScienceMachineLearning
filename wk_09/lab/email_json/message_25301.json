{"category": "ham", "to_address": "sugar@laptop.org", "from_address": "Dafydd Harries <dafydd.harries@collabora.co.uk>", "subject": "Re: [sugar] [patch][connect-activity] Update to high-level API in\n\tlatest dbus-python", "body": "Ar 04/05/2007 am 19:16, ysgrifennodd Simon McVittie:\n> -def guess(x):\n> -    if x.lower() in ('true', 'false'):\n> -        return\n> -\n> -    if x == 'true':\n> -        return True\n> -\n> -    if x == 'false':\n> -        return False\n> -\n> -    try:\n> -        return int(x)\n> -    except ValueError:\n> -        pass\n> -\n> -    return x\n> +def decode(x, sig):\n> +    # XXX: dbus-python ought to do most of the work for this\n> +    if sig == 'b':\n> +        x = x.lower()\n> +        if x in ('true', '1'):\n> +            return True\n> +        if x in ('false', '0'):\n> +            return False\n> +        raise ValueError('Not true or false: %r' % x)\n> +    elif sig == 'n':\n> +        return dbus.Int16(x)\n> +    elif sig == 'q':\n> +        return dbus.UInt16(x)\n> +    elif sig == 'i':\n> +        return dbus.Int32(x)\n> +    elif sig == 'u':\n> +        return dbus.UInt32(x)\n> +    elif sig == 'x':\n> +        return dbus.Int64(x)\n> +    elif sig == 't':\n> +        return dbus.UInt64(x)\n> +    elif sig == 'd':\n> +        return dbus.Double(x)\n> +    elif sig == 's':\n> +        return dbus.UTF8String(x)\n> +    else:\n> +        raise TypeError('Unhandled D-Bus signature %r' % sig)\n\ntelepathy-python's examples/account.py currently does something like guess()\nrather than something like decode(). That should probably be changed.\n\n> --- a/client.py\n> +++ b/client.py\n> @@ -1,25 +1,28 @@\n> -\n>  import pprint\n>  \n> -import dbus.glib\n>  import gtk\n>  import telepathy\n>  \n> -# Needed for now, as dbus-python's high-level API doesn't support connecting\n> -# to arbitrary addresses, or daemonless connections.\n>  import _dbus_bindings\n>  import dbus.lowlevel\n\nAre these still necessary?\n\n> +from dbus.connection import Connection\n> +from dbus.mainloop.glib import DBusGMainLoop\n> +from dbus.service import Object\n> +\n> +from telepathy.interfaces import CHANNEL_TYPE_TUBES, \\\n> +        CHANNEL_TYPE_TEXT, CONN_INTERFACE, CHANNEL_INTERFACE_GROUP\n> +from telepathy.constants import TUBE_TYPE_DBUS, \\\n> +        TUBE_STATE_LOCAL_PENDING, TUBE_STATE_REMOTE_PENDING, TUBE_STATE_OPEN, \\\n> +        CONNECTION_STATUS_CONNECTED, HANDLE_TYPE_ROOM\n\nI have a slight preference towards just using \"import telepathy\" rather than\n\"from telepathy import (long list of constants)\", but I'm not hugely partial,\nso this is ok.\n\n> +dbus_main_loop = DBusGMainLoop(set_as_default=True)\n\nStatements in libraries considered dubious. In other words, \"import x\"\nshouldn't cause side-effects.\n\nWhat does this actually do? Does it create a new GLib mainloop? Will it cause\nodd things to happen if another DBusGMainLoop loop has already been installed?\n\n>  def print_dbus_message(msg):\n>      print 'got %s' % (msg.__class__.__name__)\n\nIs this still used? If not, remove it.\n\n> From bdc429db799fb8f18a48ba75fd81e673bb50da01 Mon Sep 17 00:00:00 2001\n> From: Simon McVittie \n> Date: Fri, 4 May 2007 17:40:20 +0100\n> Subject: [PATCH] client.py: split out game code into a service.Object\n\n...\n\n> +logging.basicConfig()\n> +_logger = logging.getLogger('connect-activity.client')\n\nIs this idempotent? The documentation is ambiguous:\n\n  Does basic configuration for the logging system by creating a StreamHandler\n  with a default Formatter and adding it to the root logger. The functions\n  debug(), info(), warning(), error() and critical() will call basicConfig()\n  automatically if no handlers are defined for the root logger.\n\nDoes this cause side effects if a handler is defined for the root logger\nalready? (Whatever that means. :P)\n\n> +class ConnectGame(Object):\n\nNicely done. Perhaps this should even be split out into a separate file, e.g.\ngame.py.\n\n-- \nDafydd\n_______________________________________________\nSugar mailing list\nSugar@laptop.org\nhttp://mailman.laptop.org/mailman/listinfo/sugar\n\n"}