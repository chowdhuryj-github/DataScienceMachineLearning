{"category": "ham", "to_address": "Danny Tylman <danny.tylman@insightix.com>", "from_address": "\"Gerald (Jerry) Carter\" <jerry@samba.org>", "subject": "Re: [Samba] Re: Win32 services management?", "body": "-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA1\n\n[Moving to Samba-technical for dev discussion]\n\nDanny,\n\n> I am facing some difficulties in implementing the parser \n> function. Somehow - I keep getting a 'nca_s_fault_ndr' responses.\n> \n> I guess this is due invalid parsing of parameters. I am \n> counting on the IDL specified here:\n> \n> http://websvn.samba.org/cgi-bin/viewcvs.cgi/branches/SAMBA_4_0/source/librpc/idl/svcctl.idl?rev=18639&view=markup\n> \n> \n> And having couple of problems:\n\nFirst, are you using bzr for source control?  This would be\nhelpful in reviewing your patches.\n\nIf you need more details on using bzr with Samba svn trees,\nSee http://wiki.samba.org/index.php/Using_Bazaar_for_Samba_Development\n\n>   1.\n>      svcctl_CreateServiceW defines [in,size_is(dependencies_size)] \n> uint8 *dependencies and [in] uint32 dependencies_size.\n> Which are uint8 type - I think I can use a RPC_DATA_BLOB\n> for that. This type appear in several places - including\n> the username/pass combination for the service user.\n> Looking at a Windows packet created with the CreateService() \n> API, I can see the password is encrypted. I don't know\n> how to resolve this issue.\n\nWhat is the password length ?  I'd assume it is some derivative\nof the the NTLM hash (it not the hash itself).\n\n>   2. I am trying to create a simple service, ignoring \n>      all the complicated issues, that is: passing 'null'\n>      at all places I don't have to implement. But yet - all\n>      I am getting is a 'nca_s_fault_ndr'.\n\nSomething is off with the parsing functions.  Specifically the PDU you\nare sending.\n\n>   3. Questions:\n>      1. How much should I count on the Samba4 IDL? How is it\n>         generated? I found no official documentation on that.\n\nIt's generally very accurate although I remember having to flesh\nout a few places where the svcctl calls were wrong.\n\n>      2. Looking at the SMB package data I see that the\n>         'Policy_handle' part is larger (in size) than the Windows\n>         counterpart, my function does the same as the others\n>         regarding this handle, so I am just ignoring this issue. Is\n>         it wise?\n\nThe handle is always 20 bytes.  Can you send me a packet trace\nto point out what you mean here ?\n\n>      3. I don't quite understand if it matters to declare a pointer\n>         in the code (UNISTR2 *str) and then use the prs_pointer()\n>         function rather than declaring a variable (UNISTR2 str) and\n>         using the smb_io_unistr2() function. I saw the latter do\n>         some padding (prs_align()), but I keep getting gaps in my\n>         packets which I can't explain - no matter which function I use.\n\nSome rpc PDUs always have the string.  Others use a 32bit pointer\nto indicate whether the string value is present or not.  These two\ninstances (a UNISTR2 and a UNIST2R2*) are parsed differently.\n\n\n\n\n\n\ncheers, jerry\n=====================================================================\nSamba                                    ------- http://www.samba.org\nCenteris                         -----------  http://www.centeris.com\n\"What man is a man who does not make the world better?\"      --Balian\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1.4.3 (GNU/Linux)\nComment: Using GnuPG with Mozilla - http://enigmail.mozdev.org\n\niD8DBQFGHRSBIR7qMdg1EfYRAnXqAJ9ydo0Ur6mllerjF5Ta0/q2H0DiIQCfQChW\n4KDmYe5wLlvOYlTt9C3D55M=\n=zh7g\n-----END PGP SIGNATURE-----\n\n"}