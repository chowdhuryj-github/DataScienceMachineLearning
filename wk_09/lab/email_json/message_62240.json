{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "ocelma@iua.upf.edu", "subject": "[R] Long-tail model in R ... anyone?", "body": "Dear all,\n\nfirst I would like to tell you that I've been using R for two days... (so,\nyou can predict my knowledge of the language!).\n\nYet, I managed to implement some stuff related with the Long-Tail model [1].\nI did some tests with the data in table 1 (from [1]), and plotted figure 2\n(from [1]). (See R code and CSV file at the end of the email)\n\nNow, I'm stuck in the nonlinear regression model of F(x). I got a nice error:\n\"\nError in nls(~F(r, N50, beta, alfa), data = dataset, start = list(N50 =\nN50,  : singular gradient\n\"\n\nAnd, yes, I've been looking for how to solve this (via this mailing list +\nsome google), and I could not come across to a proper solution. That's why\nI am asking the experts to help me! :-)\n\nSo, any help would be much appreciated...\n\nCheers, Oscar\n[1] http://www.firstmonday.org/issues/issue12_5/kilkki/\n\nPS: R code and CVS file\n\nFILE: \"data.R\" (data taken from [1] Table 1, columns 1 and 2)\n--8=<-------------------\n\"rank\",\"cum_value\"\n10,     17396510\n32,     31194809\n96,     53447300\n420,    100379331\n1187,   152238166\n24234,  432238757\n91242,  581332371\n294180, 650880870\n1242185,665227287\n-->=8-------------------\n\nR CODE:\n\n#\n# F(x). The long-tail model\n# Reference: http://www.firstmonday.org/issues/issue12_5/kilkki/\n# Params:\n#       x   :   Rank (either an integer or a list)\n#       N50 :   the number of objects that cover half of the whole volume\n#       beta:   total volume\n#       alfa:   the factor that defines the form of the function\nF <- function (x, N50, beta=1.0, alfa=0.49)\n{\n        xx <- as.numeric(x) # as.numeric() prevents overflow\n        Fx = beta / ( (N50/xx)^alfa + 1 )\n        Fx\n}\n\n# Read CSV file (rank, cum_value)\nlt <- read.csv(file=\"data.R\",head=TRUE,sep=\",\")\n\nr <- lt$rank\nv <- lt$cum_value\npcnt <- v/v[length(v)] *100 # get cumulative percentage\nplot(r, pcnt, log=\"x\", type='l', xlab='Ranking', ylab='Cumulative\npercentatge of sales', main=\"Books Popularity\", sub=\"The long-tail\neffect\", col='blue')\n\n# Set some default values to be used by F(x)...\nalfa = 0.49\nbeta = 1.38\nN50 = 30714\n\n# Start using F(x). Results are in 'f' ...\nf <- c(0) # oops! is this the best initialization for 'f'?\nfor (i in 1:24234) f[i] <- F(i, N50, beta, alfa)*100\n\n# Plot some estimated values from F(x) (N50, beta, and alfa values come\nfrom the paper. See ref. [1])\nplot(f, log=\"x\", type='l', xlab='Ranking', ylab='Cumulative percentatge of\nsales', main=\"Books Popularity\", sub=\"Plotting first values of F(x) and\nsome real points\")\npoints(r, pcnt, col=\"blue\") # adding the \"real\" points\n\n# Create a dataset to be used by nls()\ndataset <- data.frame(r, pcnt)\n\n# Verifying that F(x) works fine... (comparing with the \"real\" values\ncontained in the dataset)\n\ndataset\nF(10, N50, beta, alfa) * 100\nF(32, N50, beta, alfa) * 100\nF(96, N50, beta, alfa) * 100\nF(420, N50, beta, alfa) * 100\nF(1187, N50, beta, alfa) * 100\nF(24234, N50, beta, alfa) * 100\nF(91242, N50, beta, alfa) * 100\nF(294180, N50, beta, alfa) * 100\nF(1242185, N50, beta, alfa) * 100\n\n#dataset <- data.frame(pcnt) # which dataset should I use? Should I\ninclude the ranks in it?\nnls( ~ F(r, N50, beta, alfa), data = dataset, start = list(N50=N50,\nbeta=beta, alfa=alfa), trace = TRUE )\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}