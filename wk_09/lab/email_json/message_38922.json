{"category": "ham", "to_address": "Nicholas Clark <nwc10@colon.colondot.net>", "from_address": "Andy Spieherty <spiehera@lafayette.edu>", "subject": "Re: [svn:parrot] r18661 - trunk/config/init/hints", "body": "On Mon, 28 May 2007, Nicholas Clark wrote:\n\n> On Sat, May 26, 2007 at 08:14:30PM -0700, chromatic@cvs.perl.org wrote:\n\n> > +++ trunk/config/init/hints/linux.pm\tSat May 26 20:14:29 2007\n> > @@ -52,6 +52,9 @@\n> >          }\n> >      }\n> >      else {\n> > +        # hide non-exported symbols\n> > +        $cflags .= ' -fvisibility=hidden';\n> > +\n> >          if ( $ld_share_flags !~ /-fPIC/ ) {\n> >              $ld_share_flags .= ' -fPIC';\n> >          }\n> > @@ -87,6 +90,7 @@\n> >          libparrot_shared       => 'libparrot$(SHARE_EXT).$(SOVERSION)',\n> >          libparrot_shared_alias => 'libparrot$(SHARE_EXT)',\n> >          libparrot_soname       => '-Wl,-soname=libparrot$(SHARE_EXT).$(SOVERSION)',\n> > +        sym_export             => '__attribute__ ((visibility(\"default\")))',\n> >      );\n> >  \n> >      if ( ( split( '-', $Config{archname} ) )[0] eq 'ia64' ) {\n> \n> This is something I really approve of, but it can't be done unconditionally.\n> Is the gcc version kept somewhere convenient in the configure data structures?\n\nYes it is.  Although the gccversion test hasn't been called when the hints \nfile is processed, the Configure system does have a fairly complete set of \ncallback \"triggers\" that can be used to run this code at the right time.  \nThe solaris hints file has examples of using such triggers.  I think the \nsolaris cc_shared trigger is probably a good example to follow here. \n(Though it looks like my comment about a hypothetical shlibs.pl unit is no \nlonger quite applicable since there now appears to be a shlibs.pm unit. \nPerhaps I should fix that up some day.)\n\n-- \n    Andy Spieherty\t\tspiehera@lafayette.edu\n\n"}