{"category": "ham", "to_address": "bugs-bitbucket@netlabs.develooper.com", "from_address": "James Keenan (via RT) <parrotbug-followup@parrotcode.org>", "subject": "[perl #42362] [TODO]:  Unit tests for modules used during configuration ", "body": "# New Ticket Created by  James Keenan \n# Please include the string:  [perl #42362]\n# in the subject line of all future correspondence about this issue. \n# \n\n\nSuppose that I run the tests in t/configure/*.t with Devel::Cover:\n\n$> cover -delete coverage/configure/\n$> PERL5OPT=-MDevel::Cover=-db,coverage/configure prove t/configure/ \n*.t \"$@\"\n$> cover coverage/configure/ -ignore_re '^(t\\/configure|\\/usr|lib\\/(?! \nParrot))'\nor\n$> cover coverage/configure/ -ignore_re '^(t\\/configure|\\/usr|lib\\/(?! \nParrot))' -report=text > coverage/analysis.configure.txt\n\nThe resulting coverage analysis suggests that considerable code in  \nthe config/*/*.pm tree is not reached by these tests.  Here's an  \nexcerpt; see attachment for more.\n\n---------------------------- ------ ------ ------ ------ ------  \n------ ------\nFile                           stmt   bran   cond    sub    pod    \ntime  total\n---------------------------- ------ ------ ------ ------ ------  \n------ ------\nconfig/auto/aio.pm             45.5    0.0    n/a   83.3    n/a     \n0.1   42.6\nconfig/auto/alignptrs.pm       42.9    0.0    0.0   85.7    n/a     \n0.0   35.8\nconfig/auto/byteorder.pm       53.6    0.0    n/a   83.3    n/a     \n0.0   50.0\nconfig/auto/cgoto.pm           41.7    0.0    0.0   83.3    n/a     \n0.0   37.0\nconfig/auto/cpu.pm             58.1    0.0    n/a   85.7    n/a     \n0.0   52.2\n\nIn every case I've examined, the runsteps() method is untested by the  \ntest suite in question.  Writing a test for that method would usually  \nboost subroutine coverage to 100% and would go along way toward  \ngetting decent statement coverage.\n\nAre these modules touched by tests in some other location?  Ack-ing a  \nsample of them from the top level in my sandbox suggests not.\n\n##### START ACK #####\n[parrot] 517 $ ack --nohtml --nophp 'auto(\\/|::)python'\nconfig/auto/python.pm\n6:config/auto/python - Check whether python is there\n18:package auto::python;\n\nConfigure.pl\n345:    auto::python\n##### END ACK #####\n\nAssignment:\n\nWrite unit tests for each module found under config/.\n\nSuch tests should be run in a 'pre-Configure.pl' state, i.e., they  \nshould be executable at the point after checking out a Parrot  \nrepository branch and before you have invoked Configure.pl.\n\nAny files or directories created while running such tests should be  \ncreated in temporary directories that are automatically cleaned up at  \nthe end of a single test script's execution.\n\nkid51\n\n"}