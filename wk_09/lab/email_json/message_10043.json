{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "francogrex <francogrex@mail.com>", "subject": "Re: [R] Conditional power, predictive power", "body": "\nOk I am replying to my own message! I wrote a \"function\", it works well but\nit's a bit twisted because you will have to edit the last file in excel or\nother.\nThis is to analyze the bayesian predictive power in an analysis where\ntreatment x is compared to treatment y. Example: Total final subject number\nis 100 (randomization 1:1, so 50 per group). We do an interim analysis when\nthere are 25 subjects in group x and 25 subjects in group y. Number of\nsuccesses in x=10; number of successes in y=16. Prior=beta(0.6,0.4).\n----------------------------------------------------------------------------------------------------------------\n\n##Predictive Probability Interim Analysis, John Cook, 2006\n\nprepower=function(a,b,s0,f0,s1,f1){\nfactorial(s1+f1)/ (factorial(s1)*factorial(f1))*\nbeta(s0+s1+a,f0+f1+b)/beta(s0+a,f0+b)}\n\nfor(i in 0:25) {sink(\"pw.power1.txt\",append=TRUE);\nv=prepower(0.6,0.4,10,15,i,25-i)\ndput(v)\nsink()\n}\nfor(i in 0:25) {sink(\"pw.power2.txt\",append=TRUE);\nv=prepower(0.6,0.4,16,9,i,25-i)\ndput(v)\nsink()\n}\n\nx=scan(file=\"pw.power1.txt\")\ny=scan(file=\"pw.power2.txt\")\n\nzth=function(xa,ya,na,xb,yb,nb){\ntha=(xa+ya)/na\nthb=(xb+yb)/nb\nth=(xa+xb+ya+yb)/(na+nb)\nz=(tha-thb)/sqrt(th*(1-th)*((1/na)+(1/na)))\nz\n}\n\nfor(i in 0:25){sink(\"pw.zval.txt\",append=TRUE)\nzval=(zth(10,i,50,16,0:25,50))\ncat(zval,sep=\"\\n\")\nsink()\n}\nz=scan(file=\"pw.zval.txt\")\n\nfor(i in 1:26){sink(\"pw.predict.txt\",append=TRUE)\npw=((x[i]*y[1:26]))\ncat(pw,sep=\"\\n\")\nsink()\n}\np=scan(file=\"pw.predict.txt\")\n\nmdf <- data.frame(z, p) \npw.bind=mdf[order(z,p),] \nwrite.table(pw.bind,file=\"pw.bind.txt\",sep=\"\\t\")\n\n##edit pw.bind file in excel for z>1.96, z<-1.96 or in between (or any other\nvalue); save as same file\n\npredictive=read.table(file=\"pw.bind.txt\",header=TRUE)\nsum(predictive$p)\n\n## This gives the bayesian predictive power\n\n-- \nView this message in context: http://www.nabble.com/Conditional-power%2C-predictive-power-tf3603396.html#a10079648\nSent from the R help mailing list archive at Nabble.com.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}