{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23278 - in branches/SAMBA_3_0_26/source: include\n\tlibmsrpc rpc_client rpc_parse utils", "body": "Author: jerry\nDate: 2007-05-31 21:15:53 +0000 (Thu, 31 May 2007)\nNew Revision: 23278\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23278\n\nLog:\nremove vestiges of rpccli_reg_close()\nModified:\n   branches/SAMBA_3_0_26/source/include/rpc_reg.h\n   branches/SAMBA_3_0_26/source/libmsrpc/cac_winreg.c\n   branches/SAMBA_3_0_26/source/rpc_client/cli_reg.c\n   branches/SAMBA_3_0_26/source/rpc_parse/parse_reg.c\n   branches/SAMBA_3_0_26/source/utils/net_rpc_registry.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/include/rpc_reg.h\n===================================================================\n--- branches/SAMBA_3_0_26/source/include/rpc_reg.h\t2007-05-31 21:09:57 UTC (rev 23277)\n+++ branches/SAMBA_3_0_26/source/include/rpc_reg.h\t2007-05-31 21:15:53 UTC (rev 23278)\n@@ -348,19 +348,7 @@\n /***********************************************/\n \n typedef struct {\n-\tPOLICY_HND pol; /* policy handle */\n-} REG_Q_CLOSE;\n-\n-typedef struct {\n \tPOLICY_HND pol; \n-\tWERROR status; \n-} REG_R_CLOSE;\n-\n-\n-/***********************************************/\n-\n-typedef struct {\n-\tPOLICY_HND pol; \n \tuint32 key_index;       \n \tuint16 key_name_len;   \n \tuint16 unknown_1;       /* 0x0414 */\n\nModified: branches/SAMBA_3_0_26/source/libmsrpc/cac_winreg.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libmsrpc/cac_winreg.c\t2007-05-31 21:09:57 UTC (rev 23277)\n+++ branches/SAMBA_3_0_26/source/libmsrpc/cac_winreg.c\t2007-05-31 21:15:53 UTC (rev 23278)\n@@ -93,7 +93,6 @@\n \t\t  POLICY_HND * key )\n {\n \tstruct rpc_pipe_client *pipe_hnd = NULL;\n-\tWERROR err;\n \n \tif ( !hnd )\n \t\treturn CAC_FAILURE;\n@@ -114,8 +113,7 @@\n \t\treturn CAC_FAILURE;\n \t}\n \n-\terr = rpccli_reg_close( pipe_hnd, mem_ctx, key );\n-\thnd->status = werror_to_ntstatus( err );\n+\thnd->status = rpccli_winreg_CloseKey( pipe_hnd, mem_ctx, key );\n \n \tif ( !NT_STATUS_IS_OK( hnd->status ) ) {\n \t\treturn CAC_FAILURE;\n@@ -203,8 +201,7 @@\n \n \tif ( !op->in.parent_key ) {\n \t\t/*then close the one that we opened above */\n-\t\terr = rpccli_reg_close( pipe_hnd, mem_ctx, parent_key );\n-\t\thnd->status = werror_to_ntstatus( err );\n+\t\thnd->status = rpccli_winreg_CloseKey( pipe_hnd, mem_ctx, parent_key );\n \n \t\tif ( !NT_STATUS_IS_OK( hnd->status ) ) {\n \t\t\treturn CAC_FAILURE;\n@@ -436,7 +433,7 @@\n \t\trpccli_reg_flush_key( pipe_hnd, mem_ctx, key );\n \n \t\t/*close the key that we opened */\n-\t\trpccli_reg_close( pipe_hnd, mem_ctx, &subkey );\n+\t\trpccli_winreg_CloseKey( pipe_hnd, mem_ctx, &subkey );\n \n \t\t/*now we delete the subkey */\n \t\terr = rpccli_reg_delete_key( pipe_hnd, mem_ctx, key,\n\nModified: branches/SAMBA_3_0_26/source/rpc_client/cli_reg.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_client/cli_reg.c\t2007-05-31 21:09:57 UTC (rev 23277)\n+++ branches/SAMBA_3_0_26/source/rpc_client/cli_reg.c\t2007-05-31 21:15:53 UTC (rev 23278)\n@@ -635,31 +635,6 @@\n }\n \n /****************************************************************************\n-****************************************************************************/\n-\n-WERROR rpccli_reg_close(struct rpc_pipe_client *cli, TALLOC_CTX *mem_ctx,\n-                       POLICY_HND *hnd)\n-{\n-\tREG_Q_CLOSE in;\n-\tREG_R_CLOSE out;\n-\tprs_struct qbuf, rbuf;\n-\n-\tZERO_STRUCT (in);\n-\tZERO_STRUCT (out);\n-\t\n-\tinit_reg_q_close(&in, hnd);\n-\n-\tCLI_DO_RPC_WERR( cli, mem_ctx, PI_WINREG, REG_CLOSE, \n-\t            in, out, \n-\t            qbuf, rbuf,\n-\t            reg_io_q_close,\n-\t            reg_io_r_close, \n-\t            WERR_GENERAL_FAILURE );\n-\t\n-\treturn out.status;\n-}\n-\n-/****************************************************************************\n do a REG Query Info\n ****************************************************************************/\n \n\nModified: branches/SAMBA_3_0_26/source/rpc_parse/parse_reg.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_parse/parse_reg.c\t2007-05-31 21:09:57 UTC (rev 23277)\n+++ branches/SAMBA_3_0_26/source/rpc_parse/parse_reg.c\t2007-05-31 21:15:53 UTC (rev 23278)\n@@ -685,66 +685,6 @@\n }\n \n /*******************************************************************\n- Inits an REG_Q_CLOSE structure.\n-********************************************************************/\n-\n-void init_reg_q_close(REG_Q_CLOSE *q_c, POLICY_HND *hnd)\n-{\n-\tDEBUG(5,(\"init_reg_q_close\\n\"));\n-\n-\tmemcpy(&q_c->pol, hnd, sizeof(q_c->pol));\n-}\n-\n-/*******************************************************************\n-reads or writes a structure.\n-********************************************************************/\n-\n-BOOL reg_io_q_close(const char *desc,  REG_Q_CLOSE *q_u, prs_struct *ps, int depth)\n-{\n-\tif (q_u == NULL)\n-\t\treturn False;\n-\n-\tprs_debug(ps, depth, desc, \"reg_io_q_close\");\n-\tdepth++;\n-\n-\tif(!prs_align(ps))\n-\t\treturn False;\n-\n-\tif(!smb_io_pol_hnd(\"\", &q_u->pol, ps, depth))\n-\t\treturn False;\n-\tif(!prs_align(ps))\n-\t\treturn False;\n-\n-\treturn True;\n-}\n-\n-/*******************************************************************\n-reads or writes a structure.\n-********************************************************************/\n-\n-BOOL reg_io_r_close(const char *desc,  REG_R_CLOSE *r_u, prs_struct *ps, int depth)\n-{\n-\tif ( !r_u )\n-\t\treturn False;\n-\n-\tprs_debug(ps, depth, desc, \"reg_io_r_close\");\n-\tdepth++;\n-\n-\tif(!prs_align(ps))\n-\t\treturn False;\n-\n-\tif(!smb_io_pol_hnd(\"\", &r_u->pol, ps, depth))\n-\t\treturn False;\n-\tif(!prs_align(ps))\n-\t\treturn False;\n-\n-\tif(!prs_werror(\"status\", ps, depth, &r_u->status))\n-\t\treturn False;\n-\n-\treturn True;\n-}\n-\n-/*******************************************************************\n makes a structure.\n ********************************************************************/\n \n\nModified: branches/SAMBA_3_0_26/source/utils/net_rpc_registry.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/net_rpc_registry.c\t2007-05-31 21:09:57 UTC (rev 23277)\n+++ branches/SAMBA_3_0_26/source/utils/net_rpc_registry.c\t2007-05-31 21:15:53 UTC (rev 23278)\n@@ -186,8 +186,8 @@\n \t/* cleanup */\n \t\n \tif ( strlen( subpath ) != 0 )\n-\t\trpccli_reg_close(pipe_hnd, mem_ctx, &pol_key );\n-\trpccli_reg_close(pipe_hnd, mem_ctx, &pol_hive );\n+\t\trpccli_winreg_CloseKey(pipe_hnd, mem_ctx, &pol_key );\n+\trpccli_winreg_CloseKey(pipe_hnd, mem_ctx, &pol_hive );\n \n \treturn werror_to_ntstatus(result);\n }\n@@ -249,8 +249,8 @@\n \t\n \t/* cleanup */\n \t\n-\trpccli_reg_close(pipe_hnd, mem_ctx, &pol_key );\n-\trpccli_reg_close(pipe_hnd, mem_ctx, &pol_hive );\n+\trpccli_winreg_CloseKey(pipe_hnd, mem_ctx, &pol_key );\n+\trpccli_winreg_CloseKey(pipe_hnd, mem_ctx, &pol_hive );\n \n \treturn werror_to_ntstatus(result);\n }\n\n"}