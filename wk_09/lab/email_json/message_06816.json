{"category": "ham", "to_address": "\"Felix Wave\" <felix-wave@vr-web.de>", "from_address": "\"jim holtman\" <jholtman@gmail.com>", "subject": "Re: [R] Dataimport with readLines using skip= and nlines= ?", "body": "Will this work for you?\n\n> x.in <- \"EXAM NUM:2\n+ -----------------\n+ EXAM #1\n+ ASTIG:-2.4D\n+ AXIS:4.8\n+ START OF HEIGHT DATA\n+ S= 0 y=0.0 x=0.00000000\n+ S= 0 y=0.1 x=0.00055643\n+ S= 9 y=4.9 x=1.67278117\n+ S= 9 y=5.0 x=1.74873257\n+ S=10 y=0.0 x=0.00000000\n+ S=10 y=0.1 x=0.00075557\n+ S=99 y=5.3 x=1.94719490\n+ END OF HEIGHT DATA\n+ X POS:-0.299mm\n+ Y POS:0.442mm\n+ Z POS:-0.290mm\n+ -----------------\n+ EXAM #2\n+ ASTIG:-2.4D\n+ AXIS:4.8\n+ START OF HEIGHT DATA\n+ S= 0 y=0.0 x=0.00000000\n+ S= 0 y=0.1 x=0.00055643\n+ S= 9 y=4.9 x=1.67278117\n+ S= 9 y=5.0 x=1.74873257\n+ S=10 y=0.0 x=0.00000000\n+ S=10 y=0.1 x=0.00075557\n+ S=99 y=5.3 x=1.94719490\n+ END OF HEIGHT DATA\n+ X POS:-0.299mm\n+ Y POS:0.442mm\n+ Z POS:-0.290mm\n+ \"\n> # read in the lines and delete all except those containing \"S=\"\n> input <- readLines(textConnection(x.in))\n> input <- input[grep(\"S=\", input)]\n> # delete 'Sxy='\n> input <- gsub(\".=\", \"\", input)\n> # read in the data using scan\n> myData <- scan(textConnection(input), what=0)\nRead 42 items\n> matrix(myData, ncol=3, byrow=TRUE, dimnames=list(NULL, c(\"S\", \"y\", \"x\")))\n       S   y          x\n [1,]  0 0.0 0.00000000\n [2,]  0 0.1 0.00055643\n [3,]  9 4.9 1.67278117\n [4,]  9 5.0 1.74873257\n [5,] 10 0.0 0.00000000\n [6,] 10 0.1 0.00075557\n [7,] 99 5.3 1.94719490\n [8,]  0 0.0 0.00000000\n [9,]  0 0.1 0.00055643\n[10,]  9 4.9 1.67278117\n[11,]  9 5.0 1.74873257\n[12,] 10 0.0 0.00000000\n[13,] 10 0.1 0.00075557\n[14,] 99 5.3 1.94719490\n>\n\n\nOn 4/16/07, Felix Wave  wrote:\n> Hello,\n> I have a problem with readLines.\n> I have a data file with many informations added with a different number of measurments (example at the end).\n> I only want to read the measurments witch start with \"START OF HEIGHT DATA\" and end with \"END OF HEIGHT DATA\".\n>\n> The difficulty is:\n> -I want to read the file with \"readLines\", because the measurments have letters and\n> numbers (e.g. S=0.00012) witch have to be filtered for using a matrix (scan make errors).\n> -The second problem is, that the number of measurments is variable.\n>\n> My idea. I have the position (skip=r2) of the beginning of the measurments, the length (nlines=r1) and the number of all measurments (for (i in i:r3)).\n>\n> My problem and question. I need a command to read my measurments.\n> The readLine command has no possibility to skip lines. And the read.file command\n> can't filter my data.dat for (S= , S=, x=, y=).\n>\n> I hope you have an idea.\n> Thank's for all.\n> Felix\n>\n>\n>\n> My R Code:\n> --------------\n>\n> #################################################\n> #R Code to find to measurments in the data file #\n> #################################################\n> location <- my.read.file( \"dat.dat\" )\n>\n> my.read.file <- function(file=file){\n> a1 <- readLines( con=file, n=-1 )\n> a2 <- grep(\"START OF HEIGHT DATA|END OF HEIGHT DATA\", a1 )\n> a3 <- matrix(a2, ncol=2)              #matrix with the location of START & END\n> }\n>\n> r1 <- location[,2] - location[,1]    #distance between START & END\n> r2 <- location[,1]                         #position of START\n> r3 <- length(location) / 2             #number of START & ENDs\n>\n>\n> ################################################\n> # R Code to read the measurments ###############\n> ################################################\n> for (i in 1:r3)\n>\n> Measure[i] <- meas.read.file( \"dat.dat\" )                    #single matrix for every measurment\n>\n> meas.read.file <-  function(file=file){                           #HERE IS MY PROBLEM\n> #v1 <- read.table(\"dat.dat\", skip=r2[i], nlines=r3[i])  #HERE IS MY PROBLEM\n> v2 <- readLines( con=file, n=-1)\n> v3 <- gsub(\" \", \"\", v2)\n> v4 <- gsub( \"S=|y=|x=\", \" \", v3 )\n> v5 <- gsub(\"^ \", \"\", v4)\n>\n> m <- t( sapply( strsplit(v5, split=\" \"), as.numeric ) )\n> colnames(m) <- c(\"S\", \"y\", \"x\" )\n> return(m)\n> }\n>\n>\n>\n>\n> My Datafile:\n> ########\n>\n>\n> EXAM NUM:2\n> -----------------\n> EXAM #1\n> ASTIG:-2.4D\n> AXIS:4.8\n> START OF HEIGHT DATA\n> S= 0 y=0.0 x=0.00000000\n> S= 0 y=0.1 x=0.00055643\n> S= 9 y=4.9 x=1.67278117\n> S= 9 y=5.0 x=1.74873257\n> S=10 y=0.0 x=0.00000000\n> S=10 y=0.1 x=0.00075557\n> S=99 y=5.3 x=1.94719490\n> END OF HEIGHT DATA\n> X POS:-0.299mm\n> Y POS:0.442mm\n> Z POS:-0.290mm\n> -----------------\n> EXAM #2\n> ASTIG:-2.4D\n> AXIS:4.8\n> START OF HEIGHT DATA\n> S= 0 y=0.0 x=0.00000000\n> S= 0 y=0.1 x=0.00055643\n> S= 9 y=4.9 x=1.67278117\n> S= 9 y=5.0 x=1.74873257\n> S=10 y=0.0 x=0.00000000\n> S=10 y=0.1 x=0.00075557\n> S=99 y=5.3 x=1.94719490\n> END OF HEIGHT DATA\n> X POS:-0.299mm\n> Y POS:0.442mm\n> Z POS:-0.290mm\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\n\n-- \nJim Holtman\nCincinnati, OH\n+1 513 646 9390\n\nWhat is the problem you are trying to solve?\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}