{"category": "ham", "to_address": "Jeff Coffler <jeff-list-sambatech@taltos.com>", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: Problems with dfs and Samba 3.0.24-5/3.0.25-7 - please help", "body": "On Wed, May 16, 2007 at 05:59:41PM -0700, Jeff Coffler wrote:\n> Hi,\n> \n> I'm running Fedora Core 6, and I'm having a heck of a problem with \n> Samba.  I'm pretty sure it's related to the dfs code.  I noticed this \n> code change from Jeremy:\n> \n>    http://lists.samba.org/archive/samba-cvs/2007-March/075343.html\n> \n> It seemed like this was related based on my level 3 logs.  But I \n> verified that 3.0.25-7 has that fix, and yet my problem continues.\n> \n> My server is just a simple standalone server with user authentication.  \n> When I connect from Windows XP, I get:\n> \n>    % net use x: \\\\miffy\\jeff\n>    System error 3 has occurred.\n> \n>    The system cannot find the path specified.\n> \n> Samba 3.0.24-1 (downloaded as part of FC6) works perfectly.  The above \n> works without an issue.\n> Samba 3.0.24-5 (downloaded as an update of FC6) is broken.\n> If I download 3.0.25-7 from Samba.org for FC6, it's broken.\n> \n> In the logs for the broken cases (log level 3), the point where I \n> *think* things go sour is here:\n> \n> [2007/05/16 14:27:29, 3] smbd/msdfs.c:get_referred_path(624)\n>  get_referred_path: |jeff| in dfs path \\miffy\\jeff is not a dfs root.\n> [2007/05/16 14:27:29, 3] smbd/error.c:error_packet_set(106)\n>  error packet at smbd/trans2.c(6184) cmd=50 (SMBtrans2) NT_STATUS_NOT_FOUND\n> \n> It goes downhill from there.  But I'm not certain, as I don't have a lot \n> of experience looking at Samba logs.\n> \n> I have log level 3's of the working case (3.0.24-1) and the broken cases:\n> \n> The working case:\n>    https://webdav.taltos.com/jcoffler-lap.log.good\n> \n> The broken case (3.0.24-5):\n>    https://webdav.taltos.com/jcoffler-lap.log.bad.24-5\n> \n> And the broken case (3.0.25-7):\n>    https://webdav.taltos.com/jcoffler-lap.log.bad\n> \n> I'm at a loss of where to go from here.  Can anyone offer any advice?  \n> It seems like there was some sort of code change here that broke things, \n> but my usage case seems so simple, I just don't get it.\n\nAh - this explains a lot. The default for the \"msdfs root\"\nparameter changed between 3.0.24 from True to False.\n\nHas this client been restarted since the new Samba\nload was added and restarted ?\n\nIf not - try rebooting the client. The clients remember\nif a server was a dfs root and act accordingly until a\nrestart.\n\nThe decision was made to change \"msdfs root = no\"\ndue to problems detecting that the initial name given in\na dfs root path belonged to this server (as I recall).\n\nJeremy.\n\n"}