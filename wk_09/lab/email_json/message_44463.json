{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23378 - in\n\tbranches/SAMBA_3_0_26/source/rpc_server: .", "body": "Author: obnox\nDate: 2007-06-07 20:13:02 +0000 (Thu, 07 Jun 2007)\nNew Revision: 23378\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23378\n\nLog:\n\nFix the RPC_ANONYMOUS_AUTH_TYPE in rpc_server/srv_pipe.c:api_pipe_bind_req.\nThis had the effect of not being able to set privileges via (e.g.) net rpc\nrights.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0_26/source/rpc_server/srv_pipe.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/rpc_server/srv_pipe.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_server/srv_pipe.c\t2007-06-07 13:35:39 UTC (rev 23377)\n+++ branches/SAMBA_3_0_26/source/rpc_server/srv_pipe.c\t2007-06-07 20:13:02 UTC (rev 23378)\n@@ -1632,11 +1632,18 @@\n \n \t\tcase RPC_ANONYMOUS_AUTH_TYPE:\n \t\t\t/* Unauthenticated bind request. */\n+\t\t\t/* Get the authenticated pipe user from current_user */\n+\t\t\tif (!copy_current_user(&p->pipe_user, &current_user)) {\n+\t\t\t\tDEBUG(10, (\"Could not copy current user\\n\"));\n+\t\t\t\tgoto err_exit;\n+\t\t\t}\n \t\t\t/* We're finished - no more packets. */\n \t\t\tp->auth.auth_type = PIPE_AUTH_TYPE_NONE;\n \t\t\t/* We must set the pipe auth_level here also. */\n \t\t\tp->auth.auth_level = PIPE_AUTH_LEVEL_NONE;\n \t\t\tp->pipe_bound = True;\n+\t\t\t/* The session key was initialized from the SMB\n+\t\t\t * session in make_internal_rpc_pipe_p */\n \t\t\tbreak;\n \n \t\tdefault:\n\n"}