{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jpeach@samba.org", "subject": "svn commit: samba r22413 - in branches/SAMBA_3_0/source: . modules", "body": "Author: jpeach\nDate: 2007-04-20 16:07:16 +0000 (Fri, 20 Apr 2007)\nNew Revision: 22413\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22413\n\nLog:\nSimplify the build rules for plugin modules. Add support for per-platform\nexports files. Fix the shared library build pf pdb_ldap.\n\nAdded:\n   branches/SAMBA_3_0/source/modules/exports.darwin\nModified:\n   branches/SAMBA_3_0/source/Makefile.in\n   branches/SAMBA_3_0/source/configure.in\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0/source/Makefile.in\t2007-04-20 12:23:36 UTC (rev 22412)\n+++ branches/SAMBA_3_0/source/Makefile.in\t2007-04-20 16:07:16 UTC (rev 22413)\n@@ -26,6 +26,11 @@\n LDFLAGS=@PIE_LDFLAGS@ @LDFLAGS@\n AR=@AR@\n LDSHFLAGS=@LDSHFLAGS@ @LDFLAGS@\n+\n+# The MODULE_EXPORTS variable conatins the platform-specific linker flags\n+# needed to restrict the exports for VFS, IDMAP, RPC and PASSDB modules.\n+MODULE_EXPORTS=@MODULE_EXPORTS@\n+\n WINBIND_NSS_LDSHFLAGS=@WINBIND_NSS_LDSHFLAGS@ @LDFLAGS@\n AWK=@AWK@\n PICFLAG=@PICFLAG@\n@@ -1320,85 +1325,75 @@\n libmsrpc: $(LIBMSRPC)\n libaddns: $(LIBADDNS)\n \n+# Linker command to link a RPC, VFS, AUTH, CHARSET or PASSDB module.\n+SHLD_MODULE = $(SHLD) $(LDSHFLAGS) $(MODULE_EXPORTS) \\\n+\t      -o $@ @SONAMEFLAG@`basename $@`\n+\n bin/librpc_lsarpc.@SHLIBEXT@: proto_exists $(RPC_LSA_OBJ)\n \t@echo \"Linking $@\"\n+\t@$(SHLD_MODULE) $(RPC_LSA_OBJ)\n \t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_LSA_OBJ) -lc \\\n \t\t@SONAMEFLAG@`basename $@`\n \n bin/librpc_samr.@SHLIBEXT@: proto_exists $(RPC_SAMR_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_SAMR_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_SAMR_OBJ)\n \n bin/librpc_unixinfo.@SHLIBEXT@: proto_exists $(RPC_UNIXINFO_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_UNIXINFO_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_UNIXINFO_OBJ)\n \n bin/librpc_epmapper.@SHLIBEXT@: proto_exists $(RPC_EPMAPPER_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_EPMAPPER_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_SVC_OBJ)\n \n bin/librpc_srvsvc.@SHLIBEXT@: proto_exists $(RPC_SVC_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_SVC_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_SVC_OBJ)\n \n bin/librpc_svcctl.@SHLIBEXT@: proto_exists $(RPC_SVCCTL_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_SVCCTL_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_SVCCTL_OBJ)\n \n bin/librpc_ntsvcs.@SHLIBEXT@: proto_exists $(RPC_NTSVCS_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_NTSVCS_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_NTSVCS_OBJ)\n \n bin/librpc_wkssvc.@SHLIBEXT@: proto_exists $(RPC_WKS_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_WKS_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_WKS_OBJ)\n \n bin/librpc_NETLOGON.@SHLIBEXT@: proto_exists $(RPC_NETLOG_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_NETLOG_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_NETLOG_OBJ)\n \n bin/librpc_winreg.@SHLIBEXT@: proto_exists $(RPC_REG_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_REG_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_REG_OBJ)\n \n bin/librpc_initshutdown.@SHLIBEXT@: proto_exists $(RPC_INITSHUTDOWN_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_INITSHUTDOWN_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_INITSHUTDOWN_OBJ)\n \n bin/librpc_lsa_ds.@SHLIBEXT@: proto_exists $(RPC_LSA_DS_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_LSA_DS_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_LSA_DS_OBJ)\n \n bin/librpc_spoolss.@SHLIBEXT@: proto_exists $(RPC_SPOOLSS_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_SPOOLSS_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_SPOOLSS_OBJ)\n \n bin/librpc_eventlog.@SHLIBEXT@: proto_exists $(RPC_EVENTLOG_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_EVENTLOG_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_EVENTLOG_OBJ)\n \n bin/librpc_netdfs.@SHLIBEXT@: proto_exists $(RPC_DFS_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_DFS_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_DFS_OBJ)\n \n bin/librpc_echo.@SHLIBEXT@: proto_exists $(RPC_ECHO_OBJ)\n \t@echo \"Linking $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(RPC_ECHO_OBJ) -lc \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(RPC_ECHO_OBJ)\n \n bin/winbindd@EXEEXT@: proto_exists $(WINBINDD_OBJ) @BUILD_POPT@ bin/.dummy\n \t@echo \"Linking $@\"\n@@ -1429,209 +1424,174 @@\n \n bin/builtin.@SHLIBEXT@: proto_exists $(AUTH_BUILTIN_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(AUTH_BUILTIN_OBJ) @SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(AUTH_BUILTIN_OBJ)\n \n bin/domain.@SHLIBEXT@: proto_exists $(AUTH_DOMAIN_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(AUTH_DOMAIN_OBJ) @SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(AUTH_DOMAIN_OBJ)\n \n bin/script.@SHLIBEXT@: proto_exists $(AUTH_SCRIPT_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(AUTH_SCRIPT_OBJ) @SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(AUTH_SCRIPT_OBJ)\n \n bin/smbserver.@SHLIBEXT@: proto_exists $(AUTH_SERVER_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(AUTH_SERVER_OBJ) @SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(AUTH_SERVER_OBJ)\n \n bin/winbind.@SHLIBEXT@: proto_exists $(AUTH_WINBIND_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(AUTH_WINBIND_OBJ) @SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(AUTH_WINBIND_OBJ)\n \n bin/unix.@SHLIBEXT@: proto_exists $(AUTH_UNIX_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(AUTH_UNIX_OBJ) @SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(AUTH_UNIX_OBJ)\n \n bin/sam.@SHLIBEXT@: proto_exists $(AUTH_SAM_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(AUTH_SAM_OBJ) @SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(AUTH_SAM_OBJ)\n \n-bin/ldapsam.@SHLIBEXT@: passdb/pdb_ldap.o\n+bin/ldapsam.@SHLIBEXT@: passdb/pdb_ldap.o passdb/pdb_nds.o\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) $(LDAP_LIBS) -o $@ passdb/pdb_ldap.o \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) passdb/pdb_ldap.o passdb/pdb_nds.o $(LDAP_LIBS)\n \n bin/tdbsam.@SHLIBEXT@: proto_exists passdb/pdb_tdb.o\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ passdb/pdb_tdb.o \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) passdb/pdb_tdb.o\n \n bin/smbpasswd.@SHLIBEXT@: proto_exists passdb/pdb_smbpasswd.o\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ passdb/pdb_smbpasswd.o \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) passdb/pdb_smbpasswd.o\n \n bin/rid.@SHLIBEXT@: proto_exists nsswitch/idmap_rid.o\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ nsswitch/idmap_rid.o \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) nsswitch/idmap_rid.o\n \n bin/ad.@SHLIBEXT@: nsswitch/idmap_ad.o\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ nsswitch/idmap_ad.o \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) nsswitch/idmap_ad.o\n \n bin/weird.@SHLIBEXT@: proto_exists $(DEVEL_HELP_WEIRD_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(DEVEL_HELP_WEIRD_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(DEVEL_HELP_WEIRD_OBJ)\n \n bin/CP850.@SHLIBEXT@: proto_exists $(CP850_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(CP850_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(CP850_OBJ)\n \n bin/CP437.@SHLIBEXT@: proto_exists $(CP437_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(CP437_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(CP437_OBJ)\n \n bin/macosxfs.@SHLIBEXT@: $(CHARSET_MACOSXFS_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(CHARSET_MACOSXFS_OBJ) \\\n-\t\t-framework CoreFoundation @SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(CHARSET_MACOSXFS_OBJ) -framework CoreFoundation\n \n # NOTE, there is no build rule for a dynamic default VFS module because\n # this one MUST MUST MUST be built statically.\n \n bin/audit.@SHLIBEXT@: proto_exists $(VFS_AUDIT_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_AUDIT_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_AUDIT_OBJ)\n \n bin/extd_audit.@SHLIBEXT@: proto_exists $(VFS_EXTD_AUDIT_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_EXTD_AUDIT_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_EXTD_AUDIT_OBJ)\n \n bin/full_audit.@SHLIBEXT@: proto_exists $(VFS_FULL_AUDIT_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_FULL_AUDIT_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_FULL_AUDIT_OBJ)\n \n bin/recycle.@SHLIBEXT@: proto_exists $(VFS_RECYCLE_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_RECYCLE_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_RECYCLE_OBJ)\n \n bin/netatalk.@SHLIBEXT@: proto_exists $(VFS_NETATALK_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_NETATALK_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_NETATALK_OBJ)\n \n bin/fake_perms.@SHLIBEXT@: proto_exists $(VFS_FAKE_PERMS_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_FAKE_PERMS_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_FAKE_PERMS_OBJ)\n \n bin/default_quota.@SHLIBEXT@: proto_exists $(VFS_DEFAULT_QUOTA_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_DEFAULT_QUOTA_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_DEFAULT_QUOTA_OBJ)\n \n bin/readonly.@SHLIBEXT@: proto_exists $(VFS_READONLY_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_READONLY_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_READONLY_OBJ)\n \n bin/shadow_copy.@SHLIBEXT@: proto_exists $(VFS_SHADOW_COPY_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_SHADOW_COPY_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_SHADOW_COPY_OBJ)\n \n bin/cap.@SHLIBEXT@: proto_exists $(VFS_CAP_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_CAP_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_CAP_OBJ)\n \n bin/expand_msdfs.@SHLIBEXT@: proto_exists $(VFS_EXPAND_MSDFS_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_EXPAND_MSDFS_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_EXPAND_MSDFS_OBJ)\n \n-bin/afsacl.@SHLIBEXT@: $(VFS_AFSACL_OBJ:.o=.po)\n+bin/afsacl.@SHLIBEXT@: $(VFS_AFSACL_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_AFSACL_OBJ:.o=.po) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_AFSACL_OBJ)\n \n bin/posixacl.@SHLIBEXT@: $(VFS_POSIXACL_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_POSIXACL_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_POSIXACL_OBJ)\n \n bin/aixacl.@SHLIBEXT@: $(VFS_AIXACL_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_AIXACL_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_AIXACL_OBJ)\n \n bin/aixacl2.@SHLIBEXT@: $(VFS_AIXACL2_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_AIXACL2_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_AIXACL2_OBJ)\n \n bin/solarisacl.@SHLIBEXT@: $(VFS_SOLARISACL_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_SOLARISACL_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_SOLARISACL_OBJ)\n \n bin/irixacl.@SHLIBEXT@: proto_exists $(VFS_IRIXACL_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_IRIXACL_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_IRIXACL_OBJ)\n \n bin/hpuxacl.@SHLIBEXT@: proto_exists $(VFS_HPUXACL_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_HPUXACL_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_HPUXACL_OBJ)\n \n bin/tru64acl.@SHLIBEXT@: $(VFS_TRU64ACL_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_TRU64ACL_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_TRU64ACL_OBJ)\n \n bin/catia.@SHLIBEXT@: proto_exists $(VFS_CATIA_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_CATIA_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_CATIA_OBJ)\n \n bin/cacheprime.@SHLIBEXT@: proto_exists $(VFS_CACHEPRIME_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_CACHEPRIME_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_CACHEPRIME_OBJ)\n \n bin/prealloc.@SHLIBEXT@: proto_exists $(VFS_PREALLOC_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_PREALLOC_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_PREALLOC_OBJ)\n \n bin/commit.@SHLIBEXT@: proto_exists $(VFS_COMMIT_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_COMMIT_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_COMMIT_OBJ)\n \n bin/gpfs.@SHLIBEXT@: $(VFS_GPFS_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_GPFS_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_GPFS_OBJ)\n \n bin/notify_fam.@SHLIBEXT@: $(VFS_NOTIFY_FAM_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_NOTIFY_FAM_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_NOTIFY_FAM_OBJ)\n \n bin/readahead.@SHLIBEXT@: $(VFS_READAHEAD_OBJ)\n \t@echo \"Building plugin $@\"\n-\t@$(SHLD) $(LDSHFLAGS) -o $@ $(VFS_READAHEAD_OBJ) \\\n-\t\t@SONAMEFLAG@`basename $@`\n+\t@$(SHLD_MODULE) $(VFS_READAHEAD_OBJ)\n \n #########################################################\n ## IdMap NSS plugins\n@@ -1727,6 +1687,8 @@\n \t@$(SHELL) $(srcdir)/script/installmodules.sh $(INSTALLPERMS) $(DESTDIR) $(prefix) $(NSSINFOLIBDIR) $(NSS_INFO_MODULES)\n \t@$(SHELL) $(srcdir)/script/installmodules.sh $(INSTALLPERMS) $(DESTDIR) $(prefix) $(CHARSETLIBDIR) $(CHARSET_MODULES)\n \t@$(SHELL) $(srcdir)/script/installmodules.sh $(INSTALLPERMS) $(DESTDIR) $(prefix) $(AUTHLIBDIR) $(AUTH_MODULES)\n+\t@$(SHELL) $(srcdir)/script/linkmodules.sh $(DESTDIR)$(PDBLIBDIR) ldapsam.@SHLIBEXT@ NDS_ldapsam.@SHLIBEXT@\n+\t@$(SHELL) $(srcdir)/script/linkmodules.sh $(DESTDIR)$(PDBLIBDIR) ldapsam.@SHLIBEXT@ NDS_ldapsam_compat.@SHLIBEXT@\n \t@$(SHELL) $(srcdir)/script/linkmodules.sh $(DESTDIR)$(PDBLIBDIR) ldapsam.@SHLIBEXT@ ldapsam_compat.@SHLIBEXT@\n \t@$(SHELL) $(srcdir)/script/linkmodules.sh $(DESTDIR)$(AUTHLIBDIR) rhosts.@SHLIBEXT@ hostsequiv.@SHLIBEXT@\n \t@$(SHELL) $(srcdir)/script/linkmodules.sh $(DESTDIR)$(AUTHLIBDIR) sam.@SHLIBEXT@ sam_ignoredomain.@SHLIBEXT@\n\nModified: branches/SAMBA_3_0/source/configure.in\n===================================================================\n--- branches/SAMBA_3_0/source/configure.in\t2007-04-20 12:23:36 UTC (rev 22412)\n+++ branches/SAMBA_3_0/source/configure.in\t2007-04-20 16:07:16 UTC (rev 22413)\n@@ -259,6 +259,7 @@\n AC_SUBST(SAMBA_CPPFLAGS)\n AC_SUBST(SHELL)\n AC_SUBST(LDSHFLAGS)\n+AC_SUBST(MODULE_EXPORTS)\n AC_SUBST(SONAMEFLAG)\n AC_SUBST(SHLD)\n AC_SUBST(HOST_OS)\n@@ -1672,11 +1673,13 @@\n # these are the defaults, good for lots of systems\n HOST_OS=\"$host_os\"\n LDSHFLAGS=\"-shared\"\n+MODULE_EXPORTS=\"\"\n SONAMEFLAG=\"#\"\n SHLD=\"\\${CC} \\${CFLAGS}\"\n PICFLAG=\"${PIE_CFLAGS}\"\n SHLIBEXT=\"so\"\n \n+\n # this bit needs to be modified for each OS that supports share libs\n # You need to specify how to create a shared library and\n # how to compile C code to produce PIC object files\n@@ -1850,6 +1853,7 @@\n \t\t*darwin*)   AC_DEFINE(DARWINOS,1,[Whether the host os is Darwin/MacOSX])\n \t\t\tBLDSHARED=\"true\"\n \t\t\tLDSHFLAGS=\"-bundle -flat_namespace -undefined suppress\"\n+\t\t\tMODULE_EXPORTS=\"-exported_symbols_list \\$(srcdir)/modules/exports.darwin\"\n \t\t\tSHLIBEXT=\"dylib\"\n \t\t\t# Since gcc doesn't fail on unrecognised options, the\n \t\t\t# PIE test incorrectly succeeds. Darwin gcc does not\n\nAdded: branches/SAMBA_3_0/source/modules/exports.darwin\n===================================================================\n--- branches/SAMBA_3_0/source/modules/exports.darwin\t2007-04-20 12:23:36 UTC (rev 22412)\n+++ branches/SAMBA_3_0/source/modules/exports.darwin\t2007-04-20 16:07:16 UTC (rev 22413)\n@@ -0,0 +1 @@\n+_init_module\n\n"}