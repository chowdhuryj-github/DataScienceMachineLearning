{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "svn commit: samba r22831 - in\n\tbranches/SAMBA_4_0/source/ntvfs/sysdep: .", "body": "Author: tridge\nDate: 2007-05-14 00:58:24 +0000 (Mon, 14 May 2007)\nNew Revision: 22831\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22831\n\nLog:\n\ntake advantage of EVENT_FD_AUTOCLOSE in the inotify code\n\nModified:\n   branches/SAMBA_4_0/source/ntvfs/sysdep/inotify.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/ntvfs/sysdep/inotify.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/sysdep/inotify.c\t2007-05-14 00:57:48 UTC (rev 22830)\n+++ branches/SAMBA_4_0/source/ntvfs/sysdep/inotify.c\t2007-05-14 00:58:24 UTC (rev 22831)\n@@ -80,16 +80,6 @@\n \n \n /*\n-  destroy the inotify private context\n-*/\n-static int inotify_destructor(struct inotify_private *in)\n-{\n-\tclose(in->fd);\n-\treturn 0;\n-}\n-\n-\n-/*\n   see if a particular event from inotify really does match a requested\n   notify event in SMB\n */\n@@ -271,10 +261,9 @@\n \tin->watches = NULL;\n \n \tctx->private_data = in;\n-\ttalloc_set_destructor(in, inotify_destructor);\n \n \t/* add a event waiting for the inotify fd to be readable */\n-\tevent_add_fd(ctx->ev, in, in->fd, EVENT_FD_READ, inotify_handler, in);\n+\tevent_add_fd(ctx->ev, in, in->fd, EVENT_FD_READ|EVENT_FD_AUTOCLOSE, inotify_handler, in);\n \t\n \treturn NT_STATUS_OK;\n }\n\n"}