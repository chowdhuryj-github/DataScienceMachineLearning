{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "svn commit: samba r22232 - in\n\tbranches/SAMBA_4_0/source/cluster/ctdb: . common include", "body": "Author: tridge\nDate: 2007-04-16 00:29:13 +0000 (Mon, 16 Apr 2007)\nNew Revision: 22232\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22232\n\nLog:\n\nadd a special message handler ID meaning \"all messages please\"\n\nThis better fits the way Samba4 does message dispatch\n\nModified:\n   branches/SAMBA_4_0/source/cluster/ctdb/common/ctdb_message.c\n   branches/SAMBA_4_0/source/cluster/ctdb/ctdb_cluster.c\n   branches/SAMBA_4_0/source/cluster/ctdb/include/ctdb.h\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/cluster/ctdb/common/ctdb_message.c\n===================================================================\n--- branches/SAMBA_4_0/source/cluster/ctdb/common/ctdb_message.c\t2007-04-16 00:18:54 UTC (rev 22231)\n+++ branches/SAMBA_4_0/source/cluster/ctdb/common/ctdb_message.c\t2007-04-16 00:29:13 UTC (rev 22232)\n@@ -39,7 +39,7 @@\n \t/* XXX we need a must faster way of finding the matching srvid\n \t   - maybe a tree? */\n \tfor (ml=ctdb->message_list;ml;ml=ml->next) {\n-\t\tif (ml->srvid == srvid) break;\n+\t\tif (ml->srvid == srvid || ml->srvid == CTDB_SRVID_ALL) break;\n \t}\n \tif (ml == NULL) {\n \t\tprintf(\"daemon vnn:%d  no msg handler for srvid=%u\\n\", ctdb_get_vnn(ctdb), srvid);\n\nModified: branches/SAMBA_4_0/source/cluster/ctdb/ctdb_cluster.c\n===================================================================\n--- branches/SAMBA_4_0/source/cluster/ctdb/ctdb_cluster.c\t2007-04-16 00:18:54 UTC (rev 22231)\n+++ branches/SAMBA_4_0/source/cluster/ctdb/ctdb_cluster.c\t2007-04-16 00:29:13 UTC (rev 22232)\n@@ -144,8 +144,8 @@\n \tint ret;\n \n \t/* setup messaging handler */\n-\tret = ctdb_set_message_handler(state->ctdb, ctdb_message_handler, \n-\t\t\t\t       server.id, state);\n+\tret = ctdb_set_message_handler(state->ctdb, CTDB_SRVID_ALL, \n+\t\t\t\t       ctdb_message_handler, state);\n         if (ret == -1) {\n                 DEBUG(0,(\"ctdb_set_message_handler failed - %s\\n\", \n \t\t\t ctdb_errstr(state->ctdb)));\n\nModified: branches/SAMBA_4_0/source/cluster/ctdb/include/ctdb.h\n===================================================================\n--- branches/SAMBA_4_0/source/cluster/ctdb/include/ctdb.h\t2007-04-16 00:18:54 UTC (rev 22231)\n+++ branches/SAMBA_4_0/source/cluster/ctdb/include/ctdb.h\t2007-04-16 00:29:13 UTC (rev 22232)\n@@ -56,6 +56,11 @@\n #define CTDB_FLAG_CONNECT_WAIT (1<<2)\n \n \n+/* \n+   a message handler ID meaning \"give me all messages\"\n+ */\n+#define CTDB_SRVID_ALL 0xFFFFFFFF\n+\n struct event_context;\n \n /*\n\n"}