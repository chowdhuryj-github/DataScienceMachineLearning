{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 163: merge from ronnie in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 163\nrevision-id: tridge@samba.org-20070419025451-eaea0b4b18ce3fa5\nparent: tridge@samba.org-20070419024319-a841e423b4a13de6\nparent: ronniesahlberg@gmail.com-20070419024819-a7dgjgmvsu1n75dx\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Thu 2007-04-19 12:54:51 +1000\nmessage:\n  merge from ronnie\nmodified:\n  common/ctdb_daemon.c           ctdb_daemon.c-20070409200331-3el1kqgdb9m4ib0g-1\n  direct/ctdbd_test.c            ctdbd_test.c-20070411085057-17kgjzfktsh28g99-1\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070419024819-a7dgjgmvsu1n75dx\n    parent: ronniesahlberg@gmail.com-20070419023439-swff506prvebhy7s\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Thu 2007-04-19 12:48:19 +1000\n    message:\n       the checks for srcnode and destnode from the client are redundant since the daemon will sort these out itself before it sends the call of to either the local handler or a remote daemon\n=== modified file 'common/ctdb_daemon.c'\n--- a/common/ctdb_daemon.c\t2007-04-19 02:33:13 +0000\n+++ b/common/ctdb_daemon.c\t2007-04-19 02:48:19 +0000\n@@ -306,18 +306,6 @@\n \tstruct daemon_call_state *dstate;\n \tstruct ctdb_call *call;\n \n-\t/* check that the client filled in the correct vnn for the local node */\n-\tif (ctdb_get_vnn(client->ctdb) != c->hdr.srcnode) {\n-\t\tDEBUG(0, (__location__ \"Wrong srcnode in CTDB_REQ_CALL from client  was:%d should be :%d\\n\", c->hdr.srcnode, ctdb_get_vnn(client->ctdb)));\n-\t\treturn;\n-\t}\n-\n-\t/* verify that the destnode makes sense */\n-\tif (c->hdr.destnode >= client->ctdb->num_nodes) {\n-\t\tDEBUG(0, (__location__ \"Wrong dstnode in CTDB_REQ_CALL from client  was:%d but there are only %d nodes in the cluster\\n\", c->hdr.destnode, client->ctdb->num_nodes));\n-\t\treturn;\n-\t}\n-\n \tctdb_db = find_ctdb_db(client->ctdb, c->db_id);\n \tif (!ctdb_db) {\n \t\tDEBUG(0, (__location__ \" Unknown database in request. db_id==0x%08x\",\n\n=== modified file 'direct/ctdbd_test.c'\n--- a/direct/ctdbd_test.c\t2007-04-19 02:34:39 +0000\n+++ b/direct/ctdbd_test.c\t2007-04-19 02:48:19 +0000\n@@ -188,7 +188,7 @@\n \n    when the daemon has responded   this node should be the dmaster (unless it has migrated off again)\n  */\n-void fetch_record(int fd, uint32_t db_id, TDB_DATA key, int thisnode, int destnode)\n+void fetch_record(int fd, uint32_t db_id, TDB_DATA key)\n {\n \tstruct ctdb_req_call *req;\n \tstruct ctdb_reply_call *rep;\n@@ -202,8 +202,6 @@\n \treq->hdr.ctdb_magic  = CTDB_MAGIC;\n \treq->hdr.ctdb_version = CTDB_VERSION;\n \treq->hdr.operation   = CTDB_REQ_CALL;\n-\treq->hdr.destnode    = destnode;\n-\treq->hdr.srcnode     = thisnode;\n \treq->hdr.reqid       = 1;\n \n \treq->flags           = CTDB_IMMEDIATE_MIGRATION;\n@@ -298,7 +296,7 @@\n \tkey.dsize=strlen((const char *)(key.dptr));\n \tprintf(\"fetch the test key:[%s]\\n\",key.dptr);\n \n-\tfetch_record(fd, db_id, key, 0, 1);\n+\tfetch_record(fd, db_id, key);\n \tprintf(\"\\n\");\n \n \n\n"}