{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 532: more detail in recovery message in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 532\nrevision-id: tridge@samba.org-20070611113709-s0awmt49mm030bct\nparent: tridge@samba.org-20070611035650-5le1j4hug22kkd0o\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Mon 2007-06-11 21:37:09 +1000\nmessage:\n  more detail in recovery message\nmodified:\n  server/ctdb_recoverd.c         recoverd.c-20070503213540-bvxuyd9jm1f7ig90-1\n=== modified file 'server/ctdb_recoverd.c'\n--- a/server/ctdb_recoverd.c\t2007-06-09 11:58:50 +0000\n+++ b/server/ctdb_recoverd.c\t2007-06-11 11:37:09 +0000\n@@ -1293,11 +1293,19 @@\n \t\t   active, then that is also a good reason to do recovery\n \t\t */\n \t\tfor (i=0;inum;i++) {\n-\t\t\tif ((remote_nodemap->nodes[i].vnn != nodemap->nodes[i].vnn)\n-\t\t\t    || ((remote_nodemap->nodes[i].flags & NODE_FLAGS_INACTIVE) != \n-\t\t\t\t(nodemap->nodes[i].flags & NODE_FLAGS_INACTIVE))) {\n-\t\t\t\tDEBUG(0, (__location__ \" Remote node:%u has different nodemap.\\n\", \n-\t\t\t\t\t  nodemap->nodes[j].vnn));\n+\t\t\tif (remote_nodemap->nodes[i].vnn != nodemap->nodes[i].vnn) {\n+\t\t\t\tDEBUG(0, (__location__ \" Remote node:%u has different nodemap vnn for %d (%u vs %u).\\n\", \n+\t\t\t\t\t  nodemap->nodes[j].vnn, i, \n+\t\t\t\t\t  remote_nodemap->nodes[i].vnn, nodemap->nodes[i].vnn));\n+\t\t\t\tdo_recovery(rec, mem_ctx, vnn, num_active, nodemap, \n+\t\t\t\t\t    vnnmap, nodemap->nodes[j].vnn);\n+\t\t\t\tgoto again;\n+\t\t\t}\n+\t\t\tif ((remote_nodemap->nodes[i].flags & NODE_FLAGS_INACTIVE) != \n+\t\t\t    (nodemap->nodes[i].flags & NODE_FLAGS_INACTIVE)) {\n+\t\t\t\tDEBUG(0, (__location__ \" Remote node:%u has different nodemap flags for %d (0x%x vs 0x%x)\\n\", \n+\t\t\t\t\t  nodemap->nodes[j].vnn, i,\n+\t\t\t\t\t  remote_nodemap->nodes[i].flags, nodemap->nodes[i].flags));\n \t\t\t\tdo_recovery(rec, mem_ctx, vnn, num_active, nodemap, \n \t\t\t\t\t    vnnmap, nodemap->nodes[j].vnn);\n \t\t\t\tgoto again;\n\n"}