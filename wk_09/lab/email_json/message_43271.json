{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 472: merged vsftpd event script from ronnie in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 472\nrevision-id: tridge@samba.org-20070606002927-x2zgceuujia96o9q\nparent: tridge@samba.org-20070606002546-0qw4bar4ckcwt50m\nparent: sahlberg@ronnie-20070605084249-0l895p3hyaw15czd\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Wed 2007-06-06 10:29:27 +1000\nmessage:\n  merged vsftpd event script from ronnie\nadded:\n  config/events.d/40.vsftpd      40.vsftpd-20070605080716-mih15mjbgsjt7niv-1\nmodified:\n  config/events.d/59.nfslock     nfslock-20070601105340-vlcvnp6euoj3zdwy-2\n  packaging/RPM/ctdb.spec        ctdb.spec-20070527204758-biuh7znabuwan3zn-3\n  tools/ctdb_control.c           ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1\n  web/ctdb.html                  ctdb.html-20070601052353-vgod9lfo4an4o83j-2\n    ------------------------------------------------------------\n    revno: 432.1.27\n    merged: sahlberg@ronnie-20070605084249-0l895p3hyaw15czd\n    parent: sahlberg@ronnie-20070605084043-wzqhm9lrjokae4hc\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-06-05 18:42:49 +1000\n    message:\n      ctdb is only a ha solution when combined with a cluster filesystem\n    ------------------------------------------------------------\n    revno: 432.1.26\n    merged: sahlberg@ronnie-20070605084043-wzqhm9lrjokae4hc\n    parent: sahlberg@ronnie-20070605083206-amcsg8vky52w2293\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-06-05 18:40:43 +1000\n    message:\n      add some text about CTDB and in which scenarios it would be a good\n      candidate to solve the users needs for a HA solution\n    ------------------------------------------------------------\n    revno: 432.1.25\n    merged: sahlberg@ronnie-20070605083206-amcsg8vky52w2293\n    parent: sahlberg@ronnie-20070605081645-gmj5biig34hgw2hw\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-06-05 18:32:06 +1000\n    message:\n      provide machinereadable output for  ctdb ip\n    ------------------------------------------------------------\n    revno: 432.1.24\n    merged: sahlberg@ronnie-20070605081645-gmj5biig34hgw2hw\n    parent: sahlberg@ronnie-20070605081401-81yjnnlig9a37788\n    parent: tridge@samba.org-20070605075707-2kpo0bzgbgat4ik1\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-06-05 18:16:45 +1000\n    message:\n      merge from tridge\n    ------------------------------------------------------------\n    revno: 432.1.23\n    merged: sahlberg@ronnie-20070605081401-81yjnnlig9a37788\n    parent: sahlberg@ronnie-20070605024335-h3su0gfytwva0qyt\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-06-05 18:14:01 +1000\n    message:\n      add a simple events script to manage vsftpd \n    ------------------------------------------------------------\n    revno: 432.1.22\n    merged: sahlberg@ronnie-20070605024335-h3su0gfytwva0qyt\n    parent: sahlberg@ronnie-20070604224330-1ly6b84wu57s34u7\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-06-05 12:43:35 +1000\n    message:\n      dont use CTDB_MANAGES_NFS for controlling the lockmanager\n      use a dedicated variable CTDB_MANAGES_NFSLOCK   since some might want to \n      use nfs but no lockmanager\n    ------------------------------------------------------------\n    revno: 432.1.21\n    merged: sahlberg@ronnie-20070604224330-1ly6b84wu57s34u7\n    parent: sahlberg@ronnie-20070604111151-q97kri6nnlhugk88\n    parent: tridge@samba.org-20070604122852-z351kj9m6s28x08f\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-06-05 08:43:30 +1000\n    message:\n      merge from tridge\n=== added file 'config/events.d/40.vsftpd'\n--- a/config/events.d/40.vsftpd\t1970-01-01 00:00:00 +0000\n+++ b/config/events.d/40.vsftpd\t2007-06-05 08:14:01 +0000\n@@ -0,0 +1,45 @@\n+#!/bin/sh\n+# event strict to manage vsftpd in a cluster environment\n+\n+. /etc/ctdb/functions\n+loadconfig vsftpd\n+\n+[ \"$CTDB_MANAGES_VSFTPD\" = \"yes\" ] || exit 0\n+\n+cmd=\"$1\"\n+shift\n+\n+case $cmd in \n+     startup)\n+\t/bin/mkdir -p /etc/ctdb/state/vsftpd\n+\n+\t# make sure the service is stopped first\n+\tservice vsftpd stop > /dev/null 2>&1\n+\tservice vsftpd start\n+\t;;\n+\n+     shutdown)\n+\tservice vsftpd stop\n+\t;;\n+\n+     takeip)\n+\techo \"restart\" >> /etc/ctdb/state/vsftpd/restart\n+\t;;\n+\n+     releaseip)\n+\techo \"restart\" >> /etc/ctdb/state/vsftpd/restart\n+\t;;\n+\n+     recovered)\n+\t# if we have taken or released any ips we must \n+\t# restart vsftpd to ensure that all tcp connections are reset\n+\t[ -f /etc/ctdb/state/vsftpd/restart ] && {\n+\t\tservice vsftpd stop > /dev/null 2>&1\n+\t\tservice vsftpd start\n+\t} >/dev/null 2>&1\n+\n+\t/bin/rm -f /etc/ctdb/state/vsftpd/restart\n+\t;;\n+esac\n+\n+exit 0\n\n=== modified file 'config/events.d/59.nfslock'\n--- a/config/events.d/59.nfslock\t2007-06-05 05:18:37 +0000\n+++ b/config/events.d/59.nfslock\t2007-06-05 08:16:45 +0000\n@@ -4,7 +4,7 @@\n . /etc/ctdb/functions\n loadconfig nfs\n \n-[ \"$CTDB_MANAGES_NFS\" = \"yes\" ] || exit 0\n+[ \"$CTDB_MANAGES_NFSLOCK\" = \"yes\" ] || exit 0\n \n [ -z \"$STATD_SHARED_DIRECTORY\" ] && exit 0\n \n\n=== modified file 'packaging/RPM/ctdb.spec'\n--- a/packaging/RPM/ctdb.spec\t2007-06-04 05:09:03 +0000\n+++ b/packaging/RPM/ctdb.spec\t2007-06-05 08:14:01 +0000\n@@ -94,6 +94,7 @@\n %{_sysconfdir}/ctdb/events\n %{_sysconfdir}/ctdb/functions\n %{_sysconfdir}/ctdb/events.d/10.interface\n+%{_sysconfdir}/ctdb/events.d/40.vsftpd\n %{_sysconfdir}/ctdb/events.d/50.samba\n %{_sysconfdir}/ctdb/events.d/59.nfslock\n %{_sysconfdir}/ctdb/events.d/60.nfs\n\n=== modified file 'tools/ctdb_control.c'\n--- a/tools/ctdb_control.c\t2007-06-06 00:25:46 +0000\n+++ b/tools/ctdb_control.c\t2007-06-06 00:29:27 +0000\n@@ -355,6 +355,17 @@\n \t\treturn ret;\n \t}\n \n+\tif(options.machinereadable){\n+\t\tprintf(\":Public IP:Node:\\n\");\n+\t\tfor(i=0;inum;i++){\n+\t\t\tprintf(\":%s:%d:\\n\",\n+\t\t\tinet_ntoa(ips->ips[i].sin.sin_addr),\n+\t\t\tips->ips[i].takeover_vnn);\n+\t\t}\n+\t\treturn 0;\n+\t}\n+\n+\n \tprintf(\"Number of nodes:%d\\n\", ips->num);\n \tfor(i=0;inum;i++){\n \t\tprintf(\"%-16s %d\\n\",\n\n=== modified file 'web/ctdb.html'\n--- a/web/ctdb.html\t2007-06-03 06:33:08 +0000\n+++ b/web/ctdb.html\t2007-06-05 08:42:49 +0000\n@@ -81,6 +81,19 @@\n seconds. During the recovery period the databases are 'frozen', and\n all IO operations by ctdb clients are suspended.\n \n+Is CTDB a HA solution?\n+Yes and no.\n+CTDB alone is not a HA solution, but when you combine CTDB with a clustered \n+filesystem it becomes one.\n+CTDB is primarily developed around the concept of having a shared cluster \n+filesystem shared across all the nodes in the cluster to provide the features\n+required for building a NAS cluster.\n+Thus CTDB relies on an external component (the cluster filesystem) to provide \n+the mechanisms for avoiding split-brain and other difficult tasks.\n+However, If you applications do need a clustered filesystem for all the nodes, \n+in that scenario CTDB will provide a very easy to install and manage \n+solution for your clustering HA needs.\n+\n IP Takeover\n \n When a node in a cluster fails, CTDB will arrange that a different\n\n"}