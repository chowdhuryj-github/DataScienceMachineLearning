{"category": "ham", "to_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "from_address": "ronggui <ronggui.huang@gmail.com>", "subject": "Re: [R] Question about \"evalq\"", "body": "Hi,Gabor Grothendieck, Thanks very much.\n\nOn 5/27/07, Gabor Grothendieck  wrote:\n> evalq looks like this:\n>\n>    > evalq\n>    function (expr, envir, enclos)\n>    eval.parent(substitute(eval(quote(expr), envir, enclos)))\n>    \n>\n> so it seems the difference is that\n>\n> - eval(quote(), envir, enclos) evaluates envir and enclos\n>   in the current frame but\n> - evalq evaluates them in the parent.frame.\n>\n> This may be easier to see in the following example:\n\nYeah, This example make the question easier to understand.\n\n>    x <- \"G\"\n>    f1 <- function() eval(quote(x), parent.frame())\n>    f2 <- function() evalq(x, parent.frame())\n>    f11 <- function() {\n>         x <- \"a\"\n>         f1()\n>    }\n>    f22 <- function() {\n>         x <- \"b\"\n>         f2()\n>    }\n>    f11() # a\n>    f22() # G\n>\n> To avoid this problem pass a variable whose value is\n> to be enclos= rather than an expression to compute it:\n\n--This is a good idea.\n--If \"evalq evaluates them in the parent.frame\", I expected that if I\nchange parent.frame(2) to parent.frame(1), I will get the answer.But I\ncan not actually. So what's wrong with my understanding?\n\n    f1 <- function(x,digits=5) lapply(x, f2)\n    f2 <- function(x) {\n       evalq(print(digits), list(x=x), parent.frame(1))\n    }\n    f1(list(x1=1)) ##Error in print(digits) : object \"digits\" not found\n\n\n>    f1 <- function(x,digits=5) lapply(x, f2)\n>    f2 <- function(x) {\n>       pf2 <- parent.frame(2)\n>       evalq(print(digits), list(x=x), pf2)\n>    }\n>    f1(list(x1=1)) # 5\n>\n>\n>\n> On 5/26/07, ronggui  wrote:\n> > The help page of eval says: The 'evalq' form is equivalent to\n> > 'eval(quote(expr), ...)'.  But the following is not equivalent.  Can\n> > anyone give me some explaination? Thanks very much.\n> >\n> > > f1 <- function(x,digits=5) lapply(x, f2)\n> > > f2 <- function(x) eval(quote(print(x+1,digits=digits)),list(x=x),parent.frame(2))\n> > > f1(list(x1=1))\n> > [1] 2\n> > $x1\n> > [1] 2\n> >\n> > >\n> > > f1 <- function(x,digits=5) lapply(x, f2)\n> > > f2 <- function(x) evalq(print(x+1,digits=digits),list(x=x),parent.frame(2))\n> > > f1(list(x1=1))\n> > Error in print.default(x + 1, digits = digits) :\n> >  object \"digits\" not found\n> >\n> >\n> >\n> > --\n> > Ronggui Huang\n> > Department of Sociology\n> > Fudan University, Shanghai, China\n> >\n> > ______________________________________________\n> > R-help@stat.math.ethz.ch mailing list\n> > https://stat.ethz.ch/mailman/listinfo/r-help\n> > PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> > and provide commented, minimal, self-contained, reproducible code.\n> >\n>\n\n\n-- \nRonggui Huang\nDepartment of Sociology\nFudan University, Shanghai, China\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}