{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jelmer@samba.org", "subject": "svn commit: samba r22133 - in branches/SAMBA_4_0: .\n\tsource/script/tests", "body": "Author: jelmer\nDate: 2007-04-08 23:55:01 +0000 (Sun, 08 Apr 2007)\nNew Revision: 22133\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22133\n\nLog:\nDon't push parameters into environment until necessary.\nModified:\n   branches/SAMBA_4_0/\n   branches/SAMBA_4_0/source/script/tests/selftest.pl\n\n\nChangeset:\n\nProperty changes on: branches/SAMBA_4_0\n___________________________________________________________________\nName: bzr:merge\n...skipped...\n\nModified: branches/SAMBA_4_0/source/script/tests/selftest.pl\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-08 19:41:47 UTC (rev 22132)\n+++ branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-08 23:55:01 UTC (rev 22133)\n@@ -366,7 +366,6 @@\n \n $prefix =~ s+//+/+;\n $ENV{PREFIX} = $prefix;\n-\n $ENV{SRCDIR} = $srcdir;\n \n my $tls_enabled = not $opt_quick;\n@@ -384,8 +383,6 @@\n $ENV{PKG_CONFIG_PATH} = \"$old_pwd/bin/pkgconfig:$ENV{PKG_CONFIG_PATH}\";\n $ENV{PATH} = \"$old_pwd/bin:$ENV{PATH}\";\n \n-my @torture_options = ();\n-\n if ($opt_socket_wrapper_pcap) {\n \tSocketWrapper::setup_pcap($opt_socket_wrapper_pcap);\n \t# Socket wrapper pcap implies socket wrapper\n@@ -435,7 +432,7 @@\n SocketWrapper::set_default_iface(6);\n \n foreach (\"PASSWORD\", \"DOMAIN\", \"SERVER\", \"CONFIGURATION\", \n-\t      \"USERNAME\", \"PREFIX\", \"NETBIOSNAME\", \"KRB5_CONFIG\", \"PIDDIR\") {\n+\t      \"USERNAME\", \"NETBIOSNAME\") {\n \t$ENV{$_} = $testenv_vars->{$_};\n }\n \n@@ -446,6 +443,7 @@\n \t\t\t\t\t\t \"127.0.0.10/8\",\n \t\t\t\t\t\t \"127.0.0.11/8\"));\n \n+my @torture_options = ();\n push (@torture_options, \"--option=interfaces=$interfaces\");\n push (@torture_options, $testenv_vars->{CONFIGURATION});\n # ensure any one smbtorture call doesn't run too long\n@@ -490,14 +488,16 @@\n # The Kerberos tests fail if this variable is set.\n delete $ENV{DOMAIN};\n \n+$ENV{KRB5_CONFIG} = $testenv_vars->{KRB5_CONFIG};\n+\n if ($opt_testenv) {\n+\t$ENV{PIDDIR} = $testenv_vars->{PIDDIR};\n \tmy $term = ($ENV{TERM} or \"xterm\");\n \tsystem(\"$term -e 'echo -e \\\"Welcome to the Samba4 Test environment\n This matches the client environment used in make test\n smbd is pid `cat \\$PIDDIR/smbd.pid`\n \n Some useful environment variables:\n-AUTH=\\$AUTH\n TORTURE_OPTIONS=\\$TORTURE_OPTIONS\n CONFIGURATION=\\$CONFIGURATION\n SERVER=\\$SERVER\n\n"}