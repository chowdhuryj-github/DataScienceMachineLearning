{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 545: check winbind in monitoring event too in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 545\nrevision-id: tridge@samba.org-20070617020529-q032m8vir2vx3c2i\nparent: tridge@samba.org-20070617015742-vstv17rrkkpahaij\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sun 2007-06-17 12:05:29 +1000\nmessage:\n  check winbind in monitoring event too\nmodified:\n  config/events.d/50.samba       samba-20070601105340-vlcvnp6euoj3zdwy-3\n  config/functions               functions-20070601105405-gajwirydr5a9zd6x-1\n=== modified file 'config/events.d/50.samba'\n--- a/config/events.d/50.samba\t2007-06-17 01:57:42 +0000\n+++ b/config/events.d/50.samba\t2007-06-17 02:05:29 +0000\n@@ -65,6 +65,9 @@\n \n \tsmb_ports=`testparm -sv 2> /dev/null | egrep '\\s*smb ports =' | cut -d= -f2`\n \tctdb_check_tcp_ports \"Samba\" $smb_ports\n+\n+\t# check winbind is OK\n+\tctdb_check_command \"winbind\" \"wbinfo -p\"\n \t;;\n \n esac\n\n=== modified file 'config/functions'\n--- a/config/functions\t2007-06-17 01:57:42 +0000\n+++ b/config/functions\t2007-06-17 02:05:29 +0000\n@@ -162,3 +162,17 @@\n       }\n   done\n }\n+\n+######################################################\n+# check a command returns zero status\n+# usage: ctdb_check_command SERVICE_NAME \n+######################################################\n+ctdb_check_command() {\n+  service_name=\"$1\"\n+  wait_cmd=\"$2\"\n+  [ -z \"$wait_cmd\" ] && return;\n+  $wait_cmd > /dev/null 2>&1 || {\n+      echo \"`date` ERROR: $service_name - $wait_cmd returned error\"\n+      exit 1\n+  }\n+}\n\n"}