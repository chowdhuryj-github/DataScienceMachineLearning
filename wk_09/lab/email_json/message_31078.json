{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22951 - in branches/SAMBA_3_0_26/source/libsmb: .", "body": "Author: jra\nDate: 2007-05-16 17:30:00 +0000 (Wed, 16 May 2007)\nNew Revision: 22951\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22951\n\nLog:\nMerge Volkers's logic fix from r22930. Only read\nthe rest of the data if there is any.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0_26/source/libsmb/clientgen.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/libsmb/clientgen.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libsmb/clientgen.c\t2007-05-16 17:17:25 UTC (rev 22950)\n+++ branches/SAMBA_3_0_26/source/libsmb/clientgen.c\t2007-05-16 17:30:00 UTC (rev 22951)\n@@ -111,7 +111,7 @@\n \t}\n \n \t/* If the server is not responding, note that now */\n-\tif (len <= 0) {\n+\tif (len < 0) {\n                 DEBUG(0, (\"Receiving SMB: Server stopped responding\\n\"));\n \t\tcli->smb_rw_error = smb_read_error;\n \t\tclose(cli->fd);\n@@ -192,7 +192,8 @@\n \t\t\t}\n \n \t\t\t/* Read the rest of the data. */\n-\t\t\tif (!cli_receive_smb_data(cli,cli->inbuf+len,total_len - len)) {\n+\t\t\tif ((total_len - len > 0) &&\n+\t\t\t    !cli_receive_smb_data(cli,cli->inbuf+len,total_len - len)) {\n \t\t\t\tgoto read_err;\n \t\t\t}\n \n\n"}