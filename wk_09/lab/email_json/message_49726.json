{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "svn commit: samba r23535 - in\n\tbranches/SAMBA_4_0/source/torture/nbench: .", "body": "Author: tridge\nDate: 2007-06-17 21:54:11 +0000 (Sun, 17 Jun 2007)\nNew Revision: 23535\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23535\n\nLog:\n\naccept numeric ntstatus codes in nbench load files (ronnies wireshark\nscript generates numeric codes)\n\nModified:\n   branches/SAMBA_4_0/source/torture/nbench/nbench.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/torture/nbench/nbench.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/nbench/nbench.c\t2007-06-17 20:04:57 UTC (rev 23534)\n+++ branches/SAMBA_4_0/source/torture/nbench/nbench.c\t2007-06-17 21:54:11 UTC (rev 23535)\n@@ -48,7 +48,7 @@\n \tBOOL correct = True;\n \tdouble target_rate = lp_parm_double(-1, \"torture\", \"targetrate\", 0);\t\n \n-\tif (target_rate != 0) {\n+\tif (target_rate != 0 && client == 0) {\n \t\tprintf(\"Targetting %.4f MByte/sec\\n\", target_rate);\n \t}\n \n@@ -106,13 +106,19 @@\n \t\t\texit(1);\n \t\t}\n \n-\t\tif (strncmp(params[i-1], \"NT_STATUS_\", 10) != 0) {\n+\t\tif (strncmp(params[i-1], \"NT_STATUS_\", 10) != 0 &&\n+\t\t    strncmp(params[i-1], \"0x\", 2) != 0) {\n \t\t\tprintf(\"Badly formed status at line %d\\n\", nbench_line_count);\n \t\t\ttalloc_free(params);\n \t\t\tcontinue;\n \t\t}\n \n-\t\tstatus = nt_status_string_to_code(params[i-1]);\n+\t\t/* accept numeric or string status codes */\n+\t\tif (strncmp(params[i-1], \"0x\", 2) == 0) {\n+\t\t\tstatus = NT_STATUS(strtoul(params[i-1], NULL, 16));\n+\t\t} else {\n+\t\t\tstatus = nt_status_string_to_code(params[i-1]);\n+\t\t}\n \n \t\tDEBUG(9,(\"run_netbench(%d): %s %s\\n\", client, params[0], params[1]));\n \n\n"}