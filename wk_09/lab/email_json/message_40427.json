{"category": "ham", "to_address": "parrotbug-followup@parrotcode.org", "from_address": "Mark Glines <mark@glines.org>", "subject": "Re: [perl #42938] [BUG] allocation failures in res_lea.c", "body": "On Thu, 31 May 2007 23:09:54 -0700\nMark Glines  wrote:\n> Might be worth it to prereserve 8 bytes or so, to avoid having to\n> realloc as often, if this will be called a lot.  Currently it just\n> reallocs the minimum necessary to fit the existing string, the new\n> character and a null terminator.\n\nThere is a performance impact from the additional check, but I don't\nthink the above optimization is necessary... or its possible\nParrot_reallocate_string() already reserves extra room internally.\nEither way, I don't see enough of a performance hit from the patch\nto be too worried about this.\n\nI tried \"prove t/op t/library\" with different scenarios, to try to\nmeasure the performance impact.  Here are the setups and the results:\n\nConfigure.pl with no args, and no patches applied\n\nAll tests successful, 2 tests and 172 subtests skipped.\nFiles=56, Tests=2488, 73 wallclock secs (51.64 cusr + 11.49 csys = 63.13 CPU)\n\n\nConfigure.pl with no args, #42938 patch applied\n\nAll tests successful, 2 tests and 172 subtests skipped.\nFiles=56, Tests=2488, 72 wallclock secs (51.73 cusr + 11.59 csys = 63.32 CPU)\n\n\nConfigure.pl --gc=libc, no patches applied\n\nFailed Test              Stat Wstat Total Fail  List of Failed\n-------------------------------------------------------------------------------\nt/library/string_utils.t    0     6    29    4  28-29\nt/op/stringu.t              2   512    25    2  1 19\n2 tests and 176 subtests skipped.\nFailed 2/56 test scripts. 4/2488 subtests failed.\nFiles=56, Tests=2488, 69 wallclock secs (50.57 cusr + 11.19 csys = 61.76 CPU)\nFailed 2/56 test programs. 4/2488 subtests failed.\n\n\nConfigure.pl --gc=libc, #42938 patch applied\n\nAll tests successful, 2 tests and 176 subtests skipped.\nFiles=56, Tests=2488, 70 wallclock secs (50.67 cusr + 11.24 csys = 61.91 CPU)\n\n\nMark\n\n"}