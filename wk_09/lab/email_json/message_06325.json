{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 108: merge CTDB_SRVID_ALL patch from Samba4 in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 108\nrevision-id: tridge@samba.org-20070416003139-ac731d5336e759e3\nparent: tridge@samba.org-20070416002144-34daa28d0f1d01db\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Mon 2007-04-16 10:31:39 +1000\nmessage:\n  merge CTDB_SRVID_ALL patch from Samba4\nmodified:\n  common/ctdb_message.c          ctdb_message.c-20070208224107-9dnio7x7z33prrmt-1\n  common/ctdb_util.c             ctdb_util.c-20061128065342-to93h6eejj5kon81-3\n  include/ctdb.h                 ctdb.h-20061117234101-o3qt14umlg9en8z0-11\n=== modified file 'common/ctdb_message.c'\n--- a/common/ctdb_message.c\t2007-04-16 00:21:44 +0000\n+++ b/common/ctdb_message.c\t2007-04-16 00:31:39 +0000\n@@ -39,7 +39,7 @@\n \t/* XXX we need a must faster way of finding the matching srvid\n \t   - maybe a tree? */\n \tfor (ml=ctdb->message_list;ml;ml=ml->next) {\n-\t\tif (ml->srvid == srvid) break;\n+\t\tif (ml->srvid == srvid || ml->srvid == CTDB_SRVID_ALL) break;\n \t}\n \tif (ml == NULL) {\n \t\tprintf(\"daemon vnn:%d  no msg handler for srvid=%u\\n\", ctdb_get_vnn(ctdb), srvid);\n\n=== modified file 'common/ctdb_util.c'\n--- a/common/ctdb_util.c\t2007-04-16 00:21:44 +0000\n+++ b/common/ctdb_util.c\t2007-04-16 00:31:39 +0000\n@@ -43,15 +43,16 @@\n \ttalloc_free(ctdb->err_msg);\n \tva_start(ap, fmt);\n \tctdb->err_msg = talloc_vasprintf(ctdb, fmt, ap);\n+\tDEBUG(0,(\"ctdb error: %s\\n\", ctdb->err_msg));\n \tva_end(ap);\n }\n \n-\n /*\n   a fatal internal error occurred - no hope for recovery\n */\n void ctdb_fatal(struct ctdb_context *ctdb, const char *msg)\n {\n+\tDEBUG(0,(\"ctdb fatal error: %s\\n\", msg));\n \tfprintf(stderr, \"ctdb fatal error: '%s'\\n\", msg);\n \tabort();\n }\n\n=== modified file 'include/ctdb.h'\n--- a/include/ctdb.h\t2007-04-12 05:46:50 +0000\n+++ b/include/ctdb.h\t2007-04-16 00:31:39 +0000\n@@ -56,6 +56,11 @@\n #define CTDB_FLAG_CONNECT_WAIT (1<<2)\n \n \n+/* \n+   a message handler ID meaning \"give me all messages\"\n+ */\n+#define CTDB_SRVID_ALL 0xFFFFFFFF\n+\n struct event_context;\n \n /*\n\n"}