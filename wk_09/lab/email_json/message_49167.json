{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "svn commit: samba r23520 - in branches/SAMBA_4_0/source/client: .", "body": "Author: tridge\nDate: 2007-06-16 17:14:02 +0000 (Sat, 16 Jun 2007)\nNew Revision: 23520\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23520\n\nLog:\n\ndisplay shadow copy information in 'allinfo'\n\nModified:\n   branches/SAMBA_4_0/source/client/client.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/client/client.c\n===================================================================\n--- branches/SAMBA_4_0/source/client/client.c\t2007-06-16 17:13:42 UTC (rev 23519)\n+++ branches/SAMBA_4_0/source/client/client.c\t2007-06-16 17:14:02 UTC (rev 23520)\n@@ -1726,6 +1726,7 @@\n \tchar *fname;\n \tunion smb_fileinfo finfo;\n \tNTSTATUS status;\n+\tint fnum;\n \n \tif (!args[1]) {\n \t\td_printf(\"allinfo \\n\");\n@@ -1809,6 +1810,40 @@\n \t\td_printf(\"\\tcluster_shift   %ld\\n\", (long)finfo.compression_info.out.cluster_shift);\n \t}\n \n+\t/* shadow copies if available */\n+\tfnum = smbcli_open(ctx->cli->tree, fname, O_RDONLY, DENY_NONE);\n+\tif (fnum != -1) {\n+\t\tstruct smb_shadow_copy info;\n+\t\tint i;\n+\t\tinfo.in.file.fnum = fnum;\n+\t\tinfo.in.max_data = ~0;\n+\t\tstatus = smb_raw_shadow_data(ctx->cli->tree, ctx, &info);\n+\t\tif (NT_STATUS_IS_OK(status)) {\n+\t\t\td_printf(\"\\tshadow_copy: %u volumes  %u names\\n\",\n+\t\t\t\t info.out.num_volumes, info.out.num_names);\n+\t\t\tfor (i=0;icli->tree, ctx, &finfo);\n+\t\t\t\tif (NT_STATUS_EQUAL(status, NT_STATUS_OBJECT_PATH_NOT_FOUND)) {\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (!NT_STATUS_IS_OK(status)) {\n+\t\t\t\t\td_printf(\"%s - %s\\n\", finfo.generic.in.file.path, \n+\t\t\t\t\t\t nt_errstr(status));\n+\t\t\t\t\treturn 1;\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\td_printf(\"\\t\\tcreate_time:    %s\\n\", nt_time_string(ctx, finfo.all_info.out.create_time));\n+\t\t\t\td_printf(\"\\t\\twrite_time:     %s\\n\", nt_time_string(ctx, finfo.all_info.out.write_time));\n+\t\t\t\td_printf(\"\\t\\tchange_time:    %s\\n\", nt_time_string(ctx, finfo.all_info.out.change_time));\n+\t\t\t\td_printf(\"\\t\\tsize:           %lu\\n\", (unsigned long)finfo.all_info.out.size);\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n \treturn 0;\n }\n \n\n"}