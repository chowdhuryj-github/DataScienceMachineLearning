{"category": "ham", "to_address": "Joshua Isom <jrisom@gmail.com>", "from_address": "Mark Glines <mark@glines.org>", "subject": "LD_LIBRARY_PATH required on FreeBSD (was: Re: GC bug on\n freebsd/x86, triggered by a perl6 test)", "body": "On Tue, 5 Jun 2007 01:13:36 -0500\nJoshua Isom  wrote:\n\n> After a little prodding around, I think the problem is that the\n> dynops aren't build with the rpath.  I don't know how \"proper\" the\n> following patch is(i.e. linux doesn't seem to have a problem so\n> either this is right or the other way is right), but it does the\n> trick.\n\n\n> -our $LDFLAGS = q[@ldflags@ @ld_debug@];\n> +our $LDFLAGS = q[@ldflags@ @ld_debug@ @rpath_blib@];\n\nSorry, but this patch didn't change anything for me.  The libparrot.so\nlink line looks the same (maybe because its linking with cc, not ld),\nand I still need to specify an LD_LIBRARY_PATH when invoking parrot\nfrom a subdir, later on.\n\nSince it works on linux but not freebsd, and since freebsd seems to\nhave the same tools available as linux, could it just be a difference\nin the hints files?\n\nparanoid@chirp ~/parrot $ grep rpath config/init/hints/freebsd.pm config/init/hints/linux.pm\nconfig/init/hints/freebsd.pm:        rpath => '-Wl,-R',\nconfig/init/hints/linux.pm:        rpath          => '-Wl,-rpath=',\n\nOn the other hand, I don't see an actual \"-Wl,-rpath=\" clause on the\nlinker line for a linux build, either.  And the result works on linux\nwithout any LD_LIBRARY_PATH hints, but not on freebsd.\n\nLinker line under linux:\n\ni686-pc-linux-gnu-gcc -shared -L/usr/local/lib -fPIC -L/usr/local/lib\n-o blib/lib/libparrot.so.0.4.12 -Wl,-soname=libparrot.so.0.4.12 [long\nlist of objects] -lpthread -lnsl -ldl -lm -lcrypt -lutil -lrt -lgmp\n-lreadline -lncurses -lpthread -lm -L/usr/lib  -licuuc -licudata\n-lpthread -lm\n\nLinker line under freebsd:\n\ncc -shared  -L/usr/local/lib -Wl,-E -L/usr/local/lib -o\nblib/lib/libparrot.so.0.4.12 -Wl,-soname=libparrot.so.0.4.12 [long list\nof objects] -lm -lcrypt -lutil -pthread -lreadline\n\nMark\n\n"}