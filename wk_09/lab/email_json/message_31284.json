{"category": "ham", "to_address": "\"fatih ozgul\" <fatih.ozgul@gmail.com>", "from_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "subject": "Re: [R] converting a data frame to ts objects", "body": "On 5/16/07, Gabor Grothendieck  wrote:\n> On 5/16/07, fatih ozgul  wrote:\n> > Dear R-ians\n> >\n> > I have a data frame like\n> >\n> > Person_id  Date/time        Count\n> > ---------  ----------      -------\n> > 123         20 May 1999      1\n> > 123         21 May 1999      3\n> > 222         1  Feb 2000      2\n> > 222         3  Feb 2000      4\n> >\n> > I want to create ts objects for each person_id (i.e. 123 and 222). Time\n> > series frequency can be in months and all starting from the same date (i.e.\n> > May 1999).\n> >\n> > Rather than manually creating sum of counts for each month and creating ts\n> > objects manually for each persons,\n> >\n> > Is there a function for creating ts objects automatically from such data?\n> >\n>\n> Try this:\n>\n> # read in as data frame and fix up date\n> Lines.raw <- \"Person_id Date/time Count\n> 123 20 May 1999 1\n> 123 21 May 1999 3\n> 222 1 Feb 2000 2\n> 222 3 Feb 2000 4\n> \"\n> library(zoo)\n> DF <- read.table(textConnection(Lines.raw), skip = 1,\n>  col.names = c(\"Person_id\", \"d\", \"b\", \"Y\", \"Count\"))\n> DF$Date.time <- as.Date(paste(DF$d, DF$b, DF$Y), \"%d %b %Y\")\n>\n> # aggregate counts over months, series and convert to \"ts\"\n> f <- function(DF) aggregate(zoo(DF$Count), as.yearmon(DF$Date.time), sum)\n> z <- do.call(\"merge.zoo\", lapply(split(DF, DF$Person_id), f))\n> frequency(z) <- 12\n> as.ts(z)\n>\n\nA slight simplification based on zoo 1.3-1 (which just appeared on CRAN)\nis the following.  It converts the month and year columns directly into\nclass \"yearmon\" eliminating the intermediate step of going via \"Date\" class.\nIts the same number of lines but a couple of the lines are now simpler.\n\n# read in as data frame and fix up date\nLines.raw <- \"Person_id Date/time Count\n\n123 20 May 1999 1\n123 21 May 1999 3\n222 1 Feb 2000 2\n222 3 Feb 2000 4\n\"\n\nlibrary(zoo)\nDF <- read.table(textConnection(Lines.raw), skip = 1,\n col.names = c(\"Person_id\", \"d\", \"b\", \"Y\", \"Count\"))\nDF$yearmon <- as.yearmon(paste(DF$b, DF$Y), \"%b %Y\")\n\n# aggregate counts over months, merge series and convert to \"ts\"\nag <- function(DF) aggregate(zoo(DF$Count), DF$yearmon, sum)\nz <- do.call(\"merge.zoo\", lapply(split(DF, DF$Person_id), ag))\nfrequency(z) <- 12\nas.ts(z)\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}