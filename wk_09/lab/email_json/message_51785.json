{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "\"M. Jankowski\" <mjankowski@gmail.com>", "subject": "[R] Need Help: User Defined R Functions in Sweave/Latex", "body": "Dear all,\n\nI want to start my post by expressing my sincere gratitude for all the\nhelp this group has given me in Sweave/Latex/R. The tools are\nexcellent and so is the community!\n\nOn to the question.\n\nMy Sweave code is intended to make lots of plots and create a *.pdf\ndocument. Sweave is perfect for this. The only problem is that  I find\nmyself using the same R code, within my Sweave input file over an\nover. I know about Latex macros and I can even get R functions,\nessentially used as subroutines, to sort of work. \"\\Sexpr{}\" will not\nwork because the R code I want to use over and over is in the R\nenvironment. I've tried numerous ways to tackle this process and could\nreally use some help. If there is some easier way to do this please\nlet me know!\n\nThis is the R function:\nbasicplot <- function(x, nplots, sectionname){\n# Begin to make figure here\nfile = paste(\"scatter\",nplots, \".pdf\", sep=\"\")\npdf(file = file,paper=\"special\", width=6, height = 6)\nplot(x)\ndev.off()\ncat(\"\\\\begin{figure}\\n\")\ncat(\"\\\\includegraphics{\",file,\"}\\n\", sep=\"\")\ncat(\"\\\\caption{\", sectionname,\"}\\n\", sep = \"\")\ncat(\"\\\\end{figure}\\n\")\n#End figure making\n}\n\nThe aim is to generate Latex code which will have some basic\ninformation as part of the caption. The trouble seems to be that the\noutput from the function appears to latex as if it is protected R code\nwhen I really want to create output that pdflatex will act on.\nEssentially, the resulting *.pdf contains the lines output by the cat\nfunction in basicplot. Or:\n\\begin{figure}\n\\includegraphics{scatter1.pdf}\n\\caption{myname}\n\\end{figure}\nThese lines are not in the environment acted by Latex. I tried a\nvariant of the function where <> and received\nthe same result. Below are the files *.Snw -> *.tex -> *.pdf and the\noutput I received while compiling. If there is anything else I can\ngive to help you help me just let me know. Thanks!\n\nMatt\n\nMy system:\nT41 IBM Thinkpad\nUbuntu Feisty (7.04)\nR version 2.5\n\ntestmacro3.Snw:\nmdj@lapmdj:~/mydocs/R$ more testmacro3.Snw\n\\documentclass[a4paper]{article}\n\\usepackage{fullpage}\n<>=\nbasicplot <- function(x, nplots, sectionname){\n# Begin to make figure here\nfile = paste(\"scatter\",nplots, \".pdf\", sep=\"\")\npdf(file = file,paper=\"special\", width=6, height = 6)\nplot(x)\ndev.off()\ncat(\"\\\\begin{figure}\\n\")\ncat(\"\\\\includegraphics{\",file,\"}\\n\", sep=\"\")\ncat(\"\\\\caption{\", sectionname,\"}\\n\", sep = \"\")\ncat(\"\\\\end{figure}\\n\")\n#End figure making\n}\n@\n\n\\begin{document}\nFiller text here.\\\\\n<<>>=\nlibrary(\"flowCore\")\nx <- read.FCS(\"/home/mdj/data/yifacs2/NL7_PHA03_1.fcs\", transformation = FALSE,\nalter.names = TRUE);\nbasicplot(x, nplots = 1, sectionname=\"myname\")\n@\nEnd text here \\\\\n\\end{document}\n\ntestmacro3.tex\n\\usepackage{/usr/share/R/share/texmf/Sweave}\n\\begin{document}\nFiller text here.\\\\\n\\begin{Schunk}\n\\begin{Sinput}\n> library(\"flowCore\")\n\\end{Sinput}\n\\begin{Soutput}\nScalable Robust Estimators with High Breakdown Point (version 0.3-05)\n\\end{Soutput}\n\\begin{Sinput}\n> x <- read.FCS(\"/home/mdj/data/yifacs2/NL7_PHA03_1.fcs\", transformation = FALSE\n,\n+     alter.names = TRUE)\n> basicplot(x, nplots = 1, sectionname = \"myname\")\n\\end{Sinput}\n\\begin{Soutput}\n\\begin{figure}\n\\includegraphics{scatter1.pdf}\n\\caption{myname}\n\\end{figure}\n\\end{Soutput}\n\\end{Schunk}\nEnd text here \\\\\n\\end{document}\n\ntestmacro3.pdf:\nFiller text here.\n> library(\"flowCore\")\nScalable Robust Estimators with High Breakdown Point (version 0.3-05)\n> x <- read.FCS(\"/home/mdj/data/yifacs2/NL7_PHA03_1.fcs\", transformation = FALSE,\n+ alter.names = TRUE)\n> basicplot(x, nplots = 1, sectionname = \"myname\")\n\\begin{figure}\n\\includegraphics{scatter1.pdf}\n\\caption{myname}\n\\end{figure}\nEnd text here\n\n\n\nOutput:\nmdj@lapmdj:~/mydocs/R$ R CMD Sweave testmacro3.Snw\n[1] \"Welcome to my custom R eenvironment!\"\n> library(\"utils\"); Sweave(\"testmacro3.Snw\")\nWriting to file testmacro3.tex\nProcessing code chunks ...\n 1 : term verbatim\n 2 : echo term verbatim\nLoading required package: Biobase\nLoading required package: tools\n\nWelcome to Bioconductor\n\n    Vignettes contain introductory material. To view, type\n    'openVignette()' or start with 'help(Biobase)'. For details\n    on reading vignettes, see the openVignette help page.\n\nLoading required package: rrcov\nKernSmooth 2.22 installed\nCopyright M. P. Wand 1997\n\nYou can now run LaTeX on 'testmacro3.tex'\n> mdj@lapmdj:~/mydocs/Rpdflatex testmacro3.tex\nThis is pdfeTeX, Version 3.141592-1.21a-2.2 (Web2C 7.5.4)\nentering extended mode\n(./testmacro3.tex\nLaTeX2e <2003/12/01>\nBabel  and hyphenation patterns for american, french, german, ngerman, b\nahasa, basque, bulgarian, catalan, croatian, czech, danish, dutch, esperanto, e\nstonian, finnish, greek, icelandic, irish, italian, latin, magyar, norsk, polis\nh, portuges, romanian, russian, serbian, slovak, slovene, spanish, swedish, tur\nkish, ukrainian, nohyphenation, loaded.\n(/usr/share/texmf-tetex/tex/latex/base/article.cls\nDocument Class: article 2004/02/16 v1.4f Standard LaTeX document class\n(/usr/share/texmf-tetex/tex/latex/base/size10.clo))\n(/usr/share/texmf-texlive/tex/latex/preprint/fullpage.sty)\n(/usr/share/R/share/texmf/Sweave.sty\n\nLaTeX Warning: You have requested package `/usr/share/R/share/texmf/Sweave',\n               but the package provides `Sweave'.\n\n(/usr/share/texmf-tetex/tex/latex/base/ifthen.sty)\n(/usr/share/texmf-tetex/tex/latex/graphics/graphicx.sty\n(/usr/share/texmf-tetex/tex/latex/graphics/keyval.sty)\n(/usr/share/texmf-tetex/tex/latex/graphics/graphics.sty\n(/usr/share/texmf-tetex/tex/latex/graphics/trig.sty)\n(/usr/share/texmf-tetex/tex/latex/graphics/graphics.cfg)\n(/usr/share/texmf-tetex/tex/latex/graphics/pdftex.def)))\n(/usr/share/texmf-texlive/tex/latex/fancyvrb/fancyvrb.sty\nStyle option: `fancyvrb' v2.6, with DG/SPQR fixes <1998/07/17> (tvz)\nNo file fancyvrb.cfg.\n) (/usr/share/texmf/tex/latex/R/upquote.sty\n(/usr/share/texmf-tetex/tex/latex/base/textcomp.sty\n(/usr/share/texmf-tetex/tex/latex/base/ts1enc.def)))\n(/usr/share/texmf-tetex/tex/latex/base/fontenc.sty\n(/usr/share/texmf-tetex/tex/latex/base/t1enc.def))\n(/usr/share/texmf-tetex/tex/latex/ae/ae.sty\n(/usr/share/texmf-tetex/tex/latex/base/fontenc.sty\n(/usr/share/texmf-tetex/tex/latex/base/t1enc.def)\n(/usr/share/texmf-tetex/tex/latex/ae/t1aer.fd))))\nNo file testmacro3.aux.\n(/usr/share/texmf-tetex/tex/latex/base/ts1cmr.fd)\n(/usr/share/texmf-tetex/tex/context/base/supp-pdf.tex\n(/usr/share/texmf-tetex/tex/context/base/supp-mis.tex\nloading : Context Support Macros / Miscellaneous (2004.10.26)\n)\nloading : Context Support Macros / PDF (2004.03.26)\n)\nUnderfull \\hbox (badness 10000) in paragraph at lines 6--8\n\n(/usr/share/texmf-tetex/tex/latex/ae/t1aett.fd)\nUnderfull \\hbox (badness 10000) in paragraph at lines 26--27\n\n[1{/var/lib/texmf/fonts/map/pdftex/updmap/pdftex.map}] (./testmacro3.aux) )\n(see the transcript file for additional information)\nOutput written on testmacro3.pdf (1 page, 26713 bytes).\nTranscript written on testmacro3.log.\nmdj@lapmdj:~/mydocs/R$ xpdf testmacro3.pdf &\n[4] 11100\nmdj@lapmdj:~/mydocs/R$ Warning: Attempt to remove nonexistent passive grab\nxpdf testmacro3.pdf &\n[5] 11109\n[4]   Done                    xpdf testmacro.pdf\nmdj@lapmdj:~/mydocs/R$\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}