{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r23369 - in\n\tbranches/SAMBA_3_0_25/packaging/Debian/debian-sarge: . patches", "body": "Author: idra\nDate: 2007-06-06 16:13:14 +0000 (Wed, 06 Jun 2007)\nNew Revision: 23369\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23369\n\nLog:\n\nFix an fhs.patch bug that causes winbind to refuse to start\nif it needs to recreate the winbindd_cache.tdb file\n\n\nModified:\n   branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/changelog\n   branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/fhs.patch\n\n\nChangeset:\nModified: branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/changelog\n===================================================================\n--- branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/changelog\t2007-06-06 13:02:24 UTC (rev 23368)\n+++ branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/changelog\t2007-06-06 16:13:14 UTC (rev 23369)\n@@ -1,3 +1,9 @@\n+samba (3.0.25a-2) stable; urgency=low\n+\n+  * Fix bug in fhs.patch\n+\n+ -- Simo Sorce   Wed, 6  Jun 2007 11:33:30 -0400\n+\n samba (3.0.25a-1) stable; urgency=high\n \n   * samba 3.0.25a Stabilizing release\n\nModified: branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/fhs.patch\n===================================================================\n--- branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/fhs.patch\t2007-06-06 13:02:24 UTC (rev 23368)\n+++ branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/fhs.patch\t2007-06-06 16:13:14 UTC (rev 23369)\n@@ -261,6 +261,27 @@\n  \t\t\t\tWINBINDD_CACHE_TDB_DEFAULT_HASH_SIZE, \n  \t\t\t\tTDB_DEFAULT /*TDB_CLEAR_IF_FIRST*/, O_RDWR|O_CREAT, 0600);\n  \n+@@ -2223,9 +2223,9 @@\n+ \t\ttdb_close(wcache->tdb);\n+ \t\twcache->tdb = NULL;\n+ \n+-\t\tif (unlink(lock_path(\"winbindd_cache.tdb\")) == -1) {\n++\t\tif (unlink(cache_path(\"winbindd_cache.tdb\")) == -1) {\n+ \t\t\tDEBUG(0,(\"initialize_winbindd_cache: unlink %s failed %s \",\n+-\t\t\t\tlock_path(\"winbindd_cache.tdb\"),\n++\t\t\t\tcache_path(\"winbindd_cache.tdb\"),\n+ \t\t\t\tstrerror(errno) ));\n+ \t\t\treturn False;\n+ \t\t}\n+@@ -2487,7 +2487,7 @@\n+ \t\treturn;\n+ \n+ \t/* when working offline we must not clear the cache on restart */\n+-\twcache->tdb = tdb_open_log(lock_path(\"winbindd_cache.tdb\"),\n++\twcache->tdb = tdb_open_log(cache_path(\"winbindd_cache.tdb\"),\n+ \t\t\t\tWINBINDD_CACHE_TDB_DEFAULT_HASH_SIZE, \n+ \t\t\t\tlp_winbind_offline_logon() ? TDB_DEFAULT : (TDB_DEFAULT | TDB_CLEAR_IF_FIRST), \n+ \t\t\t\tO_RDWR|O_CREAT, 0600);\n diff -uNr samba-3.0.10.orig/source/param/loadparm.c samba-3.0.10/source/param/loadparm.c\n --- samba-3.0.10.orig/source/param/loadparm.c\t2004-12-17 03:50:09.000000000 -0800\n +++ samba-3.0.10/source/param/loadparm.c\t2004-12-17 03:55:30.000000000 -0800\n\n"}