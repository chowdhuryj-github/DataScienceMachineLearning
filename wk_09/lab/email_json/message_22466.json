{"category": "ham", "to_address": "simo <idra@samba.org>", "from_address": "Johann Hanne <jhml@gmx.net>", "subject": "Re: \"valid users = domain_user\" without specifying domain", "body": "On Thursday 03 May 2007 15:08, you wrote:\n> On Mon, 2007-04-30 at 13:11 +0200, Johann Hanne wrote:\n> > > I'm pretty sure this behavior is described in the release notes for\n> > > the 3.0.23 release series.  It is by deisgn.  DOMAION\\group1 and\n> > > (local) group1 have different SIDs.\n> >\n> > Yes, I've read the release notes, but maybe I'm misunderstanding\n> > something. I thought that \"valid users = +apache\" is the same as \"valid\n> > users = +MACHINE\\apache\" and that MACHINE is the literal string\n> > \"MACHINE\"?\n>\n> no, MACHINE is the name of your machine (netbios name), and MACHINE\n> +apache refer to a mapped group you can create (mapped to the local\n> apache).\n>\n> > > > Shouldn't this be a configuration that works? user1,\n> > > > user2 and user3 are actually winbind/nss mapped users, so why\n> > > > do I have to specify the domain name here?\n> > >\n> > > Just make MACHINE\\Apache and add domain users to that.\n> >\n> > I really tried everything I could think of. And I've also added all\n> > possible combinations (even those which don't make sense to me),\n> > currently I have:\n>\n> just map a local group to apache and it should just work.\nI tried:\n--\n# net groupmap add unixgroup=apache type=local\nNo rid or sid specified, choosing a RID\nGot RID 1163\nSuccessfully added group apache to the mapping db as a alias (local) group\n# net groupmap list\napache (S-1-5-21-3048374563-2127316528-2660899232-1163) -> apache\n# net sam list localgroups\napache\n# net sam listmem apache\nMYSERVER\\apache has 0 members\n--\n(It works if I add MYDOMAIN\\user1 with \"net sam addmem\", but this is not what \nI want - I'd like to maintain 1 group only...)\n\n/etc/group has:\n--\napache::81:user1\n--\n\nsmb.conf has:\n--\n[www]\n  comment = Web\n  path = /var/www\n  valid users = +apache\n--\n\nsmbd -i -S -d 100\n--\n...\nenum_group_mapping: returning group apache of type Local Group\n...\nmaking a connection to 'normal' service www\nstring_to_sid: Sid +apache does not start with 'S-'.\nlookup_name: MYSERVER\\apache => MYSERVER (domain), apache (name)\npush_sec_ctx(0, 0) : sec_ctx_stack_ndx = 1\npush_conn_ctx(0) : conn_ctx_stack_ndx = 0\nsetting sec ctx (0, 0) - sec_ctx_stack_ndx = 1\nNT user token: (NULL)\nUNIX token of user 0\nPrimary group is 0 and contains 0 supplementary groups\ntdb_unpack(ddff, 32) -> 32\npop_sec_ctx (0, 0) - sec_ctx_stack_ndx = 0\nUser MYDOMAIN\\user1 not in 'valid users'\n...\n--\n\nAm I still missing something?? I really can't find anything related in the \nHOWTOs...\n\nThanks for your help!\n\nCheers, Johann\n\n"}