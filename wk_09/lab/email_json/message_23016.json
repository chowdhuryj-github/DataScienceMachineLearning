{"category": "ham", "to_address": "\"Dave Daugherty\" <dave.daugherty@centrify.com>", "from_address": "Michael B Allen <mba2000@ioplex.com>", "subject": "Re: Cross Realm SMB Signature Failure", "body": "On Thu, 3 May 2007 20:21:30 -0700\n\"Dave Daugherty\"  wrote:\n\n> I think the signing key is communicated in the AP_REP coming back from\n> the server.  Maybe the Windows server does not like something about the\n> AP_REQ packet.\n\nHi Dave,\n\nYeah. Maybe the MIT ticket is a little different (e.g. no PAC) and the\nserver code isn't trying hard enough to come up with a good session key\nor it's using the wrong session key.\n\n> Are you running the latest MIT Kerberos libraries?\n\nEah, 1.3.4 shipped with CentOS 4.4. Could be newer I suppose.\n\nI just installed SP2 + SP2 update on the target Windows server. It had\nno effect.\n\nMike\n\n> Subject: Cross Realm SMB Signature Failure\n> \n> When smbclient authenticates across realms (from MIT realm S.W.NET to\n> W2K3 realm W.NET) I'm seeing the server is just echoing back the same\n> signature sent by client. That signature of couse fails verification:\n> \n> $ kinit -f ioplex@S.W.NET\n> Password for ioplex@S.W.NET: \n> $ smbclient -k -U ioplex //dc1.w.net/tmp\n> signing_good: BAD SIG: seq 1\n> SMB Signature verification failed on incoming packet!\n> session setup failed: Server packet had invalid SMB signature!\n> \n> If I use a W.NET cred it works fine and ssh works in the other direction\n> so I think the trust is good.\n> \n> All enctypes are RC4. Haven't updated the W2K3 server since installing\n> it. Trying that now ...\n> \n> I'm using stock 3.0.23c-2 on CentOS 5.0 with an unmodified smb.conf.\n> \n> Has anyone seen this before?\n> \n> Mike\n\n-- \nMichael B Allen\nPHP Active Directory Kerberos SSO\nhttp://www.ioplex.com/\n\n"}