{"category": "ham", "to_address": "\"Patrick R. Michaud\" <pmichaud@pobox.com>", "from_address": "chromatic <chromatic@wgz.org>", "subject": "Re: Odd Memory Corruption", "body": "On Thursday 05 July 2007 19:58:50 Patrick R. Michaud wrote:\n\n> I also get segfaults after applying this patch.\n>\n> However, if I change the patch such that the \"size_t sentinel;\"\n> line goes at the end of the struct PMC instead of the beginning,\n> then everything appears to compile and run.\n>\n> In fact, if \"size_t sentinel;\" is placed as the second or third\n> line in the struct (i.e., after \"pobj_t obj;\" or \"VTABLE *vtable;\")\n> then things still appear to compile and run.  It's only when the\n> sentinel is given as the first line that I get errors.\n>\n> So, I'm guessing there's some code somewhere that assumes that\n> \"obj\" is always the first component of PMC.\n\nRight, and the clue was also in parrot/pobj.h.  Because buffers, strings, and \nPMCs all are PObjs, their structs must be isomorphic.  Hoisting the sentinel \ninto the pobj_t struct gets past that segfault.\n\nStructural subtyping hates me.\n\n-- c\n\n"}