{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r22740 - in branches/SAMBA_3_0/source/auth: .", "body": "Author: vlendec\nDate: 2007-05-07 12:15:11 +0000 (Mon, 07 May 2007)\nNew Revision: 22740\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22740\n\nLog:\nMove debug_*_user_token to token_utils.c\n\nModified:\n   branches/SAMBA_3_0/source/auth/auth_util.c\n   branches/SAMBA_3_0/source/auth/token_util.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/auth/auth_util.c\n===================================================================\n--- branches/SAMBA_3_0/source/auth/auth_util.c\t2007-05-07 11:25:00 UTC (rev 22739)\n+++ branches/SAMBA_3_0/source/auth/auth_util.c\t2007-05-07 12:15:11 UTC (rev 22740)\n@@ -430,51 +430,6 @@\n \treturn NT_STATUS_IS_OK(nt_status) ? True : False;\n }\n \n-/****************************************************************************\n- prints a NT_USER_TOKEN to debug output.\n-****************************************************************************/\n-\n-void debug_nt_user_token(int dbg_class, int dbg_lev, NT_USER_TOKEN *token)\n-{\n-\tsize_t     i;\n-\t\n-\tif (!token) {\n-\t\tDEBUGC(dbg_class, dbg_lev, (\"NT user token: (NULL)\\n\"));\n-\t\treturn;\n-\t}\n-\t\n-\tDEBUGC(dbg_class, dbg_lev,\n-\t       (\"NT user token of user %s\\n\",\n-\t\tsid_string_static(&token->user_sids[0]) ));\n-\tDEBUGADDC(dbg_class, dbg_lev,\n-\t\t  (\"contains %lu SIDs\\n\", (unsigned long)token->num_sids));\n-\tfor (i = 0; i < token->num_sids; i++)\n-\t\tDEBUGADDC(dbg_class, dbg_lev,\n-\t\t\t  (\"SID[%3lu]: %s\\n\", (unsigned long)i, \n-\t\t\t   sid_string_static(&token->user_sids[i])));\n-\n-\tdump_se_priv( dbg_class, dbg_lev, &token->privileges );\n-}\n-\n-/****************************************************************************\n- prints a UNIX 'token' to debug output.\n-****************************************************************************/\n-\n-void debug_unix_user_token(int dbg_class, int dbg_lev, uid_t uid, gid_t gid,\n-\t\t\t   int n_groups, gid_t *groups)\n-{\n-\tint     i;\n-\tDEBUGC(dbg_class, dbg_lev,\n-\t       (\"UNIX token of user %ld\\n\", (long int)uid));\n-\n-\tDEBUGADDC(dbg_class, dbg_lev,\n-\t\t  (\"Primary group is %ld and contains %i supplementary \"\n-\t\t   \"groups\\n\", (long int)gid, n_groups));\n-\tfor (i = 0; i < n_groups; i++)\n-\t\tDEBUGADDC(dbg_class, dbg_lev, (\"Group[%3i]: %ld\\n\", i, \n-\t\t\t(long int)groups[i]));\n-}\n-\n static int server_info_dtor(auth_serversupplied_info *server_info)\n {\n \tTALLOC_FREE(server_info->sam_account);\n\nModified: branches/SAMBA_3_0/source/auth/token_util.c\n===================================================================\n--- branches/SAMBA_3_0/source/auth/token_util.c\t2007-05-07 11:25:00 UTC (rev 22739)\n+++ branches/SAMBA_3_0/source/auth/token_util.c\t2007-05-07 12:15:11 UTC (rev 22740)\n@@ -147,8 +147,8 @@\n  * Add alias SIDs from memberships within the partially created token SID list\n  */\n \n-static NTSTATUS add_aliases(const DOM_SID *domain_sid,\n-\t\t\t    struct nt_user_token *token)\n+NTSTATUS add_aliases(const DOM_SID *domain_sid,\n+\t\t     struct nt_user_token *token)\n {\n \tuint32 *aliases;\n \tsize_t i, num_aliases;\n@@ -455,4 +455,49 @@\n \treturn result;\n }\n \n+/****************************************************************************\n+ prints a NT_USER_TOKEN to debug output.\n+****************************************************************************/\n+\n+void debug_nt_user_token(int dbg_class, int dbg_lev, NT_USER_TOKEN *token)\n+{\n+\tsize_t     i;\n+\t\n+\tif (!token) {\n+\t\tDEBUGC(dbg_class, dbg_lev, (\"NT user token: (NULL)\\n\"));\n+\t\treturn;\n+\t}\n+\t\n+\tDEBUGC(dbg_class, dbg_lev,\n+\t       (\"NT user token of user %s\\n\",\n+\t\tsid_string_static(&token->user_sids[0]) ));\n+\tDEBUGADDC(dbg_class, dbg_lev,\n+\t\t  (\"contains %lu SIDs\\n\", (unsigned long)token->num_sids));\n+\tfor (i = 0; i < token->num_sids; i++)\n+\t\tDEBUGADDC(dbg_class, dbg_lev,\n+\t\t\t  (\"SID[%3lu]: %s\\n\", (unsigned long)i, \n+\t\t\t   sid_string_static(&token->user_sids[i])));\n+\n+\tdump_se_priv( dbg_class, dbg_lev, &token->privileges );\n+}\n+\n+/****************************************************************************\n+ prints a UNIX 'token' to debug output.\n+****************************************************************************/\n+\n+void debug_unix_user_token(int dbg_class, int dbg_lev, uid_t uid, gid_t gid,\n+\t\t\t   int n_groups, gid_t *groups)\n+{\n+\tint     i;\n+\tDEBUGC(dbg_class, dbg_lev,\n+\t       (\"UNIX token of user %ld\\n\", (long int)uid));\n+\n+\tDEBUGADDC(dbg_class, dbg_lev,\n+\t\t  (\"Primary group is %ld and contains %i supplementary \"\n+\t\t   \"groups\\n\", (long int)gid, n_groups));\n+\tfor (i = 0; i < n_groups; i++)\n+\t\tDEBUGADDC(dbg_class, dbg_lev, (\"Group[%3i]: %ld\\n\", i, \n+\t\t\t(long int)groups[i]));\n+}\n+\n /* END */\n\n"}