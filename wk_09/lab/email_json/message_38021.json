{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 382: default log file to reasonable location in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 382\nrevision-id: tridge@samba.org-20070529052638-xj2efvjbm9e8o6y7\nparent: tridge@samba.org-20070529052041-dmvblb655nqxg7dx\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Tue 2007-05-29 15:26:38 +1000\nmessage:\n  default log file to reasonable location\nmodified:\n  common/cmdline.c               cmdline.c-20070416041216-w1zvz91bkdsgjckw-1\n  direct/ctdbd.c                 ctdbd.c-20070411085044-dqmhr6mfeexnyt4m-1\n  packaging/RHEL/setup/ctdb.sysconfig ctdb.sysconfig-20070527204758-biuh7znabuwan3zn-7\n=== modified file 'common/cmdline.c'\n--- a/common/cmdline.c\t2007-05-29 05:20:41 +0000\n+++ b/common/cmdline.c\t2007-05-29 05:26:38 +0000\n@@ -36,7 +36,6 @@\n \tint self_connect;\n \tconst char *db_dir;\n \tint torture;\n-\tconst char *logfile;\n \tconst char *events;\n } ctdb_cmdline = {\n \t.nlist = ETCDIR \"/ctdb/nodes\",\n@@ -46,7 +45,6 @@\n \t.self_connect = 0,\n \t.db_dir = VARDIR \"/ctdb\",\n \t.torture = 0,\n-\t.logfile = NULL,\n };\n \n enum {OPT_EVENTSYSTEM=1};\n@@ -74,7 +72,6 @@\n \t{ \"debug\", 'd', POPT_ARG_INT, &LogLevel, 0, \"debug level\"},\n \t{ \"dbdir\", 0, POPT_ARG_STRING, &ctdb_cmdline.db_dir, 0, \"directory for the tdb files\", NULL },\n \t{ \"torture\", 0, POPT_ARG_NONE, &ctdb_cmdline.torture, 0, \"enable nastiness in library\", NULL },\n-\t{ \"logfile\", 0, POPT_ARG_STRING, &ctdb_cmdline.logfile, 0, \"log file location\", \"filename\" },\n \t{ \"events\", 0, POPT_ARG_STRING, NULL, OPT_EVENTSYSTEM, \"event system\", NULL },\n \t{ NULL }\n };\n@@ -100,12 +97,6 @@\n \t\texit(1);\n \t}\n \n-\tret = ctdb_set_logfile(ctdb, ctdb_cmdline.logfile);\n-\tif (ret == -1) {\n-\t\tprintf(\"ctdb_set_logfile failed - %s\\n\", ctdb_errstr(ctdb));\n-\t\texit(1);\n-\t}\n-\n \tif (ctdb_cmdline.self_connect) {\n \t\tctdb_set_flags(ctdb, CTDB_FLAG_SELF_CONNECT);\n \t}\n\n=== modified file 'direct/ctdbd.c'\n--- a/direct/ctdbd.c\t2007-05-29 05:20:41 +0000\n+++ b/direct/ctdbd.c\t2007-05-29 05:26:38 +0000\n@@ -42,11 +42,14 @@\n \tconst char *public_address_list;\n \tconst char *public_interface;\n \tconst char *event_script;\n+\tconst char *logfile;\n } options = {\n-\t.event_script = ETCDIR \"/ctdb/events\"\n+\t.event_script = ETCDIR \"/ctdb/events\",\n+\t.logfile = VARDIR \"/log/log.ctdb\"\n };\n \n \n+\n /*\n   main program\n */\n@@ -62,6 +65,7 @@\n \t\t{ \"public-addresses\", 0, POPT_ARG_STRING, &options.public_address_list, 0, \"public address list file\", \"filename\" },\n \t\t{ \"public-interface\", 0, POPT_ARG_STRING, &options.public_interface, 0, \"public interface\", \"interface\"},\n \t\t{ \"event-script\", 0, POPT_ARG_STRING, &options.event_script, 0, \"event script\", \"filename\" },\n+\t\t{ \"logfile\", 0, POPT_ARG_STRING, &options.logfile, 0, \"log file location\", \"filename\" },\n \t\tPOPT_TABLEEND\n \t};\n \tint opt, ret;\n@@ -94,6 +98,12 @@\n \n \tctdb = ctdb_cmdline_init(ev);\n \n+\tret = ctdb_set_logfile(ctdb, options.logfile);\n+\tif (ret == -1) {\n+\t\tprintf(\"ctdb_set_logfile to %s failed - %s\\n\", options.logfile, ctdb_errstr(ctdb));\n+\t\texit(1);\n+\t}\n+\n \tif (options.public_interface) {\n \t\tctdb->takeover.interface = talloc_strdup(ctdb, options.public_interface);\n \t\tCTDB_NO_MEMORY(ctdb, ctdb->takeover.interface);\n\n=== modified file 'packaging/RHEL/setup/ctdb.sysconfig'\n--- a/packaging/RHEL/setup/ctdb.sysconfig\t2007-05-28 15:38:04 +0000\n+++ b/packaging/RHEL/setup/ctdb.sysconfig\t2007-05-29 05:26:38 +0000\n@@ -1,8 +1,7 @@\n # Options to ctdbd\n-CLUSTER_NODES=/etc/samba/cluster_nodes.txt\n-PUBLIC_ADDRESSES=/etc/samba/public_addresses.txt\n+CLUSTER_NODES=/etc/ctdb/nodes\n+PUBLIC_ADDRESSES=/etc/ctdb/public_addresses\n PUBLIC_INTERFACE=eth0\n-#CTDB_PORT=9001\n #LOGFILE=/var/log/samba/log.ctdb\n #DEBUGLEVEL=0\n \n\n"}