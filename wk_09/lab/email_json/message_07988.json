{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "lmuelle@samba.org", "subject": "svn commit: samba r22318 - in branches: SAMBA_3_0/source/lib\n\tSAMBA_3_0_25/source/lib", "body": "Author: lmuelle\nDate: 2007-04-17 17:17:19 +0000 (Tue, 17 Apr 2007)\nNew Revision: 22318\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22318\n\nLog:\nIf we're running as non root we might not be able to dump the core file\nto the corepath.\n\nEven the chdir() will fail if the LOGFILEBASE path is set 0700.\n\nIf the currrent user doesn't have the permission to create the core file\nwe end with:\n   unable to change to \n   refusing to dump core\n\nThe alternative would be to change the permissions of the directory.\nBut taht would not ensure core dumps are working out of the box.\n\nModified:\n   branches/SAMBA_3_0/source/lib/fault.c\n   branches/SAMBA_3_0_25/source/lib/fault.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/fault.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/fault.c\t2007-04-17 17:07:14 UTC (rev 22317)\n+++ branches/SAMBA_3_0/source/lib/fault.c\t2007-04-17 17:17:19 UTC (rev 22318)\n@@ -161,6 +161,13 @@\n \t}\n \n #if DUMP_CORE\n+\t/* If we're running as non root we might not be able to dump the core\n+\t * file to the corepath.  There must not be an unbecome_root() before\n+\t * we call abort(). */\n+\tif (getuid() != 0) {\n+\t\tbecome_root();\n+\t}\n+\n \tif (*corepath != '\\0') {\n \t\t/* The chdir might fail if we dump core before we finish\n \t\t * processing the config file.\n\nModified: branches/SAMBA_3_0_25/source/lib/fault.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/lib/fault.c\t2007-04-17 17:07:14 UTC (rev 22317)\n+++ branches/SAMBA_3_0_25/source/lib/fault.c\t2007-04-17 17:17:19 UTC (rev 22318)\n@@ -161,6 +161,13 @@\n \t}\n \n #if DUMP_CORE\n+\t/* If we're running as non root we might not be able to dump the core\n+\t * file to the corepath.  There must not be an unbecome_root() before\n+\t * we call abort(). */\n+\tif (getuid() != 0) {\n+\t\tbecome_root();\n+\t}\n+\n \tif (*corepath != '\\0') {\n \t\t/* The chdir might fail if we dump core before we finish\n \t\t * processing the config file.\n\n"}