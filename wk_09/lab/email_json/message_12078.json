{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r22431 - in branches/SAMBA_3_0_25/source: auth\n\tnsswitch", "body": "Author: jerry\nDate: 2007-04-21 21:39:05 +0000 (Sat, 21 Apr 2007)\nNew Revision: 22431\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22431\n\nLog:\ncompiler cleanup fixes for the idmap changes that were not checked in fotr some reason\nModified:\n   branches/SAMBA_3_0_25/source/auth/auth_util.c\n   branches/SAMBA_3_0_25/source/nsswitch/idmap.c\n   branches/SAMBA_3_0_25/source/nsswitch/winbindd.c\n   branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_25/source/auth/auth_util.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/auth/auth_util.c\t2007-04-21 21:29:31 UTC (rev 22430)\n+++ branches/SAMBA_3_0_25/source/auth/auth_util.c\t2007-04-21 21:39:05 UTC (rev 22431)\n@@ -982,9 +982,7 @@\n NTSTATUS create_local_token(auth_serversupplied_info *server_info)\n {\n \tTALLOC_CTX *mem_ctx;\n-\tstruct id_map *ids;\n \tNTSTATUS status;\n-\tBOOL wb = True;\n \tsize_t i;\n \t\n \n\nModified: branches/SAMBA_3_0_25/source/nsswitch/idmap.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/idmap.c\t2007-04-21 21:29:31 UTC (rev 22430)\n+++ branches/SAMBA_3_0_25/source/nsswitch/idmap.c\t2007-04-21 21:39:05 UTC (rev 22431)\n@@ -91,24 +91,6 @@\n \treturn NULL;\n }\n \n-/* part of a quick hack to avoid loops, need to be sorted out correctly later on */\n-static BOOL idmap_in_own_child;\n-\n-static BOOL idmap_is_in_own_child(void)\n-{\n-\treturn idmap_in_own_child;\n-}\n-\n-void reset_idmap_in_own_child(void)\n-{\n-\tidmap_in_own_child = False;\n-}\n-\n-void set_idmap_in_own_child(void)\n-{\n-\tidmap_in_own_child = True;\n-}\n-\n BOOL idmap_is_offline(void)\n {\n \treturn ( lp_winbind_offline_logon() &&\n@@ -855,9 +837,6 @@\n {\n \tNTSTATUS ret;\n \tstruct idmap_domain *dom;\n-\tchar *domname, *name;\n-\tenum lsa_SidType sid_type;\n-\tBOOL wbret;\n \n \t/* If we are offline we cannot lookup SIDs, deny mapping */\n \tif (idmap_is_offline())\t{\n@@ -1415,6 +1394,8 @@\n \t\t\t\t(unsigned long)maps[i].xid.id,\n \t\t\t\tsid_string_static(maps[i].sid));\n \t\t\tbreak;\n+\t\tcase ID_TYPE_NOT_SPECIFIED:\n+\t\t\tbreak;\n \t\t}\n \t}\n \n\nModified: branches/SAMBA_3_0_25/source/nsswitch/winbindd.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/winbindd.c\t2007-04-21 21:29:31 UTC (rev 22430)\n+++ branches/SAMBA_3_0_25/source/nsswitch/winbindd.c\t2007-04-21 21:39:05 UTC (rev 22431)\n@@ -1012,9 +1012,6 @@\n \n \tnamecache_enable();\n \n-\t/* quick hack to avoid a loop in idmap, proper fix later */\n-\treset_idmap_in_own_child();\n-\n \t/* Winbind daemon initialisation */\n \n \tif ( ! NT_STATUS_IS_OK(idmap_init_cache()) ) {\n\nModified: branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\t2007-04-21 21:29:31 UTC (rev 22430)\n+++ branches/SAMBA_3_0_25/source/nsswitch/winbindd_dual.c\t2007-04-21 21:39:05 UTC (rev 22431)\n@@ -923,9 +923,6 @@\n \t\t\tchild);\n \t}\n \n-\t/* quick hack to avoid a loop in idmap, proper fix later */\n-\tset_idmap_in_own_child();\n-\n \twhile (1) {\n \n \t\tint ret;\n\n"}