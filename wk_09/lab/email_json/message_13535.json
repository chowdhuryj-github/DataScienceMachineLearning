{"category": "ham", "to_address": "perl6-internals@perl.org, Jonathan Worthington <jonathan@jnthn.net>", "from_address": "James E Keenan <jkeen_via_google@yahoo.com>", "subject": "Re: src/pmc/classobject.h:  Why is it in this directory?", "body": "Jonathan Worthington wrote:\n> James E Keenan wrote:\n> \n>> File src/pmc/classobject.h was added very recently:\n>>\n>> r18244 | jonathan | 2007-04-16 19:26:34 -0400 (Mon, 16 Apr 2007) | 1 line\n> \n> Aye.\n> \n>> I'm wondering why it was added in directory src/pmc/.  Previously, \n>> that directory held only files with names ending in .num or .pmc:\n>>\n>> [parrot] 527 $ ls src/pmc/ | cut -d '.' -f 2 | sort | uniq -c\n>>    1 num\n>>   81 pmc\n>>\n>> These were the 'pmc' files transformed by tools/build/pmc2c.pl into c \n>> files.  Is src/pmc/ the most appropriate location for a .h file?\n> \n> Only the Class and Object PMCs need this header file. Nothing else \n> should include it. It's part of my attempt to encourage encapsulation. I \n> was following the precedent that src/ contains some .h files (I guess, \n> for a similar reason). I'm pretty sure I've seen .h files show up in \n> languages PMC directories too.\n> \n> The fact that you've pointed out its unusual for a .h file to be there \n> is perhaps a good thing, 'cus anyone thinking of including it themselves \n> will hopefully think the same. ;-) If anyone feels really strongly \n> otherwise, I won't be bothered if it gets moved.\n> \n> \n\nI stumbled across it because I was re-running the build tools tests in \nt/tools/pmc2cutils/*.t.\n\n[parrot] 502 $ prove -v t/tools/pmc2cutils/00-qualify.t\nt/tools/pmc2cutils/00-qualify....1..9\nok 1 - use Parrot::Pmc2c::Utils;\nok 2 - Makefile located\nok 3 - myconfig located\nok 4 - lib/Parrot/PMC.pm located\nnot ok 5 - only 2 file suffixes in src/pmc\n\n#   Failed test 'only 2 file suffixes in src/pmc'\n#   at t/tools/pmc2cutils/00-qualify.t line 26.\n#          got: '3'\n#     expected: '2'\n...\n# Looks like you failed 1 test of 9.\ndubious\n         Test returned status 1 (wstat 256, 0x100)\nDIED. FAILED test 5\n         Failed 1/9 tests, 88.89% okay\nFailed Test                     Stat Wstat Total Fail  List of Failed\n-------------------------------------------------------------------------------\nt/tools/pmc2cutils/00-qualify.t    1   256     9    1  5\nFailed 1/1 test scripts. 1/9 subtests failed.\nFiles=1, Tests=9,  2 wallclock secs ( 0.25 cusr +  0.13 csys =  0.38 CPU)\nFailed 1/1 test programs. 1/9 subtests failed.\n\n\nNow, granted, the test that failed may have been written in a too \nrestrictive manner.  But I was trying to determine which files in \nsrc/pmc/ I needed to copy to a temporary directory for the purpose of \nrunning tests later in the test suite.\n\nSince I use src/pmc/class.pmc later in the test suite, I may have to \nreformulate a test there as well:\n\n[parrot] 506 $ grep -n 'src/pmc/class' t/tools/pmc2cutils/*.t\nt/tools/pmc2cutils/05-gen_c.t:286:    my @pmcfiles = ( \n\"$main::topdir/src/pmc/default.pmc\", \"$main::topdir/src/pmc/class.pmc\", );\n\n"}