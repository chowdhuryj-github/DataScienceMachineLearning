{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23431 - in\n\tbranches/SAMBA_3_0_26/source/rpcclient: .", "body": "Author: obnox\nDate: 2007-06-12 10:57:08 +0000 (Tue, 12 Jun 2007)\nNew Revision: 23431\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23431\n\nLog:\nMerge rpcclient/cmd_spoolss.c portion of r16945 and r19811.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0_26/source/rpcclient/cmd_spoolss.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/rpcclient/cmd_spoolss.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpcclient/cmd_spoolss.c\t2007-06-12 10:31:48 UTC (rev 23430)\n+++ branches/SAMBA_3_0_26/source/rpcclient/cmd_spoolss.c\t2007-06-12 10:57:08 UTC (rev 23431)\n@@ -707,17 +707,23 @@\n \t\tbreak;\n \t}\n \tcase REG_MULTI_SZ: {\n-\t\tuint16 *curstr = (uint16 *) value.data_p;\n-\t\tuint8 *start = value.data_p;\n-\t\tprintf(\"%s: REG_MULTI_SZ:\\n\", value.valuename);\n-\t\twhile (((uint8 *) curstr < start + value.size)) {\n-\t\t\trpcstr_pull(text, curstr, sizeof(text), -1, \n-\t\t\t\t    STR_TERMINATE);\n-\t\t\tprintf(\"  %s\\n\", *text != 0 ? text : \"NULL\");\n-\t\t\tcurstr += strlen(text) + 1;\n+\t\tuint32 i, num_values;\n+\t\tchar **values;\n+\n+\t\tif (!NT_STATUS_IS_OK(reg_pull_multi_sz(NULL, value.data_p,\n+\t\t\t\t\t\t       value.size,\n+\t\t\t\t\t\t       &num_values,\n+\t\t\t\t\t\t       &values))) {\n+\t\t\td_printf(\"reg_pull_multi_sz failed\\n\");\n+\t\t\tbreak;\n \t\t}\n+\n+\t\tfor (i=0; i<num_values; i++) {\n+\t\t\td_printf(\"%s\\n\", values[i]);\n+\t\t}\n+\t\tTALLOC_FREE(values);\n+\t\tbreak;\n \t}\n-\tbreak;\n \tdefault:\n \t\tprintf(\"%s: unknown type %d\\n\", value.valuename, value.type);\n \t}\n\n"}