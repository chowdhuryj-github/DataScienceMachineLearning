{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23564 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_26/source/nsswitch", "body": "Author: gd\nDate: 2007-06-21 13:05:56 +0000 (Thu, 21 Jun 2007)\nNew Revision: 23564\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23564\n\nLog:\nHandle MSG_DUMP_EVENT_LIST only in winbindd for now.\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd.c\t2007-06-21 13:04:28 UTC (rev 23563)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd.c\t2007-06-21 13:05:56 UTC (rev 23564)\n@@ -1159,6 +1159,9 @@\n \tmessaging_register(winbind_messaging_context(), NULL,\n \t\t\t   MSG_WINBIND_ONLINESTATUS, winbind_msg_onlinestatus);\n \n+\tmessaging_register(winbind_messaging_context(), NULL,\n+\t\t\t   MSG_DUMP_EVENT_LIST, winbind_msg_dump_event_list);\n+\n \tpoptFreeContext(pc);\n \n \tnetsamlogon_cache_init(); /* Non-critical */\n\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\t2007-06-21 13:04:28 UTC (rev 23563)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_dual.c\t2007-06-21 13:05:56 UTC (rev 23564)\n@@ -698,7 +698,30 @@\n \t}\n }\n \n+void winbind_msg_dump_event_list(struct messaging_context *msg_ctx,\n+\t\t\t\t void *private_data,\n+\t\t\t\t uint32_t msg_type,\n+\t\t\t\t struct server_id server_id,\n+\t\t\t\t DATA_BLOB *data)\n+{\n+\tstruct winbindd_child *child;\n \n+\tDEBUG(10,(\"winbind_msg_dump_event_list received\\n\"));\n+\n+\tdump_event_list(winbind_event_context());\n+\n+\tfor (child = children; child != NULL; child = child->next) {\n+\n+\t\tDEBUG(10,(\"winbind_msg_dump_event_list: sending message to pid %u\\n\",\n+\t\t\t(unsigned int)child->pid));\n+\n+\t\tmessaging_send_buf(msg_ctx, pid_to_procid(child->pid),\n+\t\t\t\t   MSG_DUMP_EVENT_LIST,\n+\t\t\t\t   NULL, 0);\n+\t}\n+\n+}\n+\n static void account_lockout_policy_handler(struct event_context *ctx,\n \t\t\t\t\t   struct timed_event *te,\n \t\t\t\t\t   const struct timeval *now,\n@@ -885,6 +908,18 @@\n \ttalloc_destroy(mem_ctx);\n }\n \n+static void child_msg_dump_event_list(struct messaging_context *msg,\n+\t\t\t\t      void *private_data,\n+\t\t\t\t      uint32_t msg_type,\n+\t\t\t\t      struct server_id server_id,\n+\t\t\t\t      DATA_BLOB *data)\n+{\n+\tDEBUG(5,(\"child_msg_dump_event_list received\\n\"));\n+\n+\tdump_event_list(winbind_event_context());\n+}\n+\n+\n static BOOL fork_domain_child(struct winbindd_child *child)\n {\n \tint fdpair[2];\n@@ -958,6 +993,8 @@\n \t\t\t     MSG_WINBIND_ONLINE, NULL);\n \tmessaging_deregister(winbind_messaging_context(),\n \t\t\t     MSG_WINBIND_ONLINESTATUS, NULL);\n+\tmessaging_deregister(winbind_messaging_context(),\n+\t\t\t     MSG_DUMP_EVENT_LIST, NULL);\n \n \t/* Handle online/offline messages. */\n \tmessaging_register(winbind_messaging_context(), NULL,\n@@ -966,6 +1003,8 @@\n \t\t\t   MSG_WINBIND_ONLINE, child_msg_online);\n \tmessaging_register(winbind_messaging_context(), NULL,\n \t\t\t   MSG_WINBIND_ONLINESTATUS, child_msg_onlinestatus);\n+\tmessaging_register(winbind_messaging_context(), NULL,\n+\t\t\t   MSG_DUMP_EVENT_LIST, child_msg_dump_event_list);\n \n \tif ( child->domain ) {\n \t\tchild->domain->startup = True;\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd.c\t2007-06-21 13:04:28 UTC (rev 23563)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd.c\t2007-06-21 13:05:56 UTC (rev 23564)\n@@ -1120,6 +1120,9 @@\n \tmessaging_register(winbind_messaging_context(), NULL,\n \t\t\t   MSG_WINBIND_ONLINESTATUS, winbind_msg_onlinestatus);\n \n+\tmessaging_register(winbind_messaging_context(), NULL,\n+\t\t\t   MSG_DUMP_EVENT_LIST, winbind_msg_dump_event_list);\n+\n \tpoptFreeContext(pc);\n \n \tnetsamlogon_cache_init(); /* Non-critical */\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\t2007-06-21 13:04:28 UTC (rev 23563)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_dual.c\t2007-06-21 13:05:56 UTC (rev 23564)\n@@ -698,7 +698,30 @@\n \t}\n }\n \n+void winbind_msg_dump_event_list(struct messaging_context *msg_ctx,\n+\t\t\t\t void *private_data,\n+\t\t\t\t uint32_t msg_type,\n+\t\t\t\t struct server_id server_id,\n+\t\t\t\t DATA_BLOB *data)\n+{\n+\tstruct winbindd_child *child;\n \n+\tDEBUG(10,(\"winbind_msg_dump_event_list received\\n\"));\n+\n+\tdump_event_list(winbind_event_context());\n+\n+\tfor (child = children; child != NULL; child = child->next) {\n+\n+\t\tDEBUG(10,(\"winbind_msg_dump_event_list: sending message to pid %u\\n\",\n+\t\t\t(unsigned int)child->pid));\n+\n+\t\tmessaging_send_buf(msg_ctx, pid_to_procid(child->pid),\n+\t\t\t\t   MSG_DUMP_EVENT_LIST,\n+\t\t\t\t   NULL, 0);\n+\t}\n+\n+}\n+\n static void account_lockout_policy_handler(struct event_context *ctx,\n \t\t\t\t\t   struct timed_event *te,\n \t\t\t\t\t   const struct timeval *now,\n@@ -885,6 +908,18 @@\n \ttalloc_destroy(mem_ctx);\n }\n \n+static void child_msg_dump_event_list(struct messaging_context *msg,\n+\t\t\t\t      void *private_data,\n+\t\t\t\t      uint32_t msg_type,\n+\t\t\t\t      struct server_id server_id,\n+\t\t\t\t      DATA_BLOB *data)\n+{\n+\tDEBUG(5,(\"child_msg_dump_event_list received\\n\"));\n+\n+\tdump_event_list(winbind_event_context());\n+}\n+\n+\n static BOOL fork_domain_child(struct winbindd_child *child)\n {\n \tint fdpair[2];\n@@ -958,6 +993,8 @@\n \t\t\t     MSG_WINBIND_ONLINE, NULL);\n \tmessaging_deregister(winbind_messaging_context(),\n \t\t\t     MSG_WINBIND_ONLINESTATUS, NULL);\n+\tmessaging_deregister(winbind_messaging_context(),\n+\t\t\t     MSG_DUMP_EVENT_LIST, NULL);\n \n \t/* Handle online/offline messages. */\n \tmessaging_register(winbind_messaging_context(), NULL,\n@@ -966,6 +1003,8 @@\n \t\t\t   MSG_WINBIND_ONLINE, child_msg_online);\n \tmessaging_register(winbind_messaging_context(), NULL,\n \t\t\t   MSG_WINBIND_ONLINESTATUS, child_msg_onlinestatus);\n+\tmessaging_register(winbind_messaging_context(), NULL,\n+\t\t\t   MSG_DUMP_EVENT_LIST, child_msg_dump_event_list);\n \n \tif ( child->domain ) {\n \t\tchild->domain->startup = True;\n\n"}