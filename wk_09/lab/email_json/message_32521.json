{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 325: don't count packets received from before the transport\n\ttold us the node was dead in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 325\nrevision-id: tridge@samba.org-20070519040448-1noxp9bh4mer11zr\nparent: tridge@samba.org-20070519040102-fo2l751oby7bd8gr\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-05-19 14:04:48 +1000\nmessage:\n  don't count packets received from before the transport told us the node was dead\nmodified:\n  common/ctdb.c                  ctdb.c-20061127094323-t50f58d65iaao5of-2\n=== modified file 'common/ctdb.c'\n--- a/common/ctdb.c\t2007-05-19 03:45:24 +0000\n+++ b/common/ctdb.c\t2007-05-19 04:04:48 +0000\n@@ -384,6 +384,7 @@\n {\n \tnode->ctdb->num_connected--;\n \tnode->flags &= ~NODE_FLAGS_CONNECTED;\n+\tnode->rx_cnt = 0;\n \tDEBUG(1,(\"%s: node %s is dead: %d connected\\n\", \n \t\t node->ctdb->name, node->name, node->ctdb->num_connected));\n \tctdb_daemon_cancel_controls(node->ctdb, node);\n\n"}