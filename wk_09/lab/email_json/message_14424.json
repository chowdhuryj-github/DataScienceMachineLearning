{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "Michael Kubovy <kubovy@virginia.edu>", "subject": "[R] Bug in xYplot() with method = 'filled bands'", "body": "Dear r-helpers,\n\nI have been bitten by a cryptic comment in the help page for xYplot().\n\nHere is some code from Madeline Bauer, one of the authors, which is  \nessentailly the code on the help page for xYplot():\n\n# This example uses the summarize function in Hmisc to\n# compute the median and outer quartiles.  The outer quartiles are\n# displayed using \"filled bands\"\n\nset.seed(111)\ndfr <- expand.grid(month=1:12, year=c(1997,1998), reps=1:100)\nmonth <- dfr$month; year <- dfr$year\ny <- abs(month-6.5) + 2*runif(length(month)) + year-1997\ns <- summarize(y, llist(month,year), smedian.hilow, conf.int=.5)\n\n# filled bands: default fill = pastel colors matching solid colors\n# in superpose.line (this works differently in R)\nxYplot ( Cbind ( y, Lower, Upper ) ~ month, groups=year,\n      method=\"filled bands\" , data=s, type=\"l\")\n\nThe comment \"this works differently in R\" should be ammended to a  \nmore explicit danger sign (otherwise users like myself might find  \nthemselves wasting a great deal of time). There appear to be two  \ndifferences between S+ and R here: (1) the default colors of the  \nbands are not as expected (but they can be changed at will, so that's  \nnot a serious problem); (2) I have not been able get rid of the  \noutline around the filled bands or change their colors to match the  \nfill.\n\nI would have thought that ...\n\nxYplot ( Cbind ( y, Lower, Upper ) ~ month, groups=year,\n      method=\"filled bands\" , data=s, type=\"l\", lwd.bands = 0,\n      lty.bands = 0, col.bands = 'white')\n\n... would do the trick.\n\nI even tried to fix the problem in the code of xYplot:\n\n > panel.XYplot\n\nfunction (x, y, subscripts, groups = NULL, type = if (is.function \n(method) ||\n...\nif (method == \"filled bands\") {\nif (.R.)\ngrid.polygon(x = c(x, rev(x)), y = c(lower, rev(upper)),\ngp = gpar(fill = col.fill, col = col.bands,\nlty = lty.bands, lwd = lwd.bands),\ndefault.units = \"native\")\nelse polygon(x = c(x, rev(x)), y = c(lower, rev(upper)),\ncol = col.fill)\n}\n...\n}\n\nObviously I don't know grid well enough to fix the problem. Help  \nwould be much appreciated, as well as a more explicit warning on the  \nxYplot() help page.\n\nThere is, of course, the possibility that there's something wrong  \nwith my version of R or my OS or my machine. In that case a  \nreplication or non-replication of this problem on a different OS  \nmight alert me to this.\n\nR version 2.5.0 RC (2007-04-21 r41269)\ni386-apple-darwin8.9.1\n\nlocale:\nC\n\nattached base packages:\n[1] \"grDevices\" \"datasets\"  \"grid\"      \"graphics\"  \"stats\"     \"utils\"\n[7] \"methods\"   \"base\"\n\nother attached packages:\n         coda         lme4       Matrix          car   \ncacheSweave       stashR\n     \"0.10-7\"  \"0.9975-13\"  \"0.9975-11\"      \"1.2-1\"         \n\"0.3\"      \"0.2-1\"\n     filehash       digest     circular         boot      gmodels  \nmultcompView\n      \"0.9-4\"      \"0.2.3\"      \"0.3-6\"     \"1.2-27\"      \n\"2.13.2\"      \"0.1-0\"\n      reshape          vcd   colorspace      effects         \nHmisc      acepack\n      \"0.7.2\"      \"1.0-3\"       \"0.95\"     \"1.0-10\"      \"3.3-1\"     \n\"1.3-2.2\"\n           HH     multcomp      mvtnorm          JGR        \niplots       JavaGD\n     \"1.18-3\"    \"0.991-9\"      \"0.7-5\"     \"1.4-15\"       \n\"1.0-7\"      \"0.3-6\"\n         MASS     gridBase      lattice latticeExtra         \nrJava       xtable\n     \"7.2-33\"      \"0.4-3\"     \"0.15-4\"      \"0.1-6\"      \n\"0.4-15\"      \"1.4-3\"\n\nThanks,\nMichael Kubovy\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}