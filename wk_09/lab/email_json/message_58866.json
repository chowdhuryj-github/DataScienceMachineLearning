{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r23665 - in branches: SAMBA_3_0/source/lib\n\tSAMBA_3_0/source/rpc_parse SAMBA_3_0_26/source/lib\n\tSAMBA_3_0_26/source/rpc_parse", "body": "Author: vlendec\nDate: 2007-06-30 09:15:33 +0000 (Sat, 30 Jun 2007)\nNew Revision: 23665\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23665\n\nLog:\nRemove two unneeded global variables\n\nModified:\n   branches/SAMBA_3_0/source/lib/privileges_basic.c\n   branches/SAMBA_3_0/source/rpc_parse/parse_lsa.c\n   branches/SAMBA_3_0_26/source/lib/privileges_basic.c\n   branches/SAMBA_3_0_26/source/rpc_parse/parse_lsa.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/privileges_basic.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/privileges_basic.c\t2007-06-30 00:22:59 UTC (rev 23664)\n+++ branches/SAMBA_3_0/source/lib/privileges_basic.c\t2007-06-30 09:15:33 UTC (rev 23665)\n@@ -364,15 +364,10 @@\n \n int count_all_privileges( void )\n {\n-\tstatic int count;\n-\t\n-\tif ( count )\n-\t\treturn count;\n-\n-\t/* loop over the array and count it */\t\n-\tfor ( count=0; !se_priv_equal(&privs[count].se_priv, &se_priv_end); count++ ) ;\n-\n-\treturn count;\n+\t/*\n+\t * The -1 is due to the weird SE_END record...\n+\t */\n+\treturn (sizeof(privs) / sizeof(privs[0])) - 1;\n }\n \n \n@@ -404,9 +399,8 @@\n  Convert a LUID to a named string\n ****************************************************************************/\n \n-char* luid_to_privilege_name(const LUID *set)\n+const char *luid_to_privilege_name(const LUID *set)\n {\n-\tstatic fstring name;\n \tint i;\n \n \tif (set->high != 0)\n@@ -414,8 +408,7 @@\n \n \tfor ( i=0; !se_priv_equal(&privs[i].se_priv, &se_priv_end); i++ ) {\n \t\tif ( set->low == privs[i].luid.low ) {\n-\t\t\tfstrcpy( name, privs[i].name );\n-\t\t\treturn name;\n+\t\t\treturn privs[i].name;\n \t\t}\n \t}\n \t\n\nModified: branches/SAMBA_3_0/source/rpc_parse/parse_lsa.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_parse/parse_lsa.c\t2007-06-30 00:22:59 UTC (rev 23664)\n+++ branches/SAMBA_3_0/source/rpc_parse/parse_lsa.c\t2007-06-30 09:15:33 UTC (rev 23665)\n@@ -3216,7 +3216,7 @@\n NTSTATUS init_r_enum_acct_rights( LSA_R_ENUM_ACCT_RIGHTS *out, PRIVILEGE_SET *privileges )\n {\n \tuint32 i;\n-\tchar *privname;\n+\tconst char *privname;\n \tconst char **privname_array = NULL;\n \tint num_priv = 0;\n \n\nModified: branches/SAMBA_3_0_26/source/lib/privileges_basic.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/privileges_basic.c\t2007-06-30 00:22:59 UTC (rev 23664)\n+++ branches/SAMBA_3_0_26/source/lib/privileges_basic.c\t2007-06-30 09:15:33 UTC (rev 23665)\n@@ -364,15 +364,10 @@\n \n int count_all_privileges( void )\n {\n-\tstatic int count;\n-\t\n-\tif ( count )\n-\t\treturn count;\n-\n-\t/* loop over the array and count it */\t\n-\tfor ( count=0; !se_priv_equal(&privs[count].se_priv, &se_priv_end); count++ ) ;\n-\n-\treturn count;\n+\t/*\n+\t * The -1 is due to the weird SE_END record...\n+\t */\n+\treturn (sizeof(privs) / sizeof(privs[0])) - 1;\n }\n \n \n@@ -404,9 +399,8 @@\n  Convert a LUID to a named string\n ****************************************************************************/\n \n-char* luid_to_privilege_name(const LUID *set)\n+const char *luid_to_privilege_name(const LUID *set)\n {\n-\tstatic fstring name;\n \tint i;\n \n \tif (set->high != 0)\n@@ -414,8 +408,7 @@\n \n \tfor ( i=0; !se_priv_equal(&privs[i].se_priv, &se_priv_end); i++ ) {\n \t\tif ( set->low == privs[i].luid.low ) {\n-\t\t\tfstrcpy( name, privs[i].name );\n-\t\t\treturn name;\n+\t\t\treturn privs[i].name;\n \t\t}\n \t}\n \t\n\nModified: branches/SAMBA_3_0_26/source/rpc_parse/parse_lsa.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_parse/parse_lsa.c\t2007-06-30 00:22:59 UTC (rev 23664)\n+++ branches/SAMBA_3_0_26/source/rpc_parse/parse_lsa.c\t2007-06-30 09:15:33 UTC (rev 23665)\n@@ -3172,7 +3172,7 @@\n NTSTATUS init_r_enum_acct_rights( LSA_R_ENUM_ACCT_RIGHTS *out, PRIVILEGE_SET *privileges )\n {\n \tuint32 i;\n-\tchar *privname;\n+\tconst char *privname;\n \tconst char **privname_array = NULL;\n \tint num_priv = 0;\n \n\n"}