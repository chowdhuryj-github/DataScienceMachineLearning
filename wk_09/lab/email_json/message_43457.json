{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 482: disable a node if testparm thinks there is a error,\n\tor warning,\n\tor an unrecognised option in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 482\nrevision-id: tridge@samba.org-20070606094625-rr6b22zkbeskchvj\nparent: tridge@samba.org-20070606064959-prbxq97dwqthth82\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Wed 2007-06-06 19:46:25 +1000\nmessage:\n  disable a node if testparm thinks there is a error, or warning, or an unrecognised option\nmodified:\n  config/events.d/50.samba       samba-20070601105340-vlcvnp6euoj3zdwy-3\n=== modified file 'config/events.d/50.samba'\n--- a/config/events.d/50.samba\t2007-06-06 02:08:42 +0000\n+++ b/config/events.d/50.samba\t2007-06-06 09:46:25 +0000\n@@ -52,6 +52,11 @@\n \t;;\n \n      monitor)\n+\ttestparm -st 2>&1 | egrep '^WARNING|^ERROR|^Unknown' && {\n+\t    echo \"`date` ERROR: testparm shows smb.conf is not clean\"\n+\t    exit 1\n+\t}\n+\n \tsmb_dirs=`testparm -st 2> /dev/null | egrep '^\\s*path = '  | cut -d= -f2`\n \tctdb_check_directories \"Samba\" $smb_dirs\t\n \n\n"}