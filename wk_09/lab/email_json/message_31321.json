{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "svn commit: samba r22961 - in\n\tbranches/SAMBA_4_0/source/auth/kerberos: .", "body": "Author: tridge\nDate: 2007-05-17 02:21:07 +0000 (Thu, 17 May 2007)\nNew Revision: 22961\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22961\n\nLog:\n\nuse EVENT_FD_AUTOCLOSE and SOCKET_FLAG_NOCLOSE to fix up some hairy\nproblems with order of socket closing in krb5\n\nModified:\n   branches/SAMBA_4_0/source/auth/kerberos/krb5_init_context.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/auth/kerberos/krb5_init_context.c\n===================================================================\n--- branches/SAMBA_4_0/source/auth/kerberos/krb5_init_context.c\t2007-05-17 02:19:28 UTC (rev 22960)\n+++ branches/SAMBA_4_0/source/auth/kerberos/krb5_init_context.c\t2007-05-17 02:21:07 UTC (rev 22961)\n@@ -305,8 +305,11 @@\n \t\ttalloc_free(remote_addr);\n \n \t\tsmb_krb5->fde = event_add_fd(ev, smb_krb5, \n-\t\t\t\t\t     socket_get_fd(smb_krb5->sock), 0,\n+\t\t\t\t\t     socket_get_fd(smb_krb5->sock), \n+\t\t\t\t\t     EVENT_FD_AUTOCLOSE,\n \t\t\t\t\t     smb_krb5_socket_handler, smb_krb5);\n+\t\t/* its now the job of the event layer to close the socket */\n+\t\tsocket_set_flags(smb_krb5->sock, SOCKET_FLAG_NOCLOSE);\n \n \t\tevent_add_timed(ev, smb_krb5, \n \t\t\t\ttimeval_current_ofs(context->kdc_timeout, 0),\n\n"}