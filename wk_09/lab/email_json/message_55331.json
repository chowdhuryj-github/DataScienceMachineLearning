{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "kai@samba.org", "subject": "svn commit: samba r23605 - in branches/SAMBA_4_0/source/script: .", "body": "Author: kai\nDate: 2007-06-26 06:04:14 +0000 (Tue, 26 Jun 2007)\nNew Revision: 23605\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23605\n\nLog:\nUpdate mkversion.sh to support git and git-svn checkouts.\nJerry, did I get you right that you'll merge this to 3_0 yourself?\n\nKai\n\nModified:\n   branches/SAMBA_4_0/source/script/mkversion.sh\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/script/mkversion.sh\n===================================================================\n--- branches/SAMBA_4_0/source/script/mkversion.sh\t2007-06-26 05:08:50 UTC (rev 23604)\n+++ branches/SAMBA_4_0/source/script/mkversion.sh\t2007-06-26 06:04:14 UTC (rev 23605)\n@@ -104,6 +104,18 @@\n \tTMP_CLEAN_TREE=`echo -e \"${BZR_INFO}\" | grep 'clean:' |sed -e 's/clean: \\([a-zA-Z]*\\).*/\\1/'`\n     fi\n \n+    if test x\"${HAVEVER}\" != x\"yes\";then\n+\tHAVEGIT=no\n+        GIT_INFO=`git show --abbrev-commit HEAD 2>/dev/null`\n+\tTMP_REVISION=`echo -e \"${GIT_INFO}\" | grep 'commit ' |sed -e 's/commit \\([0-9a-f]*\\).*/\\1/'`\n+\tif test -n \"$TMP_REVISION\";then\n+\t    HAVEGIT=yes\n+            HAVEVER=yes\n+\tfi\n+\tTMP_MIRRORED_REVISION=`echo -e \"${GIT_INFO}\" | grep 'git-svn-id' |sed -e 's#^[ ^t]*git-svn-id: svn+ssh://svn.samba.org/data/svn/samba/branches/\\(SAMBA_[34]_[0-9]\\(_[0-9]\\+\\)\\?@[0-9]*\\).*#\\1#'`\n+    fi\n+\t\n+\n     if test x\"${HAVESVN}\" = x\"yes\";then\n \tSAMBA_VERSION_STRING=\"${SAMBA_VERSION_STRING}-SVN-build-${TMP_REVISION}\"\n \techo \"#define SAMBA_VERSION_SVN_REVISION ${TMP_REVISION}\" >> $OUTPUT_FILE\n@@ -130,6 +142,14 @@\n \tfi\n \n \tSAMBA_VERSION_STRING=\"${SAMBA_VERSION_STRING}-BZR-${TMP_BZR_REVISION_STR}\"\n+    elif test x\"${HAVEGIT}\" = x\"yes\";then\n+\tTMP_GIT_REVISION_STR=\"${TMP_REVISION}\"\n+\n+\tif test -n \"$TMP_MIRRORED_REVISION\"; then\n+\t    TMP_GIT_REVISION_STR=\"${TMP_GIT_REVISION_STR}-[SVN-${TMP_MIRRORED_REVISION}]\"\n+\tfi\n+\n+\tSAMBA_VERSION_STRING=\"${SAMBA_VERSION_STRING}-GIT-${TMP_GIT_REVISION_STR}\"\n     else\n \tSAMBA_VERSION_STRING=\"${SAMBA_VERSION_STRING}-SVN-build-UNKNOWN\"\n     fi\n\n"}