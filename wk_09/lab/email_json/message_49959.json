{"category": "ham", "to_address": "\"Julia Proudnikova\" <prudnikova@itcwin.com>", "from_address": "\"Spielas Bates\" <bates@stat.wisc.edu>", "subject": "Re: [R] Question about lmer", "body": "On 6/18/07, Julia Proudnikova  wrote:\n> Hello,\n>\n> We have a problem with function lmer. This is our code:\n>\n> Get_values<-function(ff_count, fixed_factors, rf_count, random_factors, y_values)\n> {\n>   SA<-matrix(as.array(c(fixed_factors, random_factors)), ncol=3)\n>   data<-as.data.frame(SA)\n>   y<-as.array(y_values)\n>\n>   dd<-data.frame(SA)\n>   for(i in 1:(ff_count+rf_count)){\n>     dd[,i]<-as.factor(data[,i])\n>   }\n>\n>   fit_full=lmer(y~dd[,1]+dd[,2]+(1|dd[,3]),method=\"ML\")\n>   fit_full\n> }\n>\n> A<-c(0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1)\n> B<-c(0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1)\n> C<-c(0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1)\n> Y<-c(5,3,4,1,1,2,6,1,5,3,7,1,2,3,1,1,5,3,4,1,1,2,6,1,5,3,7,1,2,3,1,1)\n> r<-Get_values(2, c(A,B),1,c(C),Y)\n> r\n>\n> R output:\n> Error in inherits(x, \"factor\") : object \"dd\" not found\n>\n> Can this function work with random array? Because this code is\n> working:\n\nThe full explanation of why lmer fails to find dd has to do with the\nway names are resolved in a call to model.frame.  However, there may\nbe a way to solve your problem by redesigning your function so you\ndon't need to worry about what model.frame does.\n\nWhy not pass the data as a data frame and pass the names of the fixed\nfactors, random factors and response variable as character strings?\nYour current design of creating a matrix, then converting it to a data\nframe then converting numeric variables back to factors is a bit\nconvoluted.\n\nIf you knew that you were only going to have one random factor you\ncould generate the formula as\n\nsubstitute(y ~ ff + (1|rf), list(y = as.name(y_name), ff =\nparse(paste(ff_names, collapse = \"+\")), rf = as.name(rf_name))\n\nIt gets a bit trickier with multiple random factors.\n\nHaving said all this, it does appear that the call to model.frame\ninside lmer is getting the wrong environment from the formula and I\nwill correct that.\n\nIf you need more detail about the redesign I am suggesting, feel free\nto contact me off-list.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}