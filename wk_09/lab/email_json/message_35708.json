{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23121 - in branches: SAMBA_3_0/source\n\tSAMBA_3_0/source/pam_smbpass SAMBA_3_0_25/source\n\tSAMBA_3_0_25/source/pam_smbpass SAMBA_3_0_26/source\n\tSAMBA_3_0_26/source/pam_smbpass", "body": "Author: gd\nDate: 2007-05-24 20:26:07 +0000 (Thu, 24 May 2007)\nNew Revision: 23121\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23121\n\nLog:\nFix Bug #2727 and let pam_smbpass at least link and dlopen correctly again.\n\nThanks to Bartlomiej Solarz-Niesluchowski .\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/Makefile.in\n   branches/SAMBA_3_0/source/pam_smbpass/general.h\n   branches/SAMBA_3_0/source/pam_smbpass/pam_smb_acct.c\n   branches/SAMBA_3_0/source/pam_smbpass/pam_smb_auth.c\n   branches/SAMBA_3_0/source/pam_smbpass/pam_smb_passwd.c\n   branches/SAMBA_3_0_25/source/Makefile.in\n   branches/SAMBA_3_0_25/source/pam_smbpass/general.h\n   branches/SAMBA_3_0_26/source/Makefile.in\n   branches/SAMBA_3_0_26/source/pam_smbpass/general.h\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0/source/Makefile.in\t2007-05-24 18:12:32 UTC (rev 23120)\n+++ branches/SAMBA_3_0/source/Makefile.in\t2007-05-24 20:26:07 UTC (rev 23121)\n@@ -806,10 +806,10 @@\n \t$(LIBSMB_OBJ) $(LIB_NONSMBD_OBJ) $(NSSWINS_OBJ) $(KRBCLIENT_OBJ) $(SECRETS_OBJ)\n \n PAM_SMBPASS_OBJ_0 = pam_smbpass/pam_smb_auth.o pam_smbpass/pam_smb_passwd.o \\\n-\t\tpam_smbpass/pam_smb_acct.o pam_smbpass/support.o \\\n-\t\t$(PARAM_OBJ) $(LIB_NONSMBD_OBJ) $(PASSDB_OBJ) $(GROUPDB_OBJ) \\\n+\t\tpam_smbpass/pam_smb_acct.o pam_smbpass/support.o\n+PAM_SMBPASS_OBJ= $(PAM_SMBPASS_OBJ_0) $(PARAM_OBJ) $(LIB_NONSMBD_OBJ) $(PASSDB_OBJ) $(GROUPDB_OBJ) \\\n \t\t$(SECRETS_OBJ) $(SMBLDAP_OBJ) $(LIBSAMBA_OBJ) \\\n-\t\t$(RPC_PARSE_OBJ1) $(DOSERR_OBJ) $(LDB_OBJ)\n+\t\t$(RPC_PARSE_OBJ1) $(DOSERR_OBJ) $(LDB_OBJ) $(ERRORMAP_OBJ)\n \n IDMAP_OBJ     = nsswitch/idmap.o nsswitch/idmap_cache.o nsswitch/idmap_util.o @IDMAP_STATIC@\n \n\nModified: branches/SAMBA_3_0/source/pam_smbpass/general.h\n===================================================================\n--- branches/SAMBA_3_0/source/pam_smbpass/general.h\t2007-05-24 18:12:32 UTC (rev 23120)\n+++ branches/SAMBA_3_0/source/pam_smbpass/general.h\t2007-05-24 20:26:07 UTC (rev 23121)\n@@ -121,7 +121,7 @@\n \n struct _pam_failed_auth {\n     char *user;                 /* user that's failed to be authenticated */\n-    int id;                     /* uid of requested user */\n+    uid_t id;                   /* uid of requested user */\n     char *agent;                /* attempt from user with name */\n     int count;                  /* number of failures so far */\n };\n\nModified: branches/SAMBA_3_0/source/pam_smbpass/pam_smb_acct.c\n===================================================================\n--- branches/SAMBA_3_0/source/pam_smbpass/pam_smb_acct.c\t2007-05-24 18:12:32 UTC (rev 23120)\n+++ branches/SAMBA_3_0/source/pam_smbpass/pam_smb_acct.c\t2007-05-24 20:26:07 UTC (rev 23121)\n@@ -81,7 +81,7 @@\n \t/* Getting into places that might use LDAP -- protect the app\n \t\tfrom a SIGPIPE it's not expecting */\n \toldsig_handler = CatchSignal(SIGPIPE, SIGNAL_CAST SIG_IGN);\n-\tif (!initialize_password_db(True)) {\n+\tif (!initialize_password_db(True, NULL)) {\n \t\t_log_err( LOG_ALERT, \"Cannot access samba password database\" );\n \t\tCatchSignal(SIGPIPE, SIGNAL_CAST oldsig_handler);\n \t\treturn PAM_AUTHINFO_UNAVAIL;\n\nModified: branches/SAMBA_3_0/source/pam_smbpass/pam_smb_auth.c\n===================================================================\n--- branches/SAMBA_3_0/source/pam_smbpass/pam_smb_auth.c\t2007-05-24 18:12:32 UTC (rev 23120)\n+++ branches/SAMBA_3_0/source/pam_smbpass/pam_smb_auth.c\t2007-05-24 20:26:07 UTC (rev 23121)\n@@ -109,7 +109,7 @@\n \t\t_log_err( LOG_DEBUG, \"username [%s] obtained\", name );\n \t}\n \n-\tif (!initialize_password_db(True)) {\n+\tif (!initialize_password_db(True, NULL)) {\n \t\t_log_err( LOG_ALERT, \"Cannot access samba password database\" );\n \t\tretval = PAM_AUTHINFO_UNAVAIL;\n \t\tAUTH_RETURN;\n\nModified: branches/SAMBA_3_0/source/pam_smbpass/pam_smb_passwd.c\n===================================================================\n--- branches/SAMBA_3_0/source/pam_smbpass/pam_smb_passwd.c\t2007-05-24 18:12:32 UTC (rev 23120)\n+++ branches/SAMBA_3_0/source/pam_smbpass/pam_smb_passwd.c\t2007-05-24 20:26:07 UTC (rev 23121)\n@@ -137,7 +137,7 @@\n        from a SIGPIPE it's not expecting */\n     oldsig_handler = CatchSignal(SIGPIPE, SIGNAL_CAST SIG_IGN);\n \n-    if (!initialize_password_db(False)) {\n+    if (!initialize_password_db(False, NULL)) {\n         _log_err( LOG_ALERT, \"Cannot access samba password database\" );\n         CatchSignal(SIGPIPE, SIGNAL_CAST oldsig_handler);\n         return PAM_AUTHINFO_UNAVAIL;\n\nModified: branches/SAMBA_3_0_25/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0_25/source/Makefile.in\t2007-05-24 18:12:32 UTC (rev 23120)\n+++ branches/SAMBA_3_0_25/source/Makefile.in\t2007-05-24 20:26:07 UTC (rev 23121)\n@@ -751,9 +751,9 @@\n \n PAM_SMBPASS_OBJ_0 = pam_smbpass/pam_smb_auth.o pam_smbpass/pam_smb_passwd.o \\\n \t\tpam_smbpass/pam_smb_acct.o pam_smbpass/support.o \\\n-\t\t$(PARAM_OBJ) $(LIB_NONSMBD_OBJ) $(PASSDB_OBJ) $(GROUPDB_OBJ) \\\n+PAM_SMBPASS_OBJ = $(PAM_SMBPASS_OBJ_0) $(PARAM_OBJ) $(LIB_NONSMBD_OBJ) $(PASSDB_OBJ) $(GROUPDB_OBJ) \\\n \t\t$(SECRETS_OBJ) $(SMBLDAP_OBJ) $(LIBSAMBA_OBJ) \\\n-\t\t$(RPC_PARSE_OBJ1) $(DOSERR_OBJ)\n+\t\t$(RPC_PARSE_OBJ1) $(DOSERR_OBJ) $(ERRORMAP_OBJ)\n \n IDMAP_OBJ     = nsswitch/idmap.o nsswitch/idmap_cache.o nsswitch/idmap_util.o @IDMAP_STATIC@\n \n\nModified: branches/SAMBA_3_0_25/source/pam_smbpass/general.h\n===================================================================\n--- branches/SAMBA_3_0_25/source/pam_smbpass/general.h\t2007-05-24 18:12:32 UTC (rev 23120)\n+++ branches/SAMBA_3_0_25/source/pam_smbpass/general.h\t2007-05-24 20:26:07 UTC (rev 23121)\n@@ -113,7 +113,7 @@\n \n struct _pam_failed_auth {\n     char *user;                 /* user that's failed to be authenticated */\n-    int id;                     /* uid of requested user */\n+    uid_t id;                   /* uid of requested user */\n     char *agent;                /* attempt from user with name */\n     int count;                  /* number of failures so far */\n };\n\nModified: branches/SAMBA_3_0_26/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0_26/source/Makefile.in\t2007-05-24 18:12:32 UTC (rev 23120)\n+++ branches/SAMBA_3_0_26/source/Makefile.in\t2007-05-24 20:26:07 UTC (rev 23121)\n@@ -758,10 +758,10 @@\n \t$(LIBSMB_OBJ) $(LIB_NONSMBD_OBJ) $(NSSWINS_OBJ) $(KRBCLIENT_OBJ) $(SECRETS_OBJ)\n \n PAM_SMBPASS_OBJ_0 = pam_smbpass/pam_smb_auth.o pam_smbpass/pam_smb_passwd.o \\\n-\t\tpam_smbpass/pam_smb_acct.o pam_smbpass/support.o \\\n-\t\t$(PARAM_OBJ) $(LIB_NONSMBD_OBJ) $(PASSDB_OBJ) $(GROUPDB_OBJ) \\\n+\t\tpam_smbpass/pam_smb_acct.o pam_smbpass/support.o\n+PAM_SMBPASS_OBJ = $(PAM_SMBPASS_OBJ_0) $(PARAM_OBJ) $(LIB_NONSMBD_OBJ) $(PASSDB_OBJ) $(GROUPDB_OBJ) \\\n \t\t$(SECRETS_OBJ) $(SMBLDAP_OBJ) $(LIBSAMBA_OBJ) \\\n-\t\t$(RPC_PARSE_OBJ1) $(DOSERR_OBJ)\n+\t\t$(RPC_PARSE_OBJ1) $(DOSERR_OBJ) $(ERRORMAP_OBJ)\n \n IDMAP_OBJ     = nsswitch/idmap.o nsswitch/idmap_cache.o nsswitch/idmap_util.o @IDMAP_STATIC@\n \n\nModified: branches/SAMBA_3_0_26/source/pam_smbpass/general.h\n===================================================================\n--- branches/SAMBA_3_0_26/source/pam_smbpass/general.h\t2007-05-24 18:12:32 UTC (rev 23120)\n+++ branches/SAMBA_3_0_26/source/pam_smbpass/general.h\t2007-05-24 20:26:07 UTC (rev 23121)\n@@ -121,7 +121,7 @@\n \n struct _pam_failed_auth {\n     char *user;                 /* user that's failed to be authenticated */\n-    int id;                     /* uid of requested user */\n+    uid_t id;                   /* uid of requested user */\n     char *agent;                /* attempt from user with name */\n     int count;                  /* number of failures so far */\n };\n\n"}