{"category": "ham", "to_address": "\"Patnaik, Tirthankar\" <tirthankar.patnaik@citi.com>", "from_address": "\"Gabor Grothendieck\" <ggrothendieck@gmail.com>", "subject": "Re: [R] Confusion with sapply", "body": "Try this. It takes a Date class date and in the first line month.day.year\nconverts unclass(x) to chron.  In the last line of the function we convert\nback to Date class.  Its already vectorized so sapply is unneeded:\n\nlibrary(chron)\nf <- function(x) with(month.day.year(unclass(x)), {\n\tmonth <- ifelse(month == 6 | month == 9, 3, month)\n\tyear <- ifelse(month == 12, year + 1, year)\n\tas.Date(paste(year, month, day, sep = \"-\"))\n})\n\nRunning the last line gives:\n\n> # test\n> f(seq(Sys.Date(), length = 12, by = \"month\"))\n [1] \"2007-03-13\" \"2007-07-13\" \"2007-08-13\" \"2007-03-13\" \"2007-10-13\"\n [6] \"2007-11-13\" \"2008-12-13\" \"2008-01-13\" \"2008-02-13\" \"2008-03-13\"\n[11] \"2008-04-13\" \"2008-05-13\"\n\n\nOn 6/13/07, Patnaik, Tirthankar  wrote:\n> Hi,\n>  I have some confusion in applying a function over a column.\n>\n> Here's my function. I just need to shift non-March month-ends to March\n> month-ends. Initially I tried seq.dates, but one cannot give a negative\n> increment (decrement) here.\n>\n> return(as.Date(seq.dates(format(xdate,\"%m/%d/%Y\"),by=\"months\",len=4)[4])\n> )\n>\n> Hence this simple function:\n>\n> > mydate <- as.Date(\"2006-01-01\")\n> >\n> > # Function to shift non-March company-reporting dates to March.\n> > Set2March <- function(xdate){\n> + # Combines non-March months into March months:\n> + # Dec2006 -> Mar2007\n> + # Mar2006 -> Mar2006\n> + # Jun2006 -> Mar2006\n> + # Sep2006 -> Mar2006\n> + # VERY Specific code.\n> +     Month <- format(xdate,\"%m\")\n> +     wDate <- month.day.year(julian(xdate))\n> +     if (Month==\"12\"){\n> +         wDate$year <- wDate$year + 1\n> +         wDate$month <- 3\n> +     }else\n> +     if (Month==\"06\"){\n> +         wDate$month <- 3\n> +     }else\n> +     if (Month==\"09\"){\n> +         wDate$month <- 3\n> +         wDate$day <- wDate$day + 1\n> +     }else warning (\"No Changes made to the month, since month is not\n> one of (6,9,12)\")\n> +     cDate <- chron(paste(wDate$month,wDate$day,wDate$year,sep=\"/\"))\n> +     return(as.Date(as.yearmon(as.Date(cDate,\"%m/%d/%y\")),frac=1))\n> + }\n> > Set2March(as.Date(\"2006-06-30\"))\n> [1] \"2006-03-31\"\n> > Set2March(mydate)\n> [1] \"2006-01-31\"\n> Warning message:\n> No Changes made to the month, since month is not one of (6,9,12) in:\n> Set2March(mydate)\n> >\n>\n> Works well when I use it on a single date. Then I try it on a vector:\n>\n>\n> > dc <- seq(as.Date(\"2006-01-01\"),len=10, by=\"month\")\n> > dc\n>  [1] \"2006-01-01\" \"2006-02-01\" \"2006-03-01\" \"2006-04-01\" \"2006-05-01\"\n> \"2006-06-01\" \"2006-07-01\" \"2006-08-01\"\n>  [9] \"2006-09-01\" \"2006-10-01\"\n>\n>\n> > sapply(as.vector(dc),Set2March)\n> Error in prettyNum(.Internal(format(x, trim, digits, nsmall, width, 3,\n> :\n>        unimplemented type 'character' in 'asLogical'\n> >\n>\n> What am I missing here? Shouldn't the function work with the sapply\n> working on each entry?\n>\n>\n> TIA and best,\n> -Tir\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}