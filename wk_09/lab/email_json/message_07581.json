{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 138: make sure we notify ctdb when a node dies in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 138\nrevision-id: tridge@samba.org-20070417094129-679a037628a088fc\nparent: tridge@samba.org-20070417092749-c3fed1e34bc970c8\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Tue 2007-04-17 19:41:29 +1000\nmessage:\n  make sure we notify ctdb when a node dies\nmodified:\n  tcp/tcp_connect.c              tcp_connect.c-20061128004937-x70q1cu5xzg5g2tm-1\n=== modified file 'tcp/tcp_connect.c'\n--- a/tcp/tcp_connect.c\t2007-04-13 10:38:24 +0000\n+++ b/tcp/tcp_connect.c\t2007-04-17 09:41:29 +0000\n@@ -43,6 +43,10 @@\n \tstruct ctdb_tcp_node *tnode = talloc_get_type(\n \t\tnode->private_data, struct ctdb_tcp_node);\n \n+\tif (data == NULL) {\n+\t\tnode->ctdb->upcalls->node_dead(node);\n+\t}\n+\n \t/* start a new connect cycle to try to re-establish the\n \t   link */\n \tclose(tnode->fd);\n\n"}