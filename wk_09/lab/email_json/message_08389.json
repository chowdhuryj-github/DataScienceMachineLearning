{"category": "ham", "to_address": "perl6-internals@perl.org", "from_address": "chromatic <chromatic@wgz.org>", "subject": "Re: [perl #42594] [PATCH] Probable buffer overflow in compilers/imcc/parser_util.c", "body": "On Tuesday 17 April 2007 14:48, Steve Peters wrote:\n\n> I don't know how easily this is reached, but since the \"fmt\" variable\n> is only NULL checked, it seems like this would be possible to reached.\n\nHm, this patch breaks some tests for me:\n\nt/compilers/imcc/imcpasm/optc.t    1   256    43    1  8\nt/compilers/imcc/imcpasm/sub.t     2   512     2    2  1-2\n\nIt looks like it's eating the first source register of certain opcodes.  \nChanging (format - 1) to (format) in both patched lines fixes it for me, but \nI'm not confident enough in the patch after that to check it in.  Here's the \nverbose output.\n\n-- c\n\nt/compilers/imcc/imcpasm/optc.t \nnot ok 8 - in P param\n#     Failed test (t/compilers/imcc/imcpasm/optc.t at line 226)\n#                   '# IMCC does produce b0rken PASM files\n# # see http://guest@rt.perl.org/rt3/Ticket/Display.html?id=32392\n# _main:\n#  new P0,\n#  set P0, 42\n# @pcc_sub_call_0:\n#  set_args\n#  set_p_pc P1, foo\n#  get_results\n#  invokecc P1\n#  noop\n#  end\n# foo:\n#  get_params\n#  print P0\n#  set_returns\n#  returncc\n# '\n#     doesn't match '/_main:\n#  new (P\\d+), \\d+ # \\.Undef\n#  set \\1, 42\n# @pcc_sub_call_\\d:\n#  set_args\n#  set_p_pc (P\\d+), foo\n#  get_results\n#  invokecc \\2\n#  noop\n#  end\n# foo:\n#  get_params\n#  print P0\n#  set_returns\n#  returncc/\n# '\n\nt/compilers/imcc/imcpasm/sub.t\nnot ok 1 - non-constant dest bsr, invoke\n#     Failed test (t/compilers/imcc/imcpasm/sub.t at line 11)\n#                   '# IMCC does produce b0rken PASM files\n# # see http://guest@rt.perl.org/rt3/Ticket/Display.html?id=32392\n# _main:\n#  new P0,\n#  set_addr I0, _sub1\n#  set P0, I0\n#  invokecc P0\n#  ret\n# _sub1:\n#  ret\n# '\n#     doesn't match '/^# IMCC does produce b0rken PASM files\n# # see http://guest@rt.perl.org/rt3/Ticket/Display.html\\?id=32392\n# _main:\n#  new P(\\d+), \\d+ # \\.Sub\n#  set_addr I(\\d+), _sub1\n#  set P\\1, I\\2\n#  invokecc P\\1\n#  ret\n# _sub1:\n#  ret/\n# '\nnot ok 2 - nonlocal bsr\n#     Failed test (t/compilers/imcc/imcpasm/sub.t at line 34)\n#                   '# IMCC does produce b0rken PASM files\n# # see http://guest@rt.perl.org/rt3/Ticket/Display.html?id=32392\n# _main:\n#  new P0,\n#  set_addr I0, _f\n#  set P0, I0\n#  invokecc P0\n#  ret\n# _f:\n#  ret\n# '\n#     doesn't match '/^# IMCC does produce b0rken PASM files\n# # see http://guest@rt.perl.org/rt3/Ticket/Display.html\\?id=32392\n# _main:\n#  new P(\\d+), \\d+ # \\.Sub\n#  set_addr I(\\d+), _f\n#  set P\\1, I\\2\n#  invokecc P\\1\n#  ret\n# _f:\n#  ret/\n# '\n\n"}