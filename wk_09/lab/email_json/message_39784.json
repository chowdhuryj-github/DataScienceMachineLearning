{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r23272 - in branches: SAMBA_3_0/source/smbd\n\tSAMBA_3_0_26/source/smbd", "body": "Author: jra\nDate: 2007-05-31 17:26:30 +0000 (Thu, 31 May 2007)\nNew Revision: 23272\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23272\n\nLog:\nFix main event loop - reviewed by Volker.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/smbd/server.c\n   branches/SAMBA_3_0_26/source/smbd/server.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/smbd/server.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/server.c\t2007-05-31 17:24:30 UTC (rev 23271)\n+++ branches/SAMBA_3_0/source/smbd/server.c\t2007-05-31 17:26:30 UTC (rev 23272)\n@@ -418,8 +418,6 @@\n \t\t\t\t timeval_is_zero(&idle_timeout) ?\n \t\t\t\t NULL : &idle_timeout);\n \t\t\n-\t\trun_events(smbd_event_context(), num, &r_fds, &w_fds);\n-\n \t\tif (num == -1 && errno == EINTR) {\n \t\t\tif (got_sig_term) {\n \t\t\t\texit_server_cleanly(NULL);\n@@ -436,6 +434,10 @@\n \t\t\tcontinue;\n \t\t}\n \n+\t\tif (run_events(smbd_event_context(), num, &r_fds, &w_fds)) {\n+\t\t\tcontinue;\n+\t\t}\n+\n #if 0\n \t\tDeactivated for now, this needs to become a timed event\n \t\tvl\n\nModified: branches/SAMBA_3_0_26/source/smbd/server.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/smbd/server.c\t2007-05-31 17:24:30 UTC (rev 23271)\n+++ branches/SAMBA_3_0_26/source/smbd/server.c\t2007-05-31 17:26:30 UTC (rev 23272)\n@@ -516,8 +516,6 @@\n \t\t\t\t timeval_is_zero(&idle_timeout) ?\n \t\t\t\t NULL : &idle_timeout);\n \n-\t\trun_events(smbd_event_context(), num, &r_fds, &w_fds);\n-\n \t\tif (num == -1 && errno == EINTR) {\n \t\t\tif (got_sig_term) {\n \t\t\t\texit_server_cleanly(NULL);\n@@ -534,6 +532,10 @@\n \t\t\tcontinue;\n \t\t}\n \t\t\n+\t\tif (run_events(smbd_event_context(), num, &r_fds, &w_fds)) {\n+\t\t\tcontinue;\n+\t\t}\n+\n \t\t/* check if we need to reload services */\n \t\tcheck_reload(time(NULL));\n \n\n"}