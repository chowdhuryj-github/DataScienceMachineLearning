{"category": "ham", "to_address": "Nik Conwell <nik@bu.edu>", "from_address": "\"Gerald (Jerry) Carter\" <jerry@samba.org>", "subject": "Re: Inconsistency between groupmap \"Domain Admins\"\n and\t_lsa_add_acct_rights() checking", "body": "-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA1\n\nNik Conwell wrote:\n> (I guess this could be a HOWTO bug as well.)\n> \n> I'm part of an AD domain.\n> \n> To be considered an admin on the samba box, the howto\n> http://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/groupmapping.html\n> \n> says:\n> \n>   net groupmap add ntgroup=\"Domain Admins\" unixgroup=domadm rid=512 type=d\n> \n> When I do that net groupmap list shows:\n> \n> Domain Admins ([LOCALSID]-512) -> domadm\n> \n> \n> But, when assigning privs by a member of the unix group domadm via:\n> \n>   net -Unik rpc rights grant joe SePrintOperatorPrivilege\n> \n> it ends up checking Domain Admins with the [DOMAINSID]-512.\n> \n> In _lsa_add_acct_rights() if you're not root it calls\n> nt_token_check_domain_rid(), which ends up using the domain_sid.  But,\n> since my account sid includes [LOCALSID]-512 and not [DOMAINSID]-512 I\n> never get a good sid match and so get denied.\n> \n> Certainly, adding my groupmap \"Domain Admins\" with sid [DOMAINSID]-512\n> is enough to get the net rpc rights grant working.\n> \n> I don't know enough to stipulate that groupmap add type=d should use the\n> DOMAINSID, but it seems that way.  Or, should _lsa_add_acct_rights() but\n> updated to also check the [LOCALSID]-512 sid as well as the\n> [DOMAINSID]-512 sid?\n\nSpecify the full sid instead of just the rid to \"net groupmap add\".\nThe HOWTO is for a Samba DC IIRC.\n\nHope this helps.\n\n\n\n\n\ncheers, jerry\n=====================================================================\nSamba                                    ------- http://www.samba.org\nCenteris                         -----------  http://www.centeris.com\n\"What man is a man who does not make the world better?\"      --Balian\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1.4.3 (GNU/Linux)\nComment: Using GnuPG with Mozilla - http://enigmail.mozdev.org\n\niD8DBQFGOI/uIR7qMdg1EfYRAlafAJ9AoevLST4TjjhiHkDSGVXqGTzjoQCeMQrX\nVpckJ0MGg4qbHIlaXq/HSbU=\n=9GGI\n-----END PGP SIGNATURE-----\n\n"}