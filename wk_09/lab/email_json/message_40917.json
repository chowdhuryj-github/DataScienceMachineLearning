{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r23307 - in branches/SAMBA_3_0/source: . include\n\tlib/replace", "body": "Author: metze\nDate: 2007-06-02 08:30:42 +0000 (Sat, 02 Jun 2007)\nNew Revision: 23307\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23307\n\nLog:\nmove readahead stuff out of libreplace and make it samba3 specific\nas we can't replace this function in libreplace and we do\nthe some stuff for other function in the same way. \n\nmetze\nModified:\n   branches/SAMBA_3_0/source/configure.in\n   branches/SAMBA_3_0/source/include/includes.h\n   branches/SAMBA_3_0/source/lib/replace/README\n   branches/SAMBA_3_0/source/lib/replace/libreplace.m4\n   branches/SAMBA_3_0/source/lib/replace/replace.h\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/configure.in\n===================================================================\n--- branches/SAMBA_3_0/source/configure.in\t2007-06-02 08:16:42 UTC (rev 23306)\n+++ branches/SAMBA_3_0/source/configure.in\t2007-06-02 08:30:42 UTC (rev 23307)\n@@ -5925,6 +5925,8 @@\n              [Whether Linux readahead is available])\n fi\n \n+AC_HAVE_DECL(readahead, [#include ])\n+\n ############################################\n # See if we have the posix_fadvise syscall.\n \n\nModified: branches/SAMBA_3_0/source/include/includes.h\n===================================================================\n--- branches/SAMBA_3_0/source/include/includes.h\t2007-06-02 08:16:42 UTC (rev 23306)\n+++ branches/SAMBA_3_0/source/include/includes.h\t2007-06-02 08:30:42 UTC (rev 23307)\n@@ -1214,6 +1214,9 @@\n \n #endif\t/* HAVE_LDAP */\n \n+#if defined(HAVE_LINUX_READAHEAD) && ! defined(HAVE_READAHEAD_DECL)\n+ssize_t readahead(int fd, off64_t offset, size_t count);\n+#endif\n \n /* TRUE and FALSE are part of the C99 standard and gcc, but\n    unfortunately many vendor compilers don't support them.  Use True\n\nModified: branches/SAMBA_3_0/source/lib/replace/README\n===================================================================\n--- branches/SAMBA_3_0/source/lib/replace/README\t2007-06-02 08:16:42 UTC (rev 23306)\n+++ branches/SAMBA_3_0/source/lib/replace/README\t2007-06-02 08:30:42 UTC (rev 23307)\n@@ -55,11 +55,6 @@\n socketpair\n strptime\n \n-These external declarations are provided for those systems which lack the\n-declaration but provide the function:\n-\n-readahead\n-\n Types:\n bool\n socklen_t\n\nModified: branches/SAMBA_3_0/source/lib/replace/libreplace.m4\n===================================================================\n--- branches/SAMBA_3_0/source/lib/replace/libreplace.m4\t2007-06-02 08:16:42 UTC (rev 23306)\n+++ branches/SAMBA_3_0/source/lib/replace/libreplace.m4\t2007-06-02 08:30:42 UTC (rev 23307)\n@@ -155,7 +155,6 @@\n AC_HAVE_DECL(setresuid, [#include ])\n AC_HAVE_DECL(setresgid, [#include ])\n AC_HAVE_DECL(errno, [#include ])\n-AC_HAVE_DECL(readahead, [#include ])\n \n AC_CACHE_CHECK([for secure mkstemp],samba_cv_HAVE_SECURE_MKSTEMP,[\n AC_TRY_RUN([#include \n\nModified: branches/SAMBA_3_0/source/lib/replace/replace.h\n===================================================================\n--- branches/SAMBA_3_0/source/lib/replace/replace.h\t2007-06-02 08:16:42 UTC (rev 23306)\n+++ branches/SAMBA_3_0/source/lib/replace/replace.h\t2007-06-02 08:30:42 UTC (rev 23307)\n@@ -111,10 +111,6 @@\n extern int errno;\n #endif\n \n-#if defined(HAVE_LINUX_READAHEAD) && ! defined(HAVE_READAHEAD_DECL)\n-ssize_t readahead(int fd, off64_t offset, size_t count);\n-#endif\n-\n #ifndef HAVE_STRDUP\n #define strdup rep_strdup\n char *rep_strdup(const char *s);\n\n"}