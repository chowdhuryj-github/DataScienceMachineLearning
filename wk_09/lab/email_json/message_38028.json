{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 385: - make more options configurable in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 385\nrevision-id: tridge@samba.org-20070529060202-b5d16t238ncw2x2q\nparent: tridge@samba.org-20070529055203-vy4qlp6x1syx879n\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Tue 2007-05-29 16:02:02 +1000\nmessage:\n  - make more options configurable\n  - fixed some warnings\nmodified:\n  direct/ctdbd_test.c            ctdbd_test.c-20070411085057-17kgjzfktsh28g99-1\n  packaging/RHEL/ctdb.spec       ctdb.spec-20070527204758-biuh7znabuwan3zn-3\n  packaging/RHEL/setup/ctdb.init ctdb.init-20070527204758-biuh7znabuwan3zn-6\n  packaging/RHEL/setup/ctdb.sysconfig ctdb.sysconfig-20070527204758-biuh7znabuwan3zn-7\n  tools/ctdb_control.c           ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1\n=== modified file 'direct/ctdbd_test.c'\n--- a/direct/ctdbd_test.c\t2007-05-04 01:41:29 +0000\n+++ b/direct/ctdbd_test.c\t2007-05-29 06:02:02 +0000\n@@ -228,7 +228,7 @@\n \n int main(int argc, const char *argv[])\n {\n-\tint fd, pid, vnn, dstvnn, dstpid;\n+\tint fd, pid=0, vnn, dstvnn, dstpid;\n \tTDB_DATA message;\n \tstruct ctdb_req_message *reply;\n \tTDB_DATA dbname;\n\n=== modified file 'packaging/RHEL/ctdb.spec'\n--- a/packaging/RHEL/ctdb.spec\t2007-05-29 05:52:03 +0000\n+++ b/packaging/RHEL/ctdb.spec\t2007-05-29 06:02:02 +0000\n@@ -72,6 +72,7 @@\n rm -rf $RPM_BUILD_ROOT\n \n %post\n+/sbin/chkconfig --add ctdb\n \n %preun\n if [ $1 = 0 ] ; then\n\n=== modified file 'packaging/RHEL/setup/ctdb.init'\n--- a/packaging/RHEL/setup/ctdb.init\t2007-05-29 05:36:42 +0000\n+++ b/packaging/RHEL/setup/ctdb.init\t2007-05-29 06:02:02 +0000\n@@ -20,6 +20,8 @@\n # Source networking configuration.\n . /etc/sysconfig/network\n \n+CTDB_OPTIONS=\"\"\n+\n # pull in admin specified config \n if [ -f /etc/sysconfig/ctdb ]; then\n    . /etc/sysconfig/ctdb \n@@ -29,12 +31,14 @@\n [ ${NETWORKING} = \"no\" ] && exit 0\n \n # build up CTDB_OPTIONS variable\n-CTDB_OPTIONS=\"\"\n [ -z \"$LOGFILE\" ]          || CTDB_OPTIONS=\"$CTDB_OPTIONS --logfile=$LOGFILE\"\n+[ -z \"$NODES\" ]            || CTDB_OPTIONS=\"$CTDB_OPTIONS --nlist=$NODES\"\n+[ -z \"$CTDB_SOCKET\" ]      || CTDB_OPTIONS=\"$CTDB_OPTIONS --socket=$CTDB_SOCKET\"\n [ -z \"$PUBLIC_ADDRESSES\" ] || CTDB_OPTIONS=\"$CTDB_OPTIONS --public-addresses=$PUBLIC_ADDRESSES\"\n-[ -z \"$NODES\" ]            || CTDB_OPTIONS=\"$CTDB_OPTIONS --nlist=$NODES\"\n [ -z \"$PUBLIC_INTERFACE\" ] || CTDB_OPTIONS=\"$CTDB_OPTIONS --public-interface=$PUBLIC_INTERFACE\"\n [ -z \"$DBDIR\" ]            || CTDB_OPTIONS=\"$CTDB_OPTIONS --dbdir=$DBDIR\"\n+[ -z \"$EVENT_SCRIPT\" ]     || CTDB_OPTIONS=\"$CTDB_OPTIONS --event-script $EVENT_SCRIPT\"\n+[ -z \"$TRANSPORT\" ]        || CTDB_OPTIONS=\"$CTDB_OPTIONS --transport $TRANSPORT\"\n [ -z \"$DEBUGLEVEL\" ]       || CTDB_OPTIONS=\"$CTDB_OPTIONS -d $DEBUGLEVEL\"\n \n start() {\n\n=== modified file 'packaging/RHEL/setup/ctdb.sysconfig'\n--- a/packaging/RHEL/setup/ctdb.sysconfig\t2007-05-29 05:36:42 +0000\n+++ b/packaging/RHEL/setup/ctdb.sysconfig\t2007-05-29 06:02:02 +0000\n@@ -2,7 +2,14 @@\n \n # DBDIR=/var/ctdb\n # NODES=/etc/ctdb/nodes\n+# EVENT_SCRIPT=/etc/ctdb/events\n+# CTDB_SOCKET=/tmp/ctdb.socket\n+# TRANSPORT=\"tcp\"\n # PUBLIC_ADDRESSES=/etc/ctdb/public_addresses\n # PUBLIC_INTERFACE=eth0\n # LOGFILE=/var/log/log.ctdb\n # DEBUGLEVEL=0\n+\n+# any other options\n+# CTDB_OPTIONS=\n+\n\n=== modified file 'tools/ctdb_control.c'\n--- a/tools/ctdb_control.c\t2007-05-29 02:16:59 +0000\n+++ b/tools/ctdb_control.c\t2007-05-29 06:02:02 +0000\n@@ -737,7 +737,7 @@\n \tint opt;\n \tconst char **extra_argv;\n \tint extra_argc = 0;\n-\tint ret, i;\n+\tint ret=-1, i;\n \tpoptContext pc;\n \tstruct event_context *ev;\n \tconst char *control;\n\n"}