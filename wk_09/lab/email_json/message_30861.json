{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r22931 - in branches:\n\tSAMBA_3_0/source/lib/replace SAMBA_3_0_25/source/lib/replace\n\tSAMBA_3_0_26/source/lib/replace SAMBA_4_0/source/lib/replace", "body": "Author: obnox\nDate: 2007-05-16 11:15:16 +0000 (Wed, 16 May 2007)\nNew Revision: 22931\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22931\n\nLog:\nFix logic in detection of the need to replace dlopen and friends.\nOriginally, dlfcn.o was only added to LIBREPLACEOBJ if dlopen\nwas found in libdl but header dlfcn.h was not appropriate.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0/source/lib/replace/dlfcn.m4\n   branches/SAMBA_3_0_25/source/lib/replace/dlfcn.m4\n   branches/SAMBA_3_0_26/source/lib/replace/dlfcn.m4\n   branches/SAMBA_4_0/source/lib/replace/dlfcn.m4\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/replace/dlfcn.m4\n===================================================================\n--- branches/SAMBA_3_0/source/lib/replace/dlfcn.m4\t2007-05-16 10:59:04 UTC (rev 22930)\n+++ branches/SAMBA_3_0/source/lib/replace/dlfcn.m4\t2007-05-16 11:15:16 UTC (rev 22931)\n@@ -2,17 +2,18 @@\n save_LIBS=\"$LIBS\"\n LIBS=\"\"\n \n+libreplace_cv_dlfcn=no\n AC_SEARCH_LIBS(dlopen, dl)\n \n-if test \"$ac_cv_search_dlopen\" != no; then\n+if test x\"${ac_cv_search_dlopen}\" = x\"no\"; then\n+\tlibreplace_cv_dlfcn=yes\n+else\n \tAC_CHECK_HEADERS(dlfcn.h)\n-\n-\tlibreplace_cv_dlfcn=no\n \tAC_CHECK_FUNCS([dlopen dlsym dlerror dlclose],[],[libreplace_cv_dlfcn=yes])\n+fi\n \n-\tif test x\"${libreplace_cv_dlfcn}\" = x\"yes\";then\n-\t\tLIBREPLACEOBJ=\"${LIBREPLACEOBJ} dlfcn.o\"\n-\tfi\n+if test x\"${libreplace_cv_dlfcn}\" = x\"yes\";then\n+\tLIBREPLACEOBJ=\"${LIBREPLACEOBJ} dlfcn.o\"\n fi\n \n LIBDL=\"$LIBS\"\n\nModified: branches/SAMBA_3_0_25/source/lib/replace/dlfcn.m4\n===================================================================\n--- branches/SAMBA_3_0_25/source/lib/replace/dlfcn.m4\t2007-05-16 10:59:04 UTC (rev 22930)\n+++ branches/SAMBA_3_0_25/source/lib/replace/dlfcn.m4\t2007-05-16 11:15:16 UTC (rev 22931)\n@@ -2,17 +2,18 @@\n save_LIBS=\"$LIBS\"\n LIBS=\"\"\n \n+libreplace_cv_dlfcn=no\n AC_SEARCH_LIBS(dlopen, dl)\n \n-if test \"$ac_cv_search_dlopen\" != no; then\n+if test x\"${ac_cv_search_dlopen}\" = x\"no\"; then\n+\tlibreplace_cv_dlfcn=yes\n+else\n \tAC_CHECK_HEADERS(dlfcn.h)\n-\n-\tlibreplace_cv_dlfcn=no\n \tAC_CHECK_FUNCS([dlopen dlsym dlerror dlclose],[],[libreplace_cv_dlfcn=yes])\n+fi\n \n-\tif test x\"${libreplace_cv_dlfcn}\" = x\"yes\";then\n-\t\tLIBREPLACEOBJ=\"${LIBREPLACEOBJ} dlfcn.o\"\n-\tfi\n+if test x\"${libreplace_cv_dlfcn}\" = x\"yes\";then\n+\tLIBREPLACEOBJ=\"${LIBREPLACEOBJ} dlfcn.o\"\n fi\n \n LIBDL=\"$LIBS\"\n\nModified: branches/SAMBA_3_0_26/source/lib/replace/dlfcn.m4\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/replace/dlfcn.m4\t2007-05-16 10:59:04 UTC (rev 22930)\n+++ branches/SAMBA_3_0_26/source/lib/replace/dlfcn.m4\t2007-05-16 11:15:16 UTC (rev 22931)\n@@ -2,17 +2,18 @@\n save_LIBS=\"$LIBS\"\n LIBS=\"\"\n \n+libreplace_cv_dlfcn=no\n AC_SEARCH_LIBS(dlopen, dl)\n \n-if test \"$ac_cv_search_dlopen\" != no; then\n+if test x\"${ac_cv_search_dlopen}\" = x\"no\"; then\n+\tlibreplace_cv_dlfcn=yes\n+else\n \tAC_CHECK_HEADERS(dlfcn.h)\n-\n-\tlibreplace_cv_dlfcn=no\n \tAC_CHECK_FUNCS([dlopen dlsym dlerror dlclose],[],[libreplace_cv_dlfcn=yes])\n+fi\n \n-\tif test x\"${libreplace_cv_dlfcn}\" = x\"yes\";then\n-\t\tLIBREPLACEOBJ=\"${LIBREPLACEOBJ} dlfcn.o\"\n-\tfi\n+if test x\"${libreplace_cv_dlfcn}\" = x\"yes\";then\n+\tLIBREPLACEOBJ=\"${LIBREPLACEOBJ} dlfcn.o\"\n fi\n \n LIBDL=\"$LIBS\"\n\nModified: branches/SAMBA_4_0/source/lib/replace/dlfcn.m4\n===================================================================\n--- branches/SAMBA_4_0/source/lib/replace/dlfcn.m4\t2007-05-16 10:59:04 UTC (rev 22930)\n+++ branches/SAMBA_4_0/source/lib/replace/dlfcn.m4\t2007-05-16 11:15:16 UTC (rev 22931)\n@@ -2,17 +2,18 @@\n save_LIBS=\"$LIBS\"\n LIBS=\"\"\n \n+libreplace_cv_dlfcn=no\n AC_SEARCH_LIBS(dlopen, dl)\n \n-if test \"$ac_cv_search_dlopen\" != no; then\n+if test x\"${ac_cv_search_dlopen}\" = x\"no\"; then\n+\tlibreplace_cv_dlfcn=yes\n+else\n \tAC_CHECK_HEADERS(dlfcn.h)\n-\n-\tlibreplace_cv_dlfcn=no\n \tAC_CHECK_FUNCS([dlopen dlsym dlerror dlclose],[],[libreplace_cv_dlfcn=yes])\n+fi\n \n-\tif test x\"${libreplace_cv_dlfcn}\" = x\"yes\";then\n-\t\tLIBREPLACEOBJ=\"${LIBREPLACEOBJ} dlfcn.o\"\n-\tfi\n+if test x\"${libreplace_cv_dlfcn}\" = x\"yes\";then\n+\tLIBREPLACEOBJ=\"${LIBREPLACEOBJ} dlfcn.o\"\n fi\n \n LIBDL=\"$LIBS\"\n\n"}