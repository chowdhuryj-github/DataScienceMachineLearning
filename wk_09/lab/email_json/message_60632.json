{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r23673 - in branches: SAMBA_3_0/source/lib\n\tSAMBA_3_0_26/source/lib", "body": "Author: jra\nDate: 2007-07-02 20:51:09 +0000 (Mon, 02 Jul 2007)\nNew Revision: 23673\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23673\n\nLog:\nCheck for integer wrap on incoming data.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/lib/util_reg_api.c\n   branches/SAMBA_3_0_26/source/lib/util_reg_api.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/util_reg_api.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/util_reg_api.c\t2007-07-02 09:46:18 UTC (rev 23672)\n+++ branches/SAMBA_3_0/source/lib/util_reg_api.c\t2007-07-02 20:51:09 UTC (rev 23673)\n@@ -80,6 +80,12 @@\n \t\t\ttmp[num_ucs2] = 0;\n \t\t}\n \n+\t\tif (length + 2 < length) {\n+\t\t\t/* Integer wrap. */\n+\t\t\terr = WERR_INVALID_PARAM;\n+\t\t\tgoto error;\n+\t\t}\n+\n \t\tvalue->v.sz.len = convert_string_talloc(\n \t\t\tvalue, CH_UTF16LE, CH_UNIX, tmp, length+2,\n \t\t\t&value->v.sz.str, False);\n\nModified: branches/SAMBA_3_0_26/source/lib/util_reg_api.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/util_reg_api.c\t2007-07-02 09:46:18 UTC (rev 23672)\n+++ branches/SAMBA_3_0_26/source/lib/util_reg_api.c\t2007-07-02 20:51:09 UTC (rev 23673)\n@@ -80,6 +80,12 @@\n \t\t\ttmp[num_ucs2] = 0;\n \t\t}\n \n+\t\tif (length + 2 < length) {\n+\t\t\t/* Integer wrap. */\n+\t\t\terr = WERR_INVALID_PARAM;\n+\t\t\tgoto error;\n+\t\t}\n+\n \t\tvalue->v.sz.len = convert_string_talloc(\n \t\t\tvalue, CH_UTF16LE, CH_UNIX, tmp, length+2,\n \t\t\t&value->v.sz.str, False);\n\n"}