{"category": "ham", "to_address": "samba-technical@lists.samba.org", "from_address": "ninjabytes <ninjabytes@gmail.com>", "subject": "Kerberos and Shares", "body": "Hello,\n\nI have a Samba 3.0.24 running along with winbind 3.0.24 running as well to\nlog in our Active Directory.\n\n/etc/pam.d/common-account looks like this:\naccount sufficient       pam_winbind.so krb5_auth debug try_first_pass\ncached_login\naccount required pam_unix.so\n\n/etc/pam.d/common-auth looks like this:\nauth sufficient pam_winbind.so krb5_auth krb5_ccache_type=FILE debug\ntry_first_pass cached_login\nauth required pam_unix.so nullok_secure\n\n/etc/pam.d/common-password looks like this:\npassword    sufficient pam_winbind.so krb5_auth krb5_ccache_type=FILE\npassword    required   pam_unix.so nullok obscure min=4 max=8 md5\n\n/etc/pam.d/common-session looks like this:\nsession required        pam_unix.so\nsession optional        pam_foreground.so\nsession required        pam_mkhomedir.so umask=0022 skel=/etc/skel\n\nWhen I try to connect to a shared resource using smbclient with the \"-K\"\noption I get:\n\nsession setup failed: NT_STATUS_LOGON_FAILURE\n\nThis is my smb.conf:\n\n[global]\n   security = ads\n   realm = PAWNSHOP.LOCAL\n   encrypt passwords = yes\n   password server = PAWNSHOP.LOCAL\n   workgroup = PAWNSHOP\n   client signing = yes\n   idmap uid = 500-10000000\n   idmap gid = 500-10000000\n   server signing = mandatory\n   pam password change = yes\n   winbind separator = +\n   winbind enum users = no\n   winbind enum groups = no\n   winbind use default domain = yes\n   winbind offline logon = yes\n   winbind refresh tickets = yes\n   winbind cache time = 10\n   template homedir = /home/%U\n   template shell = /bin/bash\n   client use spnego = no\n   domain master = no\n   server string = Ubuntu WorkStation\n\nI would also like to have winbind to remove the kerberos tickets from /tmp/\nonce a user logs off but I cant seem to find out how to get that done.\n\nThanks\n\n"}