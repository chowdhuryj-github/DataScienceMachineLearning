{"category": "ham", "to_address": "sally.x.wetten@gsk.com", "from_address": "Terry Therneau <therneau@mayo.edu>", "subject": "Re: [R] Predicted Cox survival curves - factor coding problems..", "body": "  The combination of survfit, coxph, and factors is getting confused.  It is\nnot smart enough to match a new data frame that contains a numeric for sitenew\nto a fit that contained that variable as a factor.  (Perhaps it should be smart\nenough to at least die gracefully -- but it's not).\n\n   The simple solution is to not use factors.\n   \nsite1 <- 1*(coxsnps$sitenew==1)\nsite2 <- 1*(coxsnps$sitenew==2)\ntest1 <- coxph(Surv(time, censor) ~ snp1 + sex + site1 + site2 + gene +\n\t  eth.self + strata(edu), data= coxsnps)\n\t  \n\t output\n\nprofile1 <- data.frame(snp1=c(0,1), site2=c(0,0), sex=c(0,0),  \n\t               site1=c(0,0), site2=c(0,0), geno=c(0,0) eth.self=c(0,0))\nplot(survfit(test1, newdata=profile1))\n\n Note that you do not have to explicitly make \"edu\" a factor.  Since it is\nincluded in a strata statement, the coxph routine must treat it as discrete\ngroups.\n\n\n\n\tTerry Therneau\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}