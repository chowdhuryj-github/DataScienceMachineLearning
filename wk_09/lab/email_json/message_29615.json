{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22863 - in branches/SAMBA_4_0/source:\n\tcluster/ctdb ntvfs/common", "body": "Author: metze\nDate: 2007-05-14 17:51:19 +0000 (Mon, 14 May 2007)\nNew Revision: 22863\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22863\n\nLog:\nin SMB2 mode we always need to return NT_STATUS_LOCK_NOT_GRANTED\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/cluster/ctdb/brlock_ctdb.c\n   branches/SAMBA_4_0/source/ntvfs/common/brlock_tdb.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/cluster/ctdb/brlock_ctdb.c\n===================================================================\n--- branches/SAMBA_4_0/source/cluster/ctdb/brlock_ctdb.c\t2007-05-14 17:40:55 UTC (rev 22862)\n+++ branches/SAMBA_4_0/source/cluster/ctdb/brlock_ctdb.c\t2007-05-14 17:51:19 UTC (rev 22863)\n@@ -28,6 +28,7 @@\n #include \"lib/messaging/irpc.h\"\n #include \"libcli/libcli.h\"\n #include \"cluster/cluster.h\"\n+#include \"ntvfs/ntvfs.h\"\n #include \"ntvfs/common/brlock.h\"\n #include \"include/ctdb.h\"\n \n@@ -242,6 +243,11 @@\n \t * this function is only called for non pending lock!\n \t */\n \n+\t/* in SMB2 mode always return NT_STATUS_LOCK_NOT_GRANTED! */\n+\tif (lock->ntvfs->ctx->protocol == PROTOCOL_SMB2) {\n+\t\treturn NT_STATUS_LOCK_NOT_GRANTED;\n+\t}\n+\n \t/* \n \t * if the notify_ptr is non NULL,\n \t * it means that we're at the end of a pending lock\n\nModified: branches/SAMBA_4_0/source/ntvfs/common/brlock_tdb.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/common/brlock_tdb.c\t2007-05-14 17:40:55 UTC (rev 22862)\n+++ branches/SAMBA_4_0/source/ntvfs/common/brlock_tdb.c\t2007-05-14 17:51:19 UTC (rev 22863)\n@@ -34,6 +34,7 @@\n #include \"libcli/libcli.h\"\n #include \"cluster/cluster.h\"\n #include \"ntvfs/common/brlock.h\"\n+#include \"ntvfs/ntvfs.h\"\n \n /*\n   in this module a \"DATA_BLOB *file_key\" is a blob that uniquely identifies\n@@ -220,6 +221,11 @@\n \t * this function is only called for non pending lock!\n \t */\n \n+\t/* in SMB2 mode always return NT_STATUS_LOCK_NOT_GRANTED! */\n+\tif (lock->ntvfs->ctx->protocol == PROTOCOL_SMB2) {\n+\t\treturn NT_STATUS_LOCK_NOT_GRANTED;\n+\t}\n+\n \t/* \n \t * if the notify_ptr is non NULL,\n \t * it means that we're at the end of a pending lock\n\n"}