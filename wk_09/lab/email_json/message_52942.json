{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23586 - in branches: SAMBA_3_0/source/libsmb\n\tSAMBA_3_0_25/source/libsmb SAMBA_3_0_26/source/libsmb", "body": "Author: gd\nDate: 2007-06-22 14:43:42 +0000 (Fri, 22 Jun 2007)\nNew Revision: 23586\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23586\n\nLog:\nFix heimdal path in the krb5 renew routine when we need to compose the tgt\nstring ourselves.\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/libsmb/clikrb5.c\n   branches/SAMBA_3_0_25/source/libsmb/clikrb5.c\n   branches/SAMBA_3_0_26/source/libsmb/clikrb5.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libsmb/clikrb5.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/clikrb5.c\t2007-06-22 11:43:50 UTC (rev 23585)\n+++ branches/SAMBA_3_0/source/libsmb/clikrb5.c\t2007-06-22 14:43:42 UTC (rev 23586)\n@@ -1223,7 +1223,11 @@\n \t\t\t}\n \t\t} else {\n \t\t\t/* build tgt service by default */\n-\t\t\tclient_realm = krb5_princ_realm(context, client);\n+\t\t\tclient_realm = krb5_princ_realm(context, creds_in.client);\n+\t\t\tif (!client_realm) {\n+\t\t\t\tret = ENOMEM;\n+\t\t\t\tgoto done;\n+\t\t\t}\n \t\t\tret = krb5_make_principal(context, &creds_in.server, *client_realm, KRB5_TGS_NAME, *client_realm, NULL);\n \t\t\tif (ret) {\n \t\t\t\tgoto done;\n\nModified: branches/SAMBA_3_0_25/source/libsmb/clikrb5.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/libsmb/clikrb5.c\t2007-06-22 11:43:50 UTC (rev 23585)\n+++ branches/SAMBA_3_0_25/source/libsmb/clikrb5.c\t2007-06-22 14:43:42 UTC (rev 23586)\n@@ -1184,7 +1184,11 @@\n \t\t\t}\n \t\t} else {\n \t\t\t/* build tgt service by default */\n-\t\t\tclient_realm = krb5_princ_realm(context, client);\n+\t\t\tclient_realm = krb5_princ_realm(context, creds_in.client);\n+\t\t\tif (!client_realm) {\n+\t\t\t\tret = ENOMEM;\n+\t\t\t\tgoto done;\n+\t\t\t}\n \t\t\tret = krb5_make_principal(context, &creds_in.server, *client_realm, KRB5_TGS_NAME, *client_realm, NULL);\n \t\t\tif (ret) {\n \t\t\t\tgoto done;\n\nModified: branches/SAMBA_3_0_26/source/libsmb/clikrb5.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libsmb/clikrb5.c\t2007-06-22 11:43:50 UTC (rev 23585)\n+++ branches/SAMBA_3_0_26/source/libsmb/clikrb5.c\t2007-06-22 14:43:42 UTC (rev 23586)\n@@ -1223,7 +1223,11 @@\n \t\t\t}\n \t\t} else {\n \t\t\t/* build tgt service by default */\n-\t\t\tclient_realm = krb5_princ_realm(context, client);\n+\t\t\tclient_realm = krb5_princ_realm(context, creds_in.client);\n+\t\t\tif (!client_realm) {\n+\t\t\t\tret = ENOMEM;\n+\t\t\t\tgoto done;\n+\t\t\t}\n \t\t\tret = krb5_make_principal(context, &creds_in.server, *client_realm, KRB5_TGS_NAME, *client_realm, NULL);\n \t\t\tif (ret) {\n \t\t\t\tgoto done;\n\n"}