{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "\"John Phillips\" <john2943@gmail.com>", "subject": "[R] Linear model predictions, differences in class", "body": "Hi,\n\nI am using R to fit statistical models to data were the observations are\nmeans of the original data.  R is used to calculate the mean before fitting\nthe model.  My problem is: When R calculates the means using tapply, the\nclass of the means differs from the class of the original data, which gives\nme trouble when I want to use the original data to calculate model\npredictions.  Here is a simple example that demonstrates the problem:\n\n> data.in<-read.table('example.dat',header=TRUE)\n>\n> #Here are the data:\n> data.in\n  location    x      y\n1        A  17.2  28.46\n2        A 91.7 143.33\n3        A 93.6 148.05\n4        B 95.8 150.28\n5        B 54.9  89.49\n6        B 51.1  82.51\n7        C 53.9  88.46\n8        C 40.3  63.62\n9        C 38.5  64.46\n >\n> attach(data.in)\n>\n> #Calculate means by variable \"location\":\n> data.mn<-data.frame(xm = tapply(x,location,mean), ym =\ntapply(y,location,mean))\n> detach(data.in)\n>\n> #Here are the means:\n> data.mn\n        xm       ym\nA 67.50000 106.6133\nB 67.26667 107.4267\nC 44.23333   72.1800\n>\n> #Fit the model:\n> mod1<-lm(ym ~ xm, data.mn)\n>\n> mod1\n\nCall:\nlm(formula = ym ~ xm, data = data.mn)\n\nCoefficients:\n(Intercept)           xm\n      5.633        1.505\n\n> #R will make \"predictions\" using the data.mn data frame:\n> predict(mod1,newdata =  data.mn)\n        A         B         C\n107.19260 106.84153  72.18587\n>\n> #But, even if new variables are created in the original data\n> #with names that match those names used in the regression:\n > data.in$xm<-data.in$x\n> data.in$ym<-data.in$y\n> data.in\n  location    x      y   xm     ym\n1        A 17.2  28.46 17.2  28.46\n2        A 91.7 143.33 91.7 143.33\n3        A 93.6 148.05 93.6 148.05\n4        B 95.8 150.28 95.8 150.28\n5        B 54.9  89.49 54.9  89.49\n6        B 51.1  82.51 51.1  82.51\n7        C 53.9  88.46 53.9  88.46\n8        C 40.3  63.62 40.3   63.62\n9        C 38.5  64.46 38.5  64.46\n>\n> #R will not use data.in to make predictions:\n> predict(mod1,newdata = data.in)\nError: variable 'xm' was fitted with class \"other\" but class \"numeric\" was\nsupplied\n>\n> data.in$xm\n[1] 17.2 91.7 93.6 95.8 54.9 51.1 53.9 40.3 38.5\n> data.mn$xm\n       A        B        C\n67.50000 67.26667 44.23333\n>\n\nIs there a way to make these variables have the same class?  Or, is there\nsomething other than \"tapply\" that will work better for this?\n\nThanks!\n\n\t[[alternative HTML version deleted]]\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}