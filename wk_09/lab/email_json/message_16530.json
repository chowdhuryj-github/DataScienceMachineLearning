{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 191: validate the vnn in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 191\nrevision-id: tridge@samba.org-20070426133833-4ks6f3c2exb25p1q\nparent: tridge@samba.org-20070426133317-geuqvda21m707azi\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Thu 2007-04-26 15:38:33 +0200\nmessage:\n  validate the vnn\nmodified:\n  common/ctdb.c                  ctdb.c-20061127094323-t50f58d65iaao5of-2\n=== modified file 'common/ctdb.c'\n--- a/common/ctdb.c\t2007-04-26 13:28:13 +0000\n+++ b/common/ctdb.c\t2007-04-26 13:38:33 +0000\n@@ -394,7 +394,15 @@\n {\n \tstruct ctdb_node *node;\n \tctdb->status.node_packets_sent++;\n+\n+\tif (!ctdb_validate_vnn(ctdb, hdr->destnode)) {\n+\t  \tDEBUG(0,(__location__ \" cant send to node %u that does not exist\\n\", \n+\t\t\t hdr->destnode));\n+\t\treturn;\n+\t}\n+\n \tnode = ctdb->nodes[hdr->destnode];\n+\n \tif (hdr->destnode == ctdb->vnn && !(ctdb->flags & CTDB_FLAG_SELF_CONNECT)) {\n \t\tctdb_defer_packet(ctdb, hdr);\n \t} else if (ctdb->methods->queue_pkt(node, (uint8_t *)hdr, hdr->length) != 0) {\n\n"}