{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22611 - in branches: SAMBA_3_0/source/lib\n\tSAMBA_3_0/source/smbd SAMBA_3_0_25/source/lib\n\tSAMBA_3_0_25/source/smbd", "body": "Author: jra\nDate: 2007-04-30 16:32:17 +0000 (Mon, 30 Apr 2007)\nNew Revision: 22611\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22611\n\nLog:\nFix from Jens Nissen . Fix bad\nmemory leak I introduced into acl code, also remove\nredundent extra check for global_sid_System :\n\nglobal_sid_System == S-1-5-18 which is already\nincluded in the check for a domain of \nglobal_sid_NT_Authority == S-1-5\n\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/lib/util_sid.c\n   branches/SAMBA_3_0/source/smbd/posix_acls.c\n   branches/SAMBA_3_0_25/source/lib/util_sid.c\n   branches/SAMBA_3_0_25/source/smbd/posix_acls.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/util_sid.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/util_sid.c\t2007-04-30 14:32:50 UTC (rev 22610)\n+++ branches/SAMBA_3_0/source/lib/util_sid.c\t2007-04-30 16:32:17 UTC (rev 22611)\n@@ -510,9 +510,6 @@\n \tDOM_SID dom;\n \tuint32 rid;\n \n-\tif (sid_equal(sid, &global_sid_System))\n-\t\treturn True;\n-\n \tsid_copy(&dom, sid);\n \tsid_split_rid(&dom, &rid);\n \n\nModified: branches/SAMBA_3_0/source/smbd/posix_acls.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/posix_acls.c\t2007-04-30 14:32:50 UTC (rev 22610)\n+++ branches/SAMBA_3_0/source/smbd/posix_acls.c\t2007-04-30 16:32:17 UTC (rev 22611)\n@@ -1413,6 +1413,7 @@\n \t\t\tif (non_mappable_sid(&psa->trustee)) {\n \t\t\t\tDEBUG(10,(\"create_canon_ace_lists: ignoring non-mappable SID %s\\n\",\n \t\t\t\t\tsid_to_string(str, &psa->trustee) ));\n+\t\t\t\tSAFE_FREE(current_ace);\n \t\t\t\tcontinue;\n \t\t\t}\n \n\nModified: branches/SAMBA_3_0_25/source/lib/util_sid.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/lib/util_sid.c\t2007-04-30 14:32:50 UTC (rev 22610)\n+++ branches/SAMBA_3_0_25/source/lib/util_sid.c\t2007-04-30 16:32:17 UTC (rev 22611)\n@@ -510,9 +510,6 @@\n \tDOM_SID dom;\n \tuint32 rid;\n \n-\tif (sid_equal(sid, &global_sid_System))\n-\t\treturn True;\n-\n \tsid_copy(&dom, sid);\n \tsid_split_rid(&dom, &rid);\n \n\nModified: branches/SAMBA_3_0_25/source/smbd/posix_acls.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/smbd/posix_acls.c\t2007-04-30 14:32:50 UTC (rev 22610)\n+++ branches/SAMBA_3_0_25/source/smbd/posix_acls.c\t2007-04-30 16:32:17 UTC (rev 22611)\n@@ -1413,6 +1413,7 @@\n \t\t\tif (non_mappable_sid(&psa->trustee)) {\n \t\t\t\tDEBUG(10,(\"create_canon_ace_lists: ignoring non-mappable SID %s\\n\",\n \t\t\t\t\tsid_to_string(str, &psa->trustee) ));\n+\t\t\t\tSAFE_FREE(current_ace);\n \t\t\t\tcontinue;\n \t\t\t}\n \n\n"}