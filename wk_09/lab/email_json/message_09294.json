{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22344 - in branches/SAMBA_3_0/source/libsmb: .", "body": "Author: jra\nDate: 2007-04-18 21:56:18 +0000 (Wed, 18 Apr 2007)\nNew Revision: 22344\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22344\n\nLog:\nCorrectly create sub-struct for GSS encryption.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/libsmb/clifsinfo.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libsmb/clifsinfo.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/clifsinfo.c\t2007-04-18 21:10:37 UTC (rev 22343)\n+++ branches/SAMBA_3_0/source/libsmb/clifsinfo.c\t2007-04-18 21:56:18 UTC (rev 22344)\n@@ -368,6 +368,21 @@\n \t}\n \tZERO_STRUCTP(es);\n \tes->smb_enc_type = smb_enc_type;\n+\n+\tif (smb_enc_type == SMB_TRANS_ENC_GSS) {\n+#if defined(HAVE_GSSAPI) && defined(HAVE_KRB5)\n+\t\tes->s.gss_state = SMB_MALLOC_P(struct smb_tran_enc_state_gss);\n+\t\tif (!es->s.gss_state) {\n+\t\t\tSAFE_FREE(es);\n+\t\t\treturn NULL;\n+\t\t}\n+\t\tZERO_STRUCTP(es->s.gss_state);\n+#else\n+\t\tDEBUG(0,(\"make_cli_enc_state: no krb5 compiled.\\n\");\n+\t\tSAFE_FREE(es);\n+\t\treturn NULL;\n+#endif\n+\t}\n \treturn es;\n }\n \n\n"}