{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r23043 - in branches/SAMBA_4_0/source/smb_server:\n\t.", "body": "Author: metze\nDate: 2007-05-21 17:12:49 +0000 (Mon, 21 May 2007)\nNew Revision: 23043\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23043\n\nLog:\nallow more than UINT16_MAX - 1 handles on smb2 connections\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/smb_server/tcon.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/smb_server/tcon.c\n===================================================================\n--- branches/SAMBA_4_0/source/smb_server/tcon.c\t2007-05-21 16:14:22 UTC (rev 23042)\n+++ branches/SAMBA_4_0/source/smb_server/tcon.c\t2007-05-21 17:12:49 UTC (rev 23043)\n@@ -147,6 +147,7 @@\n {\n \tTALLOC_CTX *mem_ctx;\n \tstruct smbsrv_tcons_context *tcons_ctx;\n+\tuint32_t handle_uint_max;\n \tstruct smbsrv_tcon *tcon;\n \tNTSTATUS status;\n \tint i;\n@@ -154,9 +155,11 @@\n \tif (smb_sess) {\n \t\tmem_ctx = smb_sess;\n \t\ttcons_ctx = &smb_sess->smb2_tcons;\n+\t\thandle_uint_max = UINT32_MAX;\n \t} else {\n \t\tmem_ctx = smb_conn;\n \t\ttcons_ctx = &smb_conn->smb_tcons;\n+\t\thandle_uint_max = UINT16_MAX;\n \t}\n \n \ttcon = talloc_zero(mem_ctx, struct smbsrv_tcon);\n@@ -170,7 +173,7 @@\n \t * the use -1 here, because we don't want to give away the wildcard\n \t * fnum used in SMBflush\n \t */\n-\tstatus = smbsrv_init_handles(tcon, UINT16_MAX - 1);\n+\tstatus = smbsrv_init_handles(tcon, handle_uint_max - 1);\n \tif (!NT_STATUS_IS_OK(status)) {\n \t\tDEBUG(1,(\"ERROR! failed to init handles: %s\\n\", nt_errstr(status)));\n \t\tgoto failed;\n\n"}