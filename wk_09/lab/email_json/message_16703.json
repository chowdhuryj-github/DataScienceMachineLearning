{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "sfrench@samba.org", "subject": "svn commit: samba r22525 - in branches/SAMBA_3_0_25/source/client: .", "body": "Author: sfrench\nDate: 2007-04-26 17:22:13 +0000 (Thu, 26 Apr 2007)\nNew Revision: 22525\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22525\n\nLog:\nAllow prepath\n\nModified:\n   branches/SAMBA_3_0_25/source/client/mount.cifs.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_25/source/client/mount.cifs.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/client/mount.cifs.c\t2007-04-26 12:09:25 UTC (rev 22524)\n+++ branches/SAMBA_3_0_25/source/client/mount.cifs.c\t2007-04-26 17:22:13 UTC (rev 22525)\n@@ -78,6 +78,7 @@\n static char * user_name = NULL;\n static char * mountpassword = NULL;\n char * domain_name = NULL;\n+char * prefixpath = NULL;\n \n \n /* BB finish BB\n@@ -804,6 +805,11 @@\n \t\t\t\t\thost_entry = gethostbyname(unc_name);\n \t\t\t\t}\n \t\t\t\t*(share - 1) = '/'; /* put the slash back */\n+\t\t\t\tif ((prefixpath = strchr(share, '/'))) {\n+\t\t\t\t\t*prefixpath = 0;  /* permanently terminate the string */\n+\t\t\t\t\tif (!strlen(++prefixpath))\n+\t\t\t\t\t\tprefixpath = NULL; /* this needs to be done explicitly */\n+\t\t\t\t}\n \t\t\t\tif(got_ip) {\n \t\t\t\t\tif(verboseflag)\n \t\t\t\t\t\tprintf(\"ip address specified explicitly\\n\");\n@@ -1196,6 +1202,10 @@\n \t\tstrcat(options,\",\");\n \t\tstrcat(options,orgoptions);\n \t}\n+\tif(prefixpath) {\n+\t\tstrncat(options,\",prefixpath=\",12);\n+\t\tstrcat(options,prefixpath); /* no need to cat the / */\n+\t}\t\n \tif(verboseflag)\n \t\tprintf(\"\\nmount.cifs kernel mount options %s \\n\",options);\n \tif(mount(share_name, mountpoint, \"cifs\", flags, options)) {\n\n"}