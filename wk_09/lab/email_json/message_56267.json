{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23627 - in branches: SAMBA_3_0/source/libmsrpc\n\tSAMBA_3_0/source/libsmb SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0/source/python SAMBA_3_0/source/rpc_client\n\tSAMBA_3_0/source/rpc_parse SAMBA_3_0/source/rpcclient\n\tSAMBA_3_0/source/utils SAMBA_3_0_26/source/libsmb\n\tSAMBA_3_0_26/source/nsswitch SAMBA_3_0_26/source/python\n\tSAMBA_3_0_26/source/rpc_client SAMBA_3_0_26/source/rpc_parse\n\tSAMBA_3_0_26/source/rpcclient SAMBA_3_0_26/source/utils", "body": "Author: gd\nDate: 2007-06-27 11:42:17 +0000 (Wed, 27 Jun 2007)\nNew Revision: 23627\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23627\n\nLog:\nAllow to pass down the lookup-level to rpccli_lsa_lookup_names().\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/libmsrpc/cac_lsarpc.c\n   branches/SAMBA_3_0/source/libsmb/libsmbclient.c\n   branches/SAMBA_3_0/source/nsswitch/winbindd_rpc.c\n   branches/SAMBA_3_0/source/python/py_lsa.c\n   branches/SAMBA_3_0/source/rpc_client/cli_lsarpc.c\n   branches/SAMBA_3_0/source/rpc_parse/parse_lsa.c\n   branches/SAMBA_3_0/source/rpcclient/cmd_lsarpc.c\n   branches/SAMBA_3_0/source/utils/net_rpc.c\n   branches/SAMBA_3_0/source/utils/net_rpc_rights.c\n   branches/SAMBA_3_0/source/utils/net_util.c\n   branches/SAMBA_3_0/source/utils/netlookup.c\n   branches/SAMBA_3_0/source/utils/smbcacls.c\n   branches/SAMBA_3_0/source/utils/smbcquotas.c\n   branches/SAMBA_3_0_26/source/libsmb/libsmbclient.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_rpc.c\n   branches/SAMBA_3_0_26/source/python/py_lsa.c\n   branches/SAMBA_3_0_26/source/rpc_client/cli_lsarpc.c\n   branches/SAMBA_3_0_26/source/rpc_parse/parse_lsa.c\n   branches/SAMBA_3_0_26/source/rpcclient/cmd_lsarpc.c\n   branches/SAMBA_3_0_26/source/utils/net_rpc.c\n   branches/SAMBA_3_0_26/source/utils/net_rpc_rights.c\n   branches/SAMBA_3_0_26/source/utils/net_util.c\n   branches/SAMBA_3_0_26/source/utils/netlookup.c\n   branches/SAMBA_3_0_26/source/utils/smbcacls.c\n   branches/SAMBA_3_0_26/source/utils/smbcquotas.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libmsrpc/cac_lsarpc.c\n===================================================================\n--- branches/SAMBA_3_0/source/libmsrpc/cac_lsarpc.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/libmsrpc/cac_lsarpc.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -337,7 +337,7 @@\n \t\trpccli_lsa_lookup_names( pipe_hnd, mem_ctx, op->in.pol,\n \t\t\t\t\t num_names,\n \t\t\t\t\t ( const char ** ) op->in.names, NULL,\n-\t\t\t\t\t &sids, &types );\n+\t\t\t\t\t 1, &sids, &types );\n \n \tif ( NT_STATUS_IS_OK( hnd->status ) ) {\n \t\t/*this is the easy part, just make the out.sids array */\n@@ -662,7 +662,7 @@\n \t\t\t\t\t\t op->in.pol, 1,\n \t\t\t\t\t\t ( const char ** ) &( op->in.\n \t\t\t\t\t\t\t\t      name ),\n-\t\t\t\t\t\t NULL, &user_sid, &type );\n+\t\t\t\t\t\t NULL, 1, &user_sid, &type );\n \n \t\tif ( !NT_STATUS_IS_OK( hnd->status ) )\n \t\t\treturn CAC_FAILURE;\n@@ -928,7 +928,7 @@\n \t\t\t\t\t\t op->in.pol, 1,\n \t\t\t\t\t\t ( const char ** ) &( op->in.\n \t\t\t\t\t\t\t\t      name ),\n-\t\t\t\t\t\t NULL, &user_sid, &type );\n+\t\t\t\t\t\t NULL, 1, &user_sid, &type );\n \n \t\tif ( !NT_STATUS_IS_OK( hnd->status ) )\n \t\t\treturn CAC_FAILURE;\n@@ -998,7 +998,7 @@\n \t\t\t\t\t\t op->in.pol, 1,\n \t\t\t\t\t\t ( const char ** ) &( op->in.\n \t\t\t\t\t\t\t\t      name ),\n-\t\t\t\t\t\t NULL, &user_sid, &type );\n+\t\t\t\t\t\t NULL, 1, &user_sid, &type );\n \n \t\tif ( !NT_STATUS_IS_OK( hnd->status ) )\n \t\t\treturn CAC_FAILURE;\n@@ -1060,7 +1060,7 @@\n \t\t\t\t\t\t op->in.pol, 1,\n \t\t\t\t\t\t ( const char ** ) &( op->in.\n \t\t\t\t\t\t\t\t      name ),\n-\t\t\t\t\t\t NULL, &user_sid, &type );\n+\t\t\t\t\t\t NULL, 1, &user_sid, &type );\n \n \t\tif ( !NT_STATUS_IS_OK( hnd->status ) )\n \t\t\treturn CAC_FAILURE;\n@@ -1122,7 +1122,7 @@\n \t\t\t\t\t\t op->in.pol, 1,\n \t\t\t\t\t\t ( const char ** ) &( op->in.\n \t\t\t\t\t\t\t\t      name ),\n-\t\t\t\t\t\t NULL, &user_sid, &type );\n+\t\t\t\t\t\t NULL, 1, &user_sid, &type );\n \n \t\tif ( !NT_STATUS_IS_OK( hnd->status ) )\n \t\t\treturn CAC_FAILURE;\n@@ -1181,7 +1181,7 @@\n \t\t\t\t\t\t op->in.pol, 1,\n \t\t\t\t\t\t ( const char ** ) &( op->in.\n \t\t\t\t\t\t\t\t      name ),\n-\t\t\t\t\t\t NULL, &user_sid, &type );\n+\t\t\t\t\t\t NULL, 1, &user_sid, &type );\n \n \t\tif ( !NT_STATUS_IS_OK( hnd->status ) )\n \t\t\treturn CAC_FAILURE;\n\nModified: branches/SAMBA_3_0/source/libsmb/libsmbclient.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/libsmbclient.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/libsmb/libsmbclient.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -3849,7 +3849,7 @@\n         }\n \n \tif (!NT_STATUS_IS_OK(rpccli_lsa_lookup_names(pipe_hnd, ipc_cli->mem_ctx, \n-\t\t\t\t\t\t  pol, 1, &str, NULL, &sids, \n+\t\t\t\t\t\t  pol, 1, &str, NULL, 1, &sids, \n \t\t\t\t\t\t  &types))) {\n \t\tresult = False;\n \t\tgoto done;\n\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_rpc.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_rpc.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_rpc.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -290,7 +290,7 @@\n \t\treturn result;\n \n \tresult = rpccli_lsa_lookup_names(cli, mem_ctx, &lsa_policy, 1, \n-\t\t\t\t\t (const char**) &full_name, NULL, &sids, &types);\n+\t\t\t\t\t (const char**) &full_name, NULL, 1, &sids, &types);\n         \n \tif (!NT_STATUS_IS_OK(result))\n \t\treturn result;\n\nModified: branches/SAMBA_3_0/source/python/py_lsa.c\n===================================================================\n--- branches/SAMBA_3_0/source/python/py_lsa.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/python/py_lsa.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -187,7 +187,7 @@\n \n \tntstatus = rpccli_lsa_lookup_names(\n \t\thnd->cli, mem_ctx, &hnd->pol, num_names, names, \n-\t\tNULL, &sids, &name_types);\n+\t\tNULL, 1, &sids, &name_types);\n \n \tif (!NT_STATUS_IS_OK(ntstatus) && NT_STATUS_V(ntstatus) != 0x107) {\n \t\tPyErr_SetObject(lsa_ntstatus, py_ntstatus_tuple(ntstatus));\n\nModified: branches/SAMBA_3_0/source/rpc_client/cli_lsarpc.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_client/cli_lsarpc.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/rpc_client/cli_lsarpc.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -448,6 +448,7 @@\n \t\t\t\t POLICY_HND *pol, int num_names, \n \t\t\t\t const char **names,\n \t\t\t\t const char ***dom_names,\n+\t\t\t\t int level,\n \t\t\t\t DOM_SID **sids,\n \t\t\t\t enum lsa_SidType **types)\n {\n@@ -464,7 +465,7 @@\n \tZERO_STRUCT(ref);\n \tr.dom_ref = &ref\n \n-\tinit_q_lookup_names(mem_ctx, &q, pol, num_names, names);\n+\tinit_q_lookup_names(mem_ctx, &q, pol, num_names, names, level);\n \n \tCLI_DO_RPC( cli, mem_ctx, PI_LSARPC, LSA_LOOKUPNAMES,\n \t\t\tq, r,\n\nModified: branches/SAMBA_3_0/source/rpc_parse/parse_lsa.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_parse/parse_lsa.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/rpc_parse/parse_lsa.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -1567,7 +1567,8 @@\n ********************************************************************/\n \n void init_q_lookup_names(TALLOC_CTX *mem_ctx, LSA_Q_LOOKUP_NAMES *q_l, \n-\t\t\t POLICY_HND *hnd, int num_names, const char **names)\n+\t\t\t POLICY_HND *hnd, int num_names, const char **names, \n+\t\t\t int level)\n {\n \tunsigned int i;\n \n@@ -1578,7 +1579,7 @@\n \tq_l->pol = *hnd;\n \tq_l->num_entries = num_names;\n \tq_l->num_entries2 = num_names;\n-\tq_l->lookup_level = 1;\n+\tq_l->lookup_level = level;\n \n \tif (num_names) {\n \t\tif ((q_l->uni_name = TALLOC_ZERO_ARRAY(mem_ctx, UNISTR2, num_names)) == NULL) {\n\nModified: branches/SAMBA_3_0/source/rpcclient/cmd_lsarpc.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpcclient/cmd_lsarpc.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/rpcclient/cmd_lsarpc.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -47,7 +47,7 @@\n \tif (!NT_STATUS_IS_OK(result))\n \t\tgoto done;\n \n-\tresult = rpccli_lsa_lookup_names(cli, mem_ctx, &pol, 1, &name, NULL, &sids, &sid_types);\n+\tresult = rpccli_lsa_lookup_names(cli, mem_ctx, &pol, 1, &name, NULL, 1, &sids, &sid_types);\n \tif (!NT_STATUS_IS_OK(result))\n \t\tgoto done;\n \n@@ -239,7 +239,7 @@\n \t\tgoto done;\n \n \tresult = rpccli_lsa_lookup_names(cli, mem_ctx, &pol, argc - 1, \n-\t\t\t\t      (const char**)(argv + 1), NULL, &sids, &types);\n+\t\t\t\t      (const char**)(argv + 1), NULL, 1, &sids, &types);\n \n \tif (!NT_STATUS_IS_OK(result) && NT_STATUS_V(result) != \n \t    NT_STATUS_V(STATUS_SOME_UNMAPPED))\n\nModified: branches/SAMBA_3_0/source/utils/net_rpc.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/net_rpc.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/utils/net_rpc.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -2030,7 +2030,7 @@\n \t}\n \n \tresult = rpccli_lsa_lookup_names(pipe_hnd, mem_ctx, &lsa_pol, 1,\n-\t\t\t\t      &name, NULL, &sids, &types);\n+\t\t\t\t      &name, NULL, 1, &sids, &types);\n \n \tif (NT_STATUS_IS_OK(result)) {\n \t\tsid_copy(sid, &sids[0]);\n\nModified: branches/SAMBA_3_0/source/utils/net_rpc_rights.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/net_rpc_rights.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/utils/net_rpc_rights.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -76,7 +76,7 @@\n \t\treturn result;\n \n \tresult = rpccli_lsa_lookup_names(pipe_hnd, mem_ctx, &pol, 1, &name,\n-\t\t\t\t\t NULL, &sids, &sid_types);\n+\t\t\t\t\t NULL, 1, &sids, &sid_types);\n \t\n \tif ( NT_STATUS_IS_OK(result) )\n \t\tsid_copy( sid, &sids[0] );\n\nModified: branches/SAMBA_3_0/source/utils/net_util.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/net_util.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/utils/net_util.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -59,7 +59,7 @@\n \t}\n \n \tresult = rpccli_lsa_lookup_names(lsa_pipe, mem_ctx, &pol, 1,\n-\t\t\t\t\t &name, &dom_names, &sids, &types);\n+\t\t\t\t\t &name, &dom_names, 1, &sids, &types);\n \n \tif (!NT_STATUS_IS_OK(result)) {\n \t\t/* This can happen easily, don't log an error */\n\nModified: branches/SAMBA_3_0/source/utils/netlookup.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/netlookup.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/utils/netlookup.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -206,8 +206,8 @@\n \t\t\t\t\t\t&csp->pol,\n \t\t\t\t\t\t1,\n \t\t\t\t\t\t&full_name,\n-\t\t\t\t\t        NULL, &sids,\n-\t\t\t\t\t\t&types);\n+\t\t\t\t\t        NULL, 1,\n+\t\t\t\t\t\t&sids, &types);\n \n \tif (!NT_STATUS_IS_OK(nt_status)) {\n \t\treturn nt_status;\n\nModified: branches/SAMBA_3_0/source/utils/smbcacls.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/smbcacls.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/utils/smbcacls.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -145,7 +145,7 @@\n \n \tif (!cacls_open_policy_hnd() ||\n \t    !NT_STATUS_IS_OK(rpccli_lsa_lookup_names(global_pipe_hnd, global_hack_cli->mem_ctx, \n-\t\t\t\t\t\t  &pol, 1, &str, NULL, &sids, \n+\t\t\t\t\t\t  &pol, 1, &str, NULL, 1, &sids, \n \t\t\t\t\t\t  &types))) {\n \t\tresult = False;\n \t\tgoto done;\n\nModified: branches/SAMBA_3_0/source/utils/smbcquotas.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/smbcquotas.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0/source/utils/smbcquotas.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -116,7 +116,7 @@\n \n \tif (!cli_open_policy_hnd() ||\n \t    !NT_STATUS_IS_OK(rpccli_lsa_lookup_names(global_pipe_hnd, cli_ipc->mem_ctx, \n-\t\t\t\t\t\t  &pol, 1, &str, NULL, &sids, \n+\t\t\t\t\t\t  &pol, 1, &str, NULL, 1, &sids, \n \t\t\t\t\t\t  &types))) {\n \t\tresult = False;\n \t\tgoto done;\n\nModified: branches/SAMBA_3_0_26/source/libsmb/libsmbclient.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libsmb/libsmbclient.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/libsmb/libsmbclient.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -3859,7 +3859,7 @@\n         }\n \n \tif (!NT_STATUS_IS_OK(rpccli_lsa_lookup_names(pipe_hnd, ipc_cli->mem_ctx, \n-\t\t\t\t\t\t  pol, 1, &str, NULL, &sids, \n+\t\t\t\t\t\t  pol, 1, &str, NULL, 1, &sids, \n \t\t\t\t\t\t  &types))) {\n \t\tresult = False;\n \t\tgoto done;\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_rpc.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_rpc.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_rpc.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -290,7 +290,7 @@\n \t\treturn result;\n \n \tresult = rpccli_lsa_lookup_names(cli, mem_ctx, &lsa_policy, 1, \n-\t\t\t\t\t (const char**) &full_name, NULL, &sids, &types);\n+\t\t\t\t\t (const char**) &full_name, NULL, 1, &sids, &types);\n         \n \tif (!NT_STATUS_IS_OK(result))\n \t\treturn result;\n\nModified: branches/SAMBA_3_0_26/source/python/py_lsa.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/python/py_lsa.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/python/py_lsa.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -187,7 +187,7 @@\n \n \tntstatus = rpccli_lsa_lookup_names(\n \t\thnd->cli, mem_ctx, &hnd->pol, num_names, names, \n-\t\tNULL, &sids, &name_types);\n+\t\tNULL, 1, &sids, &name_types);\n \n \tif (!NT_STATUS_IS_OK(ntstatus) && NT_STATUS_V(ntstatus) != 0x107) {\n \t\tPyErr_SetObject(lsa_ntstatus, py_ntstatus_tuple(ntstatus));\n\nModified: branches/SAMBA_3_0_26/source/rpc_client/cli_lsarpc.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_client/cli_lsarpc.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/rpc_client/cli_lsarpc.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -446,6 +446,7 @@\n \t\t\t\t POLICY_HND *pol, int num_names, \n \t\t\t\t const char **names,\n \t\t\t\t const char ***dom_names,\n+\t\t\t\t int level,\n \t\t\t\t DOM_SID **sids,\n \t\t\t\t uint32 **types)\n {\n@@ -462,7 +463,7 @@\n \tZERO_STRUCT(ref);\n \tr.dom_ref = &ref\n \n-\tinit_q_lookup_names(mem_ctx, &q, pol, num_names, names);\n+\tinit_q_lookup_names(mem_ctx, &q, pol, num_names, names, level);\n \n \tCLI_DO_RPC( cli, mem_ctx, PI_LSARPC, LSA_LOOKUPNAMES,\n \t\t\tq, r,\n\nModified: branches/SAMBA_3_0_26/source/rpc_parse/parse_lsa.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_parse/parse_lsa.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/rpc_parse/parse_lsa.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -1567,7 +1567,8 @@\n ********************************************************************/\n \n void init_q_lookup_names(TALLOC_CTX *mem_ctx, LSA_Q_LOOKUP_NAMES *q_l, \n-\t\t\t POLICY_HND *hnd, int num_names, const char **names)\n+\t\t\t POLICY_HND *hnd, int num_names, const char **names, \n+\t\t\t int level)\n {\n \tunsigned int i;\n \n@@ -1578,7 +1579,7 @@\n \tq_l->pol = *hnd;\n \tq_l->num_entries = num_names;\n \tq_l->num_entries2 = num_names;\n-\tq_l->lookup_level = 1;\n+\tq_l->lookup_level = level;\n \n \tif (num_names) {\n \t\tif ((q_l->uni_name = TALLOC_ZERO_ARRAY(mem_ctx, UNISTR2, num_names)) == NULL) {\n\nModified: branches/SAMBA_3_0_26/source/rpcclient/cmd_lsarpc.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpcclient/cmd_lsarpc.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/rpcclient/cmd_lsarpc.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -47,7 +47,7 @@\n \tif (!NT_STATUS_IS_OK(result))\n \t\tgoto done;\n \n-\tresult = rpccli_lsa_lookup_names(cli, mem_ctx, &pol, 1, &name, NULL, &sids, &sid_types);\n+\tresult = rpccli_lsa_lookup_names(cli, mem_ctx, &pol, 1, &name, NULL, 1, &sids, &sid_types);\n \tif (!NT_STATUS_IS_OK(result))\n \t\tgoto done;\n \n@@ -239,7 +239,7 @@\n \t\tgoto done;\n \n \tresult = rpccli_lsa_lookup_names(cli, mem_ctx, &pol, argc - 1, \n-\t\t\t\t      (const char**)(argv + 1), NULL, &sids, &types);\n+\t\t\t\t      (const char**)(argv + 1), NULL, 1, &sids, &types);\n \n \tif (!NT_STATUS_IS_OK(result) && NT_STATUS_V(result) != \n \t    NT_STATUS_V(STATUS_SOME_UNMAPPED))\n\nModified: branches/SAMBA_3_0_26/source/utils/net_rpc.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/net_rpc.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/utils/net_rpc.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -2030,7 +2030,7 @@\n \t}\n \n \tresult = rpccli_lsa_lookup_names(pipe_hnd, mem_ctx, &lsa_pol, 1,\n-\t\t\t\t      &name, NULL, &sids, &types);\n+\t\t\t\t      &name, NULL, 1, &sids, &types);\n \n \tif (NT_STATUS_IS_OK(result)) {\n \t\tsid_copy(sid, &sids[0]);\n\nModified: branches/SAMBA_3_0_26/source/utils/net_rpc_rights.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/net_rpc_rights.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/utils/net_rpc_rights.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -76,7 +76,7 @@\n \t\treturn result;\n \n \tresult = rpccli_lsa_lookup_names(pipe_hnd, mem_ctx, &pol, 1, &name,\n-\t\t\t\t\t NULL, &sids, &sid_types);\n+\t\t\t\t\t NULL, 1, &sids, &sid_types);\n \t\n \tif ( NT_STATUS_IS_OK(result) )\n \t\tsid_copy( sid, &sids[0] );\n\nModified: branches/SAMBA_3_0_26/source/utils/net_util.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/net_util.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/utils/net_util.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -59,7 +59,7 @@\n \t}\n \n \tresult = rpccli_lsa_lookup_names(lsa_pipe, mem_ctx, &pol, 1,\n-\t\t\t\t\t &name, &dom_names, &sids, &types);\n+\t\t\t\t\t &name, &dom_names, 1, &sids, &types);\n \n \tif (!NT_STATUS_IS_OK(result)) {\n \t\t/* This can happen easily, don't log an error */\n\nModified: branches/SAMBA_3_0_26/source/utils/netlookup.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/netlookup.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/utils/netlookup.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -206,8 +206,8 @@\n \t\t\t\t\t\t&csp->pol,\n \t\t\t\t\t\t1,\n \t\t\t\t\t\t&full_name,\n-\t\t\t\t\t        NULL, &sids,\n-\t\t\t\t\t\t&types);\n+\t\t\t\t\t        NULL, 1,\n+\t\t\t\t\t\t&sids, &types);\n \n \tif (!NT_STATUS_IS_OK(nt_status)) {\n \t\treturn nt_status;\n\nModified: branches/SAMBA_3_0_26/source/utils/smbcacls.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/smbcacls.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/utils/smbcacls.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -145,7 +145,7 @@\n \n \tif (!cacls_open_policy_hnd() ||\n \t    !NT_STATUS_IS_OK(rpccli_lsa_lookup_names(global_pipe_hnd, global_hack_cli->mem_ctx, \n-\t\t\t\t\t\t  &pol, 1, &str, NULL, &sids, \n+\t\t\t\t\t\t  &pol, 1, &str, NULL, 1, &sids, \n \t\t\t\t\t\t  &types))) {\n \t\tresult = False;\n \t\tgoto done;\n\nModified: branches/SAMBA_3_0_26/source/utils/smbcquotas.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/smbcquotas.c\t2007-06-27 11:29:53 UTC (rev 23626)\n+++ branches/SAMBA_3_0_26/source/utils/smbcquotas.c\t2007-06-27 11:42:17 UTC (rev 23627)\n@@ -116,7 +116,7 @@\n \n \tif (!cli_open_policy_hnd() ||\n \t    !NT_STATUS_IS_OK(rpccli_lsa_lookup_names(global_pipe_hnd, cli_ipc->mem_ctx, \n-\t\t\t\t\t\t  &pol, 1, &str, NULL, &sids, \n+\t\t\t\t\t\t  &pol, 1, &str, NULL, 1, &sids, \n \t\t\t\t\t\t  &types))) {\n \t\tresult = False;\n \t\tgoto done;\n\n"}