{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22534 - in branches/SAMBA_4_0/source/librpc/rpc:\n\t.", "body": "Author: metze\nDate: 2007-04-27 14:17:28 +0000 (Fri, 27 Apr 2007)\nNew Revision: 22534\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22534\n\nLog:\ndon't remove socket and fd_event before we told the\npacket layer.\n\nalso fix double free (left over from cut-n-paste)\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/librpc/rpc/dcerpc_sock.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/librpc/rpc/dcerpc_sock.c\n===================================================================\n--- branches/SAMBA_4_0/source/librpc/rpc/dcerpc_sock.c\t2007-04-27 14:00:27 UTC (rev 22533)\n+++ branches/SAMBA_4_0/source/librpc/rpc/dcerpc_sock.c\t2007-04-27 14:17:28 UTC (rev 22534)\n@@ -50,24 +50,22 @@\n \n \tif (!sock) return;\n \n+\tif (sock->packet) {\n+\t\tpacket_recv_disable(sock->packet);\n+\t\tpacket_set_fde(sock->packet, NULL);\n+\t\tpacket_set_socket(sock->packet, NULL);\n+\t}\n+\n \tif (sock->fde) {\n \t\ttalloc_free(sock->fde);\n \t\tsock->fde = NULL;\n \t}\n \n \tif (sock->sock) {\n-\t\ttalloc_free(sock->fde);\n-\t\tsock->fde = NULL;\n \t\ttalloc_free(sock->sock);\n \t\tsock->sock = NULL;\n \t}\n \n-\tif (sock->packet) {\n-\t\tpacket_recv_disable(sock->packet);\n-\t\tpacket_set_fde(sock->packet, NULL);\n-\t\tpacket_set_socket(sock->packet, NULL);\n-\t}\n-\n \tif (NT_STATUS_EQUAL(NT_STATUS_UNSUCCESSFUL, status)) {\n \t\tstatus = NT_STATUS_UNEXPECTED_NETWORK_ERROR;\n \t}\n\n"}