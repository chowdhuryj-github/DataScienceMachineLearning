{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r22230 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_25/source/nsswitch", "body": "Author: idra\nDate: 2007-04-15 23:58:39 +0000 (Sun, 15 Apr 2007)\nNew Revision: 22230\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22230\n\nLog:\n\nLet's just cast here, the 2 calls have different allocation mechanisms.\nWe just let domname and name hang on the mem ctx until the call returns,\nand the context will be destroyed.\n\nSimo.\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/idmap.c\n   branches/SAMBA_3_0_25/source/nsswitch/idmap.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/idmap.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/idmap.c\t2007-04-15 21:14:37 UTC (rev 22229)\n+++ branches/SAMBA_3_0/source/nsswitch/idmap.c\t2007-04-15 23:58:39 UTC (rev 22230)\n@@ -811,7 +811,7 @@\n {\n \tNTSTATUS ret;\n \tstruct idmap_domain *dom;\n-\tconst char *domname, *name;\n+\tchar *domname, *name;\n \tenum lsa_SidType sid_type;\n \tBOOL wbret;\n \n@@ -825,14 +825,16 @@\n \t\t/* by default calls to winbindd are disabled\n \t\t   the following call will not recurse so this is safe */\n \t\twinbind_on();\n-\t\twbret = winbind_lookup_sid(ctx, map->sid, &domname, &name, &sid_type);\n+\t\twbret = winbind_lookup_sid(ctx, map->sid,\n+\t\t\t\t\t\t(const char **)&domname,\n+\t\t\t\t\t\t(const char **)&name,\n+\t\t\t\t\t\t&sid_type);\n \t\twinbind_off();\n \t} else {\n-\t\tchar *tmp_dom, *tmp_name;\n-\t\twbret = winbindd_lookup_name_by_sid(ctx, map->sid, &tmp_dom,\n-\t\t\t\t\t\t    &tmp_name, &sid_type);\n-\t\tdomname = tmp_dom;\n-\t\tname = tmp_name;\n+\t\twbret = winbindd_lookup_name_by_sid(ctx, map->sid,\n+\t\t\t\t\t\t\t&domname,\n+\t\t\t\t\t\t\t&name,\n+\t\t\t\t\t\t\t&sid_type);\n \t}\n \n \t/* check if this is a valid SID and then map it */\n\nModified: branches/SAMBA_3_0_25/source/nsswitch/idmap.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/idmap.c\t2007-04-15 21:14:37 UTC (rev 22229)\n+++ branches/SAMBA_3_0_25/source/nsswitch/idmap.c\t2007-04-15 23:58:39 UTC (rev 22230)\n@@ -811,7 +811,7 @@\n {\n \tNTSTATUS ret;\n \tstruct idmap_domain *dom;\n-\tconst char *domname, *name;\n+\tchar *domname, *name;\n \tenum lsa_SidType sid_type;\n \tBOOL wbret;\n \n@@ -825,10 +825,16 @@\n \t\t/* by default calls to winbindd are disabled\n \t\t   the following call will not recurse so this is safe */\n \t\twinbind_on();\n-\t\twbret = winbind_lookup_sid(ctx, map->sid, &domname, &name, &sid_type);\n+\t\twbret = winbind_lookup_sid(ctx, map->sid,\n+\t\t\t\t\t\t(const char **)&domname,\n+\t\t\t\t\t\t(const char **)&name,\n+\t\t\t\t\t\t&sid_type);\n \t\twinbind_off();\n \t} else {\n-\t\twbret = winbindd_lookup_name_by_sid(ctx, map->sid, &domname, &name, &sid_type);\n+\t\twbret = winbindd_lookup_name_by_sid(ctx, map->sid,\n+\t\t\t\t\t\t\t&domname,\n+\t\t\t\t\t\t\t&name,\n+\t\t\t\t\t\t\t&sid_type);\n \t}\n \n \t/* check if this is a valid SID and then map it */\n\n"}