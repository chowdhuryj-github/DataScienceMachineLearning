{"category": "ham", "to_address": "RHelp help <r-help@stat.math.ethz.ch>", "from_address": "Robin Hankin <r.hankin@noc.soton.ac.uk>", "subject": "[R] vectorize a function", "body": "Hello everyone\n\nsuppose I have an integer vector \"a\" of length \"n\" and\na symmetric matrix \"M\" of size n-by-n.\n\nVector \"a\" describes a partition of a set of \"n\" elements\nand matrix M describes a penalty function: row i column\nj represents the penalty if element i and element j\nare in the same partition.\n\nToy example follows; the real case is much larger\nand I need to evaluate my penalty function many times.\n\nIf a <- c(1,1,2,1,3)  then elements 1,2,4 are in the\nsame partition; element 3 is in a partition on its own\nand element 5 is in a partition on its own.\n\nThe total penalty  can be described by the following (ugly)\nfunction:\n\nf <- function(a,M){\n   out <- 0\n   for(i in unique(a)){\n     out <- out + sum(M[which(a==i),which(a==i)])\n   }\n   return(out)\n}\n\n\nso with\n\nM <- matrix(rpois(25,3),5,5)\nM <- M+t(M)\ndiag(M) <- 0\na <- c(1,2,1,1,3)\n\nf(a,M) gives the total penalty.\n\n\nQUESTION:  how to rewrite f() so that it has no loop?\n\n\n\n\n\n\n--\nRobin Hankin\nUncertainty Analyst\nNational Oceanography Centre, Southampton\nEuropean Way, Southampton SO14 3ZH, UK\n  tel  023-8059-7743\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}