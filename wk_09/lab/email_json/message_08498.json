{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 149: make sure we don't double free in the async lock handler\n\tin http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 149\nrevision-id: tridge@samba.org-20070418052726-e7908fbec401dbef\nparent: tridge@samba.org-20070418044202-2c70b494262610cb\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Wed 2007-04-18 15:27:26 +1000\nmessage:\n  make sure we don't double free in the async lock handler\nmodified:\n  common/ctdb_ltdb.c             ctdb_ltdb.c-20061128065342-to93h6eejj5kon81-2\n=== modified file 'common/ctdb_ltdb.c'\n--- a/common/ctdb_ltdb.c\t2007-04-18 01:20:24 +0000\n+++ b/common/ctdb_ltdb.c\t2007-04-18 05:27:26 +0000\n@@ -287,6 +287,10 @@\n \t\treturn -1;\n \t}\n \n+\t/* we need to move the packet off the temporary context in ctdb_recv_pkt(),\n+\t   so it won't be freed yet */\n+\ttalloc_steal(ctdb_db, hdr);\n+\n \t/* now tell the caller than we will retry asynchronously */\n \treturn -2;\n }\n\n"}