{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jelmer@samba.org", "subject": "svn commit: samba r22697 - in branches/SAMBA_4_0/source: . build/m4\n\tlib", "body": "Author: jelmer\nDate: 2007-05-06 15:31:03 +0000 (Sun, 06 May 2007)\nNew Revision: 22697\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22697\n\nLog:\nSupport building with external talloc.\nModified:\n   branches/SAMBA_4_0/source/build/m4/public.m4\n   branches/SAMBA_4_0/source/configure.ac\n   branches/SAMBA_4_0/source/lib/basic.mk\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/build/m4/public.m4\n===================================================================\n--- branches/SAMBA_4_0/source/build/m4/public.m4\t2007-05-06 15:17:14 UTC (rev 22696)\n+++ branches/SAMBA_4_0/source/build/m4/public.m4\t2007-05-06 15:31:03 UTC (rev 22697)\n@@ -6,12 +6,14 @@\n dnl\n dnl SMB_SUBSYSTEM(name,obj_files,required_subsystems)\n dnl\n-dnl SMB_EXT_LIB_FROM_PKGCONFIG(name,pkg-config name)\n+dnl SMB_EXT_LIB_FROM_PKGCONFIG(name,pkg-config name,[ACTION-IF-FOUND],[ACTION-IF-NOT-FOUND])\n dnl\n dnl SMB_EXT_LIB(name,libs,cflags,cppflags,ldflags)\n dnl\n dnl SMB_ENABLE(name,default_build)\n dnl\n+dnl SMB_INCLUDE_MK(file)\n+dnl\n dnl #######################################################\n dnl ### And now the implementation\t\t\t###\n dnl #######################################################\n@@ -32,7 +34,7 @@\n \"\n ])\n \n-dnl SMB_EXT_LIB_FROM_PKGCONFIG(name,pkg-config name)\n+dnl SMB_EXT_LIB_FROM_PKGCONFIG(name,pkg-config name,[ACTION-IF-FOUND],[ACTION-IF-NOT-FOUND])\n AC_DEFUN([SMB_EXT_LIB_FROM_PKGCONFIG], \n [\n \tdnl Figure out the correct variables and call SMB_EXT_LIB()\n@@ -46,8 +48,10 @@\n     \t\techo \"*** in your path, or set the PKG_CONFIG environment variable\"\n     \t\techo \"*** to the full path to pkg-config.\"\n     \t\techo \"*** Or see http://www.freedesktop.org/software/pkgconfig to get pkg-config.\"\n-\t\t\tSMB_EXT_LIB($1)\n-\t\t\tSMB_ENABLE($1, NO)\n+\t\tSMB_EXT_LIB($1)\n+\t\tSMB_ENABLE($1, NO)\n+\t\t$4\n+\n \telse\n \t\tif $PKG_CONFIG --atleast-pkgconfig-version 0.9.0; then\n         \t\tAC_MSG_CHECKING(for $2)\n@@ -55,6 +59,7 @@\n           \t\tif test \"$SMB_$1\"x = \"NO\"x ; then\n \t\t\t\tSMB_ENABLE($1, NO)\n \t\t\t\tAC_MSG_RESULT(disabled)\t\t\n+\t\t\t\t$4\n           \t\telif $PKG_CONFIG --exists '$2' ; then\n             \t\t\tAC_MSG_RESULT(yes)\n \n@@ -76,22 +81,33 @@\n \t\t\t\t\t[`$PKG_CONFIG --cflags-only-other '$2'`],\n \t\t\t\t\t[`$PKG_CONFIG --cflags-only-I '$2'`],\n \t\t\t\t\t[`$PKG_CONFIG --libs-only-other '$2'` `$PKG_CONFIG --libs-only-L '$2'`])\n+\t\t\t\t$3\n \n         \t\telse\n \t\t\t\tSMB_EXT_LIB($1)\n \t\t\t\tSMB_ENABLE($1, NO)\n \t\t\t\tAC_MSG_RESULT(no)\n             \t\t\t$PKG_CONFIG --errors-to-stdout --print-errors '$2'\n+\t\t\t\t$4\n         \t\tfi\n      \t\telse\n         \t\techo \"*** Your version of pkg-config is too old. You need version $PKG_CONFIG_MIN_VERSION or newer.\"\n         \t\t\techo \"*** See http://www.freedesktop.org/software/pkgconfig\"\n \t\t\t\tSMB_EXT_LIB($1)\n \t\t\t\tSMB_ENABLE($1, NO)\n+\t\t\t\t$4\n      \t\tfi\n   \tfi\n ])\n \n+dnl SMB_INCLUDE_MK(file)\n+AC_DEFUN([SMB_INCLUDE_MK],\n+[\n+SMB_INFO_EXT_LIBS=\"$SMB_INFO_EXT_LIBS\n+include $1\n+\"\n+])\n+\n dnl SMB_EXT_LIB(name,libs,cflags,cppflags,ldflags)\n AC_DEFUN([SMB_EXT_LIB],\n [\n\nModified: branches/SAMBA_4_0/source/configure.ac\n===================================================================\n--- branches/SAMBA_4_0/source/configure.ac\t2007-05-06 15:17:14 UTC (rev 22696)\n+++ branches/SAMBA_4_0/source/configure.ac\t2007-05-06 15:31:03 UTC (rev 22697)\n@@ -25,7 +25,10 @@\n m4_include(lib/popt/samba.m4)\n m4_include(lib/charset/config.m4)\n m4_include(lib/socket/config.m4)\n-m4_include(lib/talloc/libtalloc.m4)\n+SMB_EXT_LIB_FROM_PKGCONFIG(LIBTALLOC, talloc >= 1.0, [], [\n+\tm4_include(lib/talloc/libtalloc.m4)\n+\tSMB_INCLUDE_MK(lib/talloc/config.mk)\n+])\n m4_include(lib/tdb/libtdb.m4)\n m4_include(lib/ldb/sqlite3.m4)\n m4_include(lib/ldb/libldb.m4)\n\nModified: branches/SAMBA_4_0/source/lib/basic.mk\n===================================================================\n--- branches/SAMBA_4_0/source/lib/basic.mk\t2007-05-06 15:17:14 UTC (rev 22696)\n+++ branches/SAMBA_4_0/source/lib/basic.mk\t2007-05-06 15:31:03 UTC (rev 22697)\n@@ -3,7 +3,6 @@\n include socket/config.mk\n include charset/config.mk\n include ldb/config.mk\n-include talloc/config.mk\n include tdb/config.mk\n include tls/config.mk\n include registry/config.mk\n\n"}