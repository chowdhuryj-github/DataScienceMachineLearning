{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r23234 - in\n\tbranches/SAMBA_3_0_25/packaging/Debian/debian-sarge: . patches", "body": "Author: idra\nDate: 2007-05-30 00:40:31 +0000 (Wed, 30 May 2007)\nNew Revision: 23234\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23234\n\nLog:\n\nUpdate debian-sarge packaging\n\n\nRemoved:\n   branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/undefined-symbols.patch\nModified:\n   branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/changelog\n   branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/documentation.patch\n   branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/fhs.patch\n   branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/non-linux-ports.patch\n   branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/samba.patch\n\n\nChangeset:\nModified: branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/changelog\n===================================================================\n--- branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/changelog\t2007-05-30 00:36:23 UTC (rev 23233)\n+++ branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/changelog\t2007-05-30 00:40:31 UTC (rev 23234)\n@@ -1,3 +1,34 @@\n+samba (3.0.25a-1) stable; urgency=high\n+\n+  * samba 3.0.25a Stabilizing release\n+  * Includes Security fixes release with 3.0.24a and 3.0.25\n+\n+ -- Simo Sorce   Mon, 28 May 2007 20:45:30 -0400\n+\n+samba (3.0.24-1) stable; urgency=high\n+\n+  * samba 3.0.24 Security Release\n+\n+ -- Simo Sorce   Mon, 19 Feb 2007 15:53:30 -0500\n+\n+samba (3.0.23d-1) stable; urgency=low\n+\n+  * samba 3.0.23d Samba Team Release\n+\n+ -- Simo Sorce   Fri, 17 Nov 2006 15:39:30 -0500\n+\n+samba (3.0.23c-1) stable; urgency=low\n+\n+  * samba 3.0.23c Samba Team Release\n+\n+ -- Simo Sorce   Fri, 8  Sep 2006 14:12:30 -0400\n+\n+samba (3.0.23a-1) stable; urgency=low\n+\n+  * samba 3.0.23a Samba Team Release\n+\n+ -- Simo Sorce   Tue, 1  Aug 2006 22:01:30 -0400\n+\n samba (3.0.23-1) stable; urgency=low\n \n   * samba 3.0.23 Samba Team Release\n\nModified: branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/documentation.patch\n===================================================================\n--- branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/documentation.patch\t2007-05-30 00:36:23 UTC (rev 23233)\n+++ branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/documentation.patch\t2007-05-30 00:40:31 UTC (rev 23234)\n@@ -1,66 +1,66 @@\n --- samba-3.0.4/docs/manpages/swat.8.orig\t2004-05-05 10:22:50.000000000 -0400\n +++ samba-3.0.4/docs/manpages/swat.8\t2004-05-10 13:25:53.000000000 -0400\n-@@ -80,6 +80,13 @@\n+@@ -80,4 +80,10 @@\n  .SH \"INSTALLATION\"\n- \n  .PP\n +\\fBDebian-specific Note\\fR: all these steps have already been done for\n +you. However, by default, swat is not enabled. This has been done for\n +security reasons. To enable swat you need to edit /etc/inetd.conf,\n +uncomment the swat entry (usually at the end of the file), and then\n +restart inetd.\n-+\n +.PP\n  Swat is included as binary package with most distributions\\&. The package manager in this case takes care of the installation and configuration\\&. This section is only for those who have compiled swat from scratch\\&.\n- \n  .PP\n-@@ -87,13 +94,13 @@\n- \n- .TP 3\n- \\(bu\n+@@ -87,12 +94,12 @@\n+ .TP 3n\n+ \u2022\n -/usr/local/samba/sbin/swat\n +/usr/sbin/swat\n- .TP\n- \\(bu\n+ .TP 3n\n+ \u2022\n -/usr/local/samba/swat/images/*\n +/usr/share/samba/swat/images/*\n- .TP\n- \\(bu\n+ .TP 3n\n+ \u2022\n -/usr/local/samba/swat/help/*\n +/usr/share/samba/swat/help/*\n- .LP\n- \n  .SS \"Inetd Installation\"\n-@@ -102,7 +109,7 @@\n- You need to edit your \\fI/etc/inetd\\&.conf \\fR and \\fI/etc/services\\fR to enable SWAT to be launched via \\fBinetd\\fR\\&.\n- \n  .PP\n--In \\fI/etc/services\\fR you need to add a line like this:\n-+In \\fI/etc/services\\fR you need to add a line like this (not needed for Debian):\n- \n+ You need to edit your\n+@@ -125,7 +131,7 @@\n  .PP\n+ In\n+ \\fI/etc/services\\fR\n+-you need to add a line like this:\n++you need to add a line like this (not needed for Debian):\n+ .PP\n  \\fBswat 901/tcp\\fR\n-@@ -114,10 +121,10 @@\n- the choice of port number isn't really important except that it should be less than 1024 and not currently used (using a number above 1024 presents an obscure security hole depending on the implementation details of your\\fBinetd\\fR daemon)\\&.\n- \n  .PP\n--In \\fI/etc/inetd\\&.conf\\fR you should add a line like this:\n-+In \\fI/etc/inetd\\&.conf\\fR you should add a line like this (not needed for Debian since the maintainer scripts do it automatically. You need to uncomment the line, though, because it is added commented out for security reasons):\n- \n+@@ -140,9 +146,9 @@\n  .PP\n--\\fBswat stream tcp nowait\\&.400 root /usr/local/samba/sbin/swat swat\\fR\n-+\\fBswat stream tcp nowait\\&.400 root /usr/sbin/swat swat\\fR\n- \n+ In\n+ \\fI/etc/inetd.conf\\fR\n+-you should add a line like this:\n++you should add a line like this (not needed for Debian since the maintainer scripts do it automatically. You need to uncomment the line, though, because it is added commented out for security reasons):\n  .PP\n- Once you have edited \\fI/etc/services\\fR and \\fI/etc/inetd\\&.conf\\fR you need to send a HUP signal to inetd\\&. To do this use \\fBkill \\-1 PID \\fR where PID is the process ID of the inetd daemon\\&.\n-@@ -141,8 +148,8 @@\n- This file must contain a mapping of service name (e\\&.g\\&., swat) to service port (e\\&.g\\&., 901) and protocol type (e\\&.g\\&., tcp)\\&.\n- \n- .TP\n--\\fI/usr/local/samba/lib/smb\\&.conf\\fR\n--This is the default location of the \\fBsmb\\&.conf\\fR(5) server configuration file that swat edits\\&. Other common places that systems install this file are \\fI /usr/samba/lib/smb\\&.conf\\fR and \\fI/etc/smb\\&.conf \\fR\\&. This file describes all the services the server is to make available to clients\\&.\n-+\\fI/etc/samba/smb\\&.conf\\fR\n-+This is the default location of the \\fBsmb\\&.conf\\fR(5) server configuration file that swat edits\\&. This file describes all the services the server is to make available to clients\\&.\n- \n+-\\fBswat stream tcp nowait.400 root /usr/local/samba/sbin/swat swat\\fR\n++\\fBswat stream tcp nowait.400 root /usr/sbin/swat swat\\fR\n+ .PP\n+ Once you have edited\n+ \\fI/etc/services\\fR\n+@@ -166,13 +172,13 @@\n+ .RE\n+ .PP\n+-\\fI/usr/local/samba/lib/smb.conf\\fR\n++\\fI/etc/samba/smb.conf\\fR\n+ .RS 3n\n+ This is the default location of the\n+ \\fBsmb.conf\\fR(5)\n+ server configuration file that swat edits. Other common places that systems install this file are\n+ \\fI /usr/samba/lib/smb.conf\\fR\n+ and\n+-\\fI/etc/smb.conf \\fR. This file describes all the services the server is to make available to clients.\n++\\fI/etc/samba/smb.conf \\fR. This file describes all the services the server is to make available to clients.\n+ .RE\n  .SH \"WARNINGS\"\n- \n+ .PP\n\nModified: branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/fhs.patch\n===================================================================\n--- branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/fhs.patch\t2007-05-30 00:36:23 UTC (rev 23233)\n+++ branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/fhs.patch\t2007-05-30 00:40:31 UTC (rev 23234)\n@@ -111,19 +111,6 @@\n +\treturn lp_lockdir();\n +#endif\n +}\n-diff -uNr samba-3.0.10.orig/source/groupdb/mapping.c samba-3.0.10/source/groupdb/mapping.c\n---- samba-3.0.10.orig/source/groupdb/mapping.c\t2004-12-17 03:50:08.000000000 -0800\n-+++ samba-3.0.10/source/groupdb/mapping.c\t2004-12-17 03:55:29.000000000 -0800\n-@@ -140,8 +140,8 @@\n- \t\n- \tif (tdb)\n- \t\treturn True;\n- \t\t\n--\ttdb = tdb_open_log(lock_path(\"group_mapping.tdb\"), 0, TDB_DEFAULT, O_RDWR|O_CREAT, 0600);\n-+\ttdb = tdb_open_log(state_path(\"group_mapping.tdb\"), 0, TDB_DEFAULT, O_RDWR|O_CREAT, 0600);\n- \tif (!tdb) {\n- \t\tDEBUG(0,(\"Failed to open group mapping database\\n\"));\n- \t\treturn False;\n diff -uNr samba-3.0.10.orig/source/include/dynconfig.h samba-3.0.10/source/include/dynconfig.h\n --- samba-3.0.10.orig/source/include/dynconfig.h\t2004-12-17 03:50:08.000000000 -0800\n +++ samba-3.0.10/source/include/dynconfig.h\t2004-12-17 03:55:29.000000000 -0800\n@@ -152,18 +139,6 @@\n  \tif (stat(msg_path, &st) != 0) {\n  \t\t/* the msg file isn't available */\n  \t\tDEBUG(10, (\"lang_tdb_init: %s: %s\\n\", msg_path, \n-diff -uNr samba-3.0.21.orig/source/lib/account_pol.c samba-3.0.21/source/lib/account_pol.c\n---- samba-3.0.21.orig/source/lib/account_pol.c\t2005-12-20 15:28:38.000000000 +0000\n-+++ samba-3.0.21/source/lib/account_pol.c\t2005-12-23 11:41:08.000000000 +0000\n-@@ -262,7 +262,7 @@\n- \t\treturn True;\n- \t}\n- \n--\ttdb = tdb_open_log(lock_path(\"account_policy.tdb\"), 0, TDB_DEFAULT, O_RDWR|O_CREAT, 0600);\n-+\ttdb = tdb_open_log(state_path(\"account_policy.tdb\"), 0, TDB_DEFAULT, O_RDWR|O_CREAT, 0600);\n- \tif (!tdb) {\n- \t\tDEBUG(0,(\"Failed to open account policy database\\n\"));\n- \t\treturn False;\n diff -uNr samba-3.0.10.orig/source/lib/util.c samba-3.0.10/source/lib/util.c\n --- samba-3.0.10.orig/source/lib/util.c\t2004-12-17 03:50:08.000000000 -0800\n +++ samba-3.0.10/source/lib/util.c\t2004-12-17 03:55:29.000000000 -0800\n@@ -229,32 +204,6 @@\n   * @brief Returns the platform specific shared library extension.\n   *\n   * @retval Pointer to a static #fstring containing the extension.\n-diff -uNr samba-3.0.10.orig/source/lib/util_unistr.c samba-3.0.10/source/lib/util_unistr.c\n---- samba-3.0.10.orig/source/lib/util_unistr.c\t2004-12-17 03:50:08.000000000 -0800\n-+++ samba-3.0.10/source/lib/util_unistr.c\t2004-12-17 03:55:29.000000000 -0800\n-@@ -54,11 +54,11 @@\n- \t}\n- \tinitialised = 1;\n- \n--\tupcase_table = map_file(lib_path(\"upcase.dat\"), 0x20000);\n-+\tupcase_table = map_file(data_path(\"upcase.dat\"), 0x20000);\n- \tupcase_table_use_unmap = ( upcase_table != NULL );\n- \n--\tlowcase_table = map_file(lib_path(\"lowcase.dat\"), 0x20000);\n-+\tlowcase_table = map_file(data_path(\"lowcase.dat\"), 0x20000);\n- \tlowcase_table_use_unmap = ( lowcase_table != NULL );\n- \n- #ifdef HAVE_SETLOCALE\n- \t/* Get the name of the current locale.  */\n-@@ -161,7 +161,7 @@\n- \t\treturn;\n- \t}\n- \n--\tvalid_file = map_file(lib_path(\"valid.dat\"), 0x10000);\n-+\tvalid_file = map_file(data_path(\"valid.dat\"), 0x10000);\n- \tif (valid_file) {\n- \t\tvalid_table = valid_file;\n- \t\tmapped_file = 1;\n diff -uNr samba-3.0.10.orig/source/libsmb/samlogon_cache.c samba-3.0.10/source/libsmb/samlogon_cache.c\n --- samba-3.0.10.orig/source/libsmb/samlogon_cache.c\t2004-12-17 03:50:08.000000000 -0800\n +++ samba-3.0.10/source/libsmb/samlogon_cache.c\t2004-12-17 03:55:29.000000000 -0800\n@@ -267,15 +216,6 @@\n  \t\t\t\t\t\t   TDB_DEFAULT, O_RDWR | O_CREAT, 0600);\n  \t}\n  \n-@@ -67,7 +67,7 @@\n-            winbindd_cache.tdb open.  Open the tdb if a NULL is passed. */\n- \n- \tif (!tdb) {\n--\t\ttdb = tdb_open_log(lock_path(\"winbindd_cache.tdb\"), 5000,\n-+\t\ttdb = tdb_open_log(cache_path(\"winbindd_cache.tdb\"), 5000,\n- \t\t\t\t   TDB_DEFAULT, O_RDWR, 0600);\n- \t\tif (!tdb) {\n- \t\t\tDEBUG(5, (\"netsamlogon_clear_cached_user: failed to open cache\\n\"));\n diff -uNr samba-3.0.10.orig/source/nmbd/nmbd_serverlistdb.c samba-3.0.10/source/nmbd/nmbd_serverlistdb.c\n --- samba-3.0.10.orig/source/nmbd/nmbd_serverlistdb.c\t2004-12-17 03:50:09.000000000 -0800\n +++ samba-3.0.10/source/nmbd/nmbd_serverlistdb.c\t2004-12-17 03:55:29.000000000 -0800\n@@ -321,18 +261,6 @@\n  \t\t\t\tWINBINDD_CACHE_TDB_DEFAULT_HASH_SIZE, \n  \t\t\t\tTDB_DEFAULT /*TDB_CLEAR_IF_FIRST*/, O_RDWR|O_CREAT, 0600);\n  \n-diff -uNr samba-3.0.10.orig/source/nsswitch/winbindd_util.c samba-3.0.10/source/nsswitch/winbindd_util.c\n---- samba-3.0.10.orig/source/nsswitch/winbindd_util.c\t2004-12-17 03:50:09.000000000 -0800\n-+++ samba-3.0.10/source/nsswitch/winbindd_util.c\t2004-12-17 03:55:30.000000000 -0800\n-@@ -957,7 +957,7 @@\n- \tSMB_STRUCT_STAT stbuf;\n- \tTDB_CONTEXT *idmap_tdb;\n- \n--\tpstrcpy(idmap_name, lock_path(\"winbindd_idmap.tdb\"));\n-+\tpstrcpy(idmap_name, state_path(\"winbindd_idmap.tdb\"));\n- \n- \tif (!file_exist(idmap_name, &stbuf)) {\n- \t\t/* nothing to convert return */\n diff -uNr samba-3.0.10.orig/source/param/loadparm.c samba-3.0.10/source/param/loadparm.c\n --- samba-3.0.10.orig/source/param/loadparm.c\t2004-12-17 03:50:09.000000000 -0800\n +++ samba-3.0.10/source/param/loadparm.c\t2004-12-17 03:55:30.000000000 -0800\n@@ -498,18 +426,6 @@\n  \t\treturn False;\n  \t}\n   \n-diff -uNr samba-3.0.10.orig/source/sam/idmap_tdb.c samba-3.0.10/source/sam/idmap_tdb.c\n---- samba-3.0.10.orig/source/sam/idmap_tdb.c\t2004-12-17 03:50:09.000000000 -0800\n-+++ samba-3.0.10/source/sam/idmap_tdb.c\t2004-12-17 03:55:31.000000000 -0800\n-@@ -487,7 +487,7 @@\n- \tBOOL tdb_is_new = False;\n- \n- \t/* use the old database if present */\n--\ttdbfile = SMB_STRDUP(lock_path(\"winbindd_idmap.tdb\"));\n-+\ttdbfile = SMB_STRDUP(state_path(\"winbindd_idmap.tdb\"));\n- \tif (!tdbfile) {\n- \t\tDEBUG(0, (\"idmap_init: out of memory!\\n\"));\n- \t\treturn NT_STATUS_NO_MEMORY;\n diff -uNr samba-3.0.23.orig/source/smbd/lanman.c samba-3.0.23/source/smbd/lanman.c\n --- samba-3.0.23.orig/source/smbd/lanman.c\t2006-07-15 09:50:10.000000000 -0400\n +++ samba-3.0.23/source/smbd/lanman.c\t2006-07-15 09:55:31.000000000 -0400\n@@ -525,18 +441,6 @@\n  \t\treturn 0;\n  \t}\n \n-diff -uNr samba-3.0.10.orig/source/utils/net_idmap.c samba-3.0.10/source/utils/net_idmap.c\n---- samba-3.0.10.orig/source/utils/net_idmap.c\t2004-12-17 03:50:10.000000000 -0800\n-+++ samba-3.0.10/source/utils/net_idmap.c\t2004-12-17 03:55:32.000000000 -0800\n-@@ -126,7 +126,7 @@\n- \t\treturn NT_STATUS_UNSUCCESSFUL;\n- \t}\n- \n--\ttdbfile = SMB_STRDUP(lock_path(\"winbindd_idmap.tdb\"));\n-+\ttdbfile = SMB_STRDUP(state_path(\"winbindd_idmap.tdb\"));\n- \tif (!tdbfile) {\n- \t\tDEBUG(0, (\"idmap_init: out of memory!\\n\"));\n- \t\treturn NT_STATUS_NO_MEMORY;\n diff -uNr samba-3.0.11.orig/source/printing/nt_printing.c samba-3.0.11/source/printing/nt_printing.c\n --- samba-3.0.11.orig/source/printing/nt_printing.c\t2005-03-23 02:51:08.000000000 -0800\n +++ samba-3.0.11/source/printing/nt_printing.c\t2005-03-23 02:54:33.000000000 -0800\n@@ -549,3 +453,92 @@\n  \t\tpstrcat(printdb_path, sharename);\n  \t\tpstrcat(printdb_path, \".tdb\");\n  \n+diff -uPr samba-3.0.25a.orig/source/groupdb/mapping_tdb.c samba-3.0.25a/source/groupdb/mapping_tdb.c\n+--- samba-3.0.25a.orig/source/groupdb/mapping_tdb.c\t2007-04-25 09:38:59.000000000 +0000\n++++ samba-3.0.25a/source/groupdb/mapping_tdb.c\t2007-05-29 00:28:42.000000000 +0000\n+@@ -39,7 +39,7 @@\n+ \tif (tdb)\n+ \t\treturn True;\n+ \t\t\n+-\ttdb = tdb_open_log(lock_path(\"group_mapping.tdb\"), 0, TDB_DEFAULT, O_RDWR|O_CREAT, 0600);\n++\ttdb = tdb_open_log(state_path(\"group_mapping.tdb\"), 0, TDB_DEFAULT, O_RDWR|O_CREAT, 0600);\n+ \tif (!tdb) {\n+ \t\tDEBUG(0,(\"Failed to open group mapping database\\n\"));\n+ \t\treturn False;\n+diff -uPr samba-3.0.25a.orig/source/lib/account_pol.c samba-3.0.25a/source/lib/account_pol.c\n+--- samba-3.0.25a.orig/source/lib/account_pol.c\t2007-03-01 04:54:30.000000000 +0000\n++++ samba-3.0.25a/source/lib/account_pol.c\t2007-05-29 00:21:35.000000000 +0000\n+@@ -213,9 +213,9 @@\n+ \t\treturn True;\n+ \t}\n+ \n+-\ttdb = tdb_open_log(lock_path(\"account_policy.tdb\"), 0, TDB_DEFAULT, O_RDWR, 0600);\n++\ttdb = tdb_open_log(state_path(\"account_policy.tdb\"), 0, TDB_DEFAULT, O_RDWR, 0600);\n+ \tif (!tdb) { /* the account policies files does not exist or open failed, try to create a new one */\n+-\t\ttdb = tdb_open_log(lock_path(\"account_policy.tdb\"), 0, TDB_DEFAULT, O_RDWR|O_CREAT, 0600);\n++\t\ttdb = tdb_open_log(state_path(\"account_policy.tdb\"), 0, TDB_DEFAULT, O_RDWR|O_CREAT, 0600);\n+ \t\tif (!tdb) {\n+ \t\t\tDEBUG(0,(\"Failed to open account policy database\\n\"));\n+ \t\t\treturn False;\n+diff -uPr samba-3.0.25a.orig/source/lib/util_unistr.c samba-3.0.25a/source/lib/util_unistr.c\n+--- samba-3.0.25a.orig/source/lib/util_unistr.c\t2007-03-01 04:54:30.000000000 +0000\n++++ samba-3.0.25a/source/lib/util_unistr.c\t2007-05-29 00:24:07.000000000 +0000\n+@@ -88,11 +88,11 @@\n+ \t}\n+ \tinitialised = 1;\n+ \n+-\tupcase_table = (smb_ucs2_t *)map_file(lib_path(\"upcase.dat\"),\n++\tupcase_table = (smb_ucs2_t *)map_file(data_path(\"upcase.dat\"),\n+ \t\t\t\t\t      0x20000);\n+ \tupcase_table_use_unmap = ( upcase_table != NULL );\n+ \n+-\tlowcase_table = (smb_ucs2_t *)map_file(lib_path(\"lowcase.dat\"),\n++\tlowcase_table = (smb_ucs2_t *)map_file(data_path(\"lowcase.dat\"),\n+ \t\t\t\t\t       0x20000);\n+ \tlowcase_table_use_unmap = ( lowcase_table != NULL );\n+ \n+@@ -230,7 +230,7 @@\n+ \t\treturn;\n+ \t}\n+ \n+-\tvalid_file = (uint8 *)map_file(lib_path(\"valid.dat\"), 0x10000);\n++\tvalid_file = (uint8 *)map_file(data_path(\"valid.dat\"), 0x10000);\n+ \tif (valid_file) {\n+ \t\tvalid_table = valid_file;\n+ \t\tmapped_file = 1;\n+diff -uPr samba-3.0.25a.orig/source/libsmb/samlogon_cache.c samba-3.0.25a/source/libsmb/samlogon_cache.c\n+--- samba-3.0.25a.orig/source/libsmb/samlogon_cache.c\t2007-05-10 22:09:35.000000000 +0000\n++++ samba-3.0.25a/source/libsmb/samlogon_cache.c\t2007-05-29 00:38:41.000000000 +0000\n+@@ -67,7 +67,7 @@\n+            winbindd_cache.tdb open.  Open the tdb if a NULL is passed. */\n+ \n+ \tif (!tdb) {\n+-\t\ttdb = tdb_open_log(lock_path(\"winbindd_cache.tdb\"), \n++\t\ttdb = tdb_open_log(cache_path(\"winbindd_cache.tdb\"), \n+ \t\t\t\t   WINBINDD_CACHE_TDB_DEFAULT_HASH_SIZE,\n+ \t\t\t\t   TDB_DEFAULT, O_RDWR, 0600);\n+ \t\tif (!tdb) {\n+diff -uPr samba-3.0.25a.orig/source/nsswitch/idmap_tdb.c samba-3.0.25a/source/nsswitch/idmap_tdb.c\n+--- samba-3.0.25a.orig/source/nsswitch/idmap_tdb.c\t2007-05-10 22:09:34.000000000 +0000\n++++ samba-3.0.25a/source/nsswitch/idmap_tdb.c\t2007-05-29 00:27:55.000000000 +0000\n+@@ -247,7 +247,7 @@\n+ \t}\n+ \n+ \t/* use the old database if present */\n+-\ttdbfile = talloc_strdup(ctx, lock_path(\"winbindd_idmap.tdb\"));\n++\ttdbfile = talloc_strdup(ctx, state_path(\"winbindd_idmap.tdb\"));\n+ \tif (!tdbfile) {\n+ \t\tDEBUG(0, (\"Out of memory!\\n\"));\n+ \t\tret = NT_STATUS_NO_MEMORY;\n+diff -uPr samba-3.0.25a.orig/source/passdb/pdb_tdb.c samba-3.0.25a/source/passdb/pdb_tdb.c\n+--- samba-3.0.25a.orig/source/passdb/pdb_tdb.c\t2007-03-01 04:54:41.000000000 +0000\n++++ samba-3.0.25a/source/passdb/pdb_tdb.c\t2007-05-29 00:38:41.000000000 +0000\n+@@ -1559,7 +1559,7 @@\n+ \tuint32 rid;\n+ \tBOOL ret = False;\n+ \n+-\ttdb = tdb_open_log(lock_path(\"winbindd_idmap.tdb\"), 0,\n++\ttdb = tdb_open_log(state_path(\"winbindd_idmap.tdb\"), 0,\n+ \t\t\t   TDB_DEFAULT, O_RDWR | O_CREAT, 0644);\n+ \n+ \tif (tdb == NULL) {\n\nModified: branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/non-linux-ports.patch\n===================================================================\n--- branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/non-linux-ports.patch\t2007-05-30 00:36:23 UTC (rev 23233)\n+++ branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/non-linux-ports.patch\t2007-05-30 00:40:31 UTC (rev 23234)\n@@ -47,16 +47,18 @@\n  \t\tAC_CACHE_CHECK([for linux sendfile64 support],samba_cv_HAVE_SENDFILE64,[\n  \t\tAC_TRY_LINK([#include ],\n  [\\\n-@@ -4307,10 +4319,10 @@\n+@@ -4307,12 +4319,12 @@\n  WINBIND_NSS_LDSHFLAGS=$LDSHFLAGS\n  \n  case \"$host_os\" in\n -\t*linux*)\n +\tlinux*-gnu* | gnu* | k*bsd*-gnu)\n+\t\tNSSSONAMEVERSIONSUFFIX=\".2\"\n  \t\tWINBIND_NSS_EXTRA_OBJS=\"nsswitch/winbind_nss_linux.o\"\n  \t\t;;\n -\t*freebsd[[5-9]]*)\n +\tfreebsd5*|*freebsd[[6-9]]*)\n  \t\t# FreeBSD winbind client is implemented as a wrapper around\n  \t\t# the Linux version.\n+\t\tNSSSONAMEVERSIONSUFFIX=\".1\"\n  \t\tWINBIND_NSS_EXTRA_OBJS=\"nsswitch/winbind_nss_freebsd.o \\\n\nModified: branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/samba.patch\n===================================================================\n--- branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/samba.patch\t2007-05-30 00:36:23 UTC (rev 23233)\n+++ branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/samba.patch\t2007-05-30 00:40:31 UTC (rev 23234)\n@@ -32,11 +32,11 @@\n --- samba-3.0.0beta1.orig/source/web/diagnose.c\t2003-06-07 12:57:41.000000000 -0500\n +++ samba-3.0.0beta1/source/web/diagnose.c\t2003-06-30 20:12:22.000000000 -0500\n @@ -66,6 +66,7 @@\n- \tstatic struct cli_state cli;\n- \textern struct in_addr loopback_ip;\n+ {\n+ \tstruct cli_state *cli;\n  \n +\tloopback_ip.s_addr = htonl((127 << 24) + 1);\n- \tif (!cli_initialise(&cli))\n+ \tif ((cli = cli_initialise()) == NULL)\n  \t\treturn False;\n  \n --- samba-3.0.23/source/script/installbin.sh.in.orig\t2006-07-15 09:08:36.000000000 -0400\n\nDeleted: branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/undefined-symbols.patch\n===================================================================\n--- branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/undefined-symbols.patch\t2007-05-30 00:36:23 UTC (rev 23233)\n+++ branches/SAMBA_3_0_25/packaging/Debian/debian-sarge/patches/undefined-symbols.patch\t2007-05-30 00:40:31 UTC (rev 23234)\n@@ -1,22 +0,0 @@\n-diff -uNr samba-3.0.11.orig/source/Makefile.in samba-3.0.11/source/Makefile.in\n---- samba-3.0.11.orig/source/Makefile.in\t2005-03-23 02:40:40.000000000 -0800\n-+++ samba-3.0.11/source/Makefile.in\t2005-03-23 02:48:59.000000000 -0800\n-@@ -631,7 +631,8 @@\n- \t    $(RPC_ECHO_OBJ) $(SMBLDAP_OBJ) $(IDMAP_OBJ) libsmb/spnego.o $(PASSCHANGE_OBJ)\n- \n- WINBIND_WINS_NSS_OBJ = nsswitch/wins.o $(PARAM_OBJ) \\\n--\t$(LIBSMB_OBJ) $(LIB_NONSMBD_OBJ) $(NSSWINS_OBJ) $(KRBCLIENT_OBJ)\n-+\t$(LIBSMB_OBJ) $(LIB_NONSMBD_OBJ) $(NSSWINS_OBJ) $(KRBCLIENT_OBJ) \\\n-+\t$(SECRETS_OBJ)\n- \n- WINBIND_WINS_NSS_PICOBJS = $(WINBIND_WINS_NSS_OBJ:.o=.@PICSUFFIX@)\n- \n-@@ -997,7 +998,7 @@\n- \n- bin/libsmbclient.@SHLIBEXT@: $(LIBSMBCLIENT_PICOBJS)\n- \t@echo Linking libsmbclient shared library $@\n--\t@$(SHLD) $(LDSHFLAGS) -o $@ $(LIBSMBCLIENT_PICOBJS) $(LDFLAGS) $(LIBS) \\\n-+\t@$(SHLD) $(LDSHFLAGS) -Wl,-z,defs -o $@ $(LIBSMBCLIENT_PICOBJS) $(LDFLAGS) $(LIBS) \\\n- \t\t$(KRB5LIBS) $(LDAP_LIBS) \\\n- \t\t@SONAMEFLAG@`basename $@`.$(LIBSMBCLIENT_MAJOR)\n- \n\n"}