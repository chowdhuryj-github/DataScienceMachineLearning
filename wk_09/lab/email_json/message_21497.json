{"category": "ham", "to_address": "samba-technical@lists.samba.org", "from_address": "Nik Conwell <nik@bu.edu>", "subject": "Inconsistency between groupmap \"Domain Admins\" and\n\t_lsa_add_acct_rights() checking", "body": "(I guess this could be a HOWTO bug as well.)\n\nI'm part of an AD domain.\n\nTo be considered an admin on the samba box, the howto\nhttp://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/ \ngroupmapping.html\nsays:\n\n   net groupmap add ntgroup=\"Domain Admins\" unixgroup=domadm rid=512  \ntype=d\n\nWhen I do that net groupmap list shows:\n\nDomain Admins ([LOCALSID]-512) -> domadm\n\n\nBut, when assigning privs by a member of the unix group domadm via:\n\n   net -Unik rpc rights grant joe SePrintOperatorPrivilege\n\nit ends up checking Domain Admins with the [DOMAINSID]-512.\n\nIn _lsa_add_acct_rights() if you're not root it calls  \nnt_token_check_domain_rid(), which ends up using the domain_sid.   \nBut, since my account sid includes [LOCALSID]-512 and not  \n[DOMAINSID]-512 I never get a good sid match and so get denied.\n\nCertainly, adding my groupmap \"Domain Admins\" with sid  \n[DOMAINSID]-512 is enough to get the net rpc rights grant working.\n\nI don't know enough to stipulate that groupmap add type=d should use  \nthe DOMAINSID, but it seems that way.  Or, should _lsa_add_acct_rights \n() but updated to also check the [LOCALSID]-512 sid as well as the  \n[DOMAINSID]-512 sid?\n\n-nik\n\nNik Conwell     Boston University\nnik@bu.edu\n\n"}