{"category": "ham", "to_address": "Perl Beginners <beginners@perl.org>", "from_address": "Mathew Snyder <theillien@yahoo.com>", "subject": "problem with readline", "body": "I have a script that queries a database, grabs a bunch of email addresses from\nit and generates a procmail ruleset for each of them.  It also opens a file\nwhich contains additional email address and reads them into an array:\n\nopen AUTHFILE, \"connect(\"dbi:Pg:dbname=xx;host=10.0.2.30\", \"xxxxx\", \"xxxxxx\");\nmy @email_list;\nmy $sth;\nmy @fields = qw/email email2 email3/;\n\nforeach my $field (@fields){\n    $sth = $dbh->prepare(\"\n        SELECT $field\n        FROM contacts\");\n    $sth->execute;\n    while ((my $line) = $sth->fetchrow()) {\n        if ($line){\n            if ($line !~ /^\\s+$/g){\n                push @email_list, $line;\n            }\n        }\n    }\n    $sth->finish;\n}\n\n\n#Read in people from the authorized_users.txt file in the customercare directory\n#These are email addresses that are not in OSS but are allowed to create tickets\n\nopen AUTHFILE, \") {\n    chomp;\n    next if $_ =~ m/^#/gmx;\n    push @email_list, $_;\n}\n\nprint(\"\n#This File is generated by proclmailgen.pl and should not be edited directly.\n#It will be overwritten the next time the cron job runs.\n\nVERBOSE=off\nPMDIR=\\$HOME/.procmail\nDEFAULT=/var/spool/mail/customercare\nLOGFILE=\\$PMDIR/log\nLOCKFILE        # removes any preexisting lockfile\nLOG=\\`lockfile \\$DEFAULT\\$LOCKEXT\\`\nTRAP=\\\"rm -f \\$DEFAULT\\$LOCKEXT\\\"\n\");\n\nprintf(\"\n:0 E\n* ^From.*(customercare\\@company.com)\nbadmail\n\");\n\nprintf(\"\n:0 E\n* ^Return-Path.*(customercare\\@company.com)\nbadmail\n\");\n\nprintf(\"\n:0 E\n* ^X-Loop.*(customercare\\@company.com)\nbadmail\n\");\n\nfor my $address (@email_list){\n        $address =~ s/ //g;\n        printf(\"\n:0 E\n* ^From.*(%s)\n| /usr/local/rt-3.6.0/bin/rt-mailgate --queue customercare --action correspond\n--url https://rt.company.com/\n\" , ($address));\n}\n\nprintf(\"\n:0 E\n* ^From(.*)\n| (formail -r -A\\\"X-Loop: customercare\\@company.com\\\" ; echo \\\"%s\\\") |\n/usr/sbin/sendmail -f nobounce\\@company.com -t\n\" , ($message));\n\n-- \nKeep up with me and what I'm up to: http://theillien.blogspot.com\n\n-- \nTo unsubscribe, e-mail: beginners-unsubscribe@perl.org\nFor additional commands, e-mail: beginners-help@perl.org\nhttp://learn.perl.org/\n\n\n"}