{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r22294 - in\n\tbranches/SAMBA_4_0/source/auth/gensec: .", "body": "Author: abartlet\nDate: 2007-04-17 03:49:46 +0000 (Tue, 17 Apr 2007)\nNew Revision: 22294\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22294\n\nLog:\nLock the delegated credentials to being kerberos only, we just don't\nhave the data for anything else.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\n===================================================================\n--- branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\t2007-04-17 03:49:08 UTC (rev 22293)\n+++ branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\t2007-04-17 03:49:46 UTC (rev 22294)\n@@ -1339,6 +1339,8 @@\n \t\t}\n \n \t\tcli_credentials_set_conf(session_info->credentials);\n+\t\t/* Just so we don't segfault trying to get at a username */\n+\t\tcli_credentials_set_anonymous(session_info->credentials);\n \t\t\n \t\tret = cli_credentials_set_client_gss_creds(session_info->credentials, \n \t\t\t\t\t\t\t   gensec_gssapi_state->delegated_cred_handle,\n@@ -1347,6 +1349,10 @@\n \t\t\ttalloc_free(mem_ctx);\n \t\t\treturn NT_STATUS_NO_MEMORY;\n \t\t}\n+\t\t\n+\t\t/* This credential handle isn't useful for password authentication, so ensure nobody tries to do that */\n+\t\tcli_credentials_set_kerberos_state(session_info->credentials, CRED_MUST_USE_KERBEROS);\n+\n \t\t/* It has been taken from this place... */\n \t\tgensec_gssapi_state->delegated_cred_handle = GSS_C_NO_CREDENTIAL;\n \t}\n\n"}