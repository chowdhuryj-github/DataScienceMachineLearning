{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23198 - in branches/SAMBA_3_0_26/source: passdb\n\tregistry utils", "body": "Author: jerry\nDate: 2007-05-29 14:18:17 +0000 (Tue, 29 May 2007)\nNew Revision: 23198\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23198\n\nLog:\ncherry pick more patches from SAMBA_3_0\nModified:\n   branches/SAMBA_3_0_26/source/passdb/machine_sid.c\n   branches/SAMBA_3_0_26/source/registry/reg_objects.c\n   branches/SAMBA_3_0_26/source/utils/net_ads.c\n   branches/SAMBA_3_0_26/source/utils/pdbedit.c\n   branches/SAMBA_3_0_26/source/utils/smbcacls.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/passdb/machine_sid.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/passdb/machine_sid.c\t2007-05-29 14:09:46 UTC (rev 23197)\n+++ branches/SAMBA_3_0_26/source/passdb/machine_sid.c\t2007-05-29 14:18:17 UTC (rev 23198)\n@@ -220,6 +220,5 @@\n \n \tsid_copy(&dom_sid, sid);\n \tsid_split_rid(&dom_sid, &rid);\n-\t\n-\treturn sid_equal(&dom_sid, get_global_sam_sid());\n+\treturn sid_check_is_domain(&dom_sid);\n }\n\nModified: branches/SAMBA_3_0_26/source/registry/reg_objects.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/registry/reg_objects.c\t2007-05-29 14:09:46 UTC (rev 23197)\n+++ branches/SAMBA_3_0_26/source/registry/reg_objects.c\t2007-05-29 14:18:17 UTC (rev 23198)\n@@ -73,7 +73,7 @@\n }\n  \n  /***********************************************************************\n- Add a new key to the array\n+ Delete a key from the array\n  **********************************************************************/\n \n int regsubkey_ctr_delkey( REGSUBKEY_CTR *ctr, const char *keyname )\n\nModified: branches/SAMBA_3_0_26/source/utils/net_ads.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/net_ads.c\t2007-05-29 14:09:46 UTC (rev 23197)\n+++ branches/SAMBA_3_0_26/source/utils/net_ads.c\t2007-05-29 14:18:17 UTC (rev 23198)\n@@ -1369,10 +1369,10 @@\n \t\tstatus = ads_dns_lookup_ns( ctx, root_domain, &nameservers, &ns_count );\n \t\t\n \t\tif ( !NT_STATUS_IS_OK(status) || (ns_count == 0)) {\t\t\t\n-\t\tDEBUG(3,(\"net_ads_join: Failed to find name server for the %s \"\n+\t\t\tDEBUG(3,(\"net_ads_join: Failed to find name server for the %s \"\n \t\t\t \"realm\\n\", ads->config.realm));\n-\t\tgoto done;\n-\t}\n+\t\t\tgoto done;\n+\t\t}\n \n \t\tdnsdomain = root_domain;\t\t\n \t\t\n\nModified: branches/SAMBA_3_0_26/source/utils/pdbedit.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/pdbedit.c\t2007-05-29 14:09:46 UTC (rev 23197)\n+++ branches/SAMBA_3_0_26/source/utils/pdbedit.c\t2007-05-29 14:18:17 UTC (rev 23198)\n@@ -761,6 +761,7 @@\n \tstatic char *pwd_time_format = NULL;\n \tstatic BOOL pw_from_stdin = False;\n \tstruct pdb_methods *bin, *bout, *bdef;\n+\tchar *configfile = NULL;\n \tpoptContext pc;\n \tstruct poptOption long_options[] = {\n \t\tPOPT_AUTOHELP\n@@ -818,6 +819,9 @@\n \t\tcase 'C':\n \t\t\taccount_policy_value_set = True;\n \t\t\tbreak;\n+\t\tcase 's':\n+\t\t\tconfigfile = optarg;\n+\t\t\tbreak;\n \t\t}\n \t}\n \n\nModified: branches/SAMBA_3_0_26/source/utils/smbcacls.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/smbcacls.c\t2007-05-29 14:09:46 UTC (rev 23197)\n+++ branches/SAMBA_3_0_26/source/utils/smbcacls.c\t2007-05-29 14:18:17 UTC (rev 23198)\n@@ -381,7 +381,7 @@\n \tfstring tok;\n \tSEC_DESC *ret = NULL;\n \tsize_t sd_size;\n-\tDOM_SID *group_sid=NULL, *owner_sid=NULL;\n+\tDOM_SID *grp_sid=NULL, *owner_sid=NULL;\n \tSEC_ACL *dacl=NULL;\n \tint revision=1;\n \n@@ -407,13 +407,13 @@\n \t\t}\n \n \t\tif (strncmp(tok,\"GROUP:\", 6) == 0) {\n-\t\t\tif (group_sid) {\n+\t\t\tif (grp_sid) {\n \t\t\t\tprintf(\"Only specify group once\\n\");\n \t\t\t\tgoto done;\n \t\t\t}\n-\t\t\tgroup_sid = SMB_CALLOC_ARRAY(DOM_SID, 1);\n-\t\t\tif (!group_sid ||\n-\t\t\t    !StringToSid(group_sid, tok+6)) {\n+\t\t\tgrp_sid = SMB_CALLOC_ARRAY(DOM_SID, 1);\n+\t\t\tif (!grp_sid ||\n+\t\t\t    !StringToSid(grp_sid, tok+6)) {\n \t\t\t\tprintf(\"Failed to parse group sid\\n\");\n \t\t\t\tgoto done;\n \t\t\t}\n@@ -436,11 +436,11 @@\n \t\tgoto done;\n \t}\n \n-\tret = make_sec_desc(ctx,revision, SEC_DESC_SELF_RELATIVE, owner_sid, group_sid, \n+\tret = make_sec_desc(ctx,revision, SEC_DESC_SELF_RELATIVE, owner_sid, grp_sid, \n \t\t\t    NULL, dacl, &sd_size);\n \n   done:\n-\tSAFE_FREE(group_sid);\n+\tSAFE_FREE(grp_sid);\n \tSAFE_FREE(owner_sid);\n \n \treturn ret;\n@@ -738,7 +738,7 @@\n \t   and W2K. JRA.\n \t*/\n \n-\tsd = make_sec_desc(ctx,old->revision, old->type, old->owner_sid, old->group_sid,\n+\tsd = make_sec_desc(ctx,old->revision, old->type, old->owner_sid, old->grp_sid,\n \t\t\t   NULL, old->dacl, &sd_size);\n \n \tfnum = cli_nt_create(cli, filename, WRITE_DAC_ACCESS|WRITE_OWNER_ACCESS);\n\n"}