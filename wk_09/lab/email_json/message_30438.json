{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "derrell@samba.org", "subject": "svn commit: samba r22915 - in branches/SAMBA_3_0_25:\n\texamples/libsmbclient source/libsmb", "body": "Author: derrell\nDate: 2007-05-15 19:14:34 +0000 (Tue, 15 May 2007)\nNew Revision: 22915\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22915\n\nLog:\n\n- Fixes bug 4599.  A missing if statement forced subseqeuent\n  attempts to set attributes to fail.\n\n- I also noticed that missing attributes were setting an invalid return string\n  by getxattr(), e.g. if there was not group, the return string had \"GROUP:;\"\n  instead of excluding the GROUP attribute entirely as it should.  The big\n  problem with the way it was, is that the string could not then be passed to\n  setxattr() and parsed.\n\nModified:\n   branches/SAMBA_3_0_25/examples/libsmbclient/Makefile\n   branches/SAMBA_3_0_25/source/libsmb/libsmbclient.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_25/examples/libsmbclient/Makefile\n===================================================================\n--- branches/SAMBA_3_0_25/examples/libsmbclient/Makefile\t2007-05-15 19:10:29 UTC (rev 22914)\n+++ branches/SAMBA_3_0_25/examples/libsmbclient/Makefile\t2007-05-15 19:14:34 UTC (rev 22915)\n@@ -17,6 +17,7 @@\n TESTS=\ttestsmbc \\\n \ttree \\\n \ttestacl \\\n+\ttestacl2 \\\n \ttestbrowse \\\n \ttestbrowse2 \\\n \tteststat \\\n@@ -39,6 +40,10 @@\n \t@echo Linking testacl\n \t$(CC) `gtk-config --cflags` $(CFLAGS) $(LDFLAGS) -o $@ $< `gtk-config --libs` $(LIBSMBCLIENT) -lpopt\n \n+testacl2: testacl2.o\n+\t@echo Linking testacl2\n+\t$(CC) `gtk-config --cflags` $(CFLAGS) $(LDFLAGS) -o $@ $< `gtk-config --libs` $(LIBSMBCLIENT) -lpopt\n+\n testbrowse: testbrowse.o\n \t@echo Linking testbrowse\n \t$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $< $(LIBSMBCLIENT) -lpopt\n\nModified: branches/SAMBA_3_0_25/source/libsmb/libsmbclient.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/libsmb/libsmbclient.c\t2007-05-15 19:10:29 UTC (rev 22914)\n+++ branches/SAMBA_3_0_25/source/libsmb/libsmbclient.c\t2007-05-15 19:14:34 UTC (rev 22915)\n@@ -4556,7 +4556,7 @@\n                                                 return -1;\n                                         }\n                                         n = strlen(p);\n-                                } else {\n+                                } else if (sidstr[0] != '\\0') {\n                                         n = snprintf(buf, bufsize,\n                                                      \",OWNER:%s\", sidstr);\n                                 }\n@@ -4601,7 +4601,7 @@\n                                                 return -1;\n                                         }\n                                         n = strlen(p);\n-                                } else {\n+                                } else if (sidstr[0] != '\\0') {\n                                         n = snprintf(buf, bufsize,\n                                                      \",GROUP:%s\", sidstr);\n                                 }\n@@ -5327,7 +5327,9 @@\n                 ipc_srv = smbc_attr_server(context, server, share,\n                                            workgroup, user, password,\n                                            &pol);\n-                srv->no_nt_session = True;\n+                if (! ipc_srv) {\n+                        srv->no_nt_session = True;\n+                }\n         } else {\n                 ipc_srv = NULL;\n         }\n@@ -5752,7 +5754,9 @@\n                 ipc_srv = smbc_attr_server(context, server, share,\n                                            workgroup, user, password,\n                                            &pol);\n-                srv->no_nt_session = True;\n+                if (! ipc_srv) {\n+                        srv->no_nt_session = True;\n+                }\n         } else {\n                 ipc_srv = NULL;\n         }\n\n"}