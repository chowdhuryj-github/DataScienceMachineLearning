{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 326: removed obsolete ctdb_dump tool in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 326\nrevision-id: tridge@samba.org-20070519040701-3yay8tnb8wvo2vmr\nparent: tridge@samba.org-20070519040448-1noxp9bh4mer11zr\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-05-19 14:07:01 +1000\nmessage:\n  removed obsolete ctdb_dump tool\nremoved:\n  tools/ctdb_dump.c              ctdb_dump.c-20070422072106-vavpof4y9zz8z2lh-1\nmodified:\n  Makefile.in                    makefile.in-20061117234101-o3qt14umlg9en8z0-1\n=== removed file 'tools/ctdb_dump.c'\n--- a/tools/ctdb_dump.c\t2007-04-22 14:53:09 +0000\n+++ b/tools/ctdb_dump.c\t1970-01-01 00:00:00 +0000\n@@ -1,131 +0,0 @@\n-/* \n-   ctdb status tool\n-\n-   Copyright (C) Andrew Tridgell  2007\n-\n-   This library is free software; you can redistribute it and/or\n-   modify it under the terms of the GNU Lesser General Public\n-   License as published by the Free Software Foundation; either\n-   version 2 of the License, or (at your option) any later version.\n-\n-   This library is distributed in the hope that it will be useful,\n-   but WITHOUT ANY WARRANTY; without even the implied warranty of\n-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-   Lesser General Public License for more details.\n-\n-   You should have received a copy of the GNU Lesser General Public\n-   License along with this library; if not, write to the Free Software\n-   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n-*/\n-\n-#include \"includes.h\"\n-#include \"lib/events/events.h\"\n-#include \"system/filesys.h\"\n-#include \"popt.h\"\n-#include \"cmdline.h\"\n-#include \"../include/ctdb_private.h\"\n-#include \"db_wrap.h\"\n-\n-\n-/*\n-  show usage message\n- */\n-static void usage(void)\n-{\n-\tprintf(\"Usage: ctdb_dump \\n\");\n-\texit(1);\n-}\n-\n-struct node_info {\n-\tuint32_t num_nodes;\n-\tuint32_t vnn;\n-};\n-\n-static int traverse_fn(struct tdb_context *tdb, TDB_DATA key, TDB_DATA data, void *p)\n-{\n-\tstruct node_info *info = (struct node_info *)p;\n-\tstruct id {\n-\t\tdev_t dev;\n-\t\tino_t inode;\n-\t} *id;\n-\tstruct ctdb_ltdb_header *h = (struct ctdb_ltdb_header *)data.dptr;\n-\tchar *keystr;\n-\tuint32_t lmaster;\n-\tint authoritative=0;\n-\n-\tlmaster = ctdb_hash(&key) % info->num_nodes;\n-\n-\tid = (struct id *)key.dptr;\n-\tif (key.dsize == sizeof(*id)) {\n-\t\tkeystr = talloc_asprintf(NULL, \"%llu:%llu\", \n-\t\t\t\t\t (uint64_t)id->dev, (uint64_t)id->inode);\n-\t} else {\n-\t\tkeystr = hex_encode(NULL, key.dptr, key.dsize);\n-\t}\n-\tauthoritative = (info->vnn == lmaster || info->vnn == h->dmaster);\n-\tprintf(\"  rec %s lmaster=%u dmaster=%u %c\\n\", \n-\t       keystr, \n-\t       lmaster,\n-\t       h->dmaster,\n-\t       authoritative?'A':' ');\n-\ttalloc_free(keystr);\n-\treturn 0;\n-}\n-\n-/*\n-  main program\n-*/\n-int main(int argc, const char *argv[])\n-{\n-\tstruct poptOption popt_options[] = {\n-\t\tPOPT_AUTOHELP\n-\t\tPOPT_CTDB_CMDLINE\n-\t\tPOPT_TABLEEND\n-\t};\n-\tint opt;\n-\tconst char **extra_argv;\n-\tint i, extra_argc = 0;\n-\tpoptContext pc;\n-\tstruct tdb_wrap *db;\n-\tstruct node_info info;\t\n-\n-\tpc = poptGetContext(argv[0], argc, argv, popt_options, POPT_CONTEXT_KEEP_FIRST);\n-\n-\twhile ((opt = poptGetNextOpt(pc)) != -1) {\n-\t\tswitch (opt) {\n-\t\tdefault:\n-\t\t\tfprintf(stderr, \"Invalid option %s: %s\\n\", \n-\t\t\t\tpoptBadOption(pc, 0), poptStrerror(opt));\n-\t\t\texit(1);\n-\t\t}\n-\t}\n-\n-\t/* setup the remaining options for the main program to use */\n-\textra_argv = poptGetArgs(pc);\n-\tif (extra_argv) {\n-\t\textra_argv++;\n-\t\twhile (extra_argv[extra_argc]) extra_argc++;\n-\t}\n-\n-\tif (extra_argc < 1) {\n-\t\tusage();\n-\t}\n-\n-\tfor (i=0;itdb, traverse_fn, &info);\n-\t\t\n-\t\ttalloc_free(db);\n-\t}\n-\n-\treturn 0;\n-}\n\n=== modified file 'Makefile.in'\n--- a/Makefile.in\t2007-05-18 09:19:35 +0000\n+++ b/Makefile.in\t2007-05-19 04:07:01 +0000\n@@ -38,7 +38,7 @@\n \n OBJS = @TDB_OBJ@ @TALLOC_OBJ@ @LIBREPLACEOBJ@ @INFINIBAND_WRAPPER_OBJ@ $(EXTRA_OBJ) @EVENTS_OBJ@ $(CTDB_OBJ) $(UTIL_OBJ)\n \n-BINS = bin/ctdbd bin/ctdbd_test bin/ctdb_test bin/ctdb_bench bin/ctdb_messaging bin/ctdb_fetch bin/ctdb_fetch1 bin/lockwait bin/ctdb_control bin/ctdb_dump @INFINIBAND_BINS@\n+BINS = bin/ctdbd bin/ctdbd_test bin/ctdb_test bin/ctdb_bench bin/ctdb_messaging bin/ctdb_fetch bin/ctdb_fetch1 bin/lockwait bin/ctdb_control @INFINIBAND_BINS@\n \n DIRS = lib bin\n \n@@ -69,10 +69,6 @@\n \t@echo Linking $@\n \t@$(CC) $(CFLAGS) -o $@ tools/ctdb_control.o $(OBJS) $(LIB_FLAGS)\n \n-bin/ctdb_dump: $(OBJS) tools/ctdb_dump.o \n-\t@echo Linking $@\n-\t@$(CC) $(CFLAGS) -o $@ tools/ctdb_dump.o $(OBJS) $(LIB_FLAGS)\n-\n bin/ctdbd_test: $(OBJS) direct/ctdbd_test.o\n \t@echo Linking $@\n \t@$(CC) $(CFLAGS) -o $@ direct/ctdbd_test.o \n\n"}