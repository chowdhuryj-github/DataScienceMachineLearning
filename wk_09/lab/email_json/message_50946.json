{"category": "ham", "to_address": "Jeremy Allison <jra@samba.org>", "from_address": "Todd Stecher <todd.stecher@isilon.com>", "subject": "Re: Problem with DELETE_ON_CLOSE open_file_ntcreate()?", "body": "\nOn Jun 19, 2007, at 11:25 AM, Jeremy Allison wrote:\n\n> On Tue, Jun 19, 2007 at 11:21:52AM -0700, Todd wrote:\n>>\n>> I'm hesitant to \"fix\" this (e.g. set the lock->delete_on_close bit\n>> when we see the FILE_DELETE_ON_CLOSE option), because there might be\n>> some subtlety I'm missing here.\n>\n> Another FYI: There is a subtlety here. Allowing setting the\n> delete on close semantics on open is different to setting\n> the delete on close semantics on an already open handle.\n>\n\nSure - isn't this the \"SET_FILE_INFO\" variant for an already open  \nhandle?  In this case, I'm opening an existing file directly for the  \nfirst time.\n\n\n\n> The logic in SAMBA_3_0_25 is (I believe) correct. Once you've\n> patched your 3.0.24 run the latest Samba4 smbtorture against it\n> to make sure you've got the changes correct.\n>\n\nThanks - it turns out that when  you use a creation_disposition of  \nFILE_OPEN, then info == FILE_WAS_OPENED - this results in a failure  \nto check the FILE_DELETE_ON_CLOSE bit in the 3.0.24 codebase - as I  \nmentioned, we can't upgrade, so I think I'll have to hack this  \ntogether and run smbtorture.\n\nUnfortunately, due to our FS related divergence from the codebase, a  \nnumber of smbtorture tests fail - which would you recommend as most  \npertinent in this case?\n\n\n\n\n\n\n> Jeremy.\n\nThanks!\n\n\nTodd Stecher | Windows Interop Dev\nIsilon Systems    P +1-206-315-7500     F  +1-206-315-7501\nwww.isilon.com    D +1-206-315-7638    M +1-425-205-1180\n\n\n\n"}