{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23428 - in\n\tbranches/SAMBA_3_0_26/source/registry: .", "body": "Author: obnox\nDate: 2007-06-12 10:02:08 +0000 (Tue, 12 Jun 2007)\nNew Revision: 23428\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23428\n\nLog:\nMerge r19828 from 3_0: Add registry_fetch_values.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0_26/source/registry/reg_frontend.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/registry/reg_frontend.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/registry/reg_frontend.c\t2007-06-12 09:12:29 UTC (rev 23427)\n+++ branches/SAMBA_3_0_26/source/registry/reg_frontend.c\t2007-06-12 10:02:08 UTC (rev 23428)\n@@ -263,7 +263,63 @@\n \treturn result;\n }\n \n+NTSTATUS registry_fetch_values(TALLOC_CTX *mem_ctx, REGISTRY_KEY *key,\n+\t\t\t       uint32 *pnum_values, char ***pnames,\n+\t\t\t       struct registry_value ***pvalues)\n+{\n+\tREGVAL_CTR *ctr;\n+\tchar **names;\n+\tstruct registry_value **values;\n+\tuint32 i;\n \n+\tif (!(ctr = TALLOC_ZERO_P(mem_ctx, REGVAL_CTR))) {\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n+\tif (fetch_reg_values(key, ctr) == -1) {\n+\t\tTALLOC_FREE(ctr);\n+\t\treturn NT_STATUS_INVALID_PARAMETER;\n+\t}\n+\n+\tif (ctr->num_values == 0) {\n+\t\t*pnum_values = 0;\n+\t\tTALLOC_FREE(ctr);\n+\t\treturn NT_STATUS_OK;\n+\t}\n+\n+\tif ((!(names = TALLOC_ARRAY(ctr, char *, ctr->num_values))) ||\n+\t    (!(values = TALLOC_ARRAY(ctr, struct registry_value *,\n+\t\t\t\t     ctr->num_values)))) {\n+\t\tTALLOC_FREE(ctr);\n+\t\treturn NT_STATUS_NO_MEMORY;\n+\t}\n+\n+\tfor (i=0; inum_values; i++) {\n+\t\tREGISTRY_VALUE *val = ctr->values[i];\n+\t\tNTSTATUS status;\n+\n+\t\tif (!(names[i] = talloc_strdup(names, val->valuename))) {\n+\t\t\tTALLOC_FREE(ctr);\n+\t\t\treturn NT_STATUS_NO_MEMORY;\n+\t\t}\n+\n+\t\tstatus = registry_pull_value(values, &values[i],\n+\t\t\t\t\t     val->type, val->data_p,\n+\t\t\t\t\t     val->size, val->size);\n+\t\tif (!NT_STATUS_IS_OK(status)) {\n+\t\t\tTALLOC_FREE(ctr);\n+\t\t\treturn status;\n+\t\t}\n+\t}\n+\n+\t*pnum_values = ctr->num_values;\n+\t*pnames = talloc_move(mem_ctx, &names);\n+\t*pvalues = talloc_move(mem_ctx, &values);\n+\n+\tTALLOC_FREE(ctr);\n+\treturn NT_STATUS_OK;\n+}\n+\n /***********************************************************************\n  retreive a specific subkey specified by index.  Caller is \n  responsible for freeing memory\n\n"}