{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r22655 - in branches: SAMBA_3_0/source/libsmb\n\tSAMBA_3_0_25/source/libsmb", "body": "Author: gd\nDate: 2007-05-03 20:12:00 +0000 (Thu, 03 May 2007)\nNew Revision: 22655\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22655\n\nLog:\nCall correct free-macros in netsamlogon_cache_get() error paths. Forgot those\nin the previous commit.\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/libsmb/samlogon_cache.c\n   branches/SAMBA_3_0_25/source/libsmb/samlogon_cache.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libsmb/samlogon_cache.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/samlogon_cache.c\t2007-05-03 17:05:25 UTC (rev 22654)\n+++ branches/SAMBA_3_0/source/libsmb/samlogon_cache.c\t2007-05-03 20:12:00 UTC (rev 22655)\n@@ -193,7 +193,6 @@\n \t\n \tif ( data.dptr ) {\n \n-\n \t\tuser = TALLOC_ZERO_P(mem_ctx, NET_USER_INFO_3);\n \t\tif (user == NULL) {\n \t\t\treturn NULL;\n@@ -204,12 +203,12 @@\n \t\t\n \t\tif ( !prs_uint32( \"timestamp\", &ps, 0, &t ) ) {\n \t\t\tprs_mem_free( &ps );\n-\t\t\tSAFE_FREE(user);\n+\t\t\tTALLOC_FREE(user);\n \t\t\treturn False;\n \t\t}\n \t\t\n \t\tif ( !net_io_user_info3(\"\", user, &ps, 0, 3, 0) ) {\n-\t\t\tSAFE_FREE( user );\n+\t\t\tTALLOC_FREE( user );\n \t\t}\n \t\t\t\n \t\tprs_mem_free( &ps );\n@@ -228,7 +227,7 @@\n \t\tif ( (time_diff < 0 ) || (time_diff > lp_winbind_cache_time()) ) {\n \t\t\tDEBUG(10,(\"netsamlogon_cache_get: cache entry expired \\n\"));\n \t\t\ttdb_delete( netsamlogon_tdb, key );\n-\t\t\tSAFE_FREE( user );\n+\t\t\tTALLOC_FREE( user );\n \t\t}\n #endif\n \t}\n\nModified: branches/SAMBA_3_0_25/source/libsmb/samlogon_cache.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/libsmb/samlogon_cache.c\t2007-05-03 17:05:25 UTC (rev 22654)\n+++ branches/SAMBA_3_0_25/source/libsmb/samlogon_cache.c\t2007-05-03 20:12:00 UTC (rev 22655)\n@@ -195,7 +195,6 @@\n \t\n \tif ( data.dptr ) {\n \n-\n \t\tuser = TALLOC_ZERO_P(mem_ctx, NET_USER_INFO_3);\n \t\tif (user == NULL) {\n \t\t\treturn NULL;\n@@ -206,12 +205,12 @@\n \t\t\n \t\tif ( !prs_uint32( \"timestamp\", &ps, 0, &t ) ) {\n \t\t\tprs_mem_free( &ps );\n-\t\t\tSAFE_FREE(user);\n+\t\t\tTALLOC_FREE(user);\n \t\t\treturn False;\n \t\t}\n \t\t\n \t\tif ( !net_io_user_info3(\"\", user, &ps, 0, 3, 0) ) {\n-\t\t\tSAFE_FREE( user );\n+\t\t\tTALLOC_FREE( user );\n \t\t}\n \t\t\t\n \t\tprs_mem_free( &ps );\n@@ -230,7 +229,7 @@\n \t\tif ( (time_diff < 0 ) || (time_diff > lp_winbind_cache_time()) ) {\n \t\t\tDEBUG(10,(\"netsamlogon_cache_get: cache entry expired \\n\"));\n \t\t\ttdb_delete( netsamlogon_tdb, key );\n-\t\t\tSAFE_FREE( user );\n+\t\t\tTALLOC_FREE( user );\n \t\t}\n #endif\n \t}\n\n"}