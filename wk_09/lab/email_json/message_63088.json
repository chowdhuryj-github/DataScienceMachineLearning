{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23729 - in\n\tbranches/SAMBA_3_0_26/source/nsswitch: .", "body": "Author: jerry\nDate: 2007-07-05 19:55:25 +0000 (Thu, 05 Jul 2007)\nNew Revision: 23729\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23729\n\nLog:\nSquashed commit of the following:\n\ncommit 3941269fa01038fca242a197e8d7c1f234d45ea7\nAuthor: Gerald (Jerry) Carter \nDate:   Thu Jul 5 14:52:03 2007 -0500\n\n    Two fixes for \"winbind expand groups\".\n\n    (a) Update the counter for the number of new groups to resolve else\n        we'll only expand one group member per level and drop the rest.\n    (b) Don't reset the num_names counter in winbindd_ads.c:lookup_groupmem()\n        or we'll drop the SIDs resolved to names via cache from the resulting\n        list.\n\nModified:\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_ads.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_group.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_ads.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_ads.c\t2007-07-05 18:28:18 UTC (rev 23728)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_ads.c\t2007-07-05 19:55:25 UTC (rev 23729)\n@@ -1017,7 +1017,11 @@\n \t\t\tDEBUG(10,(\"ads: lookup_groupmem: got sid %s from cache\\n\",\n \t\t\t\t sid_string_static(&sid)));\n \t\t\tsid_copy(&(*sid_mem)[*num_names], &sid);\n-\t\t\t(*names)[*num_names] = CONST_DISCARD(char *,name);\n+\t\t\t(*names)[*num_names] = talloc_asprintf(*names, \"%s%c%s\",\n+\t\t\t\t\t\t\t       domain_name,\n+\t\t\t\t\t\t\t       *lp_winbind_separator(),\n+\t\t\t\t\t\t\t       name );\n+\n \t\t\t(*name_types)[*num_names] = name_type;\n \t\t\t(*num_names)++;\n \t\t}\n@@ -1055,7 +1059,6 @@\n \t\t\t/* Copy the entries over from the \"_nocache\" arrays \n \t\t\t * to the result arrays, skipping the gaps the \n \t\t\t * lookup_sids call left. */\n-\t\t\t*num_names = 0;\n \t\t\tfor (i=0; i < num_nocache; i++) {\n \t\t\t\tif (((names_nocache)[i] != NULL) && \n \t\t\t\t    ((name_types_nocache)[i] != SID_NAME_UNKNOWN)) \n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_group.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_group.c\t2007-07-05 18:28:18 UTC (rev 23728)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_group.c\t2007-07-05 19:55:25 UTC (rev 23729)\n@@ -576,6 +576,7 @@\n \t\t/* One more round */\n \t\tTALLOC_FREE(glist);\n \t\tglist = new_glist;\n+\t\tn_glist = n_new_glist;\n \t}\n \tTALLOC_FREE( glist );\t\n \t \n\n"}