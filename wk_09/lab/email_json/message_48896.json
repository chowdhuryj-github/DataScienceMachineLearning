{"category": "ham", "to_address": "Zack Kirsch <zack.kirsch@isilon.com>", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: Small fix to remove invalid byte range locks", "body": "On Fri, Jun 15, 2007 at 04:34:30PM -0700, Zack Kirsch wrote:\n> Hi Volker and samba-tech,\n> \n>  \n> \n> This is a small bug that we noticed while working on some byte range\n> locking code. This patch sets the modified bit on the byte_range_lock\n> struct, if validate_lock_entries() has changed the pplocks parameter\n> passed in (i.e. removed some invalid locks.)  With the modified bit set,\n> the byte_range_lock_destructor() should commit the modifications, by\n> calling tdb_store().\n> \n>  \n> \n> You could argue that perhaps this is done by design, but it seems that\n> if Samba is going to go through the effort to find invalid byte range\n> locks, it should remove them as well.\n> \n>  \n> \n> As a warning, I haven't had time to test this code path. The bug was\n> originally found and fixed by Spie Rudoff (spie_rudoff@isilon.com).\n\nPerfectly correct - thanks for catching this. That was the original\nintent behind that code but somehow the modified flag didn't get set.\n\nThis should fix some outstanding bugs I'm aware of (but could not\npreviously reproduce).\n\nThanks a *lot*.\n\nJeremy.\n\n"}