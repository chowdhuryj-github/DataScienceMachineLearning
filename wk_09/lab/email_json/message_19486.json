{"category": "ham", "to_address": "Usman Shehu <ugulumbe@yahoo.co.uk>", "from_address": "Gavin Simpson <gavin.simpson@ucl.ac.uk>", "subject": "Re: [R] Too slow to execute!", "body": "On Sun, 2007-04-29 at 06:56 -0700, Usman Shehu wrote:\n> Greetings,\n> I have the following simple function but what worries me is that it\n> takes about  5 or more minutes to execute. My machine runs on windows\n> with 1.8GHz and 256 Ram.\n> > Re=NULL\n> > for(i in 1:100000){\n> + x=rnorm(20)\n> + Re[i]=(x-2*10)/20\n> + Re\n> + }\n> I would appreciate any help on how to make it faster.\n> \n> Usman\n\nIt is not clear exactly what you want to do, but taking what you wrote\nliterally, there are 3 problems that I see:\n\n     1. You haven't allocated sufficient storage space for 'Re'. As\n        such, at each loop, R has to copy and enlarge the object which\n        take a all the time.\n     2. The result of (x-2*10)/20 is a vector of length 20, which you\n        are trying to force into the space for a vector of length 1\n     3. In a loop like this, the last line containing just 'Re' does\n        nothing. If you want 'Re' printed to the console, then you need\n        to wrap it in print. Quite why you'd want 'Re' flashing up on\n        the screen 100 000 times is beyond me...\n\nFixing each of these gives:\n\n## number of permutations\nn.perm <- 100000\n## storage space for a 100 000 x 20 matrix\nRe <- matrix(ncol = 20, nrow = n.perm)\n## set up loop\nfor(i in seq_len(n.perm)) {\n   x <- rnorm(20)\n   ## store in a row of Re\n   Re[i,] <- (x-2*10)/20\n}\n\nTiming this shows that it runs in 3.5 seconds on my desktop - which has\nsimilar processor but a lot more RAM:\n\n> system.time({\n+ n.perm <- 100000\n+ Re <- matrix(ncol = 20, nrow = n.perm)\n+ for(i in seq_len(n.perm)) {\n+    x <- rnorm(20)\n+    Re[i,] <- (x-2*10)/20\n+ }\n+ })\n   user  system elapsed\n  3.336   0.056   3.394\n\nHTH\n\nG\n-- \n%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%\nGavin Simpson                     [t] +44 (0)20 7679 0522\nECRC                              [f] +44 (0)20 7679 0565\nUCL Department of Geography\nPearson Building                  [e] gavin.simpsonATNOSPAMucl.ac.uk\nGower Street\nLondon, UK                        [w] http://www.ucl.ac.uk/~ucfagls/\nWC1E 6BT                          [w] http://www.freshwaters.org.uk/\n%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%~%\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}