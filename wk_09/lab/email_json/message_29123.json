{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 297: kill the lockwait child if the pipe goes away in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 297\nrevision-id: tridge@samba.org-20070514034901-vpwg24spu188ab97\nparent: tridge@samba.org-20070514034840-njb68t1bfrmcbhtl\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Mon 2007-05-14 13:49:01 +1000\nmessage:\n  kill the lockwait child if the pipe goes away\nmodified:\n  common/ctdb_lockwait.c         ctdb_lockwait.c-20070416214118-n1aeonljj3vpdd9q-1\n=== modified file 'common/ctdb_lockwait.c'\n--- a/common/ctdb_lockwait.c\t2007-05-05 07:19:59 +0000\n+++ b/common/ctdb_lockwait.c\t2007-05-14 03:49:01 +0000\n@@ -131,7 +131,9 @@\n \t\tclose(result->fd[0]);\n \t\ttdb_chainlock(ctdb_db->ltdb->tdb, key);\n \t\twrite(result->fd[1], &c, 1);\n-\t\tpause();\n+\t\t/* this read will exit when the parent closes its end\n+\t\t   of the pipe, or the parent dies */\n+\t\tread(result->fd[1], &c, 1);\n \t\t_exit(0);\n \t}\n \n\n"}