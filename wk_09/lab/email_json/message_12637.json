{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 182: added max_redirect_count status field in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 182\nrevision-id: tridge@samba.org-20070422165722-w0mjfpt1nxg7lu2i\nparent: tridge@samba.org-20070422161949-l7agikqiawx4ah1b\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sun 2007-04-22 18:57:22 +0200\nmessage:\n  added max_redirect_count status field\nmodified:\n  common/ctdb_call.c             ctdb_call.c-20061128065342-to93h6eejj5kon81-1\n  include/ctdb_private.h         ctdb_private.h-20061117234101-o3qt14umlg9en8z0-13\n  tools/ctdb_status.c            ctdb_status.c-20070420100703-w2y116bm9be7hmlv-2\n=== modified file 'common/ctdb_call.c'\n--- a/common/ctdb_call.c\t2007-04-22 16:19:49 +0000\n+++ b/common/ctdb_call.c\t2007-04-22 16:57:22 +0000\n@@ -605,8 +605,11 @@\n \tif (state == NULL) return;\n \n \t/* don't allow for too many redirects */\n-\tif (state->redirect_count++ == CTDB_MAX_REDIRECT) {\n+\tif ((++state->redirect_count) % CTDB_MAX_REDIRECT == 0) {\n \t\tc->dmaster = ctdb_lmaster(ctdb, &state->call.key);\n+\t\tif (state->redirect_count > ctdb->status.max_redirect_count) {\n+\t\t\tctdb->status.max_redirect_count = state->redirect_count;\n+\t\t}\n \t}\n \n \t/* send it off again */\n\n=== modified file 'include/ctdb_private.h'\n--- a/include/ctdb_private.h\t2007-04-22 12:26:45 +0000\n+++ b/include/ctdb_private.h\t2007-04-22 16:57:22 +0000\n@@ -145,6 +145,7 @@\n \tuint32_t pending_calls;\n \tuint32_t lockwait_calls;\n \tuint32_t pending_lockwait_calls;\n+\tuint32_t max_redirect_count;\n \tdouble max_call_latency;\n \tdouble max_lockwait_latency;\n };\n\n=== modified file 'tools/ctdb_status.c'\n--- a/tools/ctdb_status.c\t2007-04-22 14:39:55 +0000\n+++ b/tools/ctdb_status.c\t2007-04-22 16:57:22 +0000\n@@ -55,6 +55,7 @@\n \tprintf(\" pending_calls           %u\\n\", s->pending_calls);\n \tprintf(\" lockwait_calls          %u\\n\", s->lockwait_calls);\n \tprintf(\" pending_lockwait_calls  %u\\n\", s->pending_lockwait_calls);\n+\tprintf(\" max_redirect_count      %u\\n\", s->max_redirect_count);\n \tprintf(\" max_call_latency        %.6f seconds\\n\", s->max_call_latency);\n \tprintf(\" max_lockwait_latency    %.6f seconds\\n\", s->max_lockwait_latency);\n }\n\n"}