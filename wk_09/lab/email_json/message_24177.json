{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "Alberto Vieira Ferreira Monteiro <albmont@centroin.com.br>", "subject": "Re: [R] A function for raising a matrix to a power?", "body": "Ron E. VanNimwegen wrote:\n>\n> I was looking for a similar operator, because R uses scalar products\n> when raising a matrix to a power with \"^\".  There might be something\n> more elegant, but this little loop function will do what you need for a\n> matrix \"mat\" raised to a power \"pow\":\n>\n> mp <- function(mat,pow){\n> ans <- mat\n> for ( i in 1:(pow-1)){\n> ans <- mat%*%ans\n> }\n> return(ans)\n> }\n>\nThis function is extremely inefficient for high powers of pow\n[an unhappy choice of variables, because pow is the power\nfunction in many languages]\n\nA better method would keep track of the powers of two,\nand would optimize according to it.\n\nFor example, in order to compute mat^42, we just have to\ncompute mat^2, mat^4, mat^8, mat^16, mat^32, and\nthen mat^40 and mat^42, with \"only\" 7 multiplications, instead\nof 41.\n\nSee the technique in...\nhttp://en.wikipedia.org/wiki/Exponentiation_by_squaring\n\nmatrix.power <- function(mat, n)\n{\n  # test if mat is a square matrix\n  # treat n < 0 and n = 0 -- this is left as an exercise\n  # trap non-integer n and return an error\n  if (n == 1) return(mat)\n  result <- diag(1, ncol(mat))\n  while (n > 0) {\n    if (n %% 2 != 0) {\n      result <- result %*% mat\n      n <- n - 1\n    }\n    mat <- mat %*% mat\n    n <- n / 2\n  }\n  return(result)\n}\n\n# Test case:\nmat <- matrix(c(1,1,1,0), 2, 2)\nmat42 <- matrix.power(mat, 42)\ndet(mat) # -1\ndet(mat42) # not 1, because of truncation errors, but close enough :-)\n# I hate floating point arithmetics :-/\n\n# Another test case:\nmat <- matrix(c(1,1,0,1), 2, 2)\nmat314159 <- matrix.power(mat, 314159)\n# mat314159 is matrix(c(1,314159,0,1), 2, 2)\n\nAlberto Monteiro\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}