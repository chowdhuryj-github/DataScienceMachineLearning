{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "mimir@samba.org", "subject": "svn commit: samba r23126 - in\n\tbranches/SAMBA_4_0/source/scripting/ejs/ejsnet: .", "body": "Author: mimir\nDate: 2007-05-24 21:51:25 +0000 (Thu, 24 May 2007)\nNew Revision: 23126\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23126\n\nLog:\nthis was sitting on my laptop for a while...\n\nchange the way the ejs object is being created and return listing\ncontext (with status) rather than collecting all entries gathered\nfrom libnet call.\n\n\nrafal\n\n\nModified:\n   branches/SAMBA_4_0/source/scripting/ejs/ejsnet/mpr_user.c\n   branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_user.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/scripting/ejs/ejsnet/mpr_user.c\n===================================================================\n--- branches/SAMBA_4_0/source/scripting/ejs/ejsnet/mpr_user.c\t2007-05-24 21:45:29 UTC (rev 23125)\n+++ branches/SAMBA_4_0/source/scripting/ejs/ejsnet/mpr_user.c\t2007-05-24 21:51:25 UTC (rev 23126)\n@@ -101,6 +101,7 @@\n   UserListCtx.ResumeIndex\n   UserListCtx.Count\n   UserListCtx.EndOfList\n+  UserListCtx.Status\n  */\n struct MprVar mprUserListCtx(TALLOC_CTX *mem_ctx, struct libnet_UserList *list, NTSTATUS result)\n {\n@@ -144,6 +145,8 @@\n \tstatus = mprSetVar(&mprListCtx, \"ResumeIndex\", mprCreateIntegerVar((int)list->out.resume_index));\n \tif (!NT_STATUS_IS_OK(status)) goto done;\n \tstatus = mprSetVar(&mprListCtx, \"EndOfList\", mprCreateBoolVar(endOfList));\n+\tif (!NT_STATUS_IS_OK(status)) goto done;\n+\tstatus = mprSetVar(&mprListCtx, \"Status\", mprNTSTATUS(result));\n \n done:\n \treturn mprListCtx;\n\nModified: branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_user.c\n===================================================================\n--- branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_user.c\t2007-05-24 21:45:29 UTC (rev 23125)\n+++ branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_user.c\t2007-05-24 21:51:25 UTC (rev 23126)\n@@ -43,7 +43,7 @@\n {\n \tstruct libnet_context *ctx;\n \tconst char *userman_domain = NULL;\n-\tstruct MprVar *obj = NULL;\n+\tstruct MprVar obj;\n \n \t/* libnet context */\n \tctx = mprGetThisPtr(eid, \"ctx\");\n@@ -74,21 +74,24 @@\n \t}\n \n \t/* create 'net user' subcontext */\n-\tobj = mprInitObject(eid, \"NetUsrCtx\", argc, argv);\n+\tobj = mprObject(\"NetUsrCtx\");\n \n \t/* we need to make a copy of the string for this object */\n \tuserman_domain = talloc_strdup(ctx, userman_domain);\n \n \t/* add properties */\n-\tmprSetPtrChild(obj, \"ctx\", ctx);\n-\tmprSetPtrChild(obj, \"domain\", userman_domain);\n+\tmprSetPtrChild(&obj, \"ctx\", ctx);\n+\tmprSetPtrChild(&obj, \"domain\", userman_domain);\n \n \t/* add methods */\n-\tmprSetStringCFunction(obj, \"Create\", ejs_net_createuser);\n-\tmprSetStringCFunction(obj, \"Delete\", ejs_net_deleteuser);\n-\tmprSetStringCFunction(obj, \"Info\", ejs_net_userinfo);\n-\tmprSetCFunction(obj, \"List\", ejs_net_userlist);\n+\tmprSetStringCFunction(&obj, \"Create\", ejs_net_createuser);\n+\tmprSetStringCFunction(&obj, \"Delete\", ejs_net_deleteuser);\n+\tmprSetStringCFunction(&obj, \"Info\", ejs_net_userinfo);\n+\tmprSetCFunction(&obj, \"List\", ejs_net_userlist);\n \n+\t/* set the object returned by this function */\n+\tmpr_Return(eid, obj);\n+\n \treturn 0;\n }\n \n@@ -347,16 +350,6 @@\n \treq.in.page_size     = page_size;\n \t\n \tstatus = libnet_UserList(ctx, mem_ctx, &req);\n-\tif (!NT_STATUS_IS_OK(status) &&\n-\t    !NT_STATUS_EQUAL(status, STATUS_MORE_ENTRIES) &&\n-\t    !NT_STATUS_EQUAL(status, NT_STATUS_NO_MORE_ENTRIES)) {\n-\n-\t\tejsSetErrorMsg(eid, \"%s\", req.out.error_string);\n-\t\t\n-\t\tmprListCtx = mprCreateNullVar();\n-\t\tgoto done;\n-\t}\n-\n \tmprListCtx = mprUserListCtx(mem_ctx, &req, status);\n \n done:\n\n"}