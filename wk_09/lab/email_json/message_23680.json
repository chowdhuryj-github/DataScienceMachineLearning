{"category": "ham", "to_address": "\"ivo welch\" <ivowel@gmail.com>", "from_address": "roger koenker <roger@ysidro.econ.uiuc.edu>", "subject": "Re: [R] nlme fixed effects specification", "body": "Ivo,\n\nI don't know whether you ever got a proper answer to this question.\nHere is a kludgy one --  someone else can probably provide\na more elegant version of my diffid function.\n\nWhat you want to do is sweep out the mean deviations from both y\nand x based on the factor fe and then estimate the simple y on x  \nlinear model.\n\nI have an old function that was originally designed to do panel data\nmodels that looks like this:\n\n\"diffid\" <- function(h, id)\n{\n         if(is.vector(h))\n                 h <- matrix(h, ncol = 1)\n         Ph <- unique(id)\n         Ph <- cbind(Ph, table(id))\n         for(i in 1:ncol(h))\n                 Ph <- cbind(Ph, tapply(h[, i], id, mean))\n         is <- tapply(id, id)\n         Ph <- Ph[is,  - (1:2)]\n         h - Ph\n}\n\nWith this  you can do:\n\nset.seed(1);\nfe = as.factor( as.integer( runif(100)*10 ) ); y=rnorm(100); x=rnorm \n(100);\nsummary(lm(diffid(y,fe) ~ diffid(x,fe)))\n\nHTH,\n\nRoger\n\n\nOn May 4, 2007, at 3:08 PM, ivo welch wrote:\n\n> hi spie:  yikes.  could I have done better?  Oh dear.  I tried to make\n> my example clearer half-way through, but made it worse.  I meant\n>\n> set.seed(1);\n> fe = as.factor( as.integer( runif(100)*10 ) ); y=rnorm(100); x=rnorm \n> (100);\n> print(summary(lm( y ~ x + fe)))\n>   \n> Coefficients:\n>             Estimate Std. Error t value Pr(>|t|)\n> (Intercept)   0.1128     0.3680    0.31     0.76\n> x             0.0232     0.0960    0.24     0.81\n> fe1          -0.6628     0.5467   -1.21     0.23\n>   \n> Residual standard error: 0.949 on 89 degrees of freedom\n> Multiple R-Squared: 0.0838,     Adjusted R-squared: -0.0192\n> F-statistic: 0.814 on 10 and 89 DF,  p-value: 0.616\n>\n> I really am interested only in this linear specification, the\n> coefficient on x (0.0232) and the R^2 of 8.38% (adjusted -1.92%).  If\n> I did not have so much data in my real application, I would never have\n> to look at nlme or nlme4.  I really only want to be able to run this\n> specification through lm with far more observations (100,000) and\n> groups (10,000), and be done with my problem.\n>\n> now, with a few IQ points more, I would have looked at the lme\n> function instead of the nlme function in library(nlme).    [then\n> again, I could understand stats a lot better with a few more IQ\n> points.]  I am reading the lme description now, but I still don't\n> understand how to specify that I want to have dummies in my\n> specification, plus the x variable, and that's it.  I think I am not\n> understanding the integration of fixed and random effects in the same\n> R functions.\n>\n> thanks for pointing me at your lme4 library.  on linux, version  \n> 2.5.0, I did\n>   R CMD INSTALL matrix*.tar.gz\n>   R CMD INSTALL lme4*.tar.gz\n> and it installed painlessly.  (I guess R install packages don't have\n> knowledge of what they rely on;  lme4 requires matrix, which the docs\n> state, but having gotten this wrong, I didn't get an error.  no big\n> deal.  I guess I am too used to automatic resolution of dependencies\n> from linux installers these days that I did not expect this.)\n>\n> I now tried your specification:\n>\n>> library(lme4)\n> Loading required package: Matrix\n> Loading required package: lattice\n>> lmer(y~x+(1|fe))\n> Linear mixed-effects model fit by REML\n> Formula: y ~ x + (1 | fe)\n>  AIC BIC logLik MLdeviance REMLdeviance\n>  282 290   -138        270          276\n> Random effects:\n>  Groups   Name        Variance       Std.Dev.\n>  fe       (Intercept) 0.000000000445 0.0000211\n>  Residual             0.889548532468 0.9431588\n> number of obs: 100, groups: fe, 10\n>\n> Fixed effects:\n>             Estimate Std. Error t value\n> (Intercept)  -0.0188     0.0943  -0.199\n> x             0.0528     0.0904   0.585\n>\n> Correlation of Fixed Effects:\n>   (Intr)\n> x -0.022\n> Warning messages:\n> 1: Estimated variance for factor 'fe' is effectively zero\n>  in: `LMEoptimize<-`(`*tmp*`, value = list(maxIter = 200L, tolerance =\n> 0.0000000149011611938477,\n> 2: $ operator not defined for this S4 class, returning NULL in: x \n> $symbolic.cor\n>\n> Without being a statistician, I can still determine that this is not\n> the model I would like to work with.  The coefficient is 0.0528, not\n> 0.0232.  (I am also not sure why I am getting these warning messages\n> on my system, either, but I don't think it matters.)\n>\n> is there a simple way to get the equivalent specification for my smple\n> model, using lmer or lme, which does not choke on huge data sets?\n>\n> regards,\n>\n> /ivo\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting- \n> guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}