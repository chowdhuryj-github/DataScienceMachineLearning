{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 395: support ctdb status -n all in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 395\nrevision-id: tridge@samba.org-20070530011250-14bp0fktewrcdybm\nparent: tridge@samba.org-20070530010043-bgbx18q3o24ksgtn\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Wed 2007-05-30 11:12:50 +1000\nmessage:\n  support ctdb status -n all\nmodified:\n  tools/ctdb_control.c           ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1\n=== modified file 'tools/ctdb_control.c'\n--- a/tools/ctdb_control.c\t2007-05-29 06:02:02 +0000\n+++ b/tools/ctdb_control.c\t2007-05-30 01:12:50 +0000\n@@ -265,7 +265,22 @@\n \tuint32_t recmode, recmaster;\n \tuint32_t myvnn;\n \n-\tmyvnn = ctdb_ctrl_getvnn(ctdb, TIMELIMIT(), CTDB_CURRENT_NODE);\n+\tif (options.vnn == CTDB_BROADCAST_ALL) {\n+\t\tuint32_t *nodes;\n+\t\tuint32_t num_nodes;\n+\t\tret = 0;\n+\n+\t\tnodes = ctdb_get_connected_nodes(ctdb, TIMELIMIT(), ctdb, &num_nodes);\n+\t\tCTDB_NO_MEMORY(ctdb, nodes);\n+\t\n+\t\tfor (i=0;i<num_nodes;i++) {\n+\t\t\toptions.vnn = nodes[i];\n+\t\t\tret |= control_status(ctdb, argc, argv);\n+\t\t}\n+\t\treturn ret;\n+\t}\n+\n+\tmyvnn = ctdb_ctrl_getvnn(ctdb, TIMELIMIT(), options.vnn);\n \n \tret = ctdb_ctrl_getnodemap(ctdb, TIMELIMIT(), options.vnn, ctdb, &nodemap);\n \tif (ret != 0) {\n\n"}