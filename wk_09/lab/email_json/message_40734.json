{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "Maria Montez <montez@bu.edu>", "subject": "[R] object not found inside function", "body": "Hi!\n\nWhen running the following code I get the message: Error in eval(expr, \nenvir, enclos) : object \"A\" not found\n\nfm <- function(p,ydata, env = parent.frame()) {\n#fit model y ~ (b0+b1x1+...+bpxp)*exp(g2plus*z2plus) where bi and g2plus \nare parameters\n\n  #create design matrix for linear part\n  fo00 <- paste(\"~\",paste(paste(\"x\",1:p,sep=\"\"),collapse=\"+\"),sep=\"\")\n  fo0 <- as.formula(fo00)\n  A <- model.matrix(fo0,data=ydata)\n\n # create z variable\n  z2plus <- ifelse(totx>1,1,0)\n  ydata <- data.frame(ydata,z2plus)\n\n #run model\n  t2 <- nls(y ~ \nA*exp(g2plus*z2plus),data=ydata,start=c(g2plus=0),alg=\"plinear\")\n}\nmodel <- fm(4,ydata)\n\nThe code inside the function works if not enclosed in a function. This \nmakes me think that it is a scope problem and I need to specify the \nenvironment. Even though I've read about environment and lexical scope I \nstill don't fully understand how it works. Sometimes I can do it others \nI can't!\n\nCan someone help me?\n\nI've included below code to create a dataframe that can be used to test \nmy code.\n\nThanks, Maria\n\n######################\nydata <-\nstructure(list(x1 = as.integer(c(1, 1, 1, 1, 0, 0, 0, 0, 0, 0,\n0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,\n0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1,\n0, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0,\n0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)), x2 = as.integer(c(0,\n0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1,\n0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1,\n1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1,\n0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1,\n0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0,\n0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0,\n1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1,\n0, 1)), x3 = as.integer(c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,\n0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)), x4 = as.integer(c(1, 0,\n1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0,\n0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0,\n0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1,\n1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1,\n0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1,\n1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1,\n0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1,\n1)), y = c(6.395261598, 6.075346031, 6.396929655, 5.220355825,\n6.703188113, 7.290974778, 6.779921908, 6.047372179, 5.837730447,\n6.761572769, 6.597145702, 6.371611847, 7.19142933, 6.278521424,\n6.646390515, 6.64898455, 6.200509174, 7.297768283, 6.64898455,\n6.933423026, 6.666956792, 6.248042875, 6.673297968, 5.697093487,\n7.216709487, 6.23636959, 6.643789733, 7.210818454, 5.988961417,\n7.305188215, 6.22059017, 7.259116128, 6.613384218, 6.776506992,\n6.901737207, 6.311734809, 6.073044534, 6.805722553, 6.921658184,\n6.171700597, 6.478509642, 6.877296072, 6.309918278, 6.599870499,\n6.173786104, 6.580639137, 6.293419279, 6.980075941, 6.937314081,\n6.033086222, 6.64509097, 6.620073207, 6.33150185, 6.97354302,\n6.620073207, 6.668228248, 7.153833802, 6.629363253, 6.573680167,\n6.54534966, 6.768493212, 7.086737935, 6.144185634, 6.903747258,\n7.500529485, 7.134093721, 6.363028104, 7.145984468, 7.355001921,\n6.875232087, 6.849066283, 6.630683386, 6.899723107, 6.760414691,\n6.154858094, 6.74051936, 5.609471795, 6.82437367, 6.825460036,\n6.684611728, 6.610696045, 6.845879875, 6.64898455, 6.878326468,\n6.931471806, 7.185387016, 6.858565035, 6.008813185, 7.111512117,\n6.639875834, 6.694562059, 6.81014245, 7.617759577, 6.953684211,\n6.368187186, 7.007600614, 6.302618976, 6.003887067, 6.56526497,\n7.592366129, 7.512617545, 7.438971592, 6.49677499, 6.635946556,\n6.771935556, 6.74051936, 6.708084084, 6.401917197, 7.412160335,\n6.369900983, 6.822197391, 7.199678346, 6.415096959, 6.914730893,\n7.204149292, 7.180831199, 7.17472431, 6.769641977, 6.726233402,\n6.385194399, 6.901737207, 7.121252453, 6.672032946, 6.912742821,\n7.037027615, 7.496097345, 7.015712421, 6.668228248, 7.074963198,\n6.251903883, 6.391917113, 6.456769656, 6.426488458, 6.244166901,\n6.56526497, 7.042286172, 6.677083461, 6.054439346, 6.282266747,\n6.605297921, 6.326149473, 6.492239835, 6.368187186, 7.218909708,\n7.003974137, 6.184148891, 6.622736324, 6.862757913, 7.069874129,\n7.509883061), totx = as.integer(c(3, 2, 4, 3, 2, 2, 1, 2, 2,\n1, 2, 2, 3, 2, 2, 2, 2, 2, 3, 3, 2, 2, 1, 2, 2, 2, 3, 2, 2, 2,\n2, 3, 2, 3, 3, 1, 2, 3, 2, 2, 2, 3, 2, 2, 2, 1, 2, 4, 4, 3, 2,\n3, 3, 3, 4, 3, 3, 2, 3, 3, 3, 4, 3, 4, 3, 4, 3, 4, 4, 3, 3, 2,\n3, 2, 2, 2, 3, 3, 3, 3, 1, 3, 3, 4, 3, 3, 2, 3, 3, 3, 3, 2, 3,\n3, 3, 3, 3, 1, 1, 3, 3, 2, 3, 2, 2, 1, 2, 2, 3, 3, 2, 3, 3, 3,\n4, 4, 4, 2, 3, 3, 4, 3, 3, 3, 3, 3, 3, 4, 3, 2, 2, 2, 1, 3, 2,\n1, 1, 1, 0, 1, 0, 1, 1, 2, 1, 1, 1, 1, 1, 2)), z2plus = c(1,\n1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0,\n1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,\n1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,\n0, 1)), .Names = c(\"x1\", \"x2\", \"x3\", \"x4\", \"y\", \"totx\", \"z2plus\"\n), row.names = c(\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\",\n\"10\", \"11\", \"12\", \"13\", \"14\", \"15\", \"16\", \"17\", \"18\", \"19\", \"20\",\n\"21\", \"22\", \"23\", \"24\", \"25\", \"26\", \"27\", \"28\", \"29\", \"30\", \"31\",\n\"32\", \"33\", \"34\", \"35\", \"36\", \"37\", \"38\", \"39\", \"40\", \"41\", \"42\",\n\"43\", \"44\", \"45\", \"46\", \"47\", \"48\", \"49\", \"50\", \"51\", \"52\", \"53\",\n\"54\", \"55\", \"56\", \"57\", \"58\", \"59\", \"60\", \"61\", \"62\", \"63\", \"64\",\n\"65\", \"66\", \"67\", \"68\", \"69\", \"70\", \"71\", \"72\", \"73\", \"74\", \"75\",\n\"76\", \"77\", \"78\", \"79\", \"80\", \"81\", \"82\", \"83\", \"84\", \"85\", \"86\",\n\"87\", \"88\", \"89\", \"90\", \"91\", \"92\", \"93\", \"94\", \"95\", \"96\", \"97\",\n\"98\", \"99\", \"100\", \"101\", \"102\", \"103\", \"104\", \"105\", \"106\",\n\"107\", \"108\", \"109\", \"110\", \"111\", \"112\", \"113\", \"114\", \"115\",\n\"116\", \"117\", \"118\", \"119\", \"120\", \"121\", \"122\", \"123\", \"124\",\n\"125\", \"126\", \"127\", \"128\", \"129\", \"130\", \"131\", \"132\", \"133\",\n\"134\", \"135\", \"136\", \"137\", \"138\", \"139\", \"140\", \"141\", \"142\",\n\"143\", \"144\", \"145\", \"146\", \"147\", \"148\", \"149\", \"150\"), class = \n\"data.frame\")\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}