{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 284: show total frozen/recoving in status in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 284\nrevision-id: tridge@samba.org-20070512055108-iu7dpt4clrysv3dp\nparent: tridge@samba.org-20070512054456-hq4sgzwco9ovtb0x\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-05-12 15:51:08 +1000\nmessage:\n  show total frozen/recoving in status\nmodified:\n  common/ctdb_control.c          ctdb_control.c-20070426122724-j6gkpiofhbwdin63-1\n  include/ctdb_private.h         ctdb_private.h-20061117234101-o3qt14umlg9en8z0-13\n  tools/ctdb_control.c           ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1\n=== modified file 'common/ctdb_control.c'\n--- a/common/ctdb_control.c\t2007-05-12 05:15:27 +0000\n+++ b/common/ctdb_control.c\t2007-05-12 05:51:08 +0000\n@@ -71,6 +71,8 @@\n \t\tCHECK_CONTROL_DATA_SIZE(0);\n \t\tctdb->status.controls.status++;\n \t\tctdb->status.memory_used = talloc_total_size(ctdb);\n+\t\tctdb->status.frozen = (ctdb->freeze_mode == CTDB_FREEZE_FROZEN);\n+\t\tctdb->status.recovering = (ctdb->recovery_mode == CTDB_RECOVERY_ACTIVE);\n \t\toutdata->dptr = (uint8_t *)&ctdb->status;\n \t\toutdata->dsize = sizeof(ctdb->status);\n \t\treturn 0;\n\n=== modified file 'include/ctdb_private.h'\n--- a/include/ctdb_private.h\t2007-05-12 05:15:27 +0000\n+++ b/include/ctdb_private.h\t2007-05-12 05:51:08 +0000\n@@ -136,6 +136,8 @@\n  */\n struct ctdb_status {\n \tuint32_t num_clients;\n+\tuint32_t frozen;\n+\tuint32_t recovering;\n \tuint32_t client_packets_sent;\n \tuint32_t client_packets_recv;\n \tuint32_t node_packets_sent;\n\n=== modified file 'tools/ctdb_control.c'\n--- a/tools/ctdb_control.c\t2007-05-12 05:44:56 +0000\n+++ b/tools/ctdb_control.c\t2007-05-12 05:51:08 +0000\n@@ -102,6 +102,8 @@\n \t} fields[] = {\n #define STATUS_FIELD(n) { #n, offsetof(struct ctdb_status, n) }\n \t\tSTATUS_FIELD(num_clients),\n+\t\tSTATUS_FIELD(frozen),\n+\t\tSTATUS_FIELD(recovering),\n \t\tSTATUS_FIELD(client_packets_sent),\n \t\tSTATUS_FIELD(client_packets_recv),\n \t\tSTATUS_FIELD(node_packets_sent),\n\n"}