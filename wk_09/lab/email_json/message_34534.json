{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23085 - in\n\tbranches/SAMBA_3_0_26/source/nsswitch: .", "body": "Author: obnox\nDate: 2007-05-22 22:00:16 +0000 (Tue, 22 May 2007)\nNew Revision: 23085\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23085\n\nLog:\nActivate the winbindd validation code in 3_0_26, too.\nOriginal comment of the 3_0 checkin (r23040):\n\nActivate the winbindd cache validation code in the                                    \nwinbindd main function.                                                               \n                                                                                      \nI have tested and somewhat extended the code, and it seems                            \nto do a good job. I have possibly not caught all error                                \nconditions though.                                                                    \n                                                                                      \nMichael\n\n\nModified:\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd.c\t2007-05-22 21:53:54 UTC (rev 23084)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd.c\t2007-05-22 22:00:16 UTC (rev 23085)\n@@ -1065,6 +1065,20 @@\n \n \tpidfile_create(\"winbindd\");\n \n+\t/* Ensure all cache and idmap caches are consistent\n+\t   before we startup. */\n+\n+\tif (winbindd_validate_cache()) {\n+\t\t/* We have a bad cache, but luckily we\n+\t\t   just deleted it. Restart ourselves */\n+\t\tint i;\n+\t\t/* Ensure we have no open low fd's. */\n+\t\tfor (i = 3; i < 100; i++) {\n+\t\t\tclose(i);\n+\t\t}\n+\t\treturn execve(argv[0], argv, envp);\n+\t}\n+\n #if HAVE_SETPGID\n \t/*\n \t * If we're interactive we want to set our own process group for\n\n"}