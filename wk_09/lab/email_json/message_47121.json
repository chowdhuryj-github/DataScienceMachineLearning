{"category": "ham", "to_address": "\"yang mikey\" <mikeyredmoon@gmail.com>", "from_address": "\"ronnie sahlberg\" <ronniesahlberg@gmail.com>", "subject": "Re: [SMB] NTCreateANDX quesiotn", "body": "What exactly do you want to do?   Just list all SMB packets and which\nuser / share issued it?\n\nIf so why dont you just use wireshark/tshark that will track all this\nstate for you.\n\n\nExample:   make tshark print both the user account that logged onto\nthis UID and also show the share name that was mapped to the TID\n./tshark -n -r /mnt/winreg/winreg.cap.gz -R \"smb\" -z\nproto,colinfo,smb.account,smb.account -z\nproto,colinfo,smb.path,smb.path\n\n\nYou want to produce a service response time table for SMB but only for\nthe commands that are issued by \"administrator\" ?\n\n./tshark -n -r /mnt/winreg/winreg.cap.gz -R \"not frame\" -z\nsmb,rtt,smb.account==administrator\n\n\n\nman tshark\n\nOn 6/11/07, yang mikey  wrote:\n> hi,Mike\n>\n> yeah, I did not noticed it before just use the value on windows XP sp2 and\n> 2003, because\n> the BYTE COUNT in wroing place is zero, but when I tested in windows 2000, I\n> found there is a\n> unormal large number in there, if I read it, the memory shall crashed.\n>\n> in fact, I am doing a little tool to monitor the share folder change via\n> parsing CIFS protocol.\n> I dont know why MS change the SMB protocle so much by adding some\n> NTxxxANDXs, I\n> feel to so hard to know what user done, For example, because of COMMAND_COPY\n> is obsolete,\n> I can't judge the COPY operation, copy source , copy target, I just see a\n> file is opened by 0xA2\n> and read by 0x2E, and a new file is created(also 0xA2), are there any\n> document to describe the\n> procedure?  thanks.\n>                                                                        Mikey\n>\n>\n>\n> 2007/6/11, Michael B Allen :\n> >\n> > Ahh, I see what you're talking about. In the response. The WordCount is\n> > way too large. It should be more like 34 and not 42. Funny, I've written\n> > multiple CIFS clients and never noticed.\n> >\n> > Mike\n> >\n> > On Mon, 11 Jun 2007 12:09:38 +0900\n> > \"yang mikey\"  wrote:\n> >\n> > > hi, Allen\n> > > Thanks your reply and time.\n> > > I am sorry that can not send any packet file to you, because you know, I\n> > am\n> > > in company.\n> > > But this packet is not any special I think. just a very common\n> > NTCreateAndX\n> > > packet(smb.command == 0xA2), if\n> > > you login into a server with share folder and make some file operations\n> > such\n> > > as delete or create\n> > > a new file, you shall see the packet in etheral.\n> > >                                                                   Mikey\n> > >\n> > >\n> > > 2007/6/9, Michael B Allen :\n> > > >\n> > > > Mikey,\n> > > >\n> > > > Is it ok to send me your capture file?\n> > > >\n> > > > I'm always interested in seeing mutant packets.\n> > > >\n> > > > Mike\n> > > >\n> > > > On Fri, 8 Jun 2007 11:11:21 +0900\n> > > > \"yang mikey\"  wrote:\n> > > >\n> > > > > hi, everybody\n> > > > > I found a interesting thing,\n> > > > >\n> > > > > when I see the header of NTCreateANCX[0xA2] via Ethereal\n> > > > > I found the value of WORD COUNT is 42, but the position of BYTE\n> > COUNT is\n> > > > not\n> > > > > at\n> > > > > (offset of WORD COUNT) +  (value of  WORD COUNT) *2.\n> > > > >\n> > > > > Why it happened, and How Ethereal knows  the correct position of\n> > BYTE\n> > > > COUNT.\n> > > > >\n> > > > > thanks a lot\n> > > > >                                                             Mikey\n> > > > >\n> > > >\n> > > >\n> > > > --\n> > > > Michael B Allen\n> > > > PHP Active Directory Kerberos SSO\n> > > > http://www.ioplex.com/\n> > > >\n> > >\n> >\n> >\n> > --\n> > Michael B Allen\n> > PHP Active Directory Kerberos SSO\n> > http://www.ioplex.com/\n> >\n>\n\n"}