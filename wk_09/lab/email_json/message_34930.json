{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23092 - in branches/SAMBA_3_0_RELEASE: .\n\tsource/smbd source/tdb/tools", "body": "Author: jerry\nDate: 2007-05-23 15:28:47 +0000 (Wed, 23 May 2007)\nNew Revision: 23092\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23092\n\nLog:\nMerge Herb's changes to tdbtool and Jeremy's fox \nfor renames with the cifs fs client.\n\n\n\nModified:\n   branches/SAMBA_3_0_RELEASE/WHATSNEW.txt\n   branches/SAMBA_3_0_RELEASE/source/smbd/reply.c\n   branches/SAMBA_3_0_RELEASE/source/tdb/tools/tdbtool.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_RELEASE/WHATSNEW.txt\n===================================================================\n--- branches/SAMBA_3_0_RELEASE/WHATSNEW.txt\t2007-05-23 15:17:49 UTC (rev 23091)\n+++ branches/SAMBA_3_0_RELEASE/WHATSNEW.txt\t2007-05-23 15:28:47 UTC (rev 23092)\n@@ -54,6 +54,7 @@\n       about that we retry the lock every 10 seconds instead of waiting\n       for the standard select timeout.\n     * BUG 4637: Fix samlogon reply regression that broke domain logons.\n+    * Fix rename for Linux cifs fs client.\n \n \n o   Alexander Bokovoy \n@@ -85,6 +86,11 @@\n       uninitialized variables.\n \n \n+o   Herb Lewis \n+    * Update connection structure definition for tdbtool display\n+      output.\n+\n+\n o   Derrell Lipman \n     * BUG 4601: Fix smbc_getxattr() to properly return the required\n       size of the buffer needed to contain the extended attributes.\n\nModified: branches/SAMBA_3_0_RELEASE/source/smbd/reply.c\n===================================================================\n--- branches/SAMBA_3_0_RELEASE/source/smbd/reply.c\t2007-05-23 15:17:49 UTC (rev 23091)\n+++ branches/SAMBA_3_0_RELEASE/source/smbd/reply.c\t2007-05-23 15:28:47 UTC (rev 23092)\n@@ -4260,10 +4260,10 @@\n \t\treturn NT_STATUS_OBJECT_NAME_COLLISION;\n \t}\n \n-\tstatus = can_rename(conn,newname,attrs,&sbuf);\n+\tstatus = can_rename(conn,fsp->fsp_name,attrs,&sbuf);\n \n \tif (dest_exists && !NT_STATUS_IS_OK(status)) {\n-\t\tDEBUG(3,(\"rename_internals: Error %s rename %s -> %s\\n\",\n+\t\tDEBUG(3,(\"rename_internals_fsp: Error %s rename %s -> %s\\n\",\n \t\t\tnt_errstr(status), fsp->fsp_name,newname));\n \t\tif (NT_STATUS_EQUAL(status,NT_STATUS_SHARING_VIOLATION))\n \t\t\tstatus = NT_STATUS_ACCESS_DENIED;\n\nModified: branches/SAMBA_3_0_RELEASE/source/tdb/tools/tdbtool.c\n===================================================================\n--- branches/SAMBA_3_0_RELEASE/source/tdb/tools/tdbtool.c\t2007-05-23 15:17:49 UTC (rev 23091)\n+++ branches/SAMBA_3_0_RELEASE/source/tdb/tools/tdbtool.c\t2007-05-23 15:28:47 UTC (rev 23092)\n@@ -116,7 +116,7 @@\n \tint cnum;\n \tuid_t uid;\n \tgid_t gid;\n-\tchar name[24];\n+\tchar servicename[FSTRING_LEN];\n \tchar addr[24];\n \tchar machine[FSTRING_LEN];\n \ttime_t start;\n@@ -373,7 +373,7 @@\n \tprintf( \"\\ndata %d bytes\\n\", (int)dbuf.dsize);\n \tprintf( \"pid    =%5d   \", ((connections_data*)dbuf.dptr)->pid);\n \tprintf( \"cnum   =%10d  \", ((connections_data*)dbuf.dptr)->cnum);\n-\tprintf( \"name   =[%s]\\n\", ((connections_data*)dbuf.dptr)->name);\n+\tprintf( \"name   =[%s]\\n\", ((connections_data*)dbuf.dptr)->servicename);\n \t\n \tprintf( \"uid    =%5d   \",  ((connections_data*)dbuf.dptr)->uid);\n \tprintf( \"addr   =[%s]\\n\", ((connections_data*)dbuf.dptr)->addr);\n\n"}