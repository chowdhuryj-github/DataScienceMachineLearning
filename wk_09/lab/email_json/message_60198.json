{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23672 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_26/source/nsswitch", "body": "Author: gd\nDate: 2007-07-02 09:46:18 +0000 (Mon, 02 Jul 2007)\nNew Revision: 23672\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23672\n\nLog:\nAllow msrpc_name_to_sid() to be called without a domain_name and just a name.\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_rpc.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_rpc.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_rpc.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_rpc.c\t2007-07-01 19:40:04 UTC (rev 23671)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_rpc.c\t2007-07-02 09:46:18 UTC (rev 23672)\n@@ -269,18 +269,20 @@\n \tstruct rpc_pipe_client *cli;\n \tPOLICY_HND lsa_policy;\n \n-        if(name == NULL || *name=='\\0') {\n-                DEBUG(3,(\"rpc: name_to_sid name=%s\\n\", domain_name));\n-                full_name = talloc_asprintf(mem_ctx, \"%s\", domain_name);\n-        } else {\n-                DEBUG(3,(\"rpc: name_to_sid name=%s\\\\%s\\n\", domain_name, name));\n-                full_name = talloc_asprintf(mem_ctx, \"%s\\\\%s\", domain_name, name);\n-        }\n+\tif (name == NULL || *name=='\\0') {\n+\t\tfull_name = talloc_asprintf(mem_ctx, \"%s\", domain_name);\n+\t} else if (domain_name == NULL || *domain_name == '\\0') {\n+\t\tfull_name = talloc_asprintf(mem_ctx, \"%s\", name);\n+\t} else {\n+\t\tfull_name = talloc_asprintf(mem_ctx, \"%s\\\\%s\", domain_name, name);\n+\t}\n \tif (!full_name) {\n \t\tDEBUG(0, (\"talloc_asprintf failed!\\n\"));\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \n+\tDEBUG(3,(\"rpc: name_to_sid name=%s\\n\", full_name));\n+\n \tws_name_return( full_name, WB_REPLACE_CHAR );\n \n \tDEBUG(3,(\"name_to_sid [rpc] %s for domain %s\\n\", full_name?full_name:\"\", domain_name ));\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_rpc.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_rpc.c\t2007-07-01 19:40:04 UTC (rev 23671)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_rpc.c\t2007-07-02 09:46:18 UTC (rev 23672)\n@@ -269,18 +269,20 @@\n \tstruct rpc_pipe_client *cli;\n \tPOLICY_HND lsa_policy;\n \n-        if(name == NULL || *name=='\\0') {\n-                DEBUG(3,(\"rpc: name_to_sid name=%s\\n\", domain_name));\n-                full_name = talloc_asprintf(mem_ctx, \"%s\", domain_name);\n-        } else {\n-                DEBUG(3,(\"rpc: name_to_sid name=%s\\\\%s\\n\", domain_name, name));\n-                full_name = talloc_asprintf(mem_ctx, \"%s\\\\%s\", domain_name, name);\n-        }\n+\tif (name == NULL || *name=='\\0') {\n+\t\tfull_name = talloc_asprintf(mem_ctx, \"%s\", domain_name);\n+\t} else if (domain_name == NULL || *domain_name == '\\0') {\n+\t\tfull_name = talloc_asprintf(mem_ctx, \"%s\", name);\n+\t} else {\n+\t\tfull_name = talloc_asprintf(mem_ctx, \"%s\\\\%s\", domain_name, name);\n+\t}\n \tif (!full_name) {\n \t\tDEBUG(0, (\"talloc_asprintf failed!\\n\"));\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n \n+\tDEBUG(3,(\"rpc: name_to_sid name=%s\\n\", full_name));\n+\n \tws_name_return( full_name, WB_REPLACE_CHAR );\n \n \tDEBUG(3,(\"name_to_sid [rpc] %s for domain %s\\n\", full_name?full_name:\"\", domain_name ));\n\n"}