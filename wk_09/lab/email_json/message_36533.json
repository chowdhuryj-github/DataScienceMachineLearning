{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 350: handle corrupt ctdb packets better in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 350\nrevision-id: tridge@samba.org-20070526044612-v0alyob7oxnvdun3\nparent: tridge@samba.org-20070526040108-o5vdpfl6tel9ojku\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-05-26 14:46:12 +1000\nmessage:\n  handle corrupt ctdb packets better\nmodified:\n  common/ctdb_io.c               ctdb_io.c-20070409200335-dzfc7f3rra5rcf60-1\n=== modified file 'common/ctdb_io.c'\n--- a/common/ctdb_io.c\t2007-05-15 04:08:58 +0000\n+++ b/common/ctdb_io.c\t2007-05-26 04:46:12 +0000\n@@ -109,6 +109,11 @@\n \t\tuint8_t *d2;\n \t\tuint32_t len;\n \t\tlen = *(uint32_t *)data;\n+\t\tif (len == 0) {\n+\t\t\t/* bad packet! treat as EOF */\n+\t\t\tDEBUG(0,(\"Invalid packet of length 0\\n\"));\n+\t\t\tgoto failed;\n+\t\t}\n \t\td2 = talloc_memdup(queue, data, len);\n \t\tif (d2 == NULL) {\n \t\t\tDEBUG(0,(\"read error memdup failed for %u\\n\", len));\n\n"}