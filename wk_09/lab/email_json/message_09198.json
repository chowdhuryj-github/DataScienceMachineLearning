{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "Michael Adam <ma@sernet.de>", "subject": "Rev 5372: merge from upstream in\n\thttp://samba.sernet.de/ma/bzr/SAMBA_3_0-registry.bzr/", "body": "At http://samba.sernet.de/ma/bzr/SAMBA_3_0-registry.bzr/\n\n------------------------------------------------------------\nrevno: 5372\nrevision-id: ma@sernet.de-20070418202137-d18e314f5670f77b\nparent: ma@sernet.de-20070418201624-44864fb7d8f026fb\nparent: jerry@samba.org-20070418170336-xa1273iy55qd0ptu\ncommitter: Michael Adam \nbranch nick: SAMBA_3_0-registry.bzr\ntimestamp: Wed 2007-04-18 22:21:37 +0200\nmessage:\n  merge from upstream\nmodified:\n  REVISION                       REVISION-20060530022625-68239662668b41c3\n  make-tarball.sh                maketarball.sh-20060530022625-59649e9787ac3704\n  source/nsswitch/idmap_ldap.c   idmap_ldap.c-20061212152804-ho38ifnk7se3gdfx-1\n    ------------------------------------------------------------\n    merged: jerry@samba.org-20070418170336-xa1273iy55qd0ptu\n    parent: obnox@samba.org-20070418170155-rf9du1t9lbross32\n    committer: jerry@samba.org\n    branch nick: SAMBA_3_0.bzr\n    timestamp: Wed 2007-04-18 12:03:36 -0500\n    message:\n      jerry@samba.org (r22340)  2007-04-18 11:45:00 -0500 (Wed, 18 Apr 2007)\n          \n          Fix another segfault in idmap_ldap.c caused by setting the iterator\n          LDAPMessage * to NULL on each loop rotation.\n          \n          \n    ------------------------------------------------------------\n    merged: obnox@samba.org-20070418170155-rf9du1t9lbross32\n    parent: jra@samba.org-20070418050155-9pwpbark0woks5q6\n    committer: obnox@samba.org\n    branch nick: SAMBA_3_0.bzr\n    timestamp: Wed 2007-04-18 12:01:55 -0500\n    message:\n      obnox@samba.org (r22330)  2007-04-18 06:12:31 -0500 (Wed, 18 Apr 2007)\n          \n          For my own convenience (changes discussed some weeks ago with\n          Jerry, who basically didn't care - now I can commit them myself;-):\n          \n          - Add a call to mkversion.sh to ensure sane version number even\n          from a plain checkout.\n          - Add a \"nodocs\" switch to allow for calling make-tarball.sh without\n          the need of having samba-docs and using-samba around.\n          \n          \n=== modified file 'REVISION'\n--- a/REVISION\t2007-04-18 05:01:55 +0000\n+++ b/REVISION\t2007-04-18 17:03:36 +0000\n@@ -2,9 +2,9 @@\n URL: svn+ssh://svn.samba.org/home/svn/samba/branches/SAMBA_3_0\n Repository Root: svn+ssh://svn.samba.org/home/svn/samba\n Repository UUID: 0c0555d6-39d7-0310-84fc-f1cc0bd64818\n-Revision: 22327\n+Revision: 22340\n Node Kind: directory\n-Last Changed Author: jra\n-Last Changed Rev: 22327\n-Last Changed Date: 2007-04-17 19:34:10 -0500 (Tue, 17 Apr 2007)\n+Last Changed Author: jerry\n+Last Changed Rev: 22340\n+Last Changed Date: 2007-04-18 11:45:00 -0500 (Wed, 18 Apr 2007)\n \n\n=== modified file 'make-tarball.sh'\n--- a/make-tarball.sh\t2006-05-30 02:26:57 +0000\n+++ b/make-tarball.sh\t2007-04-18 17:01:55 +0000\n@@ -4,35 +4,43 @@\n ## You either need to include the using_samba cvs module in the\n ## parent directory or tell the script where to find it \n ##\n-## Usgae:  ./make-tarball.sh\n+## Usgae:  ./make-tarball.sh [nodocs]\n+\n+NODOCS=0\n+if [ x\"$1\" = x\"nodocs\" ] ; then\n+\tNODOCS=1\n+\techo Not including docs.\n+fi\n \n DOCSDIR=../samba-docs/\n USING_SAMBA=../using_samba/\n SRCDIR=`pwd`\n \n-if [ ! -d $USING_SAMBA ]; then\n-\n-\techo Cannot find \"Using Samba\" directory \\(assuming $USING_SAMBA\\).  \n-\techo Please set the USING_SAMBA variable in this script to the correct\n-\techo location.  The html files are available in the using_samba CVS \n-\techo module on cvs.samba.org.  See http://cvs/samba.org/ for details \n-\techo about anonymous CVS access.  Exiting now....\n-\n-\texit 1\n-\n-fi\n-\n-if [ ! -d $DOCSDIR ]; then\n-\n-\techo Cannot find samba-docs \\(assuming $DOCSDIR\\).\n-\techo Please set the DOCSDIR variable in this script \n-\techo to the correct path.\n-\n-\texit 1\n-\n-fi\n-\n-\n+if [ $NODOCS -eq 0 ]; then\n+\tif [ ! -d $USING_SAMBA ]; then\n+\t\n+\t\techo Cannot find \"Using Samba\" directory \\(assuming $USING_SAMBA\\).  \n+\t\techo Please set the USING_SAMBA variable in this script to the correct\n+\t\techo location.  The html files are available in the using_samba CVS \n+\t\techo module on cvs.samba.org.  See http://cvs.samba.org/ for details \n+\t\techo about anonymous CVS access.  Exiting now....\n+\t\n+\t\texit 1\n+\t\n+\tfi\n+\t\n+\tif [ ! -d $DOCSDIR ]; then\n+\t\n+\t\techo Cannot find samba-docs \\(assuming $DOCSDIR\\).\n+\t\techo Please set the DOCSDIR variable in this script \n+\t\techo to the correct path.\n+\t\n+\t\texit 1\n+\t\n+\tfi\n+fi\n+\n+( cd source ; sh script/mkversion.sh )\n VERSION=`grep SAMBA_VERSION_OFFICIAL_STRING source/include/version.h | cut -d\\\" -f2 | sed 's/ /_/g'`\n TARBALLDIR=/tmp/samba-$VERSION\n \n@@ -44,8 +52,10 @@\n mkdir $TARBALLDIR\n rsync -aC ./ $TARBALLDIR\n /bin/rm -rf $TARBALLDIR/docs/*\n-rsync -aC $DOCSDIR/ $TARBALLDIR/docs/ \n-rsync -aC $USING_SAMBA $TARBALLDIR/docs/htmldocs/\n+if [ $NODOCS -eq 0 ]; then\n+\trsync -aC $DOCSDIR/ $TARBALLDIR/docs/ \n+\trsync -aC $USING_SAMBA $TARBALLDIR/docs/htmldocs/\n+fi\n \n echo Creating packaging scripts...\n ( cd $TARBALLDIR/packaging; sh bin/update-pkginfo $VERSION 1 )\n\n=== modified file 'source/nsswitch/idmap_ldap.c'\n--- a/source/nsswitch/idmap_ldap.c\t2007-03-11 17:02:04 +0000\n+++ b/source/nsswitch/idmap_ldap.c\t2007-04-18 17:03:36 +0000\n@@ -1028,6 +1028,7 @@\n \n static NTSTATUS idmap_ldap_sids_to_unixids(struct idmap_domain *dom, struct id_map **ids)\n {\n+       \tLDAPMessage *entry = NULL;\n \tNTSTATUS ret;\n \tTALLOC_CTX *memctx;\n \tstruct idmap_ldap_context *ctx;\n@@ -1108,7 +1109,6 @@\n \t}\n \n \tfor (i = 0; i < count; i++) {\n-\t\tLDAPMessage *entry = NULL;\n \t\tchar *sidstr = NULL;\n \t\tchar *tmp = NULL;\n \t\tenum id_type type;\n\n"}