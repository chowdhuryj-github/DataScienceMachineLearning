{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23584 - in branches: SAMBA_3_0/source/registry\n\tSAMBA_3_0_26/source/registry", "body": "Author: obnox\nDate: 2007-06-22 11:42:17 +0000 (Fri, 22 Jun 2007)\nNew Revision: 23584\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23584\n\nLog:\nUse a while loop instead of a for loop without increment... :-)\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0/source/registry/reg_api.c\n   branches/SAMBA_3_0_26/source/registry/reg_api.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/registry/reg_api.c\n===================================================================\n--- branches/SAMBA_3_0/source/registry/reg_api.c\t2007-06-22 11:21:59 UTC (rev 23583)\n+++ branches/SAMBA_3_0/source/registry/reg_api.c\t2007-06-22 11:42:17 UTC (rev 23584)\n@@ -691,7 +691,6 @@\n \tTALLOC_CTX *mem_ctx = NULL;\n \tWERROR werr = WERR_OK;\n \tstruct registry_key *key;\n-\tuint32 idx = 0;\n \tchar *subkey_name = NULL;\n \n \tmem_ctx = talloc_new(ctx);\n@@ -706,14 +705,8 @@\n \t\tgoto done;\n \t}\n \n-\t/* NOTE: we *must not* increment idx in this loop since\n-\t * the list of subkeys shrinks with each loop body. \n-\t * so this way, we repeatedly delete the *first* entry\n-\t * of a shrinking list. */\n-\tfor (idx = 0;\n-\t     W_ERROR_IS_OK(werr = reg_enumkey(mem_ctx, key, idx,\n-\t\t\t     \t\t      &subkey_name, NULL));\n-\t    ) \n+\twhile (W_ERROR_IS_OK(werr = reg_enumkey(mem_ctx, key, 0,\n+\t\t\t\t\t\t&subkey_name, NULL))) \n \t{\n \t\twerr = reg_deletekey_recursive(mem_ctx, key, subkey_name);\n \t\tif (!W_ERROR_IS_OK(werr)) {\n\nModified: branches/SAMBA_3_0_26/source/registry/reg_api.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/registry/reg_api.c\t2007-06-22 11:21:59 UTC (rev 23583)\n+++ branches/SAMBA_3_0_26/source/registry/reg_api.c\t2007-06-22 11:42:17 UTC (rev 23584)\n@@ -691,7 +691,6 @@\n \tTALLOC_CTX *mem_ctx = NULL;\n \tWERROR werr = WERR_OK;\n \tstruct registry_key *key;\n-\tuint32 idx = 0;\n \tchar *subkey_name = NULL;\n \n \tmem_ctx = talloc_new(ctx);\n@@ -706,14 +705,8 @@\n \t\tgoto done;\n \t}\n \n-\t/* NOTE: we *must not* increment idx in this loop since\n-\t * the list of subkeys shrinks with each loop body. \n-\t * so this way, we repeatedly delete the *first* entry\n-\t * of a shrinking list. */\n-\tfor (idx = 0;\n-\t     W_ERROR_IS_OK(werr = reg_enumkey(mem_ctx, key, idx,\n-\t\t\t     \t\t      &subkey_name, NULL));\n-\t    ) \n+\twhile (W_ERROR_IS_OK(werr = reg_enumkey(mem_ctx, key, 0,\n+\t\t\t\t\t\t&subkey_name, NULL))) \n \t{\n \t\twerr = reg_deletekey_recursive(mem_ctx, key, subkey_name);\n \t\tif (!W_ERROR_IS_OK(werr)) {\n\n"}