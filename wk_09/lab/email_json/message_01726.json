{"category": "ham", "to_address": "Volker.Lendecke@SerNet.DE", "from_address": "simo <idra@samba.org>", "subject": "Re: wrt inotify problem", "body": "On Tue, 2007-04-10 at 18:14 +0200, Volker Lendecke wrote:\n> On Tue, Apr 10, 2007 at 12:03:31PM -0400, simo wrote:\n> > > Is there a specific errno that this gives?\n> > \n> > Yes sorry, as pasted on IRC:\n> >  vl, ioctl(28, FIONREAD, [0])                = -1 EACCES\n> > (Permission denied)\n> \n> Ok, this is really broken. SELinux allows us to set up\n> everything necessary for inotify but then when something\n> happens gives us an access denied? Very weird. Trying to\n> find a fix.\n\nYes I think this is what happens, I will have a fixed policy tomorrow\nhopefully.\n\n> Can you get me a full strace leading up to this error?\n\nThis is the loop from one ioctl to the next, I can reproduce a full\nsession strace if you need it.\n\nstat64(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=3519, ...}) = 0\ntime(NULL)                              = 1176220085\nstat64(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=3519, ...}) = 0\nstat64(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=3519, ...}) = 0\nstat64(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=3519, ...}) = 0\nsend(29, \"<27>Apr 10 11:48:05 smbd[4071]: \"..., 100, MSG_NOSIGNAL) = 100\ngeteuid32()                             = 16777221\nwrite(15, \"[2007/04/10 11:48:05, 0] smbd/no\"..., 68) = 68\ntime(NULL)                              = 1176220085\nstat64(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=3519, ...}) = 0\nstat64(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=3519, ...}) = 0\nstat64(\"/etc/localtime\", {st_mode=S_IFREG|0644, st_size=3519, ...}) = 0\nsend(29, \"<27>Apr 10 11:48:05 smbd[4071]: \"..., 58, MSG_NOSIGNAL) = 58\ngeteuid32()                             = 16777221\nwrite(15, \"  No data on inotify fd?!\\n\", 26) = 26\ngettimeofday({1176220085, 153495}, NULL) = 0\nselect(29, [5 23 28], [], NULL, {60, 0}) = 2 (in [23 28], left {60, 0})\nioctl(28, FIONREAD, [0])                = -1 EACCES (Permission denied)\n\n-- \nSimo Sorce\nSamba Team GPL Compliance Officer\nemail: idra@samba.org\nhttp://samba.org\n\n"}