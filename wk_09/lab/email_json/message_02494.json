{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r22170 - in branches/SAMBA_4_0:\n\tsource/script/tests testprogs/blackbox", "body": "Author: abartlet\nDate: 2007-04-11 12:10:40 +0000 (Wed, 11 Apr 2007)\nNew Revision: 22170\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22170\n\nLog:\nTo get the smbclient blackbox test to pass again, we need to get the\nprivate dir to contain a valid machine account.\n\nIt isn't really valid it use the DC's account any more, so extend this\nscript to also join the domain.  This nicely tests out some previously\nuntested code too!\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/script/tests/selftest.pl\n   branches/SAMBA_4_0/testprogs/blackbox/test_smbclient.sh\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/script/tests/selftest.pl\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-11 11:43:07 UTC (rev 22169)\n+++ branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-11 12:10:40 UTC (rev 22170)\n@@ -448,6 +448,14 @@\n \n \tmy $abs_srcdir = cwd();\n \n+\tmkdir \"$prefix/client\" unless -d \"$prefix/client\";\n+\t\n+\tif ( -d \"$prefix/client/private\" ) {\n+\t        unlink <$prefix/client/private/*>;\n+\t} else {\n+\t        mkdir(\"$prefix/client/private\");\n+\t}\n+\n \topen(CF, \">$conffile\");\n \tprint CF \"[global]\\n\";\n \tif (defined($ENV{VALGRIND})) {\n@@ -456,8 +464,7 @@\n \t\tprint CF \"\\ticonv:native = false\\n\";\n \t}\n \tprint CF \n-\"\tnetbios name = localtest\n-\tnetbios aliases = localhost\n+\"\tnetbios name = client\n \";\n \tif (defined($vars->{DOMAIN})) {\n \t\tprint CF \"\\tworkgroup = $vars->{DOMAIN}\\n\";\n@@ -465,9 +472,6 @@\n \tif (defined($vars->{REALM})) {\n \t\tprint CF \"\\trealm = $vars->{REALM}\\n\";\n \t}\n-\tif (defined($vars->{PIDDIR})) {\n-\t\tprint CF \"\\tpid directory = $vars->{PIDDIR}\\n\";\n-\t}\n \tif (defined($vars->{NCALRPCDIR})) {\n \t\tprint CF \"\\tncalrpc dir = $vars->{NCALRPCDIR}\\n\";\n \t}\n@@ -475,6 +479,7 @@\n \t\tprint CF \"\\twinbindd socket directory = $vars->{WINBINDD_SOCKET_DIR}\\n\";\n \t}\n \tprint CF \"\n+        private dir = $abs_srcdir/$prefix/client/private\n \tjs include = $abs_srcdir/scripting/libjs\n \tname resolve order = bcast\n \tinterfaces = $interfaces\n@@ -483,8 +488,8 @@\n \tnotify:inotify = false\n \tldb:nosync = true\n \tsystem:anonymous = true\n+\ttorture:basedir = ./st\n #We don't want to pass our self-tests if the PAC code is wrong\n-\ttorture:basedir = ./st\n \tgensec:require_pac = true\n \";\n \tclose(CF);\n\nModified: branches/SAMBA_4_0/testprogs/blackbox/test_smbclient.sh\n===================================================================\n--- branches/SAMBA_4_0/testprogs/blackbox/test_smbclient.sh\t2007-04-11 11:43:07 UTC (rev 22169)\n+++ branches/SAMBA_4_0/testprogs/blackbox/test_smbclient.sh\t2007-04-11 12:10:40 UTC (rev 22170)\n@@ -37,6 +37,8 @@\n \treturn $?\n }\n \n+testit \"domain join\" $VALGRIND bin/net join $DOMAIN $CONFIGURATION  -W \"$DOMAIN\" -U\"$USERNAME%$PASSWORD\" $@ || failed=`expr $failed + 1`\n+\n # Generate random file\n cat >tmpfile<<EOF\n foo\n\n"}