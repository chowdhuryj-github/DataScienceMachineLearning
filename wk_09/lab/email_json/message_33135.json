{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "svn commit: samba r23021 - in\n\tbranches/SAMBA_4_0/source/lib/util/tests: .", "body": "Author: tridge\nDate: 2007-05-20 10:21:14 +0000 (Sun, 20 May 2007)\nNew Revision: 23021\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23021\n\nLog:\n\ntest some boundary conditions for idtree, after I saw some suspicious\nbehaviour\n\nModified:\n   branches/SAMBA_4_0/source/lib/util/tests/idtree.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/lib/util/tests/idtree.c\n===================================================================\n--- branches/SAMBA_4_0/source/lib/util/tests/idtree.c\t2007-05-20 09:44:03 UTC (rev 23020)\n+++ branches/SAMBA_4_0/source/lib/util/tests/idtree.c\t2007-05-20 10:21:14 UTC (rev 23021)\n@@ -26,7 +26,7 @@\n static bool torture_local_idtree_simple(struct torture_context *tctx)\n {\n \tstruct idr_context *idr;\n-\tint i;\n+\tint i, ret;\n \tint *ids;\n \tint *present;\n \textern int torture_numops;\n@@ -92,6 +92,23 @@\n \t\t}\n \t}\n \n+\t/* now test some limits */\n+\tfor (i=0;i<25000;i++) {\n+\t\tret = idr_get_new_above(idr, &ids[0], random() % 25000, 0x10000-3);\n+\t\ttorture_assert(tctx, ret != -1, \"idr_get_new_above failed\");\n+\t}\n+\n+\tret = idr_get_new_above(idr, &ids[0], 0x10000-2, 0x10000);\n+\ttorture_assert_int_equal(tctx, ret, 0x10000-2, \"idr_get_new_above failed\");\n+\tret = idr_get_new_above(idr, &ids[0], 0x10000-1, 0x10000);\n+\ttorture_assert_int_equal(tctx, ret, 0x10000-1, \"idr_get_new_above failed\");\n+\tret = idr_get_new_above(idr, &ids[0], 0x10000, 0x10000);\n+\ttorture_assert_int_equal(tctx, ret, 0x10000, \"idr_get_new_above failed\");\n+\tret = idr_get_new_above(idr, &ids[0], 0x10000+1, 0x10000);\n+\ttorture_assert_int_equal(tctx, ret, -1, \"idr_get_new_above succeeded above limit\");\n+\tret = idr_get_new_above(idr, &ids[0], 0x10000+2, 0x10000);\n+\ttorture_assert_int_equal(tctx, ret, -1, \"idr_get_new_above succeeded above limit\");\n+\n \ttorture_comment(tctx, \"cleaned up\\n\");\n \treturn true;\n }\n\n"}