{"category": "ham", "to_address": "Volker.Lendecke@SerNet.DE", "from_address": "tridge@samba.org", "subject": "Re: getting rid of mkproto.sh from Samba3", "body": "Volker,\n\n > Just FYI: I'm scared of the Samba 4 build system, so it\n > would take a bit to persuade me. The Samba 3 Makefile is a\n > huge mess, but you have a chance. In Samba 4, no way to\n > figure out anything if something goes wrong.\n\nYou don't need to use the Samba4 build system to have separate\nincludes for generated prototypes. Just have a target in Makefile.in\nfor each subsys_proto.h you want. It is a couple of Makefile lines per\nsubsystem.\n\n > And, I would *like* to keep our includes.h. It is a\n > nightmare in Samba 4 to pick all necessary includes, and\n > this will fill very quickly with obsolete includes if you\n > change something.\n\nSee the script/minimal_includes.h script, which works out which\ninclude files can be removed. So you run:\n\n  script/minimal_includes.pl\n\nand it tells you things like this:\n\n Processing common/ctdb_recover.c (with 709 lines)\n   common/ctdb_recover.c: might be able to remove #include \"lib/events/events.h\"\n   common/ctdb_recover.c: might be able to remove #include \"lib/tdb/include/tdb.h\"\n   common/ctdb_recover.c: might be able to remove #include \"system/wait.h\"\n   common/ctdb_recover.c: might be able to remove #include \"lib/util/dlinklist.h\"\n\nAs for the 'nightmare' to pick the right includes, I think you will\nfind it is not so hard, and it is essential if you want to get rid of\nthe problems raised in this thread. With a single includes.h you won't\nget the incremental builds for example.\n\nCheers, Tridge\n\n"}