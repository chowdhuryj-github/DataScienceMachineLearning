{"category": "ham", "to_address": "\"perl6-internals@perl.org\" <perl6-internals@perl.org>", "from_address": "Jonathan Worthington <jonathan@jnthn.net>", "subject": "find_method changes look wrong", "body": "Hi,\n\nJust looking at the Class and Object PMCs and a couple of things concern me.\n\n1) Inside the method finding code I see this has been added:\n\n         if (  ! PMC_IS_NULL(namespace)\n            &&  VTABLE_exists_keyed_str(interp, namespace, name)) {\n            PMC *ret = VTABLE_get_pmc_keyed_str(interp, namespace, name);\n            PCCRETURN(PMC *ret);\n        }\n\nWhich is in contradiction with PDD15:\n\n\"Since the method list and vtable override list are stored in the class \nPMC, method finding is a lookup on the class object and not a lookup in \nthe namespace.\"\n\n2) find_method used to be implemented in the Object PMC. I see now that \nthere is a find_method PCCMETHOD in the Class PMC that the Object PMC \ncalls. This is bad, since all PCCMETHODs are eventually supposed to be \nmoved out to a role so we don't pollute the method \"namespace\" or a \nClass with things that other languages don't want. That means that \nObject should not rely on there being a find_method PCCMETHOD in the class.\n\nTo me it feels wrong for it to be there anyway. Class methods are \ndistinct from object methods. The PCCMETHODs described in PDD15 are \nmethods of an instance of Class. The things that you add_method'd to a \nclass are methods of objects instantiated from the class.\n\nThanks,\n\nJonathan\n\n"}