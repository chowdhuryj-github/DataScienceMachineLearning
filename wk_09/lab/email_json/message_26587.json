{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "derrell@samba.org", "subject": "svn commit: samba r22772 - in branches/SAMBA_3_0/source: .\n\tlib/replace", "body": "Author: derrell\nDate: 2007-05-10 01:27:18 +0000 (Thu, 10 May 2007)\nNew Revision: 22772\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22772\n\nLog:\n\n- Still working on the fact that readahead() is not declared (on at least one\n  OS) but is available for linking.  Instead of running configure tests with\n  -Werror-implicit-function-declaration in developer mode (which may lead to\n  different library functions being used in developer mode than when not in\n  developer mode), add tests for whether readahead is declared.  If not,\n  provide a replacement declaration in lib/replace.\n\nModified:\n   branches/SAMBA_3_0/source/configure.in\n   branches/SAMBA_3_0/source/lib/replace/README\n   branches/SAMBA_3_0/source/lib/replace/libreplace.m4\n   branches/SAMBA_3_0/source/lib/replace/replace.h\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/configure.in\n===================================================================\n--- branches/SAMBA_3_0/source/configure.in\t2007-05-09 21:38:41 UTC (rev 22771)\n+++ branches/SAMBA_3_0/source/configure.in\t2007-05-10 01:27:18 UTC (rev 22772)\n@@ -1337,19 +1337,6 @@\n # implicit declaration warnings without failing the test (in developer mode)\n ac_no_error_on_warning_CFLAGS=\"${CFLAGS}\"\n \n-# Since --enable-developer causes warnings to be treated as errors during\n-# compilation, we should avoid using features that will fail to compile.\n-#\n-# We don't want to enable this earlier because the built-in functions such as\n-# memset fail to configure properly.\n-\n-if test x\"$samba_cv_HAVE_Werror_implicit_function_declaration\" = x\"yes\" -a \\\n-        x\"$developer\" = xyes; then\n-  CFLAGS=\"${CFLAGS} -Werror-implicit-function-declaration\"\n-  ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n-  ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n-fi\n-\n echo -n \"checking for GPFS GPL libs... \"\n save_LIBS=\"$LIBS\"\n LIBS=\"$LIBS -lgpfs_gpl\"\n\nModified: branches/SAMBA_3_0/source/lib/replace/README\n===================================================================\n--- branches/SAMBA_3_0/source/lib/replace/README\t2007-05-09 21:38:41 UTC (rev 22771)\n+++ branches/SAMBA_3_0/source/lib/replace/README\t2007-05-10 01:27:18 UTC (rev 22772)\n@@ -55,6 +55,11 @@\n socketpair\n strptime\n \n+These external declarations are provided for those systems which lack the\n+declaration but provide the function:\n+\n+readahead\n+\n Types:\n bool\n socklen_t\n\nModified: branches/SAMBA_3_0/source/lib/replace/libreplace.m4\n===================================================================\n--- branches/SAMBA_3_0/source/lib/replace/libreplace.m4\t2007-05-09 21:38:41 UTC (rev 22771)\n+++ branches/SAMBA_3_0/source/lib/replace/libreplace.m4\t2007-05-10 01:27:18 UTC (rev 22772)\n@@ -155,6 +155,7 @@\n AC_HAVE_DECL(setresuid, [#include ])\n AC_HAVE_DECL(setresgid, [#include ])\n AC_HAVE_DECL(errno, [#include ])\n+AC_HAVE_DECL(readahead, [#include ])\n \n AC_CACHE_CHECK([for secure mkstemp],samba_cv_HAVE_SECURE_MKSTEMP,[\n AC_TRY_RUN([#include \n\nModified: branches/SAMBA_3_0/source/lib/replace/replace.h\n===================================================================\n--- branches/SAMBA_3_0/source/lib/replace/replace.h\t2007-05-09 21:38:41 UTC (rev 22771)\n+++ branches/SAMBA_3_0/source/lib/replace/replace.h\t2007-05-10 01:27:18 UTC (rev 22772)\n@@ -111,6 +111,11 @@\n extern int errno;\n #endif\n \n+#if defined(HAVE_LINUX_READAHEAD) && ! defined(HAVE_READAHEAD_DECL)\n+ssize_t readahead(int fd, off64_t offset, size_t count);\n+#endif\n+\n+\n #ifndef HAVE_STRDUP\n #define strdup rep_strdup\n char *rep_strdup(const char *s);\n\n"}