{"category": "ham", "to_address": "\"Patnaik, Tirthankar \" <tirthankar.patnaik@citi.com>", "from_address": "Petr PIKAL <petr.pikal@precheza.cz>", "subject": "[R] Odp:  Conditional Sums for Index creation", "body": "Hi\n\nthere probably is not an easy out of box solution. Some use can be in rle \nfunction e.g.\n\n> apply(apply(ac,2,function(x) (is.na(x))),2, function(x) \nrle(x)$values[1])\n   V1    V2    V3    V4    V5 \nFALSE FALSE FALSE  TRUE  TRUE \n\ngives you columns which start with NA and\n\n> apply(apply(ac,2,function(x) (is.na(x))),2, function(x) \nrle(x)$lengths[1])\nV1 V2 V3 V4 V5 \n 9  6  6  5 10 \n>\n\ngives you length of NA consecutive sequence in each column. Then you can \nelaborate a condition which will compute rowSums differently for a \nparticular row. E.g. when there is a TRUE value take a number for that \ngiven column and increase it by one. You will get row number for which you \nneed rowSum with and without this particular column.\n\nRegards\n\nPetr Pikal\npetr.pikal@precheza.cz\n\nr-help-bounces@stat.math.ethz.ch napsal dne 14.05.2007 08:23:01:\n\n> Hi,\n>    Apologies for the long mail. I have a data.frame with columns of\n> price/mcap data for a portfolio of stocks, and the date. To get the\n> total value of the portfolio on a daily basis, I calculate rowSums of\n> the data.frame. \n> \n> > set.seed(1)\n> > ab <- matrix(round(runif(100)*100),nrow=20,ncol=5)\n> > ab[1:5,4:5] <- NA\n> > ab[6:10,5] <- NA\n> > ac <- as.data.frame(ifelse(ab <= 7,NA,ab))\n> > ac\n>    V1 V2 V3 V4 V5\n> 1  27 93 82 NA NA\n> 2  37 21 65 NA NA\n> 3  57 65 78 NA NA\n> 4  91 13 55 NA NA\n> 5  20 27 53 NA NA\n> 6  90 39 79 26 NA\n> 7  94 NA NA 48 NA\n> 8  66 38 48 77 NA\n> 9  63 87 73  8 NA\n> 10 NA 34 69 88 NA\n> 11 21 48 48 34 24\n> 12 18 60 86 84 NA\n> 13 69 49 44 35 64\n> 14 38 19 24 33 88\n> 15 77 83 NA 48 78\n> 16 50 67 10 89 80\n> 17 72 79 32 86 46\n> 18 99 11 52 39 41\n> 19 38 72 66 78 81\n> 20 78 41 41 96 60\n> > \n> \n> Here the rows 1:20 are dates (also in my data.frame). \n> \n> Since some of the prices have NA, the rowSums is made to ignore these\n> entries. \n> \n> > rowSums(ac,na.rm=TRUE)\n>   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18\n> 19  20 \n> 202 123 200 159 100 234 142 229 231 191 175 248 261 202 286 296 315 242\n> 335 316 \n> > \n> \n> Stocks are being added to the portfolio too. So from date=6 (or row=6)\n> we have the 4th stock V4, and from date=11, we have the 5th stock V5. My\n> problem is that I need to calculate the rowSums for row=6 (When a new\n> stock was added), _with_ and _without_ the new stock. So my answer for\n> row=6 would be 234 for the plain row-sum, and 234 - 26 = 208 for the\n> original set of stocks (without V4). Similarly, my answer for row=11\n> would be 175 for the plain sum, and 175 - 24 = 151 for the original sum\n> (without V5). \n> \n> Basically I'm interested in finding out the value of the portfolio with\n> and without the new stock for the purposes of creating an index. It's\n> possible that some stocks my get dropped later, in which case there\n> would be an NA series starting for say V1 at row=18 and so on. In that\n> case, the aim would be to find the sum at row=18 with and without the\n> value of V1. \n> \n> Is there any way I can get the sum over columns, deleting specific\n> colums? To get the columns that are NA in any row, I tried (shown for\n> the first 12 rows):\n> \n> > apply(ac[1:12,],1,function(y)which(is.na(y)))\n> \n> Which correctly gives \n> \n> $`1`\n> V4 V5 \n>  4  5 \n> \n> $`2`\n> V4 V5 \n>  4  5 \n> \n> $`3`\n> V4 V5 \n>  4  5 \n> \n> $`4`\n> V4 V5 \n>  4  5 \n> \n> $`5`\n> V4 V5 \n>  4  5 \n> \n> $`6`\n> V5 \n>  5 \n> \n> $`7`\n> V2 V3 V5 \n>  2  3  5 \n> \n> $`8`\n> V5 \n>  5 \n> \n> $`9`\n> V5 \n>  5 \n> \n> $`10`\n> V1 V5 \n>  1  5 \n> \n> $`11`\n> integer(0)\n> \n> $`12`\n> V5 \n>  5 \n> \n> > \n> \n> But now I'm stuck. I don't how to use this list of indices at each row\n> to exclude my columns. \n> \n> Any pointers please? Would such an exercise be easier if I use a\n> time-series based object, like a zoo.\n> \n> \n> TIA and best,\n> -Tir\n> \n> Tirthankar Patnaik\n> India Strategy\n> Citigroup Investment Research\n> +91-22-6631 9887\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide \nhttp://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}