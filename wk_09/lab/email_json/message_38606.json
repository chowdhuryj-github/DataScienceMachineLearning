{"category": "ham", "to_address": "perl6-internals@perl.org", "from_address": "Will Coleda <will@coleda.com>", "subject": "Re: [perl #43070] [BUG] Can't build shared on darwin ", "body": "This is due to config/init/hints/darwin.pm, which hardcodes \"/usr/ \nlocal/...\" to the path.\n\nA fix which works only in a non-install variety of parrot would be:\n\n=== config/init/hints/darwin.pm\n==================================================================\n--- config/init/hints/darwin.pm (revision 5655)\n+++ config/init/hints/darwin.pm (local)\n@@ -21,7 +21,9 @@\n          }\n      }\n-    $ldflags .= \" -L\" . $conf->data->get('build_dir') . \"/blib/lib\";\n+    my $lib_dir = $conf->data->get('build_dir') . \"/blib/lib\";\n+\n+    $ldflags .= \" -L$lib_dir\";\n      $ccflags .= \" -pipe -fno-common -Wno-long-double \";\n      $ccflags =~ s/-flat_namespace\\s*//;\n      $ldflags =~ s/-flat_namespace\\s*//;\n@@ -52,10 +54,10 @@\n          # XXX ugly hack for rpath_lib in config/inter/libparrot.pm\n          rpath            => \"-L\",\n          libparrot_soname => \"-install_name \"\n-            . $conf->data->get('lib_dir')\n+            . $lib_dir\n              . $conf->data->get('slash')\n              . \"libparrot\"\n              . $conf->data->get('share_ext')\n\n\nGiven that install is generally considered borked, I'd tend to apply  \nthis.\n\n\nOn May 29, 2007, at 5:04 PM, Will Coleda (via RT) wrote:\n\n> # New Ticket Created by  Will Coleda\n> # Please include the string:  [perl #43070]\n> # in the subject line of all future correspondence about this issue.\n> # \n>\n>\n> Using a config of:\n>\n> CC=\"ccache gcc-4.0\"\n> CX=\"ccache g++-4.0\"\n> perl Configure.pl --cc=\"$CC\" --cxx=\"$CX\" --link=\"$CX\" --ld=\"$CX\"\n>  --parrot_is_shared $@\n>\n> parrot seems to build ok on darwin/intel, but dies later during the  \n> build\n> with:\n>\n> perl -MExtUtils::Command -e rm_rf PAST.pbc\n> ../../runtime/parrot/library/PAST.pbc\n> ../../parrot -o PAST.pbc --output-pbc PAST.pir\n> dyld: Library not loaded: /usr/local/lib/libparrot.dylib\n>   Referenced from: /Users/coke/research/parrot2/compilers/ \n> past/../../parrot\n>   Reason: image not found\n> make[1]: *** [PAST.pbc] Trace/BPT trap\n> make: *** [compilers.dummy] Error 2\n>\n> $ otool -l parrot | grep libparrot.dylib\n>          name /usr/local/lib/libparrot.dylib (offset 24)\n>\n> I'm guessing that shouldn't be pointing to /usr/local, as I didn't  \n> install.\n>\n> If I do a symbolic link from there back to the build version in my  \n> dev area,\n> the build completes.\n>\n\n--\nWill \"Coke\" Coleda\nwill@coleda.com\n\n\n"}