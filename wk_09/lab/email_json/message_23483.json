{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 259: allow the events system to be chosen on the command line\n\tin http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 259\nrevision-id: tridge@samba.org-20070505071843-gdt3kgn66sa3xds0\nparent: tridge@samba.org-20070505071806-hatj3yhl0nl335p3\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-05-05 17:18:43 +1000\nmessage:\n  allow the events system to be chosen on the command line\nmodified:\n  common/cmdline.c               cmdline.c-20070416041216-w1zvz91bkdsgjckw-1\n=== modified file 'common/cmdline.c'\n--- a/common/cmdline.c\t2007-05-03 01:06:24 +0000\n+++ b/common/cmdline.c\t2007-05-05 07:18:43 +0000\n@@ -37,6 +37,7 @@\n \tconst char *db_dir;\n \tint torture;\n \tconst char *logfile;\n+\tconst char *events;\n } ctdb_cmdline = {\n \t.nlist = NULL,\n \t.transport = \"tcp\",\n@@ -45,11 +46,26 @@\n \t.self_connect = 0,\n \t.db_dir = NULL,\n \t.torture = 0,\n-\t.logfile = NULL\n+\t.logfile = NULL,\n };\n \n+enum {OPT_EVENTSYSTEM=1};\n+\n+static void ctdb_cmdline_callback(poptContext con, \n+\t\t\t\t  enum poptCallbackReason reason,\n+\t\t\t\t  const struct poptOption *opt,\n+\t\t\t\t  const char *arg, const void *data)\n+{\n+\tswitch (opt->val) {\n+\tcase OPT_EVENTSYSTEM:\n+\t\tevent_set_default_backend(arg);\n+\t\tbreak;\n+\t}\n+}\n+\n \n struct poptOption popt_ctdb_cmdline[] = {\n+\t{ NULL, 0, POPT_ARG_CALLBACK, (void *)ctdb_cmdline_callback },\t\n \t{ \"nlist\", 0, POPT_ARG_STRING, &ctdb_cmdline.nlist, 0, \"node list file\", \"filename\" },\n \t{ \"listen\", 0, POPT_ARG_STRING, &ctdb_cmdline.myaddress, 0, \"address to listen on\", \"address\" },\n \t{ \"socket\", 0, POPT_ARG_STRING, &ctdb_cmdline.socketname, 0, \"local socket name\", \"filename\" },\n@@ -59,6 +75,7 @@\n \t{ \"dbdir\", 0, POPT_ARG_STRING, &ctdb_cmdline.db_dir, 0, \"directory for the tdb files\", NULL },\n \t{ \"torture\", 0, POPT_ARG_NONE, &ctdb_cmdline.torture, 0, \"enable nastiness in library\", NULL },\n \t{ \"logfile\", 0, POPT_ARG_STRING, &ctdb_cmdline.logfile, 0, \"log file location\", \"filename\" },\n+\t{ \"events\", 0, POPT_ARG_STRING, NULL, OPT_EVENTSYSTEM, \"event system\", NULL },\n \t{ NULL }\n };\n \n\n"}