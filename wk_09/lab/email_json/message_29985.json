{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "svn commit: samba r22881 - in\n\tbranches/SAMBA_4_0/source/torture/raw: .", "body": "Author: tridge\nDate: 2007-05-15 05:42:16 +0000 (Tue, 15 May 2007)\nNew Revision: 22881\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22881\n\nLog:\nshow number of connected clients\nModified:\n   branches/SAMBA_4_0/source/torture/raw/lockbench.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/torture/raw/lockbench.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/raw/lockbench.c\t2007-05-15 05:38:33 UTC (rev 22880)\n+++ branches/SAMBA_4_0/source/torture/raw/lockbench.c\t2007-05-15 05:42:16 UTC (rev 22881)\n@@ -44,6 +44,7 @@\n \n static int nprocs;\n static int lock_failed;\n+static int num_connected;\n \n struct benchlock_state {\n \tstruct event_context *ev;\n@@ -115,6 +116,11 @@\n \t}\n \tstate->req->async.private = state;\n \tstate->req->async.fn      = lock_completion;\n+\n+\tnum_connected++;\n+\n+\tDEBUG(0,(\"reconnect to %s finished (%u connected)\\n\", state->dest_host,\n+\t\t num_connected));\n }\n \n /*\n@@ -168,8 +174,6 @@\n \tio->in.fallback_to_anonymous = False;\n \tio->in.workgroup    = lp_workgroup();\n \n-\tDEBUG(0,(\"reopening connection to //%s/%s\\n\", host, share));\n-\n \t/* kill off the remnants of the old connection */\n \ttalloc_free(state->tree);\n \tstate->tree = NULL;\n@@ -195,6 +199,10 @@\n \tstate->req = NULL;\n \tif (!NT_STATUS_IS_OK(status)) {\n \t\tif (NT_STATUS_EQUAL(status, NT_STATUS_END_OF_FILE)) {\n+\t\t\ttalloc_free(state->tree);\n+\t\t\tstate->tree = NULL;\n+\t\t\tnum_connected--;\t\n+\t\t\tDEBUG(0,(\"reopening connection to %s\\n\", state->dest_host));\n \t\t\tevent_add_timed(state->ev, state->mem_ctx, \n \t\t\t\t\ttimeval_current_ofs(1,0), \n \t\t\t\t\treopen_connection, state);\n@@ -247,6 +255,8 @@\n \t\t\t\t\t\t      cli->tree->device);\n \t}\n \n+\tnum_connected = i;\n+\n \tif (!torture_setup_dir(cli, BASEDIR)) {\n \t\tgoto failed;\n \t}\n\n"}