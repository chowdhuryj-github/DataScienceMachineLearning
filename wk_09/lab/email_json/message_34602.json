{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r23088 - in branches: SAMBA_3_0/source/smbd\n\tSAMBA_3_0_25/source/smbd SAMBA_3_0_26/source/smbd", "body": "Author: jra\nDate: 2007-05-22 23:56:47 +0000 (Tue, 22 May 2007)\nNew Revision: 23088\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23088\n\nLog:\nFix rename for cifsfs client. This may be needed for\n3.0.25a.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/smbd/reply.c\n   branches/SAMBA_3_0_25/source/smbd/reply.c\n   branches/SAMBA_3_0_26/source/smbd/reply.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/smbd/reply.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/reply.c\t2007-05-22 22:35:13 UTC (rev 23087)\n+++ branches/SAMBA_3_0/source/smbd/reply.c\t2007-05-22 23:56:47 UTC (rev 23088)\n@@ -4310,10 +4310,10 @@\n \t\treturn NT_STATUS_OBJECT_NAME_COLLISION;\n \t}\n \n-\tstatus = can_rename(conn,newname,attrs,&sbuf);\n+\tstatus = can_rename(conn,fsp->fsp_name,attrs,&sbuf);\n \n \tif (dest_exists && !NT_STATUS_IS_OK(status)) {\n-\t\tDEBUG(3,(\"rename_internals: Error %s rename %s -> %s\\n\",\n+\t\tDEBUG(3,(\"rename_internals_fsp: Error %s rename %s -> %s\\n\",\n \t\t\tnt_errstr(status), fsp->fsp_name,newname));\n \t\tif (NT_STATUS_EQUAL(status,NT_STATUS_SHARING_VIOLATION))\n \t\t\tstatus = NT_STATUS_ACCESS_DENIED;\n\nModified: branches/SAMBA_3_0_25/source/smbd/reply.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/smbd/reply.c\t2007-05-22 22:35:13 UTC (rev 23087)\n+++ branches/SAMBA_3_0_25/source/smbd/reply.c\t2007-05-22 23:56:47 UTC (rev 23088)\n@@ -4260,10 +4260,10 @@\n \t\treturn NT_STATUS_OBJECT_NAME_COLLISION;\n \t}\n \n-\tstatus = can_rename(conn,newname,attrs,&sbuf);\n+\tstatus = can_rename(conn,fsp->fsp_name,attrs,&sbuf);\n \n \tif (dest_exists && !NT_STATUS_IS_OK(status)) {\n-\t\tDEBUG(3,(\"rename_internals: Error %s rename %s -> %s\\n\",\n+\t\tDEBUG(3,(\"rename_internals_fsp: Error %s rename %s -> %s\\n\",\n \t\t\tnt_errstr(status), fsp->fsp_name,newname));\n \t\tif (NT_STATUS_EQUAL(status,NT_STATUS_SHARING_VIOLATION))\n \t\t\tstatus = NT_STATUS_ACCESS_DENIED;\n\nModified: branches/SAMBA_3_0_26/source/smbd/reply.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/smbd/reply.c\t2007-05-22 22:35:13 UTC (rev 23087)\n+++ branches/SAMBA_3_0_26/source/smbd/reply.c\t2007-05-22 23:56:47 UTC (rev 23088)\n@@ -4308,10 +4308,10 @@\n \t\treturn NT_STATUS_OBJECT_NAME_COLLISION;\n \t}\n \n-\tstatus = can_rename(conn,newname,attrs,&sbuf);\n+\tstatus = can_rename(conn,fsp->fsp_name,attrs,&sbuf);\n \n \tif (dest_exists && !NT_STATUS_IS_OK(status)) {\n-\t\tDEBUG(3,(\"rename_internals: Error %s rename %s -> %s\\n\",\n+\t\tDEBUG(3,(\"rename_internals_fsp: Error %s rename %s -> %s\\n\",\n \t\t\tnt_errstr(status), fsp->fsp_name,newname));\n \t\tif (NT_STATUS_EQUAL(status,NT_STATUS_SHARING_VIOLATION))\n \t\t\tstatus = NT_STATUS_ACCESS_DENIED;\n\n"}