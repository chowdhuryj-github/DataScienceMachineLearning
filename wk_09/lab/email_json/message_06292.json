{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 106: added --dblist option to ctdbd,\n\tto allow list of databases to be specified on the command line in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 106\nrevision-id: tridge@samba.org-20070415232910-a604c82b6945e169\nparent: tridge@samba.org-20070415225857-c848786395133f34\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Mon 2007-04-16 09:29:10 +1000\nmessage:\n  added --dblist option to ctdbd, to allow list of databases to be specified on the command line\nmodified:\n  direct/ctdbd.c                 ctdbd.c-20070411085044-dqmhr6mfeexnyt4m-1\n=== modified file 'direct/ctdbd.c'\n--- a/direct/ctdbd.c\t2007-04-15 04:39:23 +0000\n+++ b/direct/ctdbd.c\t2007-04-15 23:29:10 +0000\n@@ -43,12 +43,13 @@\n int main(int argc, const char *argv[])\n {\n \tstruct ctdb_context *ctdb;\n-\tstruct ctdb_db_context *ctdb_db;\n \tconst char *nlist = NULL;\n \tconst char *transport = \"tcp\";\n \tconst char *myaddress = NULL;\n \tint self_connect=0;\n \tint daemon_mode=0;\n+\tconst char *db_list = \"test.tdb\";\n+\tchar *s, *tok;\n \n \tstruct poptOption popt_options[] = {\n \t\tPOPT_AUTOHELP\n@@ -57,6 +58,7 @@\n \t\t{ \"transport\", 0, POPT_ARG_STRING, &transport, 0, \"protocol transport\", NULL },\n \t\t{ \"self-connect\", 0, POPT_ARG_NONE, &self_connect, 0, \"enable self connect\", \"boolean\" },\n \t\t{ \"daemon\", 0, POPT_ARG_NONE, &daemon_mode, 0, \"spawn a ctdb daemon\", \"boolean\" },\n+\t\t{ \"dblist\", 0, POPT_ARG_STRING, &db_list, 0, \"list of databases\", NULL },\n \t\tPOPT_TABLEEND\n \t};\n \tint opt;\n@@ -127,11 +129,18 @@\n \t\texit(1);\n \t}\n \n-\t/* attach to a specific database */\n-\tctdb_db = ctdb_attach(ctdb, \"test.tdb\", TDB_DEFAULT, O_RDWR|O_CREAT|O_TRUNC, 0666);\n-\tif (!ctdb_db) {\n-\t\tprintf(\"ctdb_attach failed - %s\\n\", ctdb_errstr(ctdb));\n-\t\texit(1);\n+\t/* attach to the list of databases */\n+\ts = talloc_strdup(ctdb, db_list);\n+\tfor (tok=strtok(s, \", \"); tok; tok=strtok(NULL, \", \")) {\n+\t\tstruct ctdb_db_context *ctdb_db;\n+\t\tctdb_db = ctdb_attach(ctdb, tok, TDB_DEFAULT, \n+\t\t\t\t      O_RDWR|O_CREAT|O_TRUNC, 0666);\n+\t\tif (!ctdb_db) {\n+\t\t\tprintf(\"ctdb_attach to '%s'failed - %s\\n\", tok, \n+\t\t\t       ctdb_errstr(ctdb));\n+\t\t\texit(1);\n+\t\t}\n+\t\tprintf(\"Attached to database '%s'\\n\", tok);\n \t}\n \n \t/* start the protocol running */\n\n"}