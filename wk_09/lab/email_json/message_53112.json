{"category": "ham", "to_address": "beginners@perl.org", "from_address": "\"nobull67@gmail.com\" <nobull67@gmail.com>", "subject": "Re: Count co-occurrences", "body": "On Jun 22, 5:48 pm, andrej.kast...@siol.net (Andrej Kastrin) wrote:\n> Dear all,\n>\n> I wrote a simple sql querry to count co-occurrences between words but it\n> performs very very slow on large datasets. So, it's time to do it with\n> Perl. I need just a short tip to start out: which structure to use to\n> count all possible occurrences between letters (e.g. A, B and C) under\n> the particular document number. My dataset looks like following:\n>\n> 1 A\n> 1 B\n> 1 C\n> 1 B\n> 2 A\n> 2 A\n> 2 B\n> 2 C\n> etc. till doc. number 100.000\n>\n> The result file should than be similar to:\n> A B 4   ### 2 co-occurrences under doc. number 1 + 2 co-occurrences\n> under doc. number 2\n> A C 3   ### 1 co-occurrence under doc. number 1 + 2 co-occurrences under\n> doc. number 2\n> B C 3   ### 2 co-occurrences under doc. number 1 + 1 co-occurrence under\n> doc. number 2\n>\n> Thanks in advance for any pointers.\n>\n> Best, Andrej\n\nuse strict;\nuse warnings;\nmy %pairs;\n\n{\n    my ($prev_doc_id,%word_count,$doc_id);\n\n    # I've written this inner-sub as anonymous even though in this\n    # simple example script there's no outer sub. In the general case\n    # there would be and outer sub and perl doesn't implement nested\n    # nonymous subs.\n\n    my $add_to_total = sub {\n\tfor my $first ( keys %word_count ) {\n\t    for my $second ( keys %word_count ) {\n\t\tunless ( $first eq $second ) {\n\t\t    $pairs{\"$first $second\"} +=\n\t\t\t$word_count{$first} * $word_count{$second};\n\t\t}\n\t    }\n\t}\n\t%word_count=();\n\t$prev_doc_id = $doc_id;\n    };\n\n    while() {\n\t( $doc_id, my $word) = /^(\\d+) (\\w+)$/ or die;\n\t$add_to_total->()\n\t    unless defined $prev_doc_id && $doc_id eq $prev_doc_id;\n\t$word_count{$word}++;\n    }\n\n    $add_to_total->();\n}\n\nfor ( sort keys %pairs ) {\n    print \"$_ $pairs{$_}\\n\";\n}\n__DATA__\n1 A\n1 B\n1 C\n1 B\n2 A\n2 A\n2 B\n2 C\n\n\n-- \nTo unsubscribe, e-mail: beginners-unsubscribe@perl.org\nFor additional commands, e-mail: beginners-help@perl.org\nhttp://learn.perl.org/\n\n\n"}