{"category": "ham", "to_address": "andy@petdance.com, parrot-porters@perl.org", "from_address": "chromatic <chromatic@wgz.org>", "subject": "Re: [svn:parrot] r18643 - in trunk: include/parrot src", "body": "On Friday 25 May 2007 18:53:08 petdance@cvs.perl.org wrote:\n\n> Modified: trunk/src/objects.c\n> ===========================================================================\n>=== --- trunk/src/objects.c\u00a0(original)\n> +++ trunk/src/objects.c\u00a0Fri May 25 18:53:05 2007\n> @@ -40,10 +40,9 @@\n> \u00a0INTVAL\n> \u00a0Parrot_get_vtable_index(Interp *interp, STRING *name)\n> \u00a0{\n> - \u00a0 \u00a0char \u00a0*name_c = string_to_cstring(interp, name);\n> + \u00a0 \u00a0const char * const name_c = string_to_cstring(interp, name);\n> \u00a0 \u00a0 \u00a0INTVAL low \u00a0 \u00a0= 0;\n> \u00a0 \u00a0 \u00a0INTVAL high \u00a0 = NUM_VTABLE_FUNCTIONS - 1;\n> - \u00a0 \u00a0INTVAL i;\n> \u00a0\n> \u00a0 \u00a0 \u00a0/* some of the first \"slots\" don't have names. skip 'em. */\n> \u00a0 \u00a0 \u00a0while (!Parrot_vtable_slot_names[low]) {\n> @@ -52,16 +51,13 @@\n> \u00a0 \u00a0 \u00a0}\n> \u00a0\n> \u00a0 \u00a0 \u00a0while (low <= high) {\n> - \u00a0 \u00a0 \u00a0 \u00a0char *meth_c;\n> - \u00a0 \u00a0 \u00a0 \u00a0int \u00a0 cmp;\n> -\n> - \u00a0 \u00a0 \u00a0 \u00a0i \u00a0 \u00a0 \u00a0= (low + high) / 2;\n> - \u00a0 \u00a0 \u00a0 \u00a0meth_c = Parrot_vtable_slot_names[i];\n> + \u00a0 \u00a0 \u00a0 \u00a0const INTVAL i = (low + high) / 2;\n> + \u00a0 \u00a0 \u00a0 \u00a0const char * const meth_c = Parrot_vtable_slot_names[i];\n\nWhoops, that just broke a couple of platforms.  As I understand it, some picky \ncompilers only allow simultaneous declarations and assignments at the start \nof a function, not within any block.\n\nI realize that undoes the consting here, but portability wins.\n\n-- c\n\n"}