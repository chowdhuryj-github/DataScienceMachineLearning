{"category": "ham", "to_address": "debian-mirrors@lists.debian.org", "from_address": "carlos@fisica.ufpr.br (Carlos Carvalho)", "subject": "Re: ..weeding out bad debs off mirrors, was: Can I get some help,\n please?", "body": "Arnt Karlsen (arnt@c2i.net) wrote on 27 May 2007 23:44:\n >On Fri, 25 May 2007 14:13:45 -0300, Carlos wrote in message \n >> One can use the checksums in indices/md5sums.gz to verify the files\n >> locally. Very useful indeed... I do it periodically, because a mirror\n >> is a significant responsibility.\n >\n >..aye, but _precisely_how_ do you do it?  Playing with Rafal's\n >'zcat indices/md5sums.gz |md5sum -c |grep -v \": OK\" |grep -v ' etc\n >from the mirror root, I keep finding new innovative variations of\n >\": Failure\".\n\n zcat indices/md5sum.gz | md5sum -c > /some/path/md5sum-output 2> /dev/null\n\nYou can send stderr to a file if you want but it's not necessary.\n\nSome *hours* later (for a full mirror)...\n\n grep -v ': OK$' /some/path/md5sum-output\n\nshould give you\n\n/some/path/md5sum-output:Archive_Maintenance_In_Progress: FAILED open or read\n/some/path/md5sum-output:indices/md5sums.gz: FAILED\n\nif your mirror is correct.\n\nI also check that all the files in the tree are in md5sums (the\nconverse is already done by md5sum, which flags non-existent files).\nThe only ones that aren't should be those in project/trace. Use this:\n\n find \\! -type d \\! -type l | sed -e 's:./::' | sort > /some/path/debian-files\n zcat indices/md5sums.gz | awk '{print $2}' | sort > /some/path/debian-md5sum\n\nthen\n\n join -v1 /some/path/debian-files /some/path/debian-md5sum\n\npoints out the intruders.\n\n\n-- \nTo UNSUBSCRIBE, email to debian-mirrors-REQUEST@lists.debian.org\nwith a subject of \"unsubscribe\". Trouble? Contact listmaster@lists.debian.org\n\n"}