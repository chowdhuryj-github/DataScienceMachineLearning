{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23437 - in branches/SAMBA_3_0_26/source: param\n\tsmbd", "body": "Author: obnox\nDate: 2007-06-12 15:09:44 +0000 (Tue, 12 Jun 2007)\nNew Revision: 23437\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23437\n\nLog:\nMerge r21547 from 3_0:\n\nRefuse registry shares without path.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0_26/source/param/loadparm.c\n   branches/SAMBA_3_0_26/source/smbd/service.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/param/loadparm.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/param/loadparm.c\t2007-06-12 14:44:15 UTC (rev 23436)\n+++ branches/SAMBA_3_0_26/source/param/loadparm.c\t2007-06-12 15:09:44 UTC (rev 23437)\n@@ -2174,7 +2174,6 @@\n \t\t\t    service * pserviceDest);\n static void copy_service(service * pserviceDest,\n \t\t\t service * pserviceSource, BOOL *pcopymapDest);\n-static BOOL service_ok(int iService);\n static BOOL do_parameter(const char *pszParmName, const char *pszParmValue);\n static BOOL do_section(const char *pszSectionName);\n static void init_copymap(service * pservice);\n@@ -2994,7 +2993,7 @@\n incomplete or faulty, else True.\n ***************************************************************************/\n \n-static BOOL service_ok(int iService)\n+BOOL service_ok(int iService)\n {\n \tBOOL bRetval;\n \n@@ -3027,7 +3026,7 @@\n \t\tServicePtrs[iService]->bAvailable = False;\n \t}\n \n-\t/* If a service is flagged unavailable, log the fact at level 0. */\n+\t/* If a service is flagged unavailable, log the fact at level 1. */\n \tif (!ServicePtrs[iService]->bAvailable)\n \t\tDEBUG(1, (\"NOTE: Service %s is flagged unavailable.\\n\",\n \t\t\t  ServicePtrs[iService]->szService));\n\nModified: branches/SAMBA_3_0_26/source/smbd/service.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/smbd/service.c\t2007-06-12 14:44:15 UTC (rev 23436)\n+++ branches/SAMBA_3_0_26/source/smbd/service.c\t2007-06-12 15:09:44 UTC (rev 23437)\n@@ -322,6 +322,14 @@\n \tTALLOC_FREE(values);\n \treturn res;\n \n+\tif (!service_ok(res)) {\n+\t\t/* this is actually never reached, since \n+\t\t * service_ok only returns False if the service\n+\t\t * entry does not have a service name, and we _know_\n+\t\t * we do have a service name here... */\n+\t\tres = -1;\n+\t}\n+\n  error:\n \n \tTALLOC_FREE(value_names);\n\n"}