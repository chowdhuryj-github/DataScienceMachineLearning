{"category": "ham", "to_address": "\"Gerald (Jerry) Carter\" <jerry@samba.org>", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: Broken idmap interface design", "body": "On Thu, Apr 19, 2007 at 09:49:21AM -0500, Gerald (Jerry) Carter wrote:\n> -----BEGIN PGP SIGNED MESSAGE-----\n> Hash: SHA1\n> \n> Simo,\n> \n> > On Thu, 2007-04-19 at 23:30 +1000, Luke Howard wrote:\n> >> Sorry to jump in here, one thing I'd like to see \n> >> in idmap_ad is support for using the Global Catalog. Shouldn't\n> >> be too hard. Thoughts?\n> > \n> > Well IIRC rfc2307 attributes are not exposed via GC by \n> > default, so to use it we must have fallback code in place.\n> > Not that hard, but I guess this is more of a 3.0.26 feature.\n> > I am working only to stabilize the code for offline\n> > usage right now.\n> \n> It's actually worse than that.  The idmap interface is\n> badly broken.  I hate to say this, but the calls into\n> winbindd from the idmap child has to go.  I know how you\n> arrived at the design assumptions.\n> \n> You designed the unixids_to_sids() and sids_to_unixids()\n> with the assumption that the idmap plugin would have\n> knowledge about the SID type.  I didn't catch this\n> because the backend I'm using for primary testing operates\n> similarly to idmap_ad and can obtain the SID type based\n> on LDAP searches.  This is ok for something like idmap_ad\n> which can get the information.  But the general and\n> default case is idmap_tdb (or even idmap_ldap).\n> \n> Requiring the idmap_tdb code (or idmap_rid) to issues a\n> winbindd client call is wrong and a layering violation.  The\n> caller should specify the SID type which is exactly what\n> the WINBINDD_SID_TO_UID, et. al. calls used to do.\n\nIndeed. Looking at this interface cold after ignoring\nit for a while I think the SID_TYPE enum needs to be\npresent as input on all calls into a \"map SID to XXX\".\n\nJeremy.\n\n"}