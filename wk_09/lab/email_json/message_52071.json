{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23566 - in branches: SAMBA_3_0/source/lib\n\tSAMBA_3_0_26/source/lib", "body": "Author: obnox\nDate: 2007-06-21 14:23:06 +0000 (Thu, 21 Jun 2007)\nNew Revision: 23566\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23566\n\nLog:\nFix the sys_bsd_setgroups function. The actual workaround was inactive.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0/source/lib/system.c\n   branches/SAMBA_3_0_26/source/lib/system.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/system.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/system.c\t2007-06-21 14:04:55 UTC (rev 23565)\n+++ branches/SAMBA_3_0/source/lib/system.c\t2007-06-21 14:23:06 UTC (rev 23566)\n@@ -1006,14 +1006,12 @@\n \t * and insert it at the front.\n \t */\n \tif (gidset[0] != primary_gid) {\n-\t        gid_t *new_gidset;\n-\n \t        new_gidset = SMB_MALLOC_ARRAY(gid_t, setlen + 1);\n \t        if (new_gidset == NULL) {\n \t\t\treturn -1;\n \t        }\n \n-\t\tmemcpy(new_gidset + 1, gidset, ((setlen + 1) * sizeof(gid_t)));\n+\t\tmemcpy(new_gidset + 1, gidset, (setlen * sizeof(gid_t)));\n \t\tnew_gidset[0] = primary_gid;\n \t\tsetlen++;\n \t}\n\nModified: branches/SAMBA_3_0_26/source/lib/system.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/system.c\t2007-06-21 14:04:55 UTC (rev 23565)\n+++ branches/SAMBA_3_0_26/source/lib/system.c\t2007-06-21 14:23:06 UTC (rev 23566)\n@@ -1006,14 +1006,12 @@\n \t * and insert it at the front.\n \t */\n \tif (gidset[0] != primary_gid) {\n-\t        gid_t *new_gidset;\n-\n \t        new_gidset = SMB_MALLOC_ARRAY(gid_t, setlen + 1);\n \t        if (new_gidset == NULL) {\n \t\t\treturn -1;\n \t        }\n \n-\t\tmemcpy(new_gidset + 1, gidset, ((setlen + 1) * sizeof(gid_t)));\n+\t\tmemcpy(new_gidset + 1, gidset, (setlen * sizeof(gid_t)));\n \t\tnew_gidset[0] = primary_gid;\n \t\tsetlen++;\n \t}\n\n"}