{"category": "ham", "to_address": "smfltc@linux.vnet.ibm.com", "from_address": "Shirish S Pargaonkar <shirishp@us.ibm.com>", "subject": "Re: [linux-cifs-client] Re: [PATCH] CIFS: make sec=none force\n an\tanonymous mount", "body": "\n\nlinux-cifs-client-bounces+shirishp=us.ibm.com@lists.samba.org wrote on\n05/04/2007 11:41:47 AM:\n\n> Jeff Layton wrote:\n>\n> >On Fri, May 04, 2007 at 10:26:29AM -0500, Steve French (smfltc) wrote:\n> >\n> >\n> >>Jeff Layton wrote:\n> >>\n> >>\n> >>>We had a customer report that attempting to make CIFS mount with a\nnull\n> >>>username (i.e. doing an anonymous mount) doesn't work. Looking through\nthe\n> >>>code, it looks like CIFS expects a NULL username from userspace in\norder\n> >>>to trigger an anonymous mount. The mount.cifs code doesn't seem to\never\n> >>>pass a null username to the kernel, however.\n> >>>\n> >>>\n> >>Yes - cifs kernel code expects a NULL username (e.g. \"username=\") if\n> >>you really don't want to pass the default username of the uid of\n> >>the current process and you don't set the username explicitly\n> >>(e.g. in a credential file or mount parameter).\n> >>\n> >>Samba userspace tools (and smbfs) handled this by first trying to\n> >>setup the SMB session using the default user, and if that fails\n> >>with access denied then retrying sessionsetup with a null username\n> >>string.  This would be easy to change in mount.cifs (ie as long\n> >>as username was not explicitly passed on mount then if mount fails\n> >>with access denied simply add a retry with \"username=\").  This was\n> >>discussed at SambaXP.\n> >>\n> >>\n> >>\n> >\n> >Does this mean you're NAK'ing this patch in favor of a userspace fix? My\n> >perspective is that if someone explicitly requests sec=none, then we\nought\n> >to do an anonymous mount regardless of how the username is set. Would\n> >you agree that that behavior is what you would want?\n> >\n> >\n> >\n> >\n> Your patch is probably ok to add, although I would like to see if any of\n> the other Samba team\n> had thoughts on this, as \"null user\" sessions are a fairly obscure part\n> of the protocol.  But\n> even with the kernel change, mount.cifs also should change for a loosely\n> related case that of\n>     1) sec=none is not specified by the user\n>     2) but username also is not specified explicitly\n> For that case we need to retry on access denied as if it were a request\n> for a \"null user\" mount\n> ie send sec=none (or equivalently username=) the 2nd time.  This gets\n> more complicated\n> since mount.cifs also has to retry on a couple of other cases (e.g. when\n> the server does\n> not support port 445 but does not take the standard server string\n> \"*SMBSERVER\"\n> on the RFC1001 called name).\n>\n> If there are no objections from any of the other Samba guys I will take\n> your patch which has\n> the effect of treating \"sec=none\" as meaning \"ingore any userid if\n> specified, and set the username to null\n> on the session setup\").   That is consistent with what we documented.\n>\n> I had though for a while that a user who mounts passing both \"sec=none\"\n> and a username might\n> also expect to get a null password (they could have done this with\n> \"guest\" or with \"password=\") or\n> might want to try to send the password in plaintext - but I doubt that\n> we want to support\n> a user who wants to send the password plaintext without the server\n> requiring it (and in that\n> case cifs can be built and configured to allow plaintext if absolutely\n> necessary to support\n> those ancient servers).\n>\n>\n> Basically if we set username to null in kernel when (sec=none)\n>\n> >Thanks,\n> >Jeff\n> >\n> >\n> >\n>\n> _______________________________________________\n> linux-cifs-client mailing list\n> linux-cifs-client@lists.samba.org\n> https://lists.samba.org/mailman/listinfo/linux-cifs-client\n\nWhen a session setup request is sent as an anonymous user (NUL user),\nshould/could there be\npassword associated with that?\nRight now, sec=none option, will prompt you for a password.\nAnd when we add code to retry session setup as anonymous user if the first\nsession setup request\nfails, should that retry request be sent with the password or without\npassword?\n\nWhen smbfs sends requests as an anonymous user, it does not send a password\nalong with it.\n\nRegards,\n\nShirish\n\n"}