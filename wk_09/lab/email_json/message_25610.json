{"category": "ham", "to_address": "William Revelle <wr@revelle.net>", "from_address": "Prof Brian Ripley <ripley@stats.ox.ac.uk>", "subject": "Re: [R] strange behavior in data frames with duplicated column names", "body": "First, you should not be using colnames<-, which is for a matrix, on a \ndata frame.  Use names<- for data frames (and as.data.frame to convert to \na data frame).\n\nSecond, whereas duplicate row names are not allowed in a data frame, \nduplicate column names are but at your own risk.\n\nThird, there is a 'optimization too far' here which I will change in 2.5.0 \npatched.  Often with R development there is a tradeoff between speed and \ngenerality.\n\nOn Tue, 8 May 2007, William Revelle wrote:\n\n> Dear R gurus,\n>\n> There is an interesting problem with accessing specific items in a\n> column of data frame that has incorrectly been given a duplicate\n> name, even though addressing the item by row and column number.\n> Although the column is correctly listed, an item addressed by row and\n> column number gives the item with the correct row and the original\n> not the duplicated column.\n>\n> Here are the instructions to get this problem\n>\n> x <- matrix(seq(1:12),ncol=3)\n> colnames(x) <- c(\"A\",\"B\",\"A\")   #a redundant name for column 2\n> x.df <- data.frame(x)\n> x.df        #the redundant name is corrected\n> x.df[,3]    #show the column -- this always works\n> x.df[2,3]   #this works here\n> #now incorrectly label the columns with a duplicate name\n> colnames(x.df) <- c(\"A\",\"B\",\"A\")  #the redundant name is not detected\n> x.df\n> x.df[,3]     #this works as above and shows the column\n> x.df[2,3]    #but this gives the value of the first column, not the third  <---\n> rownames(x.df) <- c(\"First\",\"Second\",\"Third\",\"Third\")  #detects duplicate name\n> x.df\n> x.df[4,]     #correct second row and corrected column names!\n> x.df[4,3]    #wrong column\n> x.df         #still has the original names with the duplication\n>\n>\n> and corresponding output:\n>\n>>  x <- matrix(seq(1:12),ncol=3)\n>>  colnames(x) <- c(\"A\",\"B\",\"A\")   #a redundant name for column 2\n>>  x.df <- data.frame(x)\n>>  x.df        #the redundant name is corrected\n>   A B A.1\n> 1 1 5   9\n> 2 2 6  10\n> 3 3 7  11\n> 4 4 8  12\n>>  x.df[,3]    #show the column -- this always works\n> [1]  9 10 11 12\n>>  x.df[2,3]   #this works here\n> [1] 10\n>>  #now incorrectly label the columns with a duplicate name\n>>  colnames(x.df) <- c(\"A\",\"B\",\"A\")  #the redundant name is not detected\n>>  x.df\n>   A B  A\n> 1 1 5  9\n> 2 2 6 10\n> 3 3 7 11\n> 4 4 8 12\n>>  x.df[,3]     #this works as above and shows the column\n> [1]  9 10 11 12\n>>  x.df[2,3]    #but this gives the value of the first column, not the\n>> third  <---\n> [1] 2\n>>  rownames(x.df) <- c(\"First\",\"Second\",\"Third\",\"Third\")  #detects\n>> duplicate name\n> Error in `row.names<-.data.frame`(`*tmp*`, value = c(\"First\", \"Second\",  :\n> \tduplicate 'row.names' are not allowed\n>>  x.df\n>   A B  A\n> 1 1 5  9\n> 2 2 6 10\n> 3 3 7 11\n> 4 4 8 12\n>>  x.df[4,]     #correct second row and corrected column names!\n>   A B A.1\n> 4 4 8  12\n>>  x.df[4,3]    #wrong column\n> [1] 4\n>>  x.df         #still has the original names with the duplication\n>\n>>  unlist(R.Version())\n>                                      platform\n> arch                                            os\n>                      \"i386-apple-darwin8.9.1\"\n> \"i386\"                                 \"darwin8.9.1\"\n>                                        system\n> status                                         major\n>                           \"i386, darwin8.9.1\"\n> \"Patched\"                                           \"2\"\n>                                         minor\n> year                                         month\n>                                         \"5.0\"\n> \"2007\"                                          \"04\"\n>                                           day\n> svn rev                                      language\n>                                          \"25\"\n> \"41315\"                                           \"R\"\n>                                version.string\n> \"R version 2.5.0 Patched (2007-04-25 r41315)\"\n>>\n>\n>\n> Bill\n>\n>\n\n-- \nBrian D. Ripley,                  ripley@stats.ox.ac.uk\nProfessor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/\nUniversity of Oxford,             Tel:  +44 1865 272861 (self)\n1 South Parks Road,                     +44 1865 272866 (PA)\nOxford OX1 3TG, UK                Fax:  +44 1865 272595\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}