{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "Michael Adam <ma@sernet.de>", "subject": "Rev 5367: Try bzr and, if this is a brz checkout,\n\tuse bzr branch nick and in\n\thttp://samba.sernet.de/ma/bzr/SAMBA_3_0-registry.bzr/", "body": "At http://samba.sernet.de/ma/bzr/SAMBA_3_0-registry.bzr/\n\n------------------------------------------------------------\nrevno: 5367\nrevision-id: ma@sernet.de-20070418111737-d6f0d4da2e435822\nparent: ma@sernet.de-20070417203314-fd8138bdafee1c09\ncommitter: Michael Adam \nbranch nick: SAMBA_3_0-registry.bzr\ntimestamp: Wed 2007-04-18 13:17:37 +0200\nmessage:\n  Try bzr and, if this is a brz checkout, use bzr branch nick and\n  revision number for the version string if svn info and svk info fail.\nmodified:\n  source/script/mkversion.sh     mkversion.sh-20060530022627-7fabc53ed219204b\n=== modified file 'source/script/mkversion.sh'\n--- a/source/script/mkversion.sh\t2006-05-30 08:59:01 +0000\n+++ b/source/script/mkversion.sh\t2007-04-18 11:17:37 +0000\n@@ -82,6 +82,13 @@\n \telse\n \t    TMP_SVK_REVISION_STR=\"${TMP_REVISION}-${USER}@${HOSTNAME}\"\n \tfi\n+\tif test x\"${HAVESVK}\" = x\"no\";then\n+\t    HAVEBZR=no\n+\t    bzr revno > /dev/null 2>&1 && HAVEBZR=yes\n+\t    TMP_BZR_REVNO=`bzr revno 2> /dev/null`\n+\t    TMP_BZR_NICK=`bzr nick 2> /dev/null`\n+\t    TMP_BZR_REVISION_STR=\"${TMP_BZR_NICK}-${TMP_BZR_REVNO}\"\n+\tfi\n     fi\n \n     if test x\"${HAVESVN}\" = x\"yes\";then\n@@ -89,6 +96,8 @@\n \t    echo \"#define SAMBA_VERSION_SVN_REVISION ${TMP_REVISION}\" >> $OUTPUT_FILE\n     elif test x\"${HAVESVK}\" = x\"yes\";then\n \t    SAMBA_VERSION_STRING=\"${SAMBA_VERSION_STRING}-SVK-build-${TMP_SVK_REVISION_STR}\"\n+    elif test x\"${HAVEBZR}\" = x\"yes\";then\n+\t    SAMBA_VERSION_STRING=\"${SAMBA_VERSION_STRING}-BZR-build-${TMP_BZR_REVISION_STR}\"\n     else\n \t    SAMBA_VERSION_STRING=\"${SAMBA_VERSION_STRING}-SVN-build-UNKNOWN\"\n     fi\n\n"}