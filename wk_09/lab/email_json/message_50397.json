{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 602: store both forward and reverse mappings when the script\n\tgives us a result in http://samba.org/~tridge/3_0-ctdb", "body": "------------------------------------------------------------\nrevno: 602\nrevision-id: tridge@samba.org-20070618233003-z1g7kv5uce3qr0p2\nparent: tridge@samba.org-20070618231102-yosa0a9c5s1bna3r\ncommitter: Andrew Tridgell \nbranch nick: s3-ctdb-tridge\ntimestamp: Tue 2007-06-19 09:30:03 +1000\nmessage:\n  store both forward and reverse mappings when the script gives us a result\nmodified:\n  source/nsswitch/idmap_tdb2.c   idmap_tdb2.c-20070531053925-e5x7av5etjs83rk0-1\n=== modified file 'source/nsswitch/idmap_tdb2.c'\n--- a/source/nsswitch/idmap_tdb2.c\t2007-06-18 23:11:02 +0000\n+++ b/source/nsswitch/idmap_tdb2.c\t2007-06-18 23:30:03 +0000\n@@ -606,8 +606,11 @@\n \t\t\tif (NT_STATUS_IS_OK(ret)) {\n \t\t\t\tfstring sidstr;\n \t\t\t\tif (sid_to_string(sidstr, map->sid)) {\n+\t\t\t\t\t/* both forward and reverse mappings */\n \t\t\t\t\ttdb2_store_bystring(keystr, string_term_tdb_data(sidstr), \n \t\t\t\t\t\t\t    TDB_REPLACE);\n+\t\t\t\t\ttdb2_store_bystring(sidstr, string_term_tdb_data(keystr), \n+\t\t\t\t\t\t\t    TDB_REPLACE);\n \t\t\t\t}\n \t\t\t}\n \t\t} else {\n@@ -663,7 +666,9 @@\n \t\t\t\tsnprintf(idstr, sizeof(idstr), \"%cID %lu\", \n \t\t\t\t\t map->xid.type == ID_TYPE_UID?'U':'G',\n \t\t\t\t\t (unsigned long)map->xid.id);\n+\t\t\t\t/* store both forward and reverse mappings */\n \t\t\t\ttdb2_store_bystring(keystr, string_term_tdb_data(idstr), TDB_REPLACE);\n+\t\t\t\ttdb2_store_bystring(idstr, string_term_tdb_data(keystr), TDB_REPLACE);\n \t\t\t}\n \t\t} else {\n \t\t\tret = NT_STATUS_NONE_MAPPED;\n\n"}