{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23421 - in branches/SAMBA_3_0_26/source: include\n\tlib libmsrpc", "body": "Author: obnox\nDate: 2007-06-11 14:47:05 +0000 (Mon, 11 Jun 2007)\nNew Revision: 23421\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23421\n\nLog:\nMerge parts of r18963 that apply:\n\nMove defines from rpc_reg.h to reg_object.h.\nrpc_reg.h is not completely removed, since not all of\nthe hand-marshalled code is replaced by ndr code in 3_0_26.\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0_26/source/include/reg_objects.h\n   branches/SAMBA_3_0_26/source/include/rpc_reg.h\n   branches/SAMBA_3_0_26/source/lib/util_reg.c\n   branches/SAMBA_3_0_26/source/libmsrpc/libmsrpc_internal.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/include/reg_objects.h\n===================================================================\n--- branches/SAMBA_3_0_26/source/include/reg_objects.h\t2007-06-11 14:41:14 UTC (rev 23420)\n+++ branches/SAMBA_3_0_26/source/include/reg_objects.h\t2007-06-11 14:47:05 UTC (rev 23421)\n@@ -46,5 +46,73 @@\n \tchar            **subkeys;\n } REGSUBKEY_CTR;\n \n+/*\n+ *\n+ * Macros that used to reside in rpc_reg.h\n+ *\n+ */\n+ \n+#define HKEY_CLASSES_ROOT\t0x80000000\n+#define HKEY_CURRENT_USER\t0x80000001\n+#define HKEY_LOCAL_MACHINE \t0x80000002\n+#define HKEY_USERS         \t0x80000003\n+#define HKEY_PERFORMANCE_DATA\t0x80000004\n+\n+#define KEY_HKLM\t\t\"HKLM\"\n+#define KEY_HKU\t\t\t\"HKU\"\n+#define KEY_HKCC\t\t\"HKCC\"\n+#define KEY_HKCR\t\t\"HKCR\"\n+#define KEY_HKPD\t\t\"HKPD\"\n+#define KEY_HKPT\t\t\"HKPT\"\n+#define KEY_HKPN\t\t\"HKPN\"\n+#define KEY_HKCU\t\t\"HKCU\"\n+#define KEY_HKDD\t\t\"HKDD\"\n+#define KEY_SERVICES\t\t\"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\"\n+#define KEY_PRINTING \t\t\"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\Print\"\n+#define KEY_PRINTING_2K\t\t\"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Print\\\\Printers\"\n+#define KEY_PRINTING_PORTS\t\"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Ports\"\n+#define KEY_EVENTLOG \t\t\"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\Eventlog\"\n+#define KEY_SHARES\t\t\"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\LanmanServer\\\\Shares\"\n+#define KEY_TREE_ROOT\t\t\"\"\n+\n+/*\n+ * Registry key types\n+ *\tMost keys are going to be GENERIC -- may need a better name?\n+ *\tHKPD and HKPT are used by reg_perfcount.c\n+ *\t\tthey are special keys that contain performance data\n+ */\n+#define REG_KEY_GENERIC\t\t0\n+#define REG_KEY_HKPD\t\t1\n+#define REG_KEY_HKPT\t\t2\n+\n+/* \n+ * container for function pointers to enumeration routines\n+ * for virtual registry view \n+ */ \n+ \n+typedef struct {\n+\t/* functions for enumerating subkeys and values */\t\n+\tint \t(*fetch_subkeys)( const char *key, REGSUBKEY_CTR *subkeys);\n+\tint \t(*fetch_values) ( const char *key, REGVAL_CTR *val );\n+\tBOOL \t(*store_subkeys)( const char *key, REGSUBKEY_CTR *subkeys );\n+\tBOOL \t(*store_values)( const char *key, REGVAL_CTR *val );\n+\tBOOL\t(*reg_access_check)( const char *keyname, uint32 requested, uint32 *granted, NT_USER_TOKEN *token );\n+} REGISTRY_OPS;\n+\n+typedef struct {\n+\tconst char\t*keyname;\t/* full path to name of key */\n+\tREGISTRY_OPS\t*ops;\t\t/* registry function hooks */\n+} REGISTRY_HOOK;\n+\n+\n+/* structure to store the registry handles */\n+\n+typedef struct _RegistryKey {\n+\tuint32\t\ttype;\n+\tchar\t\t*name; \t\t/* full name of registry key */\n+\tuint32 \t\taccess_granted;\n+\tREGISTRY_HOOK\t*hook;\t\n+} REGISTRY_KEY;\n+\n #endif /* _REG_OBJECTS_H */\n \n\nModified: branches/SAMBA_3_0_26/source/include/rpc_reg.h\n===================================================================\n--- branches/SAMBA_3_0_26/source/include/rpc_reg.h\t2007-06-11 14:41:14 UTC (rev 23420)\n+++ branches/SAMBA_3_0_26/source/include/rpc_reg.h\t2007-06-11 14:47:05 UTC (rev 23421)\n@@ -53,25 +53,6 @@\n #define REG_SHUTDOWN_EX\t\t0x1e\n \n \n-#define HKEY_CLASSES_ROOT\t0x80000000\n-#define HKEY_CURRENT_USER\t0x80000001\n-#define HKEY_LOCAL_MACHINE \t0x80000002\n-#define HKEY_USERS         \t0x80000003\n-#define HKEY_PERFORMANCE_DATA\t0x80000004\n-\n-#define KEY_HKLM\t\t\"HKLM\"\n-#define KEY_HKU\t\t\t\"HKU\"\n-#define KEY_HKCR\t\t\"HKCR\"\n-#define KEY_HKPD\t\t\"HKPD\"\n-#define KEY_HKPT\t\t\"HKPT\"\n-#define KEY_SERVICES\t\t\"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\"\n-#define KEY_PRINTING \t\t\"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Control\\\\Print\"\n-#define KEY_PRINTING_2K\t\t\"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Print\\\\Printers\"\n-#define KEY_PRINTING_PORTS\t\"HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Ports\"\n-#define KEY_EVENTLOG \t\t\"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\Eventlog\"\n-#define KEY_SHARES\t\t\"HKLM\\\\SYSTEM\\\\CurrentControlSet\\\\Services\\\\LanmanServer\\\\Shares\"\n-#define KEY_TREE_ROOT\t\t\"\"\n-\n /* Registry data types */\n \n #define REG_NONE                       0\n@@ -88,45 +69,6 @@\n #define REG_RESOURCE_REQUIREMENTS_LIST 10\n \n /*\n- * Registry key types\n- *\tMost keys are going to be GENERIC -- may need a better name?\n- *\tHKPD and HKPT are used by reg_perfcount.c\n- *\t\tthey are special keys that contain performance data\n- */\n-#define REG_KEY_GENERIC\t\t0\n-#define REG_KEY_HKPD\t\t1\n-#define REG_KEY_HKPT\t\t2\n-\n-/* \n- * container for function pointers to enumeration routines\n- * for virtual registry view \n- */ \n- \n-typedef struct {\n-\t/* functions for enumerating subkeys and values */\t\n-\tint \t(*fetch_subkeys)( const char *key, REGSUBKEY_CTR *subkeys);\n-\tint \t(*fetch_values) ( const char *key, REGVAL_CTR *val );\n-\tBOOL \t(*store_subkeys)( const char *key, REGSUBKEY_CTR *subkeys );\n-\tBOOL \t(*store_values)( const char *key, REGVAL_CTR *val );\n-\tBOOL\t(*reg_access_check)( const char *keyname, uint32 requested, uint32 *granted, NT_USER_TOKEN *token );\n-} REGISTRY_OPS;\n-\n-typedef struct {\n-\tconst char\t*keyname;\t/* full path to name of key */\n-\tREGISTRY_OPS\t*ops;\t\t/* registry function hooks */\n-} REGISTRY_HOOK;\n-\n-\n-/* structure to store the registry handles */\n-\n-typedef struct _RegistryKey {\n-\tuint32\t\ttype;\n-\tchar\t\t*name; \t\t/* full name of registry key */\n-\tuint32 \t\taccess_granted;\n-\tREGISTRY_HOOK\t*hook;\t\n-} REGISTRY_KEY;\n-\n-/*\n  * RPC REGISTRY STRUCTURES\n  */\n \n\nModified: branches/SAMBA_3_0_26/source/lib/util_reg.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/util_reg.c\t2007-06-11 14:41:14 UTC (rev 23420)\n+++ branches/SAMBA_3_0_26/source/lib/util_reg.c\t2007-06-11 14:47:05 UTC (rev 23421)\n@@ -40,8 +40,8 @@\n \tcase REG_DWORD:\n \t\tresult = \"REG_DWORD\";\n \t\tbreak;\n-\tcase REG_DWORD_BE:\n-\t\tresult = \"REG_DWORD_BE\";\n+\tcase REG_DWORD_BIG_ENDIAN:\n+\t\tresult = \"REG_DWORD_BIG_ENDIAN\";\n \t\tbreak;\n \tcase REG_LINK:\n \t\tresult = \"REG_LINK\";\n\nModified: branches/SAMBA_3_0_26/source/libmsrpc/libmsrpc_internal.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libmsrpc/libmsrpc_internal.c\t2007-06-11 14:41:14 UTC (rev 23420)\n+++ branches/SAMBA_3_0_26/source/libmsrpc/libmsrpc_internal.c\t2007-06-11 14:47:05 UTC (rev 23421)\n@@ -133,7 +133,7 @@\n \t\tinit_rpc_blob_uint32( blob, data.reg_dword );\n \t\tbreak;\n \n-\tcase REG_DWORD_BE:\n+\tcase REG_DWORD_BIG_ENDIAN:\n \t\tinit_rpc_blob_uint32( blob, data.reg_dword_be );\n \t\tbreak;\n \n@@ -281,7 +281,7 @@\n \t\tdata->reg_dword = *( ( uint32 * ) buf.buffer );\n \t\tbreak;\n \n-\tcase REG_DWORD_BE:\n+\tcase REG_DWORD_BIG_ENDIAN:\n \t\tdata->reg_dword_be = *( ( uint32 * ) buf.buffer );\n \t\tbreak;\n \n\n"}