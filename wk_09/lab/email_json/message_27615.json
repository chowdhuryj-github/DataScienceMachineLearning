{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r22802 - in branches: SAMBA_3_0/source\n\tSAMBA_3_0/source/libgpo SAMBA_3_0_26/source\n\tSAMBA_3_0_26/source/libgpo", "body": "Author: gd\nDate: 2007-05-11 15:08:05 +0000 (Fri, 11 May 2007)\nNew Revision: 22802\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22802\n\nLog:\nAdd dummy gpo_apply_security_filtering() call.\n\nGuenther\n\nAdded:\n   branches/SAMBA_3_0/source/libgpo/gpo_sec.c\n   branches/SAMBA_3_0_26/source/libgpo/gpo_sec.c\nModified:\n   branches/SAMBA_3_0/source/Makefile.in\n   branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\n   branches/SAMBA_3_0_26/source/Makefile.in\n   branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0/source/Makefile.in\t2007-05-11 13:37:51 UTC (rev 22801)\n+++ branches/SAMBA_3_0/source/Makefile.in\t2007-05-11 15:08:05 UTC (rev 22802)\n@@ -299,7 +299,7 @@\n LIBADDNS_OBJ = $(LIBADDNS_OBJ0) $(TALLOC_OBJ)\n \n LIBGPO_OBJ0 = libgpo/gpo_ldap.o libgpo/gpo_parse.o libgpo/gpo_util.o \\\n-\t      libgpo/gpo_fetch.o libgpo/gpo_filesync.o\n+\t      libgpo/gpo_fetch.o libgpo/gpo_filesync.o libgpo/gpo_sec.o\n LIBGPO_OBJ = $(LIBGPO_OBJ0)\n \n LIBADS_OBJ = libads/ldap.o libads/ldap_printer.o libads/sasl.o \\\n\nModified: branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\n===================================================================\n--- branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\t2007-05-11 13:37:51 UTC (rev 22801)\n+++ branches/SAMBA_3_0/source/libgpo/gpo_ldap.c\t2007-05-11 15:08:05 UTC (rev 22802)\n@@ -549,16 +549,23 @@\n \t\t\t}\n \t\t}\n \n-\t\tnew_gpo = TALLOC_P(mem_ctx, struct GROUP_POLICY_OBJECT);\n+\t\tnew_gpo = TALLOC_ZERO_P(mem_ctx, struct GROUP_POLICY_OBJECT);\n \t\tADS_ERROR_HAVE_NO_MEMORY(new_gpo);\n \n-\t\tZERO_STRUCTP(new_gpo);\n-\n \t\tstatus = ads_get_gpo(ads, mem_ctx, gp_link->link_names[i], NULL, NULL, new_gpo);\n \t\tif (!ADS_ERR_OK(status)) {\n+\t\t\tDEBUG(10,(\"failed to get gpo: %s\\n\", gp_link->link_names[i]));\n \t\t\treturn status;\n \t\t}\n \n+\t\tstatus = ADS_ERROR_NT(gpo_apply_security_filtering(new_gpo, token));\n+\t\tif (!ADS_ERR_OK(status)) {\n+\t\t\tDEBUG(10,(\"skipping GPO \\\"%s\\\" as object has no access to it\\n\", \n+\t\t\t\tnew_gpo->display_name));\n+\t\t\tTALLOC_FREE(new_gpo);\n+\t\t\tcontinue;\n+\t\t}\n+\n \t\tnew_gpo->link = link_dn;\n \t\tnew_gpo->link_type = link_type; \n \n\nAdded: branches/SAMBA_3_0/source/libgpo/gpo_sec.c\n===================================================================\n--- branches/SAMBA_3_0/source/libgpo/gpo_sec.c\t2007-05-11 13:37:51 UTC (rev 22801)\n+++ branches/SAMBA_3_0/source/libgpo/gpo_sec.c\t2007-05-11 15:08:05 UTC (rev 22802)\n@@ -0,0 +1,30 @@\n+/* \n+ *  Unix SMB/CIFS implementation.\n+ *  Group Policy Object Support\n+ *  Copyright (C) Guenther Deschner 2007\n+ *  \n+ *  This program is free software; you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation; either version 2 of the License, or\n+ *  (at your option) any later version.\n+ *  \n+ *  This program is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *  \n+ *  You should have received a copy of the GNU General Public License\n+ *  along with this program; if not, write to the Free Software\n+ *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.\n+ */\n+\n+#include \"includes.h\"\n+\n+/****************************************************************\n+****************************************************************/\n+\n+NTSTATUS gpo_apply_security_filtering(const struct GROUP_POLICY_OBJECT *gpo, \n+\t\t\t\t      const struct GPO_SID_TOKEN *token)\n+{\n+\treturn NT_STATUS_OK;\n+}\n\nModified: branches/SAMBA_3_0_26/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0_26/source/Makefile.in\t2007-05-11 13:37:51 UTC (rev 22801)\n+++ branches/SAMBA_3_0_26/source/Makefile.in\t2007-05-11 15:08:05 UTC (rev 22802)\n@@ -280,7 +280,7 @@\n LIBADDNS_OBJ = $(LIBADDNS_OBJ0) $(TALLOC_OBJ)\n \n LIBGPO_OBJ0 = libgpo/gpo_ldap.o libgpo/gpo_parse.o libgpo/gpo_util.o \\\n-\t      libgpo/gpo_fetch.o libgpo/gpo_filesync.o\n+\t      libgpo/gpo_fetch.o libgpo/gpo_filesync.o libgpo/gpo_sec.o\n LIBGPO_OBJ = $(LIBGPO_OBJ0)\n \n LIBADS_OBJ = libads/ldap.o libads/ldap_printer.o libads/sasl.o \\\n\nModified: branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\t2007-05-11 13:37:51 UTC (rev 22801)\n+++ branches/SAMBA_3_0_26/source/libgpo/gpo_ldap.c\t2007-05-11 15:08:05 UTC (rev 22802)\n@@ -549,16 +549,23 @@\n \t\t\t}\n \t\t}\n \n-\t\tnew_gpo = TALLOC_P(mem_ctx, struct GROUP_POLICY_OBJECT);\n+\t\tnew_gpo = TALLOC_ZERO_P(mem_ctx, struct GROUP_POLICY_OBJECT);\n \t\tADS_ERROR_HAVE_NO_MEMORY(new_gpo);\n \n-\t\tZERO_STRUCTP(new_gpo);\n-\n \t\tstatus = ads_get_gpo(ads, mem_ctx, gp_link->link_names[i], NULL, NULL, new_gpo);\n \t\tif (!ADS_ERR_OK(status)) {\n+\t\t\tDEBUG(10,(\"failed to get gpo: %s\\n\", gp_link->link_names[i]));\n \t\t\treturn status;\n \t\t}\n \n+\t\tstatus = ADS_ERROR_NT(gpo_apply_security_filtering(new_gpo, token));\n+\t\tif (!ADS_ERR_OK(status)) {\n+\t\t\tDEBUG(10,(\"skipping GPO \\\"%s\\\" as object has no access to it\\n\", \n+\t\t\t\tnew_gpo->display_name));\n+\t\t\tTALLOC_FREE(new_gpo);\n+\t\t\tcontinue;\n+\t\t}\n+\n \t\tnew_gpo->link = link_dn;\n \t\tnew_gpo->link_type = link_type; \n \n\nAdded: branches/SAMBA_3_0_26/source/libgpo/gpo_sec.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libgpo/gpo_sec.c\t2007-05-11 13:37:51 UTC (rev 22801)\n+++ branches/SAMBA_3_0_26/source/libgpo/gpo_sec.c\t2007-05-11 15:08:05 UTC (rev 22802)\n@@ -0,0 +1,30 @@\n+/* \n+ *  Unix SMB/CIFS implementation.\n+ *  Group Policy Object Support\n+ *  Copyright (C) Guenther Deschner 2007\n+ *  \n+ *  This program is free software; you can redistribute it and/or modify\n+ *  it under the terms of the GNU General Public License as published by\n+ *  the Free Software Foundation; either version 2 of the License, or\n+ *  (at your option) any later version.\n+ *  \n+ *  This program is distributed in the hope that it will be useful,\n+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *  GNU General Public License for more details.\n+ *  \n+ *  You should have received a copy of the GNU General Public License\n+ *  along with this program; if not, write to the Free Software\n+ *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.\n+ */\n+\n+#include \"includes.h\"\n+\n+/****************************************************************\n+****************************************************************/\n+\n+NTSTATUS gpo_apply_security_filtering(const struct GROUP_POLICY_OBJECT *gpo, \n+\t\t\t\t      const struct GPO_SID_TOKEN *token)\n+{\n+\treturn NT_STATUS_OK;\n+}\n\n"}