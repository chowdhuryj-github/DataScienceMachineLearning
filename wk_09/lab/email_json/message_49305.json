{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r23527 - in branches: SAMBA_3_0/source/client\n\tSAMBA_3_0_25/source/client SAMBA_3_0_26/source/client", "body": "Author: idra\nDate: 2007-06-16 22:52:51 +0000 (Sat, 16 Jun 2007)\nNew Revision: 23527\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23527\n\nLog:\n\nUse existing escaping function pointed by James\n\n\nModified:\n   branches/SAMBA_3_0/source/client/smbspool.c\n   branches/SAMBA_3_0_25/source/client/smbspool.c\n   branches/SAMBA_3_0_26/source/client/smbspool.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/client/smbspool.c\n===================================================================\n--- branches/SAMBA_3_0/source/client/smbspool.c\t2007-06-16 19:58:17 UTC (rev 23526)\n+++ branches/SAMBA_3_0/source/client/smbspool.c\t2007-06-16 22:52:51 UTC (rev 23527)\n@@ -603,35 +603,11 @@\n \n static char *uri_unescape_alloc(const char *uritok)\n {\n-\tchar *t, *ret;\n-\tconst char *p;\n-\tlong int val;\n-\tchar eval[3];\n+\tchar *ret;\n \n-\tret = (char *)SMB_MALLOC(strlen(uritok)+1);\n-\n+\tret = (char *)SMB_STRDUP(uritok);\n \tif (!ret) return NULL;\n \n-\teval[2] = '\\0';\n-\n-\tfor (p = uritok, t = ret; *p; p++, t++) {\n-\t\tif (*p == '%') { /* unescape hex */\n-\t\t\tp++;\n-\t\t\teval[0] = *p;\n-\t\t\tp++;\n-\t\t\teval[1] = *p;\n-\t\t\tval = strtol(eval, NULL, 16);\n-\t\t\tif ((val == LONG_MIN || val == LONG_MAX) && errno == ERANGE) {\n-\t\t\t\tSAFE_FREE(ret);\n-\t\t\t\treturn NULL;\n-\t\t\t}\n-\t\t\t*t = (char)val;\n-\t\t} else {\n-\t\t\t*t = *p;\n-\t\t}\n-\t}\n-\n-\t*t = '\\0'; /*terminate*/\n-\n+\trfc1738_unescape(ret);\n \treturn ret;\n }\n\nModified: branches/SAMBA_3_0_25/source/client/smbspool.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/client/smbspool.c\t2007-06-16 19:58:17 UTC (rev 23526)\n+++ branches/SAMBA_3_0_25/source/client/smbspool.c\t2007-06-16 22:52:51 UTC (rev 23527)\n@@ -603,35 +603,11 @@\n \n static char *uri_unescape_alloc(const char *uritok)\n {\n-\tchar *t, *ret;\n-\tconst char *p;\n-\tlong int val;\n-\tchar eval[3];\n+\tchar *ret;\n \n-\tret = (char *)SMB_MALLOC(strlen(uritok)+1);\n-\n+\tret = (char *)SMB_STRDUP(uritok);\n \tif (!ret) return NULL;\n \n-\teval[2] = '\\0';\n-\n-\tfor (p = uritok, t = ret; *p; p++, t++) {\n-\t\tif (*p == '%') { /* unescape hex */\n-\t\t\tp++;\n-\t\t\teval[0] = *p;\n-\t\t\tp++;\n-\t\t\teval[1] = *p;\n-\t\t\tval = strtol(eval, NULL, 16);\n-\t\t\tif ((val == LONG_MIN || val == LONG_MAX) && errno == ERANGE) {\n-\t\t\t\tSAFE_FREE(ret);\n-\t\t\t\treturn NULL;\n-\t\t\t}\n-\t\t\t*t = (char)val;\n-\t\t} else {\n-\t\t\t*t = *p;\n-\t\t}\n-\t}\n-\n-\t*t = '\\0'; /*terminate*/\n-\n+\trfc1738_unescape(ret);\n \treturn ret;\n }\n\nModified: branches/SAMBA_3_0_26/source/client/smbspool.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/client/smbspool.c\t2007-06-16 19:58:17 UTC (rev 23526)\n+++ branches/SAMBA_3_0_26/source/client/smbspool.c\t2007-06-16 22:52:51 UTC (rev 23527)\n@@ -603,35 +603,11 @@\n \n static char *uri_unescape_alloc(const char *uritok)\n {\n-\tchar *t, *ret;\n-\tconst char *p;\n-\tlong int val;\n-\tchar eval[3];\n+\tchar *ret;\n \n-\tret = (char *)SMB_MALLOC(strlen(uritok)+1);\n-\n+\tret = (char *)SMB_STRDUP(uritok);\n \tif (!ret) return NULL;\n \n-\teval[2] = '\\0';\n-\n-\tfor (p = uritok, t = ret; *p; p++, t++) {\n-\t\tif (*p == '%') { /* unescape hex */\n-\t\t\tp++;\n-\t\t\teval[0] = *p;\n-\t\t\tp++;\n-\t\t\teval[1] = *p;\n-\t\t\tval = strtol(eval, NULL, 16);\n-\t\t\tif ((val == LONG_MIN || val == LONG_MAX) && errno == ERANGE) {\n-\t\t\t\tSAFE_FREE(ret);\n-\t\t\t\treturn NULL;\n-\t\t\t}\n-\t\t\t*t = (char)val;\n-\t\t} else {\n-\t\t\t*t = *p;\n-\t\t}\n-\t}\n-\n-\t*t = '\\0'; /*terminate*/\n-\n+\trfc1738_unescape(ret);\n \treturn ret;\n }\n\n"}