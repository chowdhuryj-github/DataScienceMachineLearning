{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23382 - in branches/SAMBA_4_0/source: librpc/idl\n\trpc_server/lsa", "body": "Author: gd\nDate: 2007-06-08 10:42:33 +0000 (Fri, 08 Jun 2007)\nNew Revision: 23382\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23382\n\nLog:\nFill in lsa_lsaRQueryForestTrustInformation.\n\nGuenther\n\nModified:\n   branches/SAMBA_4_0/source/librpc/idl/lsa.idl\n   branches/SAMBA_4_0/source/rpc_server/lsa/dcesrv_lsa.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/librpc/idl/lsa.idl\n===================================================================\n--- branches/SAMBA_4_0/source/librpc/idl/lsa.idl\t2007-06-08 10:32:29 UTC (rev 23381)\n+++ branches/SAMBA_4_0/source/librpc/idl/lsa.idl\t2007-06-08 10:42:33 UTC (rev 23382)\n@@ -928,8 +928,50 @@\n \tNTSTATUS lsa_LSARUNREGISTERAUDITEVENT();\n \n \t/* Function 0x49 */\n-\tNTSTATUS lsa_LSARQUERYFORESTTRUSTINFORMATION();\n+\ttypedef struct {\n+\t\t[range(0,131072)] uint32 length;\n+\t\t[size_is(length)] uint8 *data;\n+\t} lsa_ForestTrustBinaryData;\n \n+\ttypedef struct {\n+\t\tdom_sid2 *domain_sid;\n+\t\tlsa_StringLarge dns_domain_name;\n+\t\tlsa_StringLarge netbios_domain_name;\n+\t} lsa_ForestTrustDomainInfo;\n+\n+\ttypedef [switch_type(uint32)] union {\n+\t\t[case(LSA_FOREST_TRUST_TOP_LEVEL_NAME)] lsa_String top_level_name;\n+\t\t[case(LSA_FOREST_TRUST_TOP_LEVEL_NAME_EX)] lsa_StringLarge top_level_name_ex;\n+\t\t[case(LSA_FOREST_TRUST_DOMAIN_INFO)] lsa_ForestTrustDomainInfo domain_info;\n+\t\t[default] lsa_ForestTrustBinaryData data;\n+\t} lsa_ForestTrustData;\n+\n+\ttypedef [v1_enum] enum {\n+\t\tLSA_FOREST_TRUST_TOP_LEVEL_NAME = 0,\n+\t\tLSA_FOREST_TRUST_TOP_LEVEL_NAME_EX = 1,\n+\t\tLSA_FOREST_TRUST_DOMAIN_INFO = 2,\n+\t\tLSA_FOREST_TRUST_RECORD_TYPE_LAST = 3\n+\t} lsa_ForestTrustRecordType;\n+\n+\ttypedef struct {\n+\t\tuint32 flags;\n+\t\tlsa_ForestTrustRecordType level;\n+\t\thyper unknown;\n+\t\t[switch_is(level)] lsa_ForestTrustData forest_trust_data;\n+\t} lsa_ForestTrustRecord;\n+\n+\ttypedef [public] struct {\n+\t\t[range(0,4000)] uint32 count;\n+\t\t[size_is(count)] lsa_ForestTrustRecord **entries;\n+\t} lsa_ForestTrustInformation;\n+\n+\tNTSTATUS lsa_lsaRQueryForestTrustInformation(\n+\t\t[in] policy_handle *handle,\n+\t\t[in,ref] lsa_String *trusted_domain_name,\n+\t\t[in] uint16 unknown, /* level ? */\n+\t\t[out,ref] lsa_ForestTrustInformation **forest_trust_info\n+\t\t);\n+\n \t/* Function 0x4a */\n \tNTSTATUS lsa_LSARSETFORESTTRUSTINFORMATION();\n \n\nModified: branches/SAMBA_4_0/source/rpc_server/lsa/dcesrv_lsa.c\n===================================================================\n--- branches/SAMBA_4_0/source/rpc_server/lsa/dcesrv_lsa.c\t2007-06-08 10:32:29 UTC (rev 23381)\n+++ branches/SAMBA_4_0/source/rpc_server/lsa/dcesrv_lsa.c\t2007-06-08 10:42:33 UTC (rev 23382)\n@@ -3415,10 +3415,10 @@\n \n \n /* \n-  lsa_LSARQUERYFORESTTRUSTINFORMATION \n+  lsa_lsaRQueryForestTrustInformation \n */\n-static NTSTATUS dcesrv_lsa_LSARQUERYFORESTTRUSTINFORMATION(struct dcesrv_call_state *dce_call, TALLOC_CTX *mem_ctx,\n-\t\t       struct lsa_LSARQUERYFORESTTRUSTINFORMATION *r)\n+static NTSTATUS dcesrv_lsa_lsaRQueryForestTrustInformation(struct dcesrv_call_state *dce_call, TALLOC_CTX *mem_ctx,\n+\t\t       struct lsa_lsaRQueryForestTrustInformation *r)\n {\n \tDCESRV_FAULT(DCERPC_FAULT_OP_RNG_ERROR);\n }\n\n"}