{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r22645 - in\n\tbranches/SAMBA_3_0_25/source/nsswitch: .", "body": "Author: idra\nDate: 2007-05-03 12:27:31 +0000 (Thu, 03 May 2007)\nNew Revision: 22645\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22645\n\nLog:\n\nFix bug in idmap_ldap's get_credentials() code.\nWe were dereferencing null for the alloc backend.\n\nJerry, thits need to be in 3.0.25 final.\n\nSimo.\n\n\nModified:\n   branches/SAMBA_3_0_25/source/nsswitch/idmap_ldap.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_25/source/nsswitch/idmap_ldap.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/idmap_ldap.c\t2007-05-03 11:49:32 UTC (rev 22644)\n+++ branches/SAMBA_3_0_25/source/nsswitch/idmap_ldap.c\t2007-05-03 12:27:31 UTC (rev 22645)\n@@ -79,11 +79,17 @@\n \ttmp = lp_parm_const_string(-1, config_option, \"ldap_user_dn\", NULL);\n \n \tif ( tmp ) {\n-\t\tsecret = idmap_fetch_secret(\"ldap\", false, dom->name, tmp);\n+\t\tif (!dom) {\n+\t\t\t/* only the alloc backend is allowed to pass in a NULL dom */\n+\t\t\tsecret = idmap_fetch_secret(\"ldap\", true, NULL, tmp);\n+\t\t} else {\n+\t\t\tsecret = idmap_fetch_secret(\"ldap\", false, dom->name, tmp);\n+\t\t} \n+\n \t\tif (!secret) {\n \t\t\tDEBUG(0, (\"get_credentials: Unable to fetch \"\n \t\t\t\t  \"auth credentials for %s in %s\\n\",\n-\t\t\t\t  tmp, dom->name));\n+\t\t\t\t  tmp, (dom==NULL)?\"ALLOC\":dom->name));\n \t\t\tret = NT_STATUS_ACCESS_DENIED;\n \t\t\tgoto done;\n \t\t} \t\t\n\n"}