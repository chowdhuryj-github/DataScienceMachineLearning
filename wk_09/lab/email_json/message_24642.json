{"category": "ham", "to_address": "simo <idra@samba.org>", "from_address": "\"Gerald (Jerry) Carter\" <jerry@samba.org>", "subject": "Re: svn commit: samba r22713 -\n in\tbranches:\tSAMBA_3_0/source/nsswitch SAMBA_3_0_26/source/nsswitch", "body": "-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA1\n\nsimo wrote:\n\n> Yes, the cache should help, but there are still some backends \n> that can safely be queried when offline.\n\nI spent some more time thinking about this and it doesn't\nreally matter.    For example, idmap_nss is really only\nneeded by applications that deal in tokens like smbd.\nThe offlne logon geature is strictly for use by PAM\nenabled applications,  And in that case, the process will\nonly deal in gids.  So if a user has logged in once\n(which he or she must have in order to logon while offline),\nthe the appropriate SID/uid/gid mappings have been cached.\nSame thing fro idmap_passdb.\n\nidmap_rid should not be used for SIDs that you cannot\ndetermine the type for which means that by definition you\nhave already cached that information as well.\n\nI think you are dealing in theoreticals without actually\nhaving tested a working system.\n\n> In fact you shouldn't allocate if you are not able to \n> validate the SID. When offline allocation functions should\n> probably not be called (previously the validation code\n> was in idmap so it was easy to avoid problems ...)\n\nYou misunderstand the design of the offline logon feature\nthen.  The basic premise is that the core winbindd code does\nnot change.  So we don't have to have special code in each\nwinbindd API call (auth being the exception).  The cache manager\nmust be able to answer the query without calling the underlying\nbackends which are not guaranteed to work offline.  The fact\nthat some can is irrelevant.  The idmap cache manager must\nnot be required to know which ones can and which one cannot.\nThis is why you cannot delete expired entries from the\nidmap_cache.tdb as you were previously doing.\n\nAfter I've finished regression testing in the next day or so,\nif you can give me a specific example where it is necessary\nto actually call into an idmap backend while offline to make\nsomething work wecan deal with that case.  But talking about\ntheoretical possibilities leads to bloated code.\n\n\n\n\n\ncheers, jerry\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1.4.6 (GNU/Linux)\nComment: Using GnuPG with Mozilla - http://enigmail.mozdev.org\n\niD8DBQFGPxSAIR7qMdg1EfYRAvKrAJ9BfC0Zj/TN0LkqvLU/hXKw0YFDQwCghpT8\n9SRfS+oHi1ZzZzn+SeD9NJw=\n=gI7b\n-----END PGP SIGNATURE-----\n\n"}