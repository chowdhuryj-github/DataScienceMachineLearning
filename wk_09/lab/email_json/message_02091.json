{"category": "ham", "to_address": "<r-help@stat.math.ethz.ch>", "from_address": "\"Floris Van Ogtrop\" <f.vanogtrop@usyd.edu.au>", "subject": "[R] tapply and storage", "body": "Dear R-Users,\n\nI have the following problem of which I have provided a simple example.\nUsing the tapply command I can efficiently run the function genflo for\nall months and years. I am new to R and I do not understand how I can\nstore the results of f such that as the function loops through the\nmonths, I can retrieve the tail value of f from the previous month and\nuse this as a condition for the current month iteration (note the\ncomments in the code).\nForgive me if I am not clear.\n\nThanks in advance\n\nFloris   \n\nyear <- c(1972, 1972, 1972, 1972, 1972, 1972, 1972, 1972, 1972, 1972,\n1972, 1972)\nmonth <- c(1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3)\ndischarge <- c(100921, 89885, 81493, 74876, 70579, 68305, 66337, 63095,\n58446, 52674, 44028, 31956)\nn11 <- c(1,1,1,1,1,1,1,1,1,1,1,1)\nn00 <- c(0,0,0,0,0,0,0,0,0,0,0,0)\nn01 <- c(0,0,0,0,0,0,0,0,0,0,0,0)\nn10 <- c(0,0,0,0,0,0,0,0,0,0,0,0)\nflow_data <- data.frame(year, month, discharge, n11, n00, n01, n10)\n\ngenflo <- function(X)\n{\n  n <- nrow(X)\n  if((sum(X$n11) + sum(X$n10)) > 0) {\n \t  Pww <- sum(X$n11)/(sum(X$n11) + sum(X$n10))\n  } else\n    {Pww <- 0}\n  if((sum(X$n00) + sum(X$n01)) > 0) {\n \t  Pdd <- sum(X$n00)/(sum(X$n00) + sum(X$n01))\n \t} else\n    {Pdd <- 0}\n  r <- vector(length = n)\n \trand <- runif(r, 0, 1)\n  f <- vector(length = n)\t # \n  for (i in 2:n) {\t\t #\n    if(X$discharge[i-1] > 0) { # X$discharge needs to be replaced by\n                               # the tail value of f from the\n# previous iteration (month) \n   \t  if(rand[i] > Pww) {\n        f[i] <- 0\n     \t} else\n        {f[i] <- 1}\n   \t} else\n      {if(rand[i] > Pdd){\n        f[i] <- 1\n      } else\n        {f[i] <- 0}\n \t  }\n \t}\n \treturn(f)\n}\n\ngen_flow_days <- by(flow_data, list(month = flow_data[,2], year =\nflow_data[,1]), genflo)\ngen_flow_days <- unlist(gen_flow_days)\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}