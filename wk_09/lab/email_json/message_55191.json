{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r23601 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_25/source/nsswitch SAMBA_3_0_26/source/nsswitch", "body": "Author: jerry\nDate: 2007-06-26 00:52:19 +0000 (Tue, 26 Jun 2007)\nNew Revision: 23601\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23601\n\nLog:\nBUG 4579: Don't mark the SAM domain on a Samba DC as an internal domain or else all network connections from the local winbindd will fail\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_util.c\n   branches/SAMBA_3_0_25/source/nsswitch/winbindd_util.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_util.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_util.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_util.c\t2007-06-25 20:17:04 UTC (rev 23600)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_util.c\t2007-06-26 00:52:19 UTC (rev 23601)\n@@ -82,6 +82,9 @@\n \tif (sid == NULL)\n \t\treturn False;\n \n+\tif ( IS_DC )\n+\t\treturn sid_check_is_builtin(sid);\n+\n \treturn (sid_check_is_domain(sid) || sid_check_is_builtin(sid));\n }\n \n@@ -90,6 +93,9 @@\n \tif (sid == NULL)\n \t\treturn False;\n \n+\tif ( IS_DC )\n+\t\treturn sid_check_is_in_builtin(sid);\n+\n \treturn (sid_check_is_in_our_domain(sid) || sid_check_is_in_builtin(sid));\n }\n \n\nModified: branches/SAMBA_3_0_25/source/nsswitch/winbindd_util.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/nsswitch/winbindd_util.c\t2007-06-25 20:17:04 UTC (rev 23600)\n+++ branches/SAMBA_3_0_25/source/nsswitch/winbindd_util.c\t2007-06-26 00:52:19 UTC (rev 23601)\n@@ -91,6 +91,9 @@\n \tif (sid == NULL)\n \t\treturn False;\n \n+\tif ( IS_DC )\n+\t\treturn sid_check_is_builtin(sid);\n+\n \treturn (sid_check_is_domain(sid) || sid_check_is_builtin(sid));\n }\n \n@@ -99,6 +102,9 @@\n \tif (sid == NULL)\n \t\treturn False;\n \n+\tif ( IS_DC )\n+\t\treturn sid_check_is_in_builtin(sid);\n+\n \treturn (sid_check_is_in_our_domain(sid) || sid_check_is_in_builtin(sid));\n }\n \n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_util.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_util.c\t2007-06-25 20:17:04 UTC (rev 23600)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_util.c\t2007-06-26 00:52:19 UTC (rev 23601)\n@@ -91,6 +91,9 @@\n \tif (sid == NULL)\n \t\treturn False;\n \n+\tif ( IS_DC )\n+\t\treturn sid_check_is_builtin(sid);\n+\n \treturn (sid_check_is_domain(sid) || sid_check_is_builtin(sid));\n }\n \n@@ -99,6 +102,9 @@\n \tif (sid == NULL)\n \t\treturn False;\n \n+\tif ( IS_DC )\n+\t\treturn sid_check_is_in_builtin(sid);\n+\n \treturn (sid_check_is_in_our_domain(sid) || sid_check_is_in_builtin(sid));\n }\n \n\n"}