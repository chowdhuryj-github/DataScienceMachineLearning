{"category": "ham", "to_address": "Multiple recipients of list SAMBA-TECHNICAL <samba-technical@samba.org>", "from_address": "James Peach <jpeach@samba.org>", "subject": "why is (gid_t)-1 treated as a group mapping failure?", "body": "Hi all,\n\nThere's a bunch of code sprinkled throughout the passdb layer(s) that  \nasserts that -1 cannot be a valid ID. While this is often true, there  \nis historical precedent for systems using -1 (and -2). Darwin still  \nuses -1 for the group \"nogroup\", which maps to the SID S-1-0-0.\n\nIf I reference against the 3.0.10(!!) code, then -1 was still treated  \nas invalid, but that seems to have been because nametogid() had no way  \nto return an error. Is there a current justification for excluding -1?\n\nFor example, in pdb_default_delete_dom_group():\n\n         if (!get_domain_group_from_sid(group_sid, &map)) {\n                 DEBUG(10, (\"Could not find group for rid %d\\n\", rid));\n                 return NT_STATUS_NO_SUCH_GROUP;\n         }\n\n         /* We need the group name for the smb_delete_group later on */\n\n         if (map.gid == (gid_t)-1) {\n                 return NT_STATUS_NO_SUCH_GROUP;\n         }\n\n         grp = getgrgid(map.gid);\n         if (grp == NULL) {\n                 return NT_STATUS_NO_SUCH_GROUP;\n         }\n\nThe check for -1 is superfluous because if get_domain_group_from_sid  \nfailed, it should return False, and if map.gid is invalid, getgrgid  \nwill fail.\n\n--\nJames Peach | jpeach@samba.org\n\n"}