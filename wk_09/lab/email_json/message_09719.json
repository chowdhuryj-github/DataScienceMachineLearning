{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22366 - in branches/SAMBA_3_0/source/lib/talloc:\n\t.", "body": "Author: metze\nDate: 2007-04-19 09:08:53 +0000 (Thu, 19 Apr 2007)\nNew Revision: 22366\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22366\n\nLog:\nsync lib/talloc/ with samba4\n\nmetze\nModified:\n   branches/SAMBA_3_0/source/lib/talloc/config.mk\n   branches/SAMBA_3_0/source/lib/talloc/talloc.h\n   branches/SAMBA_3_0/source/lib/talloc/talloc.pc.in\n   branches/SAMBA_3_0/source/lib/talloc/testsuite.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/talloc/config.mk\n===================================================================\n--- branches/SAMBA_3_0/source/lib/talloc/config.mk\t2007-04-19 09:08:30 UTC (rev 22365)\n+++ branches/SAMBA_3_0/source/lib/talloc/config.mk\t2007-04-19 09:08:53 UTC (rev 22366)\n@@ -11,8 +11,3 @@\n #\n # End LIBRARY LIBTALLOC\n ################################################\n-\n-[BINARY::TALLOC]\n-OBJ_FILES = testsuite.o\n-PRIVATE_DEPENDENCIES = LIBTALLOC\n-INSTALLDIR = TORTUREDIR/LOCAL\n\nModified: branches/SAMBA_3_0/source/lib/talloc/talloc.h\n===================================================================\n--- branches/SAMBA_3_0/source/lib/talloc/talloc.h\t2007-04-19 09:08:30 UTC (rev 22365)\n+++ branches/SAMBA_3_0/source/lib/talloc/talloc.h\t2007-04-19 09:08:53 UTC (rev 22366)\n@@ -26,6 +26,10 @@\n    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n */\n \n+#include \n+#include \n+#include \n+\n /* this is only needed for compatibility with the old talloc */\n typedef void TALLOC_CTX;\n \n\nModified: branches/SAMBA_3_0/source/lib/talloc/talloc.pc.in\n===================================================================\n--- branches/SAMBA_3_0/source/lib/talloc/talloc.pc.in\t2007-04-19 09:08:30 UTC (rev 22365)\n+++ branches/SAMBA_3_0/source/lib/talloc/talloc.pc.in\t2007-04-19 09:08:53 UTC (rev 22366)\n@@ -6,5 +6,6 @@\n Name: talloc \n Description: A hierarchical pool based memory system with destructors\n Version: 4.0\n-Libs: @LIBS@ -L${libdir} -ltalloc\n-Cflags: -I${includedir} @CFLAGS@\n+Libs: -L${libdir} -ltalloc\n+Cflags: -I${includedir} \n+URL: http://talloc.samba.org/\n\nModified: branches/SAMBA_3_0/source/lib/talloc/testsuite.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/talloc/testsuite.c\t2007-04-19 09:08:30 UTC (rev 22365)\n+++ branches/SAMBA_3_0/source/lib/talloc/testsuite.c\t2007-04-19 09:08:53 UTC (rev 22366)\n@@ -1012,6 +1012,8 @@\n \n static bool test_autofree(void)\n {\n+#if _SAMBA_BUILD_ < 4\n+\t/* autofree test would kill smbtorture */\n \tvoid *p;\n \tprintf(\"test: autofree [\\nTALLOC AUTOFREE CONTEXT\\n]\\n\");\n \n@@ -1022,13 +1024,17 @@\n \ttalloc_free(p);\n \n \tprintf(\"success: autofree\\n\");\n+#endif\n \treturn true;\n }\n \n-int main(void)\n+struct torture_context;\n+bool torture_local_talloc(struct torture_context *tctx)\n {\n \tbool ret = true;\n \n+\tsetlinebuf(stdout);\n+\n \ttalloc_disable_null_tracking();\n \ttalloc_enable_null_tracking();\n \n@@ -1055,7 +1061,15 @@\n \t}\n \tret &= test_autofree();\n \n+\treturn ret;\n+}\n+\n+#if _SAMBA_BUILD_ < 4\n+int main(void)\n+{\n+\tbool ret = torture_local_talloc(NULL);\n \tif (!ret)\n \t\treturn -1;\n \treturn 0;\n }\n+#endif\n\n"}