{"category": "ham", "to_address": "samba-technical@lists.samba.org, tridge@samba.org", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: svn commit: samba r22202 - in\n\tbranches/SAMBA_3_0/source/nsswitch: .", "body": "On Fri, Apr 13, 2007 at 01:41:39PM +1000, tridge@samba.org wrote:\n> \n> Did you really see problems like this with any tdb file? If so, can\n> you please send me the tdb file?\n\nNo, no winbindd access will produce such a tdb file.\n\n> tdb should be doing range checking on all offsets from the db. If it\n> isn't, then we have a bug and should fix it. The range checking code\n> is what triggers the tdb to grow automatically when needed, so it\n> needs to be right even for non-corrupt databases.\n\nI know - I did work on this code remember :-).\n\nThe issue some (real) customers are seeing is with laptops\n(mainly I believe) going down hard - no shutdown. In that\ncase without the equivalent of an msync it's easy to get\na corrupted tdb state. Probably the real solution is to go\nto a transactional tdb for this cache file, but I started\nthis code before transactional tdb existed and Volker\ndid ask me to finish it. I'd imagine the speed isn't\nan issue but we should check.\n\nJeremy.\n\n"}