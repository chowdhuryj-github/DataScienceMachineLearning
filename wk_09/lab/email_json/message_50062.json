{"category": "ham", "to_address": "beginners@perl.org", "from_address": "\"Max Rodkin\" <maxi4@mail.ru>", "subject": "Re: simple tcp socket server:Is it possible, server wait for '!' sign, not '\\n'?", "body": "Thanks to all!\nScrip did work fine. Here is:\nroot@maxi4:/home# cat gsserver.pl\n#!/usr/bin/perl -w\nuse IO::Socket;\nuse DBI;\n$dbname=\"xxx\";\n$user=\"xxx\";\n$pass=\"xxx\";\n$dbh = \nDBI->connect(\"DBI:mysql:database=$dbname;host=localhost;user=$user;password=$pass\",{'RaiseError' \n=> 1});\nmy $PORT = 5001;                  # pick something not in use\nmy $server = IO::Socket::INET->new( Proto     => 'tcp',\n                                  LocalPort => $PORT,\n                                  Listen    => SOMAXCONN,\n                                  Reuse     => 1);\ndie \"can't setup server\" unless $server;\nlocal $/ = \"!\";\nmy $file=\"./1.txt\";\nopen FILE, \">>$file\" or die \"unable to open $file $!\";\nprint FILE \"[Server $0 accepting clients]\\n\";\nclose (FILE);\nwhile (my $client = $server->accept()) {\n $client->autoflush(1);\n while ( <$client>) {\n  my $answer = $_;\n  open FILE, \">>$file\" or die \"unable to open $file $!\";\n  print FILE \"$answer\\n\";\n  close (FILE);\n$_ = \"insert into tracker values (NOW(), '$answer');\";\n$sth = $dbh -> prepare($_);\n$sth -> execute();\n  print $client \"\\$Ok!\";\n}\nclose $client;\n}\n\nI did write watchdog script to keep running  gsserver.pl\n#!/usr/bin/perl -w\nmy $str=`ps -ax|grep gsserver.pl|grep -v grep`;\nif ($str gt '') {\nprint $str;\n}\nelse{exec(\"/home/gsserver.pl&\");}\n\nand setup it in crontab. The gsserver.pl in RAM permanently. But it not work \n, i did left system on several days, and script did not answer for requests. \nBut it`s running.\nWhat may be wrong?\nRespect, Max Rodkin\n\n\n\n\n-- \nTo unsubscribe, e-mail: beginners-unsubscribe@perl.org\nFor additional commands, e-mail: beginners-help@perl.org\nhttp://learn.perl.org/\n\n\n"}