{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 393: auto-restart NFS if its running when we release an IP in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 393\nrevision-id: tridge@samba.org-20070530002116-kz22u8npsxt6hhom\nparent: tridge@samba.org-20070529125328-29gu0158ljg4rcgn\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Wed 2007-05-30 10:21:16 +1000\nmessage:\n  auto-restart NFS if its running when we release an IP\nmodified:\n  tools/events                   events-20070529030121-04fjh63cxfh8v1pj-1\n=== modified file 'tools/events'\n--- a/tools/events\t2007-05-29 09:34:04 +0000\n+++ b/tools/events\t2007-05-30 00:21:16 +0000\n@@ -36,11 +36,18 @@\n \t}\n \t# if we have a local arp entry for this IP then remove it\n \t/sbin/arp -d $ip 2> /dev/null\n+\techo $ip >> /etc/ctdb/released_ips\n \texit 0\n \t;;\n \n      recovered)\n         # restart any services as necessary, like NFS\n+\t# \n+\t[ -f /etc/ctdb/released_ips ] && {\n+\t\t( /sbin/service nfs status > /dev/null 2>&1 && \n+                      /sbin/service nfs restart > /dev/null 2>&1 ) &\n+\t} > /dev/null 2>&1\n+\t/bin/rm -f /etc/ctdb/released_ips\n \texit 0\n \t;;\n \n\n"}