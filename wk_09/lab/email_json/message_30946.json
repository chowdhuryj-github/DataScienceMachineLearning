{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22938 - in branches/SAMBA_3_0_26/source: lib smbd", "body": "Author: metze\nDate: 2007-05-16 13:35:26 +0000 (Wed, 16 May 2007)\nNew Revision: 22938\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22938\n\nLog:\nmerge 22007 and 22008 from SAMBA_3_0\n\nuse tdb helper functions\n\nmetze\n\nModified:\n   branches/SAMBA_3_0_26/source/lib/util_tdb.c\n   branches/SAMBA_3_0_26/source/smbd/connection.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/lib/util_tdb.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/util_tdb.c\t2007-05-16 13:25:16 UTC (rev 22937)\n+++ branches/SAMBA_3_0_26/source/lib/util_tdb.c\t2007-05-16 13:35:26 UTC (rev 22938)\n@@ -53,12 +53,12 @@\n \n TDB_DATA string_tdb_data(const char *string)\n {\n-\treturn make_tdb_data(string, strlen(string));\n+\treturn make_tdb_data(string, string ? strlen(string) : 0 );\n }\n \n TDB_DATA string_term_tdb_data(const char *string)\n {\n-\treturn make_tdb_data(string, strlen(string) + 1);\n+\treturn make_tdb_data(string, string ? strlen(string) + 1 : 0);\n }\n \n /****************************************************************************\n\nModified: branches/SAMBA_3_0_26/source/smbd/connection.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/smbd/connection.c\t2007-05-16 13:25:16 UTC (rev 22937)\n+++ branches/SAMBA_3_0_26/source/smbd/connection.c\t2007-05-16 13:35:26 UTC (rev 22938)\n@@ -259,11 +259,10 @@\n \tsnprintf( key_string, sizeof(key_string), \"%s/%d/%d\",\n \t\tprec->name, procid_to_pid(&prec->pid), prec->pnum );\n \t\t\n-\tif ( (kbuf->dptr = talloc_strdup(prec, key_string)) == NULL )\n+\t*kbuf = string_term_tdb_data(talloc_strdup(prec, key_string));\n+\tif (kbuf->dptr == NULL )\n \t\treturn NULL;\n-\t\t\n-\tkbuf->dsize = strlen(key_string)+1;\n-\t\n+\n \treturn kbuf;\n }\n \n\n"}