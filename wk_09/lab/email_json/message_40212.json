{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "francogrex <francogrex@mail.com>", "subject": "[R] Metropolis code help", "body": "\nDears, I have the below code for metropolis of the GLM logit (logistic\nregression) using a flat prior. Can someone help me modify the prior so that\nthe model becomes hierarchical by using a flat prior for mu and sigma, the\nderived density for beta ~ N(mu, sigma^2)? Actually I took my code from a\nteacher that posted on the internet and modified it to the GLM logit but I\ncan't adapt it to the hierarchical version. \nHere is the original code of the teacher with both flat prior on betas and a\nhierarchical version:\nwww.stats.uwo.ca/faculty/murdoch/458/metropolis.r \n\n\nBelow is My code with a flat prior on beta only (I'd like also to have the\nhierarchical version!)\nX<- cbind(1,DF$nsaid,DF$diuretic,DF$diuretic*DF$nsaid)\ny<- DF$Var3\n\nMetropolis <- function(logtarget, start, R = 1000, sd\n= 1) {\n    parmcount <- length(start)\n    sims <- matrix(NA, nrow=R, ncol = parmcount)\n    colnames(sims) <- names(start)\n\n    sims[1,] <- start\n    oldlogalpha <- logtarget(start)\n    accepts <- 0\n\n    for (i in 2:R) {\n\tjump <- rnorm(parmcount, mean=0, sd=sd)\n\ty <- sims[i-1,] + jump\n\n    \tnewlogalpha <- logtarget(y)\n\tif (log(runif(1)) < newlogalpha - oldlogalpha) {\n\t    sims[i,] <- y\n\t    oldlogalpha <- newlogalpha\n\t    accepts <- accepts + 1\n\t} else {\n\t    sims[i,] <- sims[i-1,]\n\t}\n    }\n    cat('Accepted ',100*accepts/(R-1),'%\\n')\n    sims\n}\n\n# Use the binomial likelihood \nlogitll=function(beta,y,X)\n{\nX<- cbind(1,DF$nsaid,DF$diuretic,DF$diuretic*DF$nsaid)\ny<- DF$Var3\nlF1=plogis(X%*%as.vector(beta),log.p=TRUE)\nlF2=plogis(-X%*%as.vector(beta),log.p=TRUE)\nsum(y*lF1+(1-y)*lF2)\n}\n\n# Use a uniform prior for p\nlogprior <- function(beta,y,X) 0\n\n# The log posterior is the sum.  It's the target of our MCMC run\nlogposterior <- function(beta,y,X) logprior(beta,y,X)+logitll(beta,y,X)\n\nstart <- c(0,0,0,0)\nsims <- Metropolis(logposterior, start, 10000, sd=1)\n\nse_sims <- apply(sims, 2, sd)\n\nsims <- Metropolis(logposterior, start, 10000,sd=se_sims)\n\ncbind(rbind(mean(sims[1001:10000,1]),mean(sims[1001:10000,2]),mean(sims[1001:10000,3]),mean(sims[1001:10000,4])),\nrbind(sd(sims[1001:10000,1]),sd(sims[1001:10000,2]),sd(sims[1001:10000,3]),sd(sims[1001:10000,4])))\n\nThanks in advance.\n\n-- \nView this message in context: http://www.nabble.com/Metropolis-code-help-tf3850742.html#a10907938\nSent from the R help mailing list archive at Nabble.com.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}