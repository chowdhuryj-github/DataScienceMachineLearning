{"category": "ham", "to_address": "jiho <jo.irisson@gmail.com>", "from_address": "Frank E Harrell Jr <f.harrell@vanderbilt.edu>", "subject": "Re: [R] Problem with Weighted Variance in Hmisc", "body": "jiho wrote:\n> On 2007-June-01  , at 01:03 , Tom La Bone wrote:\n>> The function wtd.var(x,w) in Hmisc calculates the weighted variance  \n>> of x\n>> where w are the weights.  It appears to me that wtd.var(x,w) = var \n>> (x) if all\n>> of the weights are equal, but this does not appear to be the case. Can\n>> someone point out to me where I am going wrong here?  Thanks.\n> \n> The true formula of weighted variance is this one:\n> \thttp://www.itl.nist.gov/div898/software/dataplot/refman2/ch2/ \n> weighvar.pdf\n> But for computation purposes, wtd.var uses another definition which  \n> considers the weights as repeats instead of true weights. However if  \n> the weights are normalized (sum to one) to two formulas are equal. If  \n> you consider weights as real weights instead of repeats, I would  \n> recommend to use this option.\n> With normwt=T, your issue is solved:\n> \n>  > a=1:10\n>  > b=a\n>  > b[]=2\n>  > b\n> [1] 2 2 2 2 2 2 2 2 2 2\n>  > wtd.var(a,b)\n> [1] 8.68421\n> # all weights equal 2 <=> there are two repeats of each element of a\n>  > var(c(a,a))\n> [1] 8.68421\n>  > wtd.var(a,b,normwt=T)\n> [1] 9.166667\n>  > var(a)\n> [1] 9.166667\n> \n> Cheers,\n> \n> JiHO\n\nThe issue is what is being assumed for N in the denominator of the \nvariance formula, since the unbiased estimator subtracts one.  Using \nnormwt=TRUE means you are in effect assuming N is the number of elements \nin the data vector, ignoring the weights.\n\nFrank Harrell\n\n> ---\n> http://jo.irisson.free.fr/\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n> \n\n\n-- \nFrank E Harrell Jr   Professor and Chair           School of Medicine\n                      Department of Biostatistics   Vanderbilt University\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}