{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22164 - in branches: SAMBA_3_0/source/tdb/common\n\tSAMBA_3_0_25/source/tdb/common", "body": "Author: jra\nDate: 2007-04-11 05:27:00 +0000 (Wed, 11 Apr 2007)\nNew Revision: 22164\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22164\n\nLog:\nFix missing lock count release in transaction cancel.\nFound by Taj Khattra .\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/tdb/common/transaction.c\n   branches/SAMBA_3_0_25/source/tdb/common/transaction.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/tdb/common/transaction.c\n===================================================================\n--- branches/SAMBA_3_0/source/tdb/common/transaction.c\t2007-04-11 05:05:33 UTC (rev 22163)\n+++ branches/SAMBA_3_0/source/tdb/common/transaction.c\t2007-04-11 05:27:00 UTC (rev 22164)\n@@ -523,6 +523,8 @@\n \t\t\t\t   F_UNLCK,F_SETLKW, 0, 1);\n \t\t}\n \t\ttdb->num_locks = 0;\n+\t\ttdb->num_lockrecs = 0;\n+\t\tSAFE_FREE(tdb->lockrecs);\n \t}\n \n \t/* restore the normal io methods */\n\nModified: branches/SAMBA_3_0_25/source/tdb/common/transaction.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/tdb/common/transaction.c\t2007-04-11 05:05:33 UTC (rev 22163)\n+++ branches/SAMBA_3_0_25/source/tdb/common/transaction.c\t2007-04-11 05:27:00 UTC (rev 22164)\n@@ -526,6 +526,8 @@\n \t\t\t\t   F_UNLCK,F_SETLKW, 0, 1);\n \t\t}\n \t\ttdb->num_locks = 0;\n+\t\ttdb->num_lockrecs = 0;\n+\t\tSAFE_FREE(tdb->lockrecs);\n \t}\n \n \t/* restore the normal io methods */\n\n"}