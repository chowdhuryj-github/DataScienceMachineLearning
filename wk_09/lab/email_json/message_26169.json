{"category": "ham", "to_address": "\"Spielas Bates\" <bates@stat.wisc.edu>", "from_address": "roger koenker <rkoenker@uiuc.edu>", "subject": "Re: [R] nlme fixed effects specification", "body": "Just to provide some closure on this thread, let me add two comments:\n\n1.  Spie's version of my sweep function:\n\ndiffid1 <-\nfunction(h, id) {\n     id <- as.factor(id)[ , drop = TRUE]\n     apply(as.matrix(h), 2, function(x) x - tapply(x, id, mean)[id])\n}\n\nis far more elegant than my original, and works perfectly, but\n\n2.  I should have mentioned that proposed strategy gets the\ncoefficient estimates right, however their standard errors need a\ndegrees of freedom correction, which in the present instance\nis non-negligible -- sqrt(98/89) -- since the lm() step doesn't\nknow that we have already estimated the fixed effects with the\nsweep operation.\n\nurl:    www.econ.uiuc.edu/~roger            Roger Koenker\nemail    rkoenker@uiuc.edu            Department of Economics\nvox:     217-333-4558                University of Illinois\nfax:       217-244-6678                Champaign, IL 61820\n\n\nOn May 5, 2007, at 7:16 PM, Spielas Bates wrote:\n\n> On 5/5/07, roger koenker  wrote:\n>>\n>> On May 5, 2007, at 3:14 PM, Spielas Bates wrote:\n>> >\n>> > As Roger indicated in another reply you should be able to obtain  \n>> the\n>> > results you want by sweeping out the means of the groups from  \n>> both x\n>> > and y.  However, I tried Roger's function and a modified version  \n>> that\n>> > I wrote and could not show this.  I'm not sure what I am doing  \n>> wrong.\n>>\n>> Spie,  Isn't it just that you are generating a  balanced factor and\n>> Ivo is\n>> generating an unbalanced one -- he wrote:\n>\n>> > fe = as.factor( as.integer( runif(100)*10 ) );\n>\n>> the coefficient on x is the same....\n>\n>> or, aarrgh,  is it that you don't like the s.e. being wrong.   I\n>> didn't notice\n>> this at first.  But it shouldn't happen.  I'll have to take another\n>> look at  this.\n>\n> No, my mistake was much dumber than that.  I was comparing the wrong\n> coefficient.  For some reason I was comparing the coefficient for x in\n> the second fit to the Intercept from the first fit.\n>\n> I'm glad that it really is working and, yes, you are right, the\n> degrees of freedom are wrong in the second fit because the effect of\n> those 10 degrees of freedom are removed from the data before the model\n> is fit.\n>\n>\n>> > I enclose a transcript that shows that I can reproduce the  \n>> result from\n>> > Roger's function but it doesn't do what either of us think it  \n>> should.\n>> > BTW, I realize that the estimate for the Intercept should be  \n>> zero in\n>> > this case.\n>> >\n>> >\n>> >\n>> >> now, with a few IQ points more, I would have looked at the lme\n>> >> function instead of the nlme function in library(nlme).    [then\n>> >> again, I could understand stats a lot better with a few more IQ\n>> >> points.]  I am reading the lme description now, but I still don't\n>> >> understand how to specify that I want to have dummies in my\n>> >> specification, plus the x variable, and that's it.  I think I  \n>> am not\n>> >> understanding the integration of fixed and random effects in  \n>> the same\n>> >> R functions.\n>> >>\n>> >> thanks for pointing me at your lme4 library.  on linux, version\n>> >> 2.5.0, I did\n>> >>   R CMD INSTALL matrix*.tar.gz\n>> >>   R CMD INSTALL lme4*.tar.gz\n>> >> and it installed painlessly.  (I guess R install packages don't  \n>> have\n>> >> knowledge of what they rely on;  lme4 requires matrix, which  \n>> the docs\n>> >> state, but having gotten this wrong, I didn't get an error.  no  \n>> big\n>> >> deal.  I guess I am too used to automatic resolution of  \n>> dependencies\n>> >> from linux installers these days that I did not expect this.)\n>> >>\n>> >> I now tried your specification:\n>> >>\n>> >> > library(lme4)\n>> >> Loading required package: Matrix\n>> >> Loading required package: lattice\n>> >> > lmer(y~x+(1|fe))\n>> >> Linear mixed-effects model fit by REML\n>> >> Formula: y ~ x + (1 | fe)\n>> >>  AIC BIC logLik MLdeviance REMLdeviance\n>> >>  282 290   -138        270          276\n>> >> Random effects:\n>> >>  Groups   Name        Variance       Std.Dev.\n>> >>  fe       (Intercept) 0.000000000445 0.0000211\n>> >>  Residual             0.889548532468 0.9431588\n>> >> number of obs: 100, groups: fe, 10\n>> >>\n>> >> Fixed effects:\n>> >>             Estimate Std. Error t value\n>> >> (Intercept)  -0.0188     0.0943  -0.199\n>> >> x             0.0528     0.0904   0.585\n>> >>\n>> >> Correlation of Fixed Effects:\n>> >>   (Intr)\n>> >> x -0.022\n>> >> Warning messages:\n>> >> 1: Estimated variance for factor 'fe' is effectively zero\n>> >>  in: `LMEoptimize<-`(`*tmp*`, value = list(maxIter = 200L,\n>> >> tolerance =\n>> >> 0.0000000149011611938477,\n>> >> 2: $ operator not defined for this S4 class, returning NULL in: x\n>> >> $symbolic.cor\n>> >>\n>> >> Without being a statistician, I can still determine that this  \n>> is not\n>> >> the model I would like to work with.  The coefficient is  \n>> 0.0528, not\n>> >> 0.0232.  (I am also not sure why I am getting these warning  \n>> messages\n>> >> on my system, either, but I don't think it matters.)\n>> >>\n>> >> is there a simple way to get the equivalent specification for my\n>> >> smple\n>> >> model, using lmer or lme, which does not choke on huge data sets?\n>> >>\n>> >> regards,\n>> >>\n>> >> /ivo\n>> >>\n>> >> \n>> > ______________________________________________\n>> > R-help@stat.math.ethz.ch mailing list\n>> > https://stat.ethz.ch/mailman/listinfo/r-help\n>> > PLEASE do read the posting guide http://www.R-project.org/posting-\n>> > guide.html\n>> > and provide commented, minimal, self-contained, reproducible code.\n>>\n>>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}