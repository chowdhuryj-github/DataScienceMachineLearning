{"category": "ham", "to_address": "Alison Winters <alisonw@sgi.com>", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: bug in send_file_readbraw?", "body": "On Wed, May 09, 2007 at 10:44:33AM +1000, Alison Winters wrote:\n> I've been poking around in reply.c the past few days working on some\n> profiling improvements, and i noticed something that appears to be a bug\n> in the send_file_readbraw function.  I could be wrong in identifying\n> this as a bug because i don't know what Windows does in this case, but\n> it seems a bit bizarre to me that if the sendfile() call succeeds, we\n> then continue to call read_file() and write_data() immediately\n> afterwards.  It looks to me like we'll be sending duplicate data in this\n> case.  Patch against SAMBA_3_0 is attached, though this is evident in\n> 3.0.24 and presumably other versions too.\n> \n> Alison\n\n> Index: source/smbd/reply.c\n> ===================================================================\n> --- source/smbd/reply.c\t(revision 22764)\n> +++ source/smbd/reply.c\t(working copy)\n> @@ -2237,7 +2237,7 @@\n>  \t\t\t\tfsp->fsp_name, strerror(errno) ));\n>  \t\t\texit_server_cleanly(\"send_file_readbraw sendfile failed\");\n>  \t\t}\n> -\n> +\t\treturn;\n>  \t}\n>  \n>    normal_readbraw:\n\nPerfectly correct thanks. I'll fix for 3.0.25 and beyond.\n\nThanks !\n\nJeremy.\n\n"}