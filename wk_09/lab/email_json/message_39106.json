{"category": "ham", "to_address": "samba-technical@samba.org", "from_address": "\"Gerald (Jerry) Carter\" <jerry@samba.org>", "subject": "Re: [PATCH] LOOKUP_NAME_EXPLICIT to avoid lockups between winbindd\n and nscd", "body": "-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA1\n\nGerald (Jerry) Carter wrote:\n> Here's the problem I hit:\n> \n> getgrnam(\"foo\") -> nscd -> NSS -> winbindd ->\n>   winbindd_passdb.c:nam_to_sid() -> lookup_global_sam_name() ->\n>   getgrnam(\"foo\") -> nscd -> ....\n> \n> This is in the SAMBA_3_0 specifically but in theory could happen\n> SAMBA_3_0_25 (or 26) for an unknown group.\n> \n> The attached patch passes down enough state for the\n> name_to_sid() call to be able to determine the originating\n> winbindd cmd that came into the parent.  So we can avoid\n> making more NSS calls if the original call came in trough NSS\n> so we don't deadlock ?  But you should still service\n> lookupname() calls which are needed for example when\n> doing the token access checks for a \"valid groups\" from\n> smb.conf.\n> \n> I've got this in testing now.  The problem has shown up with the\n> DsProvider on OS X and with nscd on SOlaris and Linux.\n> \n> Comments?\n\nNo one has stringy objected so I'm checking this into\nSAMBA_3_0_26\n\n\n\ncheers, jerry\n-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1.4.6 (GNU/Linux)\nComment: Using GnuPG with Mozilla - http://enigmail.mozdev.org\n\niD8DBQFGXchsIR7qMdg1EfYRArVWAJ94miIkIGPk9pZVyIQQ07BiBxy37wCdF+dA\n8hGSnbCKhD9m0UgD3gFIm/c=\n=eU+n\n-----END PGP SIGNATURE-----\n\n"}