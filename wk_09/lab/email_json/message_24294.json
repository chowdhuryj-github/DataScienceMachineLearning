{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r22724 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_26/source/nsswitch", "body": "Author: jerry\nDate: 2007-05-06 21:31:19 +0000 (Sun, 06 May 2007)\nNew Revision: 22724\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22724\n\nLog:\nCall an nss_info backend's init() function if the \nprevious call was unsuccessful.  needed for offline\nlogons.\n\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/nss_info.c\n   branches/SAMBA_3_0_26/source/nsswitch/nss_info.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/nss_info.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/nss_info.c\t2007-05-06 21:28:03 UTC (rev 22723)\n+++ branches/SAMBA_3_0/source/nsswitch/nss_info.c\t2007-05-06 21:31:19 UTC (rev 22724)\n@@ -190,10 +190,11 @@\n \t\tnss_domain->backend = nss_backend;\n \t\tnss_domain->domain  = talloc_strdup( nss_domain, domain );\n \n-\t\tstatus = nss_domain->backend->methods->init( nss_domain );\n-\t\tif ( NT_STATUS_IS_OK( status ) ) {\n+\t\t/* Try to init and ave the result */\n+\n+\t\tnss_domain->init_status = nss_domain->backend->methods->init( nss_domain );\n \t\t\tDLIST_ADD( nss_domain_list, nss_domain );\n-\t\t} else {\n+\t\tif ( !NT_STATUS_IS_OK(nss_domain->init_status) ) {\t\t\t\n \t\t\tDEBUG(0,(\"nss_init: Failed to init backend for %s domain!\\n\", \n \t\t\t\t nss_domain->domain));\n \t\t}\n@@ -248,6 +249,10 @@\n \t\tp = nss_domain_list;\t\t\n \t}\n \n+\tif ( !NT_STATUS_IS_OK( p->init_status ) ) {\n+\t       p->init_status = p->backend->methods->init( p );\n+\t}\n+\n \treturn p;\n }\n \n\nModified: branches/SAMBA_3_0_26/source/nsswitch/nss_info.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/nss_info.c\t2007-05-06 21:28:03 UTC (rev 22723)\n+++ branches/SAMBA_3_0_26/source/nsswitch/nss_info.c\t2007-05-06 21:31:19 UTC (rev 22724)\n@@ -190,10 +190,11 @@\n \t\tnss_domain->backend = nss_backend;\n \t\tnss_domain->domain  = talloc_strdup( nss_domain, domain );\n \n-\t\tstatus = nss_domain->backend->methods->init( nss_domain );\n-\t\tif ( NT_STATUS_IS_OK( status ) ) {\n+\t\t/* Try to init and ave the result */\n+\n+\t\tnss_domain->init_status = nss_domain->backend->methods->init( nss_domain );\n \t\t\tDLIST_ADD( nss_domain_list, nss_domain );\n-\t\t} else {\n+\t\tif ( !NT_STATUS_IS_OK(nss_domain->init_status) ) {\t\t\t\n \t\t\tDEBUG(0,(\"nss_init: Failed to init backend for %s domain!\\n\", \n \t\t\t\t nss_domain->domain));\n \t\t}\n@@ -248,6 +249,10 @@\n \t\tp = nss_domain_list;\t\t\n \t}\n \n+\tif ( !NT_STATUS_IS_OK( p->init_status ) ) {\n+\t       p->init_status = p->backend->methods->init( p );\n+\t}\n+\n \treturn p;\n }\n \n\n"}