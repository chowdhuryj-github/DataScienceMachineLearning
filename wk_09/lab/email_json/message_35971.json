{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r23136 - in branches/SAMBA_4_0/source:\n\tauth/gensec ntvfs/cifs", "body": "Author: abartlet\nDate: 2007-05-25 08:44:33 +0000 (Fri, 25 May 2007)\nNew Revision: 23136\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23136\n\nLog:\nSet the event context onto the credentials in more places.\n\nThis helps ensure that the kerberos code uses the right event context.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\n   branches/SAMBA_4_0/source/ntvfs/cifs/vfs_cifs.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\n===================================================================\n--- branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\t2007-05-25 08:14:15 UTC (rev 23135)\n+++ branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\t2007-05-25 08:44:33 UTC (rev 23136)\n@@ -1342,6 +1342,7 @@\n \t\t\treturn NT_STATUS_NO_MEMORY;\n \t\t}\n \n+\t\tcli_credentials_set_event_context(session_info->credentials, gensec_security->event_ctx);\n \t\tcli_credentials_set_conf(session_info->credentials);\n \t\t/* Just so we don't segfault trying to get at a username */\n \t\tcli_credentials_set_anonymous(session_info->credentials);\n\nModified: branches/SAMBA_4_0/source/ntvfs/cifs/vfs_cifs.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/cifs/vfs_cifs.c\t2007-05-25 08:14:15 UTC (rev 23135)\n+++ branches/SAMBA_4_0/source/ntvfs/cifs/vfs_cifs.c\t2007-05-25 08:44:33 UTC (rev 23136)\n@@ -165,6 +165,7 @@\n \t\tif (!credentials) {\n \t\t\treturn NT_STATUS_NO_MEMORY;\n \t\t}\n+\t\tcli_credentials_set_event_context(credentials, ntvfs->ctx->event_ctx);\n \t\tcli_credentials_set_conf(credentials);\n \t\tcli_credentials_set_username(credentials, user, CRED_SPECIFIED);\n \t\tif (domain) {\n@@ -174,6 +175,7 @@\n \t} else if (machine_account) {\n \t\tDEBUG(5, (\"CIFS backend: Using machine account\\n\"));\n \t\tcredentials = cli_credentials_init(private);\n+\t\tcli_credentials_set_event_context(credentials, ntvfs->ctx->event_ctx);\n \t\tcli_credentials_set_conf(credentials);\n \t\tif (domain) {\n \t\t\tcli_credentials_set_domain(credentials, domain, CRED_SPECIFIED);\n\n"}