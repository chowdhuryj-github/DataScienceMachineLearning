{"category": "ham", "to_address": "\"Patnaik, Tirthankar\" <tirthankar.patnaik@citi.com>", "from_address": "\"hadley wickham\" <h.wickham@gmail.com>", "subject": "Re: [R] Confusion with sapply", "body": "On 6/13/07, Patnaik, Tirthankar  wrote:\n> Hi,\n>  I have some confusion in applying a function over a column.\n>\n> Here's my function. I just need to shift non-March month-ends to March\n> month-ends. Initially I tried seq.dates, but one cannot give a negative\n> increment (decrement) here.\n>\n> return(as.Date(seq.dates(format(xdate,\"%m/%d/%Y\"),by=\"months\",len=4)[4])\n> )\n>\n> Hence this simple function:\n>\n> > mydate <- as.Date(\"2006-01-01\")\n> >\n> > # Function to shift non-March company-reporting dates to March.\n> > Set2March <- function(xdate){\n> + # Combines non-March months into March months:\n> + # Dec2006 -> Mar2007\n> + # Mar2006 -> Mar2006\n> + # Jun2006 -> Mar2006\n> + # Sep2006 -> Mar2006\n> + # VERY Specific code.\n> +     Month <- format(xdate,\"%m\")\n> +     wDate <- month.day.year(julian(xdate))\n> +     if (Month==\"12\"){\n> +         wDate$year <- wDate$year + 1\n> +         wDate$month <- 3\n> +     }else\n> +     if (Month==\"06\"){\n> +         wDate$month <- 3\n> +     }else\n> +     if (Month==\"09\"){\n> +         wDate$month <- 3\n> +         wDate$day <- wDate$day + 1\n> +     }else warning (\"No Changes made to the month, since month is not\n> one of (6,9,12)\")\n> +     cDate <- chron(paste(wDate$month,wDate$day,wDate$year,sep=\"/\"))\n> +     return(as.Date(as.yearmon(as.Date(cDate,\"%m/%d/%y\")),frac=1))\n> + }\n> > Set2March(as.Date(\"2006-06-30\"))\n> [1] \"2006-03-31\"\n> > Set2March(mydate)\n> [1] \"2006-01-31\"\n> Warning message:\n> No Changes made to the month, since month is not one of (6,9,12) in:\n> Set2March(mydate)\n> >\n>\n> Works well when I use it on a single date. Then I try it on a vector:\n>\n>\n> > dc <- seq(as.Date(\"2006-01-01\"),len=10, by=\"month\")\n> > dc\n>  [1] \"2006-01-01\" \"2006-02-01\" \"2006-03-01\" \"2006-04-01\" \"2006-05-01\"\n> \"2006-06-01\" \"2006-07-01\" \"2006-08-01\"\n>  [9] \"2006-09-01\" \"2006-10-01\"\n>\n>\n> > sapply(as.vector(dc),Set2March)\n> Error in prettyNum(.Internal(format(x, trim, digits, nsmall, width, 3,\n> :\n>         unimplemented type 'character' in 'asLogical'\n> >\n>\n> What am I missing here? Shouldn't the function work with the sapply\n> working on each entry?\n\nYou can considerable simplify your code with some helper functions:\n\nmonth <- function(x) as.POSIXlt(x)$mon + 1\n\"month<-\" <- function(x, value) {\n\tISOdatetime(year(x) + (value - 1) %/% 12,  (value - 1) %% 12 + 1 ,\nmday(x), hour(x), minute(x), second(x), tz(x))\n}\nyear <- function(x) as.POSIXlt(x)$year + 1900\n\"year<-\" <- function(x, value) {\n\tISOdatetime(value,  month(x), mday(x), hour(x), minute(x), second(x), tz(x))\n}\n\nmarchise <- function(x) {\n\tif (month(x) == 12) year(x) <- year(x)\n\tif (month(x) %in% c(6, 9, 12)) month(x) <- 3\n\tx\n}\n\ndc <- seq(as.Date(\"2006-01-01\"),len=10, by=\"month\")\nmarchise(dc[[1]])\n\n\nHowever, that doesn't work with sapply because the date class seems to\nget stripped off - I'm not completely why, but perhaps because the\ndate class is a property of the entire vector not the individual\nvalues:\n\nsapply(marchise, dc)\n\nHadley\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}