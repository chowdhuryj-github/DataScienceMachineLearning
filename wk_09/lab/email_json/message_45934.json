{"category": "ham", "to_address": "matt@diephouse.com", "from_address": "chromatic <chromatic@wgz.org>", "subject": "Re: P6 String Assertion Failure (diagnosis and fix)", "body": "On Sunday 10 June 2007 14:44:29 Matt Diephouse wrote:\n\n> On 6/7/07, chromatic  wrote:\n\n> > When I run the t/01-sanity/06-use.t test in languages/perl6, I get an\n> > assertion failure:\n> >\n> >         parrot: src/string.c:2028: string_hash: Assertion `s->encoding &&\n> > s->charset && !(((s)->obj.flags) & b_PObj_on_free_list_FLAG)' failed.\n\n> Assertions like this really ought to be broken up in the source. By\n> using multiple assertions, it's immediately obvious which assertion as\n> actually failing. I've been meaning to split this up for quite some\n> time but never got around to it.\n\nFixed in r18911.\n\n> Good work! This has been the cause of a number of Perl 6 GC errors. I\n> spent some time trying to track it down before but never made it as\n> far as you did.\n\n> Here's hoping that this is the last GC bug. ;-)\n\nI'm not sure it is a GC bug.  At least, if it's a GC bug, it's in assuming \nthat GC flags have any meaning outside of a GC run.  I have a very strong \ninclination to revert the \"Mark all STRINGs as live\" change and fix all code \nthat looks at GC flags outside of src/gc/*.c.\n\nI do hope that Perl 6 runs better on Win32 with the temporary fix though.\n\n-- c\n\n"}