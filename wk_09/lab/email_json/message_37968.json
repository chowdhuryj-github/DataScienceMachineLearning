{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 367: rename ctdb_control utility to ctdb in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 367\nrevision-id: tridge@samba.org-20070529005912-ijwmukca83p13640\nparent: tridge@samba.org-20070528101145-v3hxch4bnxdhp7g7\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Tue 2007-05-29 10:59:12 +1000\nmessage:\n  rename ctdb_control utility to ctdb\nmodified:\n  Makefile.in                    makefile.in-20061117234101-o3qt14umlg9en8z0-1\n  takeover/ctdb_takeover.c       ctdb_takeover.c-20070525071636-a5n1ihghjtppy08r-2\n=== modified file 'Makefile.in'\n--- a/Makefile.in\t2007-05-27 20:48:18 +0000\n+++ b/Makefile.in\t2007-05-29 00:59:12 +0000\n@@ -68,7 +68,7 @@\n \t@echo Linking $@\n \t@$(CC) $(CFLAGS) -o $@ direct/ctdbd.o $(OBJS) $(LIB_FLAGS)\n \n-bin/ctdb_control: $(OBJS) tools/ctdb_control.o \n+bin/ctdb: $(OBJS) tools/ctdb_control.o \n \t@echo Linking $@\n \t@$(CC) $(CFLAGS) -o $@ tools/ctdb_control.o $(OBJS) $(LIB_FLAGS)\n \n\n=== modified file 'takeover/ctdb_takeover.c'\n--- a/takeover/ctdb_takeover.c\t2007-05-27 14:51:10 +0000\n+++ b/takeover/ctdb_takeover.c\t2007-05-29 00:59:12 +0000\n@@ -252,14 +252,17 @@\n \t\t\tfor (j=(i+1)%nodemap->num;\n \t\t\t     j != i;\n \t\t\t     j=(j+1)%nodemap->num) {\n-\t\t\t\tif (nodemap->nodes[j].flags & NODE_FLAGS_CONNECTED) {\n+\t\t\t\tif ((nodemap->nodes[j].flags & NODE_FLAGS_CONNECTED) && \n+\t\t\t\t    same_subnet(nodemap->nodes[j]->public_address, nodemap->nodes[i]->public_address, \n+\t\t\t\t\t\tnodemap->nodes[i]->public_netmask)) {\n \t\t\t\t\tctdb->nodes[i]->takeover_vnn = nodemap->nodes[j].vnn;\n \t\t\t\t\tbreak;\n \t\t\t\t}\n \t\t\t}\n \t\t\tif (j == i) {\n-\t\t\t\tDEBUG(0,(__location__ \" No node available to assign to??\\n\"));\n-\t\t\t\treturn -1;\n+\t\t\t\tDEBUG(0,(__location__ \" No node available on same network to take %s\\n\",\n+\t\t\t\t\t nodemap->nodes[i]->public_address));\n+\t\t\t\tctdb->nodes[i]->takeover_vnn = -1;\t\n \t\t\t}\n \t\t}\n \t}\t\n\n"}