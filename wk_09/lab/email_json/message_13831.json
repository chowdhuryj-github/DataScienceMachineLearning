{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22493 - in branches: SAMBA_3_0/source/smbd\n\tSAMBA_3_0_25/source/smbd", "body": "Author: jra\nDate: 2007-04-23 21:40:54 +0000 (Mon, 23 Apr 2007)\nNew Revision: 22493\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22493\n\nLog:\nFix horrible memory corruption bug with CIFS POSIX open/mkidr.\nFound by SteveF + valgrind :-). Jerry - essential for rc3.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/smbd/trans2.c\n   branches/SAMBA_3_0_25/source/smbd/trans2.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/smbd/trans2.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/trans2.c\t2007-04-23 21:07:05 UTC (rev 22492)\n+++ branches/SAMBA_3_0/source/smbd/trans2.c\t2007-04-23 21:40:54 UTC (rev 22493)\n@@ -5434,6 +5434,7 @@\n \t\t*pdata_return_size = 0;\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n+\tpdata = *ppdata;\n \n \tSSVAL(pdata,0,NO_OPLOCK_RETURN);\n \tSSVAL(pdata,2,0); /* No fnum. */\n@@ -5610,6 +5611,7 @@\n \t\t*pdata_return_size = 0;\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n+\tpdata = *ppdata;\n \n \tif (extended_oplock_granted) {\n \t\tif (flags & REQUEST_BATCH_OPLOCK) {\n\nModified: branches/SAMBA_3_0_25/source/smbd/trans2.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/smbd/trans2.c\t2007-04-23 21:07:05 UTC (rev 22492)\n+++ branches/SAMBA_3_0_25/source/smbd/trans2.c\t2007-04-23 21:40:54 UTC (rev 22493)\n@@ -5382,6 +5382,7 @@\n \t\t*pdata_return_size = 0;\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n+\tpdata = *ppdata;\n \n \tSSVAL(pdata,0,NO_OPLOCK_RETURN);\n \tSSVAL(pdata,2,0); /* No fnum. */\n@@ -5558,6 +5559,7 @@\n \t\t*pdata_return_size = 0;\n \t\treturn NT_STATUS_NO_MEMORY;\n \t}\n+\tpdata = *ppdata;\n \n \tif (extended_oplock_granted) {\n \t\tif (flags & REQUEST_BATCH_OPLOCK) {\n\n"}