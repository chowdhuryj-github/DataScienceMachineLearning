{"category": "ham", "to_address": "beginners@perl.org", "from_address": "Northstardomus <northstardomus@gmail.com>", "subject": "Re: Database insertion, escape issue", "body": "On Jun 12, 6:34 pm, chas.ow...@gmail.com (Chas Owens) wrote:\n> On 6/12/07, Northstardomus  wrote:\n> snip>         $dbh->prepare('INSERT INTO area_status (areaID, survey_date,\n> > update_time, status ) VALUES (?,?,?,?)');\n> >         $dbh->execute('$values[0]', '$values[1]', '$values[2]',\n> > '$values[3]');\n>\n> snip\n>\n> You are getting an error because $dbh->prepare returns a statement\n> handle that can be executed.  The code should be written like this:\n>\n> my $sth = $dbh->prepare('\n>     INSERT INTO area_status (areaID, survey_date, update_time, status )\n>         VALUES (?,?,?,?)\n> ');\n> $sth->execute(@values[0 .. 3]);\n>\n> Also, connecting to the database every time you want to do something\n> is expensive.  You should connect once near the beginning of the\n> script and use that connection for the rest of the script.  The\n> statement handle may also be reused, so you might want to name it with\n> a better name than $sth* like this:\n>\n> my $dbh = DBI->connect(...);\n>\n> my $insert_area_status_sth = $dbh->prepare(...);\n>\n> while () {\n>     my @rec = split /,/;\n>     $insert_area_status_sth->execute(@rec) if $rec[0] eq 'Y';\n>\n> }\n>\n> * for handles that have a limited scope $sth is perfectly fine\n\nChas, thank you, I don't think I would have found that error any time\nsoon.  I really appreciate it.  Also, thanks for the advice on how I'm\nusing the database, I think it is spot on and I am going to impliment\nyour suggestions.\n\nFor reference here is what I ended up with, I had to do the\nplaceholders in the select statement as well.\n\nReplaced the comment code with the uncommented code:\n    #$sql = \"SELECT * FROM area_status WHERE areaID='$values[0]' AND\nsurvey_date='$values[1]' AND status='$values[3]'\";\n    #$sth = $dbh->prepare($sql);\n    $sql = \"SELECT * FROM area_status WHERE areaID=? AND survey_date=?\nAND status=?\";\n    $sth = $dbh->prepare($sql);\n    $sth->execute($values[0], $values[1], $values[3]) or die $dbh-\n>errstr;;\n\nand\n\n#    if ($OK2INSERT) {\n#        $dbh = DBI->connect(\"DBI:SQLite:dbname=C:/Lanosrep/beW/Perl/\nHelpPage/area.db\", \"\", \"\", {'RaiseError' => 1});\n#        print \"Inserting into Database , @values.\";\n#        $dbh->do(\"INSERT INTO area_status (areaID, survey_date,\nupdate_time, status ) VALUES ('$values[0]', '$values[1]',\n'$values[2]', '$values[3]')\");\n#        $dbh->disconnect();\n#    }\n    if ($OK2INSERT) {\n        #$dbh = DBI->connect(\"DBI:SQLite:dbname=C:/Lanosrep/beW/Perl/\nHelpPage/area.db\", \"\", \"\", {'RaiseError' => 1});\n        print \"Inserting into Database , @values.\";\n        my $sth = $dbh->prepare('INSERT INTO area_status (areaID,\nsurvey_date, update_time, status ) VALUES (?,?,?,?)');\n        $sth->execute($values[0], $values[1], $values[2], $values[3])\nor die $dbh->errstr;\n        $sth->finish;\n        $dbh->disconnect();\n    }\n\nNSD\n\n\n-- \nTo unsubscribe, e-mail: beginners-unsubscribe@perl.org\nFor additional commands, e-mail: beginners-help@perl.org\nhttp://learn.perl.org/\n\n\n"}