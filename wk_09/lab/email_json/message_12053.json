{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r22427 - in\n\tbranches/SAMBA_4_0/source/script/tests: .", "body": "Author: abartlet\nDate: 2007-04-21 21:09:56 +0000 (Sat, 21 Apr 2007)\nNew Revision: 22427\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22427\n\nLog:\nAbort in a few more cases of failure to provision.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/script/tests/Samba4.pm\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/script/tests/Samba4.pm\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/Samba4.pm\t2007-04-21 20:44:19 UTC (rev 22426)\n+++ branches/SAMBA_4_0/source/script/tests/Samba4.pm\t2007-04-21 21:09:56 UTC (rev 22427)\n@@ -257,7 +257,7 @@\n \";\n \tclose(LDIF);\n \n-\tsystem(\"$self->{bindir}/ad2oLschema $configuration -H $privatedir/sam.ldb --option=convert:target=fedora-ds -I $self->{setupdir}/schema-map-fedora-ds-1.0 -O $fedora_ds_dir/schema/99_ad.ldif >&2\");\n+\tsystem(\"$self->{bindir}/ad2oLschema $configuration -H $privatedir/sam.ldb --option=convert:target=fedora-ds -I $self->{setupdir}/schema-map-fedora-ds-1.0 -O $fedora_ds_dir/schema/99_ad.ldif >&2\") == 0 or die(\"schema conversion for Fedora DS failed\");\n \n \treturn ($fedora_ds_dir, $pidfile);\n }\n@@ -359,10 +359,10 @@\n \tclose(CONF);\n \n \t#This uses the provision we just did, to read out the schema\n-\tsystem(\"$self->{bindir}/ad2oLschema $configuration -H $privatedir/sam.ldb -I $self->{setupdir}/schema-map-openldap-2.3 -O $ldapdir/ad.schema >&2\");\n+\tsystem(\"$self->{bindir}/ad2oLschema $configuration -H $privatedir/sam.ldb -I $self->{setupdir}/schema-map-openldap-2.3 -O $ldapdir/ad.schema >&2\") == 0 or die(\"schema conversion for OpenLDAP failed\");\n \n \t#Now create an LDAP baseDN\n-\tsystem(\"$self->{bindir}/smbscript $self->{setupdir}/provision $provision_options --ldap-base >&2\");\n+\tsystem(\"$self->{bindir}/smbscript $self->{setupdir}/provision $provision_options --ldap-base >&2\") == 0 or die(\"creating an OpenLDAP basedn failed\");\n \n \tmy $oldpath = $ENV{PATH};\n \t$ENV{PATH} = \"/usr/local/sbin:/usr/sbin:/sbin:$ENV{PATH}\";\n@@ -531,10 +531,10 @@\n #Ensure the config file is valid before we start\n \tif (system(\"$self->{bindir}/testparm $configuration -v --suppress-prompt >/dev/null 2>&1\") != 0) {\n \t\tsystem(\"$self->{bindir}/testparm $configuration >&2\");\n-\t\tdie(\"Failed to create configuration!\");\n+\t\tdie(\"Failed to create a valid smb.conf configuration!\");\n \t}\n \n-\t(system(\"($self->{bindir}/testparm $configuration -v --suppress-prompt --parameter-name=\\\"netbios name\\\" --section-name=global 2> /dev/null | grep -i ^$netbiosname ) >/dev/null 2>&1\") == 0) or die(\"Failed to create configuration!\");\n+\t(system(\"($self->{bindir}/testparm $configuration -v --suppress-prompt --parameter-name=\\\"netbios name\\\" --section-name=global 2> /dev/null | grep -i ^$netbiosname ) >/dev/null 2>&1\") == 0) or die(\"Failed to create a valid smb.conf configuration!\");\n \n \tmy @provision_options = ($configuration);\n \tpush (@provision_options, \"--host-name=$netbiosname\");\n\n"}