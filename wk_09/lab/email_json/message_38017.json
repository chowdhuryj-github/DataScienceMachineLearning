{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 383: update packaging for new defaults in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 383\nrevision-id: tridge@samba.org-20070529053642-xsoqyaoqc38ztq0o\nparent: tridge@samba.org-20070529052638-xj2efvjbm9e8o6y7\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Tue 2007-05-29 15:36:42 +1000\nmessage:\n  update packaging for new defaults\nmodified:\n  packaging/RHEL/setup/ctdb.init ctdb.init-20070527204758-biuh7znabuwan3zn-6\n  packaging/RHEL/setup/ctdb.sysconfig ctdb.sysconfig-20070527204758-biuh7znabuwan3zn-7\n=== modified file 'packaging/RHEL/setup/ctdb.init'\n--- a/packaging/RHEL/setup/ctdb.init\t2007-05-28 15:38:04 +0000\n+++ b/packaging/RHEL/setup/ctdb.init\t2007-05-29 05:36:42 +0000\n@@ -20,52 +20,26 @@\n # Source networking configuration.\n . /etc/sysconfig/network\n \n-# There is no \"default\" config so we must have this file with \n-# CLUSTER_NODES and PUBLIC_ADDRESSES\n+# pull in admin specified config \n if [ -f /etc/sysconfig/ctdb ]; then\n    . /etc/sysconfig/ctdb \n-   if [ -z $CLUSTER_NODES ] || [ -z $PUBLIC_ADDRESSES ]; then\n-       exit 0\n-   fi\n-else\n-    exit 0\n fi\n \n # Check that networking is up.\n [ ${NETWORKING} = \"no\" ] && exit 0\n \n-\n-CLUSTER_BASEDIR=`dirname $CLUSTER_NODES`\n-CLUSTER_ADDRESSES=$CLUSTER_BASEDIR/cluster_addresses.txt\n-[ -z $CTDB_PORT ] && CTDB_PORT=9001\n-[ -z $DEBUGLEVEL ] && DEBUGLEVEL=0\n-if [ -z $LOGFILE ]; then\n-    LOGFILEBASE=`smbd -b | grep LOGFILEBASE | awk '{print $2}'`\n-    if [ -z $LOGFILEBASE ]; then\n-\techo \"must have LOGFILE specified or smbd installed\"\n-\treturn 0\n-    fi\n-    LOGFILE=$LOGFILEBASE/log.ctdb\n-fi\n-\n-# build the cluster addresses file\n-TMP_ADDRESSES=`mktemp -t cluster_addresses.XXXXXXXX`\n-rm -f $TMP_ADDRESSES\n-for a in `egrep '^[[:alnum:]]' $CLUSTER_NODES`; do\n-    echo \"$a:$CTDB_PORT\" >> $TMP_ADDRESSES\n-done\n-mv -f $TMP_ADDRESSES $CLUSTER_ADDRESSES\n-\n-# create the temporary local dbdir\n-DBDIR=`mktemp -td ctdb.XXXXXXXX`\n-CTDBOPTIONS=\"--nlist=$CLUSTER_ADDRESSES --public-addresses=$PUBLIC_ADDRESSES --public-interface=$PUBLIC_INTERFACE --dbdir=$DBDIR --logfile=$LOGFILE -d $DEBUGLEVEL\"\n-\n-echo ctdbd $CTDBOPTIONS\n-exit 0\n+# build up CTDB_OPTIONS variable\n+CTDB_OPTIONS=\"\"\n+[ -z \"$LOGFILE\" ]          || CTDB_OPTIONS=\"$CTDB_OPTIONS --logfile=$LOGFILE\"\n+[ -z \"$PUBLIC_ADDRESSES\" ] || CTDB_OPTIONS=\"$CTDB_OPTIONS --public-addresses=$PUBLIC_ADDRESSES\"\n+[ -z \"$NODES\" ]            || CTDB_OPTIONS=\"$CTDB_OPTIONS --nlist=$NODES\"\n+[ -z \"$PUBLIC_INTERFACE\" ] || CTDB_OPTIONS=\"$CTDB_OPTIONS --public-interface=$PUBLIC_INTERFACE\"\n+[ -z \"$DBDIR\" ]            || CTDB_OPTIONS=\"$CTDB_OPTIONS --dbdir=$DBDIR\"\n+[ -z \"$DEBUGLEVEL\" ]       || CTDB_OPTIONS=\"$CTDB_OPTIONS -d $DEBUGLEVEL\"\n \n start() {\n \techo -n $\"Starting ctdbd services: \"\n-\tdaemon ctdbd $CTDBDOPTIONS\n+\tdaemon ctdbd $CTDB_OPTIONS\n \tRETVAL=$?\n \techo\n \t[ $RETVAL -eq 0 ] && touch /var/lock/subsys/ctdb || \\\n@@ -75,7 +49,7 @@\n \n stop() {\n \techo -n $\"Shutting down ctdbd services: \"\n-\tkillproc ctdbd\n+\tctdb shutdown\n \tRETVAL=$?\n \techo\n \t[ $RETVAL -eq 0 ] && rm -f /var/lock/subsys/ctdb\n@@ -89,7 +63,7 @@\n }\t\n \n rhstatus() {\n-\tstatus ctdbd\n+\tctdb status\n \tif [ $? -ne 0 ] ; then\n \t\treturn 1\n \tfi\n@@ -102,11 +76,6 @@\n        exit $?\n fi\n \n-# Check that we can write to it... so non-root users stop here\n-[ -w /etc/samba/smb.conf ] || exit 0\n-\n-\n-\n case \"$1\" in\n   start)\n   \tstart\n\n=== modified file 'packaging/RHEL/setup/ctdb.sysconfig'\n--- a/packaging/RHEL/setup/ctdb.sysconfig\t2007-05-29 05:26:38 +0000\n+++ b/packaging/RHEL/setup/ctdb.sysconfig\t2007-05-29 05:36:42 +0000\n@@ -1,7 +1,8 @@\n # Options to ctdbd\n-CLUSTER_NODES=/etc/ctdb/nodes\n-PUBLIC_ADDRESSES=/etc/ctdb/public_addresses\n-PUBLIC_INTERFACE=eth0\n-#LOGFILE=/var/log/samba/log.ctdb\n-#DEBUGLEVEL=0\n \n+# DBDIR=/var/ctdb\n+# NODES=/etc/ctdb/nodes\n+# PUBLIC_ADDRESSES=/etc/ctdb/public_addresses\n+# PUBLIC_INTERFACE=eth0\n+# LOGFILE=/var/log/log.ctdb\n+# DEBUGLEVEL=0\n\n"}