{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 358: send on the right socket! in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 358\nrevision-id: tridge@samba.org-20070527054743-ldficagg4243oz4g\nparent: tridge@samba.org-20070527052629-21sso5vacuoyij16\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sun 2007-05-27 15:47:43 +1000\nmessage:\n  send on the right socket!\nmodified:\n  takeover/ctdb_takeover.c       ctdb_takeover.c-20070525071636-a5n1ihghjtppy08r-2\n  takeover/system.c              system.c-20070525071636-a5n1ihghjtppy08r-3\n=== modified file 'takeover/ctdb_takeover.c'\n--- a/takeover/ctdb_takeover.c\t2007-05-27 05:26:29 +0000\n+++ b/takeover/ctdb_takeover.c\t2007-05-27 05:47:43 +0000\n@@ -68,9 +68,9 @@\n \n \tfor (tcp=arp->tcp_list;tcp;tcp=tcp->next) {\n \t\tDEBUG(0,(\"sending tcp tickle ack for %u->%s:%u\\n\",\n-\t\t\t (unsigned)tcp->daddr.sin_port, \n+\t\t\t (unsigned)ntohs(tcp->daddr.sin_port), \n \t\t\t inet_ntoa(tcp->saddr.sin_addr),\n-\t\t\t (unsigned)tcp->saddr.sin_port));\t\t\t \n+\t\t\t (unsigned)ntohs(tcp->saddr.sin_port)));\n \t\tret = ctdb_sys_send_ack(&tcp->daddr, &tcp->saddr);\n \t\tif (ret != 0) {\n \t\t\tDEBUG(0,(__location__ \" Failed to send tcp tickle ack for %s\\n\",\n\n=== modified file 'takeover/system.c'\n--- a/takeover/system.c\t2007-05-27 05:26:29 +0000\n+++ b/takeover/system.c\t2007-05-27 05:47:43 +0000\n@@ -197,7 +197,7 @@\n \tpkt.tcp.ack      = 1;\n \tpkt.tcp.check    = 0;\n \n-\tret = sendto(3, &pkt, sizeof(pkt), 0, dest, sizeof(*dest));\n+\tret = sendto(s, &pkt, sizeof(pkt), 0, dest, sizeof(*dest));\n \tif (ret != 0) {\n \t\tDEBUG(0,(__location__ \" failed sendto (%s)\\n\", strerror(errno)));\n \t}\n\n"}