{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "ab@samba.org", "subject": "svn commit: samba r23540 - in\n\tbranches/SAMBA_4_0/source/torture/basic: .", "body": "Author: ab\nDate: 2007-06-18 14:06:04 +0000 (Mon, 18 Jun 2007)\nNew Revision: 23540\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23540\n\nLog:\nContinue fixing bench-readwrite. We need to initialize state->readcnt not only when file is written but at initial write as well.\nModified:\n   branches/SAMBA_4_0/source/torture/basic/misc.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/torture/basic/misc.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/basic/misc.c\t2007-06-18 13:59:09 UTC (rev 23539)\n+++ branches/SAMBA_4_0/source/torture/basic/misc.c\t2007-06-18 14:06:04 UTC (rev 23540)\n@@ -577,12 +577,12 @@\n \t\t\t\t(state->readcnt*state->lp_params->blocksize));\n \t\trd.generic.level = RAW_READ_READX;\n \t\trd.readx.in.file.fnum\t= state->fnum \t;\n-\t\trd.readx.in.offset\t= state->readcnt * \n-\t\t\t\t\tstate->lp_params->blocksize;\n+\t\trd.readx.in.offset\t= state->readcnt*state->lp_params->blocksize; \n \t\trd.readx.in.mincnt\t= state->lp_params->blocksize;\n \t\trd.readx.in.maxcnt\t= rd.readx.in.mincnt;\n \t\trd.readx.in.remaining\t= 0\t;\n \t\trd.readx.out.data\t= state->buffer;\n+\t\trd.readx.in.read_for_execute = False;\n \t\tif(state->readcnt < state->lp_params->writeblocks){\n \t\t\tstate->readcnt++;\t\n \t\t}else{\n@@ -727,6 +727,7 @@\n \t\t\t\t\t\"file - %s\\n\", \n \t\t\t\t\tnt_errstr(req->status));\n \t\t\tstate->mode=ERROR;\n+\t\t\tstate->readcnt=0;\n \t\t\treturn;\n \t\t}\n \t\tbreak;\n\n"}