{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jpeach@samba.org", "subject": "svn commit: samba r23478 - in branches/SAMBA_3_0/source: .", "body": "Author: jpeach\nDate: 2007-06-14 03:38:43 +0000 (Thu, 14 Jun 2007)\nNew Revision: 23478\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23478\n\nLog:\nChange the handling of the developer CFLAGS so that they are always\n\nemited to the Makefile in the DEVELOPER_CFLAGS variable. This makes\nit easy to turn developer mode on and off without waiting for\nconfigure to run. The developer flags are only added to CFLAGS for\nthe --enable-developer and --enable-krb5developer cases.\n\nModified:\n   branches/SAMBA_3_0/source/Makefile.in\n   branches/SAMBA_3_0/source/configure.in\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0/source/Makefile.in\t2007-06-13 21:59:39 UTC (rev 23477)\n+++ branches/SAMBA_3_0/source/Makefile.in\t2007-06-14 03:38:43 UTC (rev 23478)\n@@ -20,8 +20,14 @@\n LIBS=@LIBS@\n CC=@CC@\n SHLD=@SHLD@\n+\n+# Add $(DEVELOPER_CFLAGS) to $(CFLAGS) to enable extra compiler\n+# (GCC) warnings. This is done automtically for --enable-developer\n+# and --enable-krb5developer.\n+DEVELOPER_CFLAGS=@DEVELOPER_CFLAGS@\n CFLAGS=@CFLAGS@\n CPPFLAGS=-DHAVE_CONFIG_H @CPPFLAGS@\n+\n EXEEXT=@EXEEXT@\n LDFLAGS=@PIE_LDFLAGS@ @LDFLAGS@\n AR=@AR@\n\nModified: branches/SAMBA_3_0/source/configure.in\n===================================================================\n--- branches/SAMBA_3_0/source/configure.in\t2007-06-13 21:59:39 UTC (rev 23477)\n+++ branches/SAMBA_3_0/source/configure.in\t2007-06-14 03:38:43 UTC (rev 23478)\n@@ -435,7 +435,19 @@\n AC_ARG_ENABLE(developer, [  --enable-developer      Turn on developer warnings and debugging (default=no)],\n     [if eval \"test x$enable_developer = xyes\"; then\n         developer=yes\n-    \tDEVELOPER_CFLAGS=\"-gstabs -Wall -Wshadow -Wstrict-prototypes -Wpointer-arith -Wcast-align -Wwrite-strings -DDEBUG_PASSWORD -DDEVELOPER\"\n+    fi])\n+\n+AC_ARG_ENABLE(krb5developer, [  --enable-krb5developer  Turn on developer warnings and debugging, except -Wstrict-prototypes (default=no)],\n+    [if eval \"test x$enable_krb5developer = xyes\"; then\n+        developer=yes\n+\tkrb5_developer=yes\n+    fi])\n+\n+# Probe the gcc version for extra CFLAGS. We always stash these in\n+# DEVELOPER_CFLAGS, so that you can turn them on and off with a simple\n+# Makefile edit, avoiding the need to re-run configure.\n+if test x\"$ac_cv_prog_gcc\" = x\"yes\" ; then\n+    \tDEVELOPER_CFLAGS=\"-gstabs -Wall -Wshadow -Wpointer-arith -Wcast-align -Wwrite-strings -DDEBUG_PASSWORD -DDEVELOPER\"\n \t# Add -Wdeclaration-after-statement if compiler supports it\n \tAC_CACHE_CHECK(\n           [that the C compiler understands -Wdeclaration-after-statement],\n@@ -448,12 +460,12 @@\n \t    samba_cv_HAVE_Wdeclaration_after_statement=yes,\n \t    samba_cv_HAVE_Wdeclaration_after_statement=no,\n \t    samba_cv_HAVE_Wdeclaration_after_statement=cross)\n+       ])\n \n-       ])\n-       if test x\"$samba_cv_HAVE_Wdeclaration_after_statement\" = x\"yes\"; then\n+\tif test x\"$samba_cv_HAVE_Wdeclaration_after_statement\" = x\"yes\"; then\n \t    DEVELOPER_CFLAGS=\"${DEVELOPER_CFLAGS} -Wdeclaration-after-statement\"\n-       fi\n-\t# here\n+\tfi\n+\n \t#-Werror-implicit-function-declaration\n \tAC_CACHE_CHECK(\n           [that the C compiler understands -Werror-implicit-function-declaration],\n@@ -470,13 +482,13 @@\n        if test x\"$samba_cv_HAVE_Werror_implicit_function_declaration\" = x\"yes\"; then\n \t    DEVELOPER_CFLAGS=\"${DEVELOPER_CFLAGS} -Werror-implicit-function-declaration\"\n        fi\n-    fi])\n \n-AC_ARG_ENABLE(krb5developer, [  --enable-krb5developer  Turn on developer warnings and debugging, except -Wstrict-prototypes (default=no)],\n-    [if eval \"test x$enable_krb5developer = xyes\"; then\n-        developer=yes\n-\tCFLAGS=\"${CFLAGS} -gstabs -Wall -Wshadow -Wpointer-arith -Wcast-qual -Wcast-align -Wwrite-strings -DDEBUG_PASSWORD -DDEVELOPER\"\n-    fi])\n+\t# krb5developer is like developer, except we don't get\n+\t# -Wstrict-prototypes.\n+       if test x\"$krb5_developer\" ~= x\"$yes\" ; then\n+\t    DEVELOPER_CFLAGS=\"$DEVELOPER_CFLAGS -Wstrict-prototypes\"\n+       fi\n+fi\n \n AC_ARG_ENABLE(dmalloc, [  --enable-dmalloc        Enable heap debugging [default=no]])\n \n@@ -6474,8 +6486,9 @@\n \t   AC_MSG_WARN([cannot run when cross-compiling]))\n \n dnl Merge in developer cflags from now on\n-if test x\"$developer\" = x\"yes\"; then\n-    CFLAGS=\"${CFLAGS} ${DEVELOPER_CFLAGS}\"\n+AC_SUBST(DEVELOPER_CFLAGS)\n+if test x\"$krb5_developer\" = x\"yes\" -o x\"$developer\" = x\"yes\"; then\n+    CFLAGS=\"${CFLAGS} $(DEVELOPER_CFLAGS)\"\n fi\n \n builddir=`pwd`\n\n"}