{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23465 - in branches: SAMBA_3_0/source/registry\n\tSAMBA_3_0_26/source/registry", "body": "Author: obnox\nDate: 2007-06-13 11:04:31 +0000 (Wed, 13 Jun 2007)\nNew Revision: 23465\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23465\n\nLog:\nThere was this diff between reg_printing in 3_0 and 3_0_26:\nbefore writing to secdesc_buf->sd,\n3_0 checked secdesc_buf->sd while 3_0_26 checked secdesc_buf->sd_size.\n\nThis patch makes both revisions check _both_ befor writing.\n\nJerry / Jeremy : please check if this is correct!\n\nMichael\n\n\nModified:\n   branches/SAMBA_3_0/source/registry/reg_printing.c\n   branches/SAMBA_3_0_26/source/registry/reg_printing.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/registry/reg_printing.c\n===================================================================\n--- branches/SAMBA_3_0/source/registry/reg_printing.c\t2007-06-13 10:47:06 UTC (rev 23464)\n+++ branches/SAMBA_3_0/source/registry/reg_printing.c\t2007-06-13 11:04:31 UTC (rev 23465)\n@@ -449,7 +449,10 @@\n \t\t\n \t/* stream the printer security descriptor */\n \t\n-\tif ( info2->secdesc_buf && info2->secdesc_buf->sd )  {\n+\tif ( info2->secdesc_buf &&\n+\t     info2->secdesc_buf->sd &&\n+\t     info2->secdesc_buf->sd_size )  \n+\t{\n \t\tif ( sec_io_desc(\"sec_desc\", &info2->secdesc_buf->sd, &prs, 0 ) ) {\n \t\t\toffset = prs_offset( &prs );\n \t\t\tregval_ctr_addvalue( values, \"Security\", REG_BINARY, prs_data_p(&prs), offset );\n\nModified: branches/SAMBA_3_0_26/source/registry/reg_printing.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/registry/reg_printing.c\t2007-06-13 10:47:06 UTC (rev 23464)\n+++ branches/SAMBA_3_0_26/source/registry/reg_printing.c\t2007-06-13 11:04:31 UTC (rev 23465)\n@@ -449,7 +449,10 @@\n \t\t\n \t/* stream the printer security descriptor */\n \t\n-\tif ( info2->secdesc_buf && info2->secdesc_buf->sd_size )  {\n+\tif ( info2->secdesc_buf &&\n+\t     info2->secdesc_buf->sd &&\n+\t     info2->secdesc_buf->sd_size )  \n+\t{\n \t\tif ( sec_io_desc(\"sec_desc\", &info2->secdesc_buf->sd, &prs, 0 ) ) {\n \t\t\toffset = prs_offset( &prs );\n \t\t\tregval_ctr_addvalue( values, \"Security\", REG_BINARY, prs_data_p(&prs), offset );\n\n"}