{"category": "ham", "to_address": "Ravi Varadhan <rvaradhan@jhmi.edu>", "from_address": "Deepankar Basu <basu.15@osu.edu>", "subject": "Re: [R] Problems in programming a simple likelihood", "body": "Ravi,\n\nThanks a lot for that clarification. Now I see that the code works.\n\nDeepankar\n\nOn Thu, 2007-04-19 at 14:01 -0400, Ravi Varadhan wrote:\n> Hi Deepankar,\n> \n> Dimitris' code works just fine.  Your problem is that the output of optim\n> does not have a corresponding \"summary\" method.  Instead you should simply\n> type the name of the object returned by \"optim\" to look at the results.\n> \n> > out <- optim(mu.start, mlogl, method = \"CG\", y = women$J, X = cbind(1,\n> women$M, women$S))\n> > out\n> $par\n> [1] -3.0612277 -1.4567141  0.3659251\n> \n> $value\n> [1] 13.32251\n> \n> $counts\n> function gradient \n>      357      101 \n> \n> $convergence\n> [1] 1\n> \n> $message\n> NULL\n> \n> Hope this helps,\n> Ravi.\n> \n> ----------------------------------------------------------------------------\n> -------\n> \n> Ravi Varadhan, Ph.D.\n> \n> Assistant Professor, The Center on Aging and Health\n> \n> Division of Geriatric Medicine and Gerontology \n> \n> Johns Hopkins University\n> \n> Ph: (410) 502-2619\n> \n> Fax: (410) 614-9625\n> \n> Email: rvaradhan@jhmi.edu\n> \n> Webpage:  http://www.jhsph.edu/agingandhealth/People/Faculty/Varadhan.html\n> \n>  \n> \n> ----------------------------------------------------------------------------\n> --------\n> \n> -----Original Message-----\n> From: r-help-bounces@stat.math.ethz.ch\n> [mailto:r-help-bounces@stat.math.ethz.ch] On Behalf Of Deepankar Basu\n> Sent: Thursday, April 19, 2007 12:42 PM\n> To: Dimitris Rizopoulos\n> Cc: r-help@stat.math.ethz.ch\n> Subject: Re: [R] Problems in programming a simple likelihood\n> \n> Dimitris,\n> \n> Thanks a lot for your suggestion and also for suggestions that others\n> have provided. I am learning fast and with the help of the R community\n> will be able to get this going pretty soon. Of course, right now I am\n> just trying to learn the language; so I am trying to program a standard\n> probit model for which I know the answers. I could easily get the\n> estimates with \"glm\". But I want to program the probit model to make\n> sure I understand the subtleties of R. \n> \n> I tried running the alternate script that you provided, but it is still\n> not working. Am I making some mistake?\n> \n> Here is what I get when I run your script (which shows that the maximum\n> number of iterations was reached without convergence):\n> \n> > source(\"probit1.R\")\n> > summary(out)\n>             Length Class  Mode\n> par         3      -none- numeric\n> value       1      -none- numeric\n> counts      2      -none- numeric\n> convergence 1      -none- numeric\n> message     0      -none- NULL\n> \n> Here is the script (exactly what you had suggested):\n> \n> mlogl <- function (mu, y, X) {\n>     zeta <- as.vector(X %*% mu)\n>     y.logic <- as.logical(y)\n>     lgLik <- numeric(length(y))\n>     lgLik[y.logic] <- pnorm(zeta[y.logic], log.p = TRUE)\n>     lgLik[!y.logic] <- pnorm(zeta[!y.logic], lower.tail = FALSE, log.p =\n> TRUE)\n>     -sum(lgLik)\n> }\n> \n> women <-\n> read.table(\"http://wps.aw.com/wps/media/objects/2228/2281678/Data_Sets/ASCII\n> /Women13.txt\", \n> header=TRUE)\n> \n> mu.start <- c(-3, -1.5, 0.5)\n> out <- optim(mu.start, mlogl, method = \"BFGS\", y = women$J, X = cbind(1,\n> women$M, women$S))\n> out\n> \n> glm.fit(x = cbind(1, women$M, women$S), y = women$J, family =\n> binomial(link = \"probit\"))$coefficients\n> \n> \n> Thanks.\n> Deepankar\n> \n> \n> On Thu, 2007-04-19 at 09:26 +0200, Dimitris Rizopoulos wrote:\n> > try the following:\n> > \n> > mlogl <- function (mu, y, X) {\n> >     zeta <- as.vector(X %*% mu)\n> >     y.logic <- as.logical(y)\n> >     lgLik <- numeric(length(y))\n> >     lgLik[y.logic] <- pnorm(zeta[y.logic], log.p = TRUE)\n> >     lgLik[!y.logic] <- pnorm(zeta[!y.logic], lower.tail = FALSE, log.p \n> > = TRUE)\n> >     -sum(lgLik)\n> > }\n> > \n> > women <- \n> >\n> read.table(\"http://wps.aw.com/wps/media/objects/2228/2281678/Data_Sets/ASCII\n> /Women13.txt\", \n> > header=TRUE)\n> > \n> > mu.start <- c(0, -1.5, 0.01)\n> > out <- optim(mu.start, mlogl, method = \"BFGS\", y = women$J, X = \n> > cbind(1, women$M, women$S))\n> > out\n> > \n> > glm.fit(x = cbind(1, women$M, women$S), y = women$J, family = \n> > binomial(link = \"probit\"))$coefficients\n> > \n> > \n> > I hope it helps.\n> > \n> > Best,\n> > Dimitris\n> > \n> > ----\n> > Dimitris Rizopoulos\n> > Ph.D. Student\n> > Biostatistical Centre\n> > School of Public Health\n> > Catholic University of Leuven\n> > \n> > Address: Kapucijnenvoer 35, Leuven, Belgium\n> > Tel: +32/(0)16/336899\n> > Fax: +32/(0)16/337015\n> > Web: http://med.kuleuven.be/biostat/\n> >      http://www.student.kuleuven.be/~m0390867/dimitris.htm\n> > \n> > \n> > ----- Original Message ----- \n> > From: \"Deepankar Basu\" \n> > To: \n> > Sent: Thursday, April 19, 2007 12:38 AM\n> > Subject: [R] Problems in programming a simple likelihood\n> > \n> > \n> > > As part of carrying out a complicated maximum likelihood estimation, \n> > > I\n> > > am trying to learn to program likelihoods in R. I started with a \n> > > simple\n> > > probit model but am unable to get the code to work. Any help or\n> > > suggestions are most welcome. I give my code below:\n> > >\n> > > ************************************\n> > > mlogl <- function(mu, y, X) {\n> > > n <- nrow(X)\n> > > zeta <- X%*%mu\n> > > llik <- 0\n> > > for (i in 1:n) {\n> > >  if (y[i]==1)\n> > >   llik <- llik + log(pnorm(zeta[i,], mean=0, sd=1))\n> > >  else\n> > >   llik <- llik + log(1-pnorm(zeta[i,], mean=0, sd=1))\n> > >    }\n> > > return(-llik)\n> > > }\n> > >\n> > > women <- read.table(\"~/R/Examples/Women13.txt\", header=TRUE)  # DATA\n> > >\n> > > # THE DATA SET CAN BE ACCESSED HERE\n> > > # women <-\n> > >\n> read.table(\"http://wps.aw.com/wps/media/objects/2228/2281678/Data_Sets/ASCII\n> /Women13.txt\", \n> > > header=TRUE)\n> > > # I HAVE CHANGED THE NAMES OF THE VARIABLES\n> > > # J is changed to \"work\"\n> > > # M is changed to \"mar\"\n> > > # S is changed to \"school\"\n> > >\n> > > attach(women)\n> > >\n> > > # THE VARIABLES OF USE ARE\n> > > #   work: binary dependent variable\n> > > #   mar: whether married or not\n> > > #   school: years of schooling\n> > >\n> > > mu.start <- c(3, -1.5, 10)\n> > > data <- cbind(1, mar, school)\n> > > out <- nlm(mlogl, mu.start, y=work, X=data)\n> > > cat(\"Results\", \"\\n\")\n> > > out$estimate\n> > >\n> > > detach(women)\n> > >\n> > > *************************************\n> > >\n> > > When I try to run the code, this is what I get:\n> > >\n> > >> source(\"probit.R\")\n> > > Results\n> > > Warning messages:\n> > > 1: NA/Inf replaced by maximum positive value\n> > > 2: NA/Inf replaced by maximum positive value\n> > > 3: NA/Inf replaced by maximum positive value\n> > > 4: NA/Inf replaced by maximum positive value\n> > >\n> > > Thanks in advance.\n> > > Deepankar\n> > >\n> > > ______________________________________________\n> > > R-help@stat.math.ethz.ch mailing list\n> > > https://stat.ethz.ch/mailman/listinfo/r-help\n> > > PLEASE do read the posting guide \n> > > http://www.R-project.org/posting-guide.html\n> > > and provide commented, minimal, self-contained, reproducible code.\n> > > \n> > \n> > \n> > Disclaimer: http://www.kuleuven.be/cwis/email_disclaimer.htm\n> >\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}