{"category": "ham", "to_address": "\"'hadley wickham'\" <h.wickham@gmail.com>", "from_address": "\"John Fox\" <jfox@mcmaster.ca>", "subject": "Re: [R] Weighted least squares", "body": "Dear Hadley,\n\n> -----Original Message-----\n> From: hadley wickham [mailto:h.wickham@gmail.com] \n> Sent: Wednesday, May 09, 2007 2:21 AM\n> To: John Fox\n> Cc: R-help@stat.math.ethz.ch\n> Subject: Re: [R] Weighted least squares\n> \n> Thanks John,\n> \n> That's just the explanation I was looking for. I had hoped \n> that there would be a built in way of dealing with them with \n> R, but obviously not.\n> \n> Given that explanation, it stills seems to me that the way R \n> calculates n is suboptimal, as demonstrated by my second example:\n> \n> summary(lm(y ~ x, data=df, weights=rep(c(0,2), each=50))) \n> summary(lm(y ~ x, data=df, weights=rep(c(0.01,2), each=50)))\n> \n> the weights are only very slightly different but the \n> estimates of residual standard error are quite different (20 \n> vs 14 in my run)\n> \n\nObservations with 0 weight are literally excluded, while those with very\nsmall weight (relative to others) don't contribute much to the fit.\nConsequently you get very similar coefficients but different numbers of\nobservations.\n\nI hope this helps,\n John\n\n> Hadley\n> \n> On 5/8/07, John Fox  wrote:\n> > Dear Hadley,\n> >\n> > I think that the problem is that the term \"weights\" has different \n> > meanings, which, although they are related, are not quite the same.\n> >\n> > The weights used by lm() are (inverse-)\"variance weights,\" \n> reflecting \n> > the variances of the errors, with observations that have \n> low-variance \n> > errors therefore being accorded greater weight in the \n> resulting WLS regression.\n> > What you have are sometimes called \"case weights,\" and I'm \n> unaware of \n> > a general way of handling them in R, although you could \n> regenerate the \n> > unaggregated data. As you discovered, you get the same coefficients \n> > with case weights as with variance weights, but different \n> standard errors.\n> > Finally, there are \"sampling weights,\" which are inversely \n> > proportional to the probability of selection; these are \n> accommodated by the survey package.\n> >\n> > To complicate matters, this terminology isn't entirely standard.\n> >\n> > I hope this helps,\n> >  John\n> >\n> > --------------------------------\n> > John Fox, Professor\n> > Department of Sociology\n> > McMaster University\n> > Hamilton, Ontario\n> > Canada L8S 4M4\n> > 905-525-9140x23604\n> > http://socserv.mcmaster.ca/jfox\n> > --------------------------------\n> >\n> > > -----Original Message-----\n> > > From: r-help-bounces@stat.math.ethz.ch \n> > > [mailto:r-help-bounces@stat.math.ethz.ch] On Behalf Of hadley \n> > > wickham\n> > > Sent: Tuesday, May 08, 2007 5:09 AM\n> > > To: R Help\n> > > Subject: [R] Weighted least squares\n> > >\n> > > Dear all,\n> > >\n> > > I'm struggling with weighted least squares, where \n> something that I \n> > > had assumed to be true appears not to be the case.\n> > > Take the following data set as an example:\n> > >\n> > > df <- data.frame(x = runif(100, 0, 100)) df$y <- df$x + 1 + \n> > > rnorm(100, sd=15)\n> > >\n> > > I had expected that:\n> > >\n> > > summary(lm(y ~ x, data=df, weights=rep(2, 100))) \n> summary(lm(y ~ x, \n> > > data=rbind(df,df)))\n> > >\n> > > would be equivalent, but they are not.  I suspect the \n> difference is \n> > > how the degrees of freedom is calculated - I had expected \n> it to be \n> > > sum(weights), but seems to be sum(weights > 0).  This seems \n> > > unintuitive to me:\n> > >\n> > > summary(lm(y ~ x, data=df, weights=rep(c(0,2), each=50))) \n> > > summary(lm(y ~ x, data=df, weights=rep(c(0.01,2), each=50)))\n> > >\n> > > What am I missing?  And what is the usual way to do a linear \n> > > regression when you have aggregated data?\n> > >\n> > > Thanks,\n> > >\n> > > Hadley\n> > >\n> > > ______________________________________________\n> > > R-help@stat.math.ethz.ch mailing list \n> > > https://stat.ethz.ch/mailman/listinfo/r-help\n> > > PLEASE do read the posting guide\n> > > http://www.R-project.org/posting-guide.html\n> > > and provide commented, minimal, self-contained, reproducible code.\n> > >\n> >\n> >\n> >\n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}