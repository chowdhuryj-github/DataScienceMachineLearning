{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r22459 - in branches/SAMBA_3_0/source/libads: .", "body": "Author: gd\nDate: 2007-04-22 15:13:50 +0000 (Sun, 22 Apr 2007)\nNew Revision: 22459\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22459\n\nLog:\nAdding ads_get_dn_from_extended_dn(), in preparation of making ranged LDAP\nqueries more generic. Michael, feel free to overwrite these and the following.\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/libads/ldap.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libads/ldap.c\n===================================================================\n--- branches/SAMBA_3_0/source/libads/ldap.c\t2007-04-22 14:51:07 UTC (rev 22458)\n+++ branches/SAMBA_3_0/source/libads/ldap.c\t2007-04-22 15:13:50 UTC (rev 22459)\n@@ -2678,23 +2678,57 @@\n }\n \n /**\n+ * pull a dn from an extended dn string\n+ * @param mem_ctx TALLOC_CTX \n+ * @param extended_dn string\n+ * @param dn pointer to the dn\n+ * @return boolean inidicating success\n+ **/\n+BOOL ads_get_dn_from_extended_dn(TALLOC_CTX *mem_ctx, \n+\t\t\t\t const char *extended_dn,\n+\t\t\t\t char **dn)\n+{\n+\tchar *p;\n+\tpstring tok;\n+\n+\tif (!extended_dn) {\n+\t\treturn False;\n+\t}\n+\n+\twhile (next_token(&extended_dn, tok, \";\", sizeof(tok))) {\n+\t\tp = tok;\n+\t}\n+\n+\tif ((*dn = talloc_strdup(mem_ctx, p)) == NULL) {\n+\t\treturn False;\n+\t}\n+\n+\treturn True;\n+}\n+\n+/**\n  * pull a DOM_SID from an extended dn string\n  * @param mem_ctx TALLOC_CTX \n+ * @param extended_dn string\n  * @param flags string type of extended_dn\n  * @param sid pointer to a DOM_SID\n  * @return boolean inidicating success\n  **/\n BOOL ads_get_sid_from_extended_dn(TALLOC_CTX *mem_ctx, \n-\t\t\t\t  const char *dn, \n+\t\t\t\t  const char *extended_dn, \n \t\t\t\t  enum ads_extended_dn_flags flags, \n \t\t\t\t  DOM_SID *sid)\n {\n-\tchar *p, *q;\n+\tchar *p, *q, *dn;\n \n-\tif (!dn) {\n+\tif (!extended_dn) {\n \t\treturn False;\n \t}\n \n+\t/* otherwise extended_dn gets stripped off */\n+\tif ((dn = talloc_strdup(mem_ctx, extended_dn)) == NULL) {\n+\t\treturn False;\n+\t}\n \t/* \n \t * ADS_EXTENDED_DN_HEX_STRING:\n \t * ;;CN=gd,OU=berlin,OU=suse,DC=ber,DC=suse,DC=de\n\n"}