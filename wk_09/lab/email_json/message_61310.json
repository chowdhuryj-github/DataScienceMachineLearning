{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "Ben Bolker <bolker@ufl.edu>", "subject": "Re: [R] how to use mle with a defined function", "body": "Lin Pan  yahoo.com> writes:\n\n> \n> \n> Hi all,\n> \n> I am trying to use mle() to find a self-defined function. Here is my\n> function:\n> \n> test <- function(a=0.1, b=0.1, c=0.001, e=0.2){\n> \n> # omega is the known covariance matrix, Y is the response vector, X is the\n> explanatory matrix\n> \n> odet = unlist(determinant(omega))[1]\n> \n> # do cholesky decomposition\n> \n> C = chol(omega)\n> \n> # transform data\n> \n> U = t(C)%*%Y\n> WW=t(C)%*%X\n> \n> beta = lm(U~W)$coef\n> \n> Z=Y-X%*%beta\n> V=solve(t(C), Z)\n> \n> 0.5*odet + 0.5*(t(V)%*%V)\n> \n> }\n> \n> and I am trying to call mle() to calculate the maximum likelihood estimates\n> for function (0.5*odet+0.5*(t(V)%*%V)) by\n> \n> result = mle(test, method=\"Nelder-Mead\")\n> \n> But I get the following error message:\n> \n> Error in optim(start, f, method = method, hessian = TRUE, ...) : \n>         (list) object cannot be coerced to 'double'\n\n\n  Can you give a self-contained example (e.g., make up a small\nmatrix?)  There are a few places where I don't understand what\nyou're doing:\n\n  - is the WW above a typo for W?\n\n  - if omega is fixed, why calculate its (log) determinant\nevery time the function is called?  (this shouldn't change\nthe answer, just slow things down)\n \n  - is X a single vector or a design matrix?\nit seems like you might want lm(U~W-1) instead of lm(U~W)\n\n  - it doesn't look like your parameters are used in the\nfunction at all -- are they really parameters for calculating\nomega?  [because of this, I can get as far as computing\nthe Hessian, and then I get \"system is exactly singular\"]\n\n   [ off topic: somewhat disturbingly, the CAPTCHA\nword for posting from Gmane was mother f***ers ... ]\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}