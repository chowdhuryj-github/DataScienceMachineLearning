{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r22184 - in\n\tbranches/SAMBA_4_0/source/torture/auth: .", "body": "Author: abartlet\nDate: 2007-04-12 04:01:42 +0000 (Thu, 12 Apr 2007)\nNew Revision: 22184\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22184\n\nLog:\nOn some hosts, parsing a compleatly invalid principal causes heimadal\nto try and figure out what realm the current host is in (by DNS lookup\nfor it's full domain name).  We don't want to do that for this test,\njust break the checksum.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/torture/auth/pac.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/torture/auth/pac.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/auth/pac.c\t2007-04-12 02:28:29 UTC (rev 22183)\n+++ branches/SAMBA_4_0/source/torture/auth/pac.c\t2007-04-12 04:01:42 UTC (rev 22184)\n@@ -276,6 +276,7 @@\n \tstruct smb_krb5_context *smb_krb5_context;\n \n \tconst char *principal_string;\n+\tchar *broken_principal_string;\n \tkrb5_principal client_principal;\n \tconst char *authtime_string;\n \ttime_t authtime;\n@@ -575,8 +576,11 @@\n \t/* Break the client principal */\n \tkrb5_free_principal(smb_krb5_context->krb5_context, client_principal);\n \n+\tbroken_principal_string = talloc_strdup(mem_ctx, principal_string);\n+\tbroken_principal_string[0]++;\n+\n \tret = krb5_parse_name(smb_krb5_context->krb5_context,\n-\t\t\t      \"not the right principal\", &client_principal);\n+\t\t\t      broken_principal_string, &client_principal);\n \tif (ret) {\n \n \t\tkrb5_free_keyblock_contents(smb_krb5_context->krb5_context, \n@@ -584,7 +588,7 @@\n \t\tkrb5_free_keyblock_contents(smb_krb5_context->krb5_context, \n \t\t\t\t\t    &server_keyblock);\n \t\ttorture_fail(tctx, talloc_asprintf(tctx, \n-\t\t\t\t\t\t   \"(saved test) parsing of bogus client principal failed: %s\", \n+\t\t\t\t\t\t   \"(saved test) parsing of broken client principal failed: %s\", \n \t\t\t\t\t\t   smb_get_krb5_error_message(smb_krb5_context->krb5_context, ret, mem_ctx)));\n \t}\n \n\n"}