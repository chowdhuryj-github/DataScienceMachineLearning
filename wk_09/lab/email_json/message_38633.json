{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 394: moved onnode into ctdb from s3 examples/ctdb in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 394\nrevision-id: tridge@samba.org-20070530010043-bgbx18q3o24ksgtn\nparent: tridge@samba.org-20070530002116-kz22u8npsxt6hhom\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Wed 2007-05-30 11:00:43 +1000\nmessage:\n  moved onnode into ctdb from s3 examples/ctdb\nadded:\n  tools/onnode.rsh               onnode.rsh-20070530010004-83j66tszzvsimcn2-1\n  tools/onnode.ssh               onnode.ssh-20070530010004-83j66tszzvsimcn2-3\nmodified:\n  packaging/RHEL/ctdb.spec       ctdb.spec-20070527204758-biuh7znabuwan3zn-3\n=== added file 'tools/onnode.rsh'\n--- a/tools/onnode.rsh\t1970-01-01 00:00:00 +0000\n+++ b/tools/onnode.rsh\t2007-05-30 01:00:43 +0000\n@@ -0,0 +1,43 @@\n+#!/bin/sh\n+# onnode script for rsh\n+\n+if [ $# -lt 2 ]; then\n+cat < \n+EOF\n+exit 1\n+fi\n+\n+NODE=\"$1\"\n+shift\n+SCRIPT=\"$*\"\n+\n+NODES=/etc/ctdb/nodes\n+\n+NUMNODES=`egrep '^[[:alnum:]]' $NODES | wc -l`\n+MAXNODE=`expr $NUMNODES - 1`\n+\n+if [ $NODE = \"all\" ]; then\n+    for a in `egrep '^[[:alnum:]]' $NODES`; do\n+\tif [ -f \"$SCRIPT\" ]; then\n+\t    rsh $a at -f $SCRIPT now\n+\telse\n+\t    rsh $a $SCRIPT\n+\tfi\n+    done\n+    exit 0\n+fi\n+\n+if [ $NODE -gt $MAXNODE ]; then\n+    echo \"Node $NODE doesn't exist\"\n+    exit 1\n+fi\n+\n+NODEPLUSONE=`expr $NODE + 1`\n+a=`egrep '^[[:alnum:]]' $NODES | head -$NODEPLUSONE | tail -1`\n+\n+if [ -f \"$SCRIPT\" ]; then\n+    exec rsh $a at -f $SCRIPT now\n+else\n+    exec rsh $a $SCRIPT\n+fi\n\n=== added file 'tools/onnode.ssh'\n--- a/tools/onnode.ssh\t1970-01-01 00:00:00 +0000\n+++ b/tools/onnode.ssh\t2007-05-30 01:00:43 +0000\n@@ -0,0 +1,43 @@\n+#!/bin/sh\n+# onnode script for ssh\n+\n+if [ $# -lt 2 ]; then\n+cat < \n+EOF\n+exit 1\n+fi\n+\n+NODE=\"$1\"\n+shift\n+SCRIPT=\"$*\"\n+\n+NODES=/etc/ctdb/nodes\n+\n+NUMNODES=`egrep '^[[:alnum:]]' $NODES | wc -l`\n+MAXNODE=`expr $NUMNODES - 1`\n+\n+if [ $NODE = \"all\" ]; then\n+    for a in `egrep '^[[:alnum:]]' $NODES`; do\n+\tif [ -f \"$SCRIPT\" ]; then\n+\t    ssh $a at -f $SCRIPT now\n+\telse\n+\t    ssh $a $SCRIPT\n+\tfi\n+    done\n+    exit 0\n+fi\n+\n+if [ $NODE -gt $MAXNODE ]; then\n+    echo \"Node $NODE doesn't exist\"\n+    exit 1\n+fi\n+\n+NODEPLUSONE=`expr $NODE + 1`\n+a=`egrep '^[[:alnum:]]' $NODES | head -$NODEPLUSONE | tail -1`\n+\n+if [ -f \"$SCRIPT\" ]; then\n+    exec ssh $a at -f $SCRIPT now\n+else\n+    exec ssh $a $SCRIPT\n+fi\n\n=== modified file 'packaging/RHEL/ctdb.spec'\n--- a/packaging/RHEL/ctdb.spec\t2007-05-29 12:53:28 +0000\n+++ b/packaging/RHEL/ctdb.spec\t2007-05-30 01:00:43 +0000\n@@ -66,6 +66,9 @@\n install -m644 setup/ctdb.sysconfig $RPM_BUILD_ROOT%{_sysconfdir}/sysconfig/ctdb\n install -m755 setup/ctdb.init $RPM_BUILD_ROOT%{initdir}/ctdb\n install -m755 tools/events $RPM_BUILD_ROOT%{_sysconfdir}/ctdb/events\n+install -m755 tools/onnode.ssh $RPM_BUILD_ROOT%{_bindir}\n+install -m755 tools/onnode.rsh $RPM_BUILD_ROOT%{_bindir}\n+ln -sf %{_bindir}/onnode.ssh onnode\n \n # unfortunately samba3 needs ctdb_private.h too\n install -m644 include/ctdb_private.h %{_includedir}/ctdb_private.h\n\n"}