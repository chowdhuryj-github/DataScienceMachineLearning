{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r22882 - in branches/SAMBA_4_0/source/ntvfs/ipc: .", "body": "Author: abartlet\nDate: 2007-05-15 06:51:18 +0000 (Tue, 15 May 2007)\nNew Revision: 22882\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22882\n\nLog:\nIt seems entirly reasonable to follow metze's suggestion and check for\na valid file handle first.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/ntvfs/ipc/vfs_ipc.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/ntvfs/ipc/vfs_ipc.c\n===================================================================\n--- branches/SAMBA_4_0/source/ntvfs/ipc/vfs_ipc.c\t2007-05-15 05:42:16 UTC (rev 22881)\n+++ branches/SAMBA_4_0/source/ntvfs/ipc/vfs_ipc.c\t2007-05-15 06:51:18 UTC (rev 22882)\n@@ -610,14 +610,13 @@\n \t\t\t      struct ntvfs_request *req, union smb_fileinfo *info)\n {\n \tstruct ipc_private *private = ntvfs->private_data;\n+\tstruct pipe_state *p = pipe_state_find(private, info->generic.in.file.ntvfs);\n+\tif (!p) {\n+\t\treturn NT_STATUS_INVALID_HANDLE;\n+\t}\n \tswitch (info->generic.level) {\n \tcase RAW_FILEINFO_GENERIC: \n \t{\n-\t\tstruct pipe_state *p;\n-\t\tp = pipe_state_find(private, info->generic.in.file.ntvfs);\n-\t\tif (!p) {\n-\t\t\treturn NT_STATUS_INVALID_HANDLE;\n-\t\t}\n \t\tZERO_STRUCT(info->generic.out);\n \t\tinfo->generic.out.attrib = FILE_ATTRIBUTE_NORMAL;\n \t\tinfo->generic.out.fname.s = strrchr(p->pipe_name, '\\\\');\n\n"}