{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "idra@samba.org", "subject": "svn commit: samba r22646 - in branches/SAMBA_3_0/source/nsswitch: .", "body": "Author: idra\nDate: 2007-05-03 12:28:25 +0000 (Thu, 03 May 2007)\nNew Revision: 22646\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22646\n\nLog:\n\nsegfault fix in idmap_ldap.c from 3_0_25\n\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/idmap_ldap.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/idmap_ldap.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/idmap_ldap.c\t2007-05-03 12:27:31 UTC (rev 22645)\n+++ branches/SAMBA_3_0/source/nsswitch/idmap_ldap.c\t2007-05-03 12:28:25 UTC (rev 22646)\n@@ -80,11 +80,17 @@\n \ttmp = lp_parm_const_string(-1, config_option, \"ldap_user_dn\", NULL);\n \n \tif ( tmp ) {\n-\t\tsecret = idmap_fetch_secret(\"ldap\", false, dom->name, tmp);\n+\t\tif (!dom) {\n+\t\t\t/* only the alloc backend is allowed to pass in a NULL dom */\n+\t\t\tsecret = idmap_fetch_secret(\"ldap\", true, NULL, tmp);\n+\t\t} else {\n+\t\t\tsecret = idmap_fetch_secret(\"ldap\", false, dom->name, tmp);\n+\t\t} \n+\n \t\tif (!secret) {\n \t\t\tDEBUG(0, (\"get_credentials: Unable to fetch \"\n \t\t\t\t  \"auth credentials for %s in %s\\n\",\n-\t\t\t\t  tmp, dom->name));\n+\t\t\t\t  tmp, (dom==NULL)?\"ALLOC\":dom->name));\n \t\t\tret = NT_STATUS_ACCESS_DENIED;\n \t\t\tgoto done;\n \t\t} \t\t\n\n"}