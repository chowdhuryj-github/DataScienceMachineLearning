{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 428: another place we need to cope with the strange epoll fork\n\tsemantics in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 428\nrevision-id: tridge@samba.org-20070602000117-hyruu43epqiar7e2\nparent: tridge@samba.org-20070601224649-wvwheltox404k3pe\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-06-02 10:01:17 +1000\nmessage:\n  another place we need to cope with the strange epoll fork semantics\nmodified:\n  lib/events/events_aio.c        events_aio.c-20070501213746-4fxluwiq4rcxib8p-1\n  lib/events/events_epoll.c      events_epoll.c-20070501213746-4fxluwiq4rcxib8p-2\n  lib/events/events_standard.c   events_standard.c-20061117234101-o3qt14umlg9en8z0-30\n=== modified file 'lib/events/events_aio.c'\n--- a/lib/events/events_aio.c\t2007-05-17 22:33:10 +0000\n+++ b/lib/events/events_aio.c\t2007-06-02 00:01:17 +0000\n@@ -393,6 +393,8 @@\n \tstruct aio_event_context *aio_ev = talloc_get_type(ev->additional_data,\n \t\t\t\t\t\t\t   struct aio_event_context);\n \n+\tepoll_check_reopen(aio_ev);\n+\n \taio_ev->num_fd_events--;\n \taio_ev->destruction_count++;\n \n\n=== modified file 'lib/events/events_epoll.c'\n--- a/lib/events/events_epoll.c\t2007-05-17 22:33:10 +0000\n+++ b/lib/events/events_epoll.c\t2007-06-02 00:01:17 +0000\n@@ -342,6 +342,8 @@\n \tstruct epoll_event_context *epoll_ev = talloc_get_type(ev->additional_data,\n \t\t\t\t\t\t\t   struct epoll_event_context);\n \n+\tepoll_check_reopen(epoll_ev);\n+\n \tepoll_ev->num_fd_events--;\n \tepoll_ev->destruction_count++;\n \n\n=== modified file 'lib/events/events_standard.c'\n--- a/lib/events/events_standard.c\t2007-05-18 01:24:45 +0000\n+++ b/lib/events/events_standard.c\t2007-06-02 00:01:17 +0000\n@@ -379,6 +379,8 @@\n \tstruct std_event_context *std_ev = talloc_get_type(ev->additional_data,\n \t\t\t\t\t\t\t   struct std_event_context);\n \n+\tepoll_check_reopen(std_ev);\n+\n \tif (std_ev->maxfd == fde->fd) {\n \t\tstd_ev->maxfd = EVENT_INVALID_MAXFD;\n \t}\n\n"}