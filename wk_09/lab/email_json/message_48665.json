{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "Dirk Eddelbuettel <edd@debian.org>", "subject": "[R] model.frame: how does one use it?", "body": "\nPhilipp Benner reported a Debian bug report against r-cran-rpart aka rpart.\nIn short, the issue has to do with how rpart evaluates a formula and\nsupporting arguments, in particular 'weights'.  \n\nA simple contrived example is\n\n-----------------------------------------------------------------------------\nlibrary(rpart)\n\n## using data from help(rpart), set up simple example\nmyformula <- formula(Kyphosis ~ Age + Number + Start)\nmydata <- kyphosis\nmyweight <- abs(rnorm(nrow(mydata)))\n\ngoodFunction <- function(mydata, myformula, myweight) {\n  hyp <- rpart(myformula, data=mydata, weights=myweight, method=\"class\")\n  prev <- hyp\n}\ngoodFunction(mydata, myformula, myweight)\ncat(\"Ok\\n\")\n\n## now remove myweight and try to compute it inside a function\nrm(myweight)\n\nbadFunction <- function(mydata, myformula) {\n  myweight <- abs(rnorm(nrow(mydata)))\n  mf <- model.frame(myformula, mydata, myweight)\n  print(head(df))\n  hyp <- rpart(myformula,\n               data=mf,\n               weights=myweight,\n               method=\"class\")\n  prev <- hyp\n}\nbadFunction(mydata, myformula)\ncat(\"Done\\n\")\n-----------------------------------------------------------------------------\n\nHere goodFunction works, but only because myweight (with useless random\nweights, but that is not the point here) is found from the calling\nenvironment. \n\nbadFunction fails after we remove myweight from there:\n\n:~> cat /tmp/philipp.R | R --slave\nOk\nError in eval(expr, envir, enclos) : object \"myweight\" not found\nExecution halted\n:~>    \n\nAs I was able to replicate it, I reported this to the package maintainer.  It\nturns out that seemingly all is well as this is supposed to work this way,\nand I got a friendly pointer to study model.frame and its help page.  \n\nNow I am stuck as I can't make sense of model.frame -- see badFunction\nabove. I would greatly appreciate any help in making rpart work with a local\nargument weights so that I can tell Philipp that there is no bug.  :)\n\nRegards, Dirk\n\n-- \nHell, there are no rules here - we're trying to accomplish something. \n                                                  -- Thomas A. Edison\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}