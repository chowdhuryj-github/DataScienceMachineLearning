{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jmcd@samba.org", "subject": "svn commit: samba r23041 - in branches: SAMBA_3_0/source/lib\n\tSAMBA_3_0_25/source/lib SAMBA_3_0_26/source/lib", "body": "Author: jmcd\nDate: 2007-05-21 16:01:22 +0000 (Mon, 21 May 2007)\nNew Revision: 23041\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23041\n\nLog:\nRemainder of fix for 4630: fix special case of unix_to_nt_time() for\nTIME_T_MAX, and also display of it in http_timestring()\n\nModified:\n   branches/SAMBA_3_0/source/lib/time.c\n   branches/SAMBA_3_0_25/source/lib/time.c\n   branches/SAMBA_3_0_26/source/lib/time.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/time.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/time.c\t2007-05-21 15:58:27 UTC (rev 23040)\n+++ branches/SAMBA_3_0/source/lib/time.c\t2007-05-21 16:01:22 UTC (rev 23041)\n@@ -95,7 +95,13 @@\n \tif (t == (time_t)-1) {\n \t\t*nt = (NTTIME)-1LL;\n \t\treturn;\n-\t}\t\t\n+\t}\t\n+\n+\tif (t == TIME_T_MAX) {\n+\t\t*nt = 0x7fffffffffffffffLL;\n+\t\treturn;\n+\t}\n+\n \tif (t == 0) {\n \t\t*nt = 0;\n \t\treturn;\n@@ -301,7 +307,9 @@\n \tstatic fstring buf;\n \tstruct tm *tm = localtime(&t);\n \n-\tif (!tm) {\n+\tif (t == TIME_T_MAX) {\n+\t\tslprintf(buf,sizeof(buf)-1,\"never\");\n+\t} else if (!tm) {\n \t\tslprintf(buf,sizeof(buf)-1,\"%ld seconds since the Epoch\",(long)t);\n \t} else {\n #ifndef HAVE_STRFTIME\n\nModified: branches/SAMBA_3_0_25/source/lib/time.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/lib/time.c\t2007-05-21 15:58:27 UTC (rev 23040)\n+++ branches/SAMBA_3_0_25/source/lib/time.c\t2007-05-21 16:01:22 UTC (rev 23041)\n@@ -95,7 +95,13 @@\n \tif (t == (time_t)-1) {\n \t\t*nt = (NTTIME)-1LL;\n \t\treturn;\n-\t}\t\t\n+\t}\t\n+\n+\tif (t == TIME_T_MAX) {\n+\t\t*nt = 0x7fffffffffffffffLL;\n+\t\treturn;\n+\t}\n+\n \tif (t == 0) {\n \t\t*nt = 0;\n \t\treturn;\n@@ -301,7 +307,9 @@\n \tstatic fstring buf;\n \tstruct tm *tm = localtime(&t);\n \n-\tif (!tm) {\n+\tif (t == TIME_T_MAX) {\n+\t\tslprintf(buf,sizeof(buf)-1,\"never\");\n+\t} else if (!tm) {\n \t\tslprintf(buf,sizeof(buf)-1,\"%ld seconds since the Epoch\",(long)t);\n \t} else {\n #ifndef HAVE_STRFTIME\n\nModified: branches/SAMBA_3_0_26/source/lib/time.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/time.c\t2007-05-21 15:58:27 UTC (rev 23040)\n+++ branches/SAMBA_3_0_26/source/lib/time.c\t2007-05-21 16:01:22 UTC (rev 23041)\n@@ -95,7 +95,13 @@\n \tif (t == (time_t)-1) {\n \t\t*nt = (NTTIME)-1LL;\n \t\treturn;\n-\t}\t\t\n+\t}\t\n+\n+\tif (t == TIME_T_MAX) {\n+\t\t*nt = 0x7fffffffffffffffLL;\n+\t\treturn;\n+\t}\n+\n \tif (t == 0) {\n \t\t*nt = 0;\n \t\treturn;\n@@ -301,7 +307,9 @@\n \tstatic fstring buf;\n \tstruct tm *tm = localtime(&t);\n \n-\tif (!tm) {\n+\tif (t == TIME_T_MAX) {\n+\t\tslprintf(buf,sizeof(buf)-1,\"never\");\n+\t} else if (!tm) {\n \t\tslprintf(buf,sizeof(buf)-1,\"%ld seconds since the Epoch\",(long)t);\n \t} else {\n #ifndef HAVE_STRFTIME\n\n"}