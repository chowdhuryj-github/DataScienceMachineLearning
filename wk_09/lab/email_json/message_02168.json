{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 87: merge from ronnie in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 87\nrevision-id: tridge@samba.org-20070411011144-6595072619c53c52\nparent: tridge@samba.org-20070411010226-3f2b9b5bcdffa4d2\nparent: ronniesahlberg@gmail.com-20070411010820-8dldbhtoz9oeps1a\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Wed 2007-04-11 11:11:44 +1000\nmessage:\n  merge from ronnie\nmodified:\n  include/ctdb.h                 ctdb.h-20061117234101-o3qt14umlg9en8z0-11\n  include/ctdb_private.h         ctdb_private.h-20061117234101-o3qt14umlg9en8z0-13\n  tests/bench.sh                 bench.sh-20070209014602-vdolpr6esqsa58s7-1\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070411010820-8dldbhtoz9oeps1a\n    parent: ronniesahlberg@gmail.com-20070410111455-rbavt7l9afkyze4p\n    parent: tridge@samba.org-20070411010226-3f2b9b5bcdffa4d2\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Wed 2007-04-11 11:08:20 +1000\n    message:\n      merge from tridge\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070410111455-rbavt7l9afkyze4p\n    parent: ronniesahlberg@gmail.com-20070410110529-ocrxhoa0xp5b3s3v\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-04-10 21:14:55 +1000\n    message:\n      rename client.id to client.messenger_id to make the purpose of the field more obvious\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070410110529-ocrxhoa0xp5b3s3v\n    parent: ronniesahlberg@gmail.com-20070410102511-sxaua0csi2ia1234\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-04-10 21:05:29 +1000\n    message:\n      add a call to register the pid for a messengin service\n      \n      store this pid inside the client structure in the ctdb daemon\n    ------------------------------------------------------------\n    merged: ronniesahlberg@gmail.com-20070410102511-sxaua0csi2ia1234\n    parent: ronniesahlberg@gmail.com-20070410045323-893gitfaif8bmigt\n    parent: tridge@samba.org-20070410094029-2b9561032c749c8a\n    committer: Ronnie sahlberg \n    branch nick: ctdb\n    timestamp: Tue 2007-04-10 20:25:11 +1000\n    message:\n      updates from tridges tree\n=== modified file 'include/ctdb.h'\n--- a/include/ctdb.h\t2007-04-11 01:01:42 +0000\n+++ b/include/ctdb.h\t2007-04-11 01:08:20 +0000\n@@ -180,5 +180,11 @@\n  */\n int ctdb_record_store(struct ctdb_record_handle *rec, TDB_DATA data);\n \n+/* when running in daemon mode this function is used by a client to tell \n+   ctdb daemon what its local identifier is.\n+   when in non-daemon mode this is a noop.\n+ */\n+int ctdb_register_message_local_id(struct ctdb_context *ctdb, uint32_t messenger_id);\n+ \n \n #endif\n\n=== modified file 'include/ctdb_private.h'\n--- a/include/ctdb_private.h\t2007-04-11 01:01:42 +0000\n+++ b/include/ctdb_private.h\t2007-04-11 01:08:20 +0000\n@@ -190,13 +190,14 @@\n   operation IDs\n */\n enum ctdb_operation {\n-\tCTDB_REQ_CALL       = 0,\n-\tCTDB_REPLY_CALL     = 1,\n-\tCTDB_REPLY_REDIRECT = 2,\n-\tCTDB_REQ_DMASTER    = 3,\n-\tCTDB_REPLY_DMASTER  = 4,\n-\tCTDB_REPLY_ERROR    = 5,\n-\tCTDB_REQ_MESSAGE    = 6\n+\tCTDB_REQ_CALL         = 0,\n+\tCTDB_REPLY_CALL       = 1,\n+\tCTDB_REPLY_REDIRECT   = 2,\n+\tCTDB_REQ_DMASTER      = 3,\n+\tCTDB_REPLY_DMASTER    = 4,\n+\tCTDB_REPLY_ERROR      = 5,\n+\tCTDB_REGISTER_CALL    = 6,\n+\tCTDB_REQ_MESSAGE      = 7\n };\n \n #define CTDB_MAGIC 0x43544442 /* CTDB */\n@@ -259,6 +260,12 @@\n \tuint8_t  data[1];\n };\n \n+struct ctdb_register_call {\n+\tstruct ctdb_req_header hdr;\n+\tuint32_t datalen;\n+\tuint8_t data[4];\n+};\n+\n struct ctdb_req_message {\n \tstruct ctdb_req_header hdr;\n \tuint32_t srvid;\n\n=== modified file 'tests/bench.sh'\n--- a/tests/bench.sh\t2007-04-07 00:45:00 +0000\n+++ b/tests/bench.sh\t2007-04-10 11:05:29 +0000\n@@ -3,7 +3,7 @@\n killall -q ctdb_bench\n \n echo \"Trying 2 nodes\"\n-bin/ctdb_bench --nlist tests/nodes.txt --listen 127.0.0.2:9001 $* &\n-bin/ctdb_bench --nlist tests/nodes.txt --listen 127.0.0.1:9001 $*\n+bin/ctdb_bench --nlist tests/nodes.txt --listen 127.0.0.2:9001 --pid=55 $* &\n+bin/ctdb_bench --nlist tests/nodes.txt --listen 127.0.0.1:9001 --pid=66 $*\n \n killall -q ctdb_bench\n\n"}