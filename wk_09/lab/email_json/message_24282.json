{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jerry@samba.org", "subject": "svn commit: samba r22717 - in branches: SAMBA_3_0/source/nsswitch\n\tSAMBA_3_0_26/source/nsswitch", "body": "Author: jerry\nDate: 2007-05-06 21:17:02 +0000 (Sun, 06 May 2007)\nNew Revision: 22717\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22717\n\nLog:\nAdd Everyone and AuthenticatedUsers to the user's token\nfor use by the require-membership-of pam_winbind option.\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\n   branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\t2007-05-06 21:15:45 UTC (rev 22716)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_pam.c\t2007-05-06 21:17:02 UTC (rev 22717)\n@@ -128,7 +128,11 @@\n \tDOM_SID *require_membership_of_sid;\n \tsize_t num_require_membership_of_sid;\n \tDOM_SID *all_sids;\n-\tsize_t num_all_sids = (2 + info3->num_groups2 + info3->num_other_sids);\n+\t/* UserSID, GroupSID, Grooup2SIDs, OtherSIDs, WellKnownSIDs */\n+\tsize_t num_all_sids = (2 + \n+\t\t\t       info3->num_groups2 + \n+\t\t\t       info3->num_other_sids + \n+\t\t\t       2 );\n \tsize_t i, j = 0, k;\n \tsize_t group_sid_length;\n \tconst char *search_location;\n@@ -213,6 +217,11 @@\n \t}\n \tj++;\t\n \n+\t/* Well-Known SIDs */\n+\n+\tsid_copy( &all_sids[j++], &global_sid_World );\n+\tsid_copy( &all_sids[j++], &global_sid_Authenticated_Users );\n+\t\n \tfor (i = 0; i < info3->num_groups2; i++) {\n \t\n \t\tsid_copy(&all_sids[j], &(info3->dom_sid.sid));\n\nModified: branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\t2007-05-06 21:15:45 UTC (rev 22716)\n+++ branches/SAMBA_3_0_26/source/nsswitch/winbindd_pam.c\t2007-05-06 21:17:02 UTC (rev 22717)\n@@ -128,7 +128,11 @@\n \tDOM_SID *require_membership_of_sid;\n \tsize_t num_require_membership_of_sid;\n \tDOM_SID *all_sids;\n-\tsize_t num_all_sids = (2 + info3->num_groups2 + info3->num_other_sids);\n+\t/* UserSID, GroupSID, Grooup2SIDs, OtherSIDs, WellKnownSIDs */\n+\tsize_t num_all_sids = (2 + \n+\t\t\t       info3->num_groups2 + \n+\t\t\t       info3->num_other_sids + \n+\t\t\t       2 );\n \tsize_t i, j = 0, k;\n \tsize_t group_sid_length;\n \tconst char *search_location;\n@@ -213,6 +217,11 @@\n \t}\n \tj++;\t\n \n+\t/* Well-Known SIDs */\n+\n+\tsid_copy( &all_sids[j++], &global_sid_World );\n+\tsid_copy( &all_sids[j++], &global_sid_Authenticated_Users );\n+\t\n \tfor (i = 0; i < info3->num_groups2; i++) {\n \t\n \t\tsid_copy(&all_sids[j], &(info3->dom_sid.sid));\n\n"}