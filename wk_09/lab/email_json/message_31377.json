{"category": "ham", "to_address": "<r-help@stat.math.ethz.ch>", "from_address": "\"Inman, Brant A.   M.D.\" <Inman.Brant@mayo.edu>", "subject": "[R] MICE for Cox model", "body": "\nR-helpers:\n\nI have a dataset that has 168 subjects and 12 variables.  Some of the\nvariables have missing data and I want to use the multiple imputation\ncapabilities of the \"mice\" package to address the missing data. Given\nthat mice only supports linear models and generalized linear models (via\nthe lm.mids and glm.mids functions) and that I need to fit Cox models, I\nfollowed the previous suggestion of John Fox and have created my own\nfunction \"cox.mids\" to use coxph to fit models to the imputed datasets.\n\n(http://tolstoy.newcastle.edu.au/R/help/06/03/22295.html)\n\nThe function I created is:\n\n------------\n\ncox.mids <- function (formula, data, ...)\n{\n    call <- match.call()\n    if (!is.mids(data)) \n        stop(\"The data must have class mids\")\n    analyses <- as.list(1:data$m)\n    for (i in 1:data$m) {\n        data.i <- complete(data, i)\n        analyses[[i]] <- coxph(formula, data = data.i, ...)\n    }\n    object <- list(call = call, call1 = data$call, nmis = data$nmis, \n        analyses = analyses)\n    oldClass(object) <- c(\"mira\", \"coxph\")\n    return(object)\n}\n\n------------\n\nThe problem that I encounter occurs when I try to use the \"pool\"\nfunction to pool the fitted models into one general model. Here is some\ncode that reproduces the error using the pbc dataset.\n\n------------\n\nd <- pbc[,c('time','status','age','sex','hepmeg','platelet', 'trt',\n'trig')]\nd[d==-9] <- NA \nd[,c(4,5,7)] <- lapply(d[,c(4,5,7)], FUN=as.factor)\nstr(d)\n\nimp <- mice(d, m=10, maxit=10, diagnostics=T, seed=500, \n\tdefaultImputationMethod=c('norm', 'logreg', 'polyreg'))\n\nfit <- cox.mids(Surv(time,status) ~ age + sex + hepmeg + platelet + trt\n+ \ttrig, imp)\n\npool(fit)\n\n------------\n\nI have looked at the \"pool\" function but cannot figure out what I have\ndone wrong.  Would really appreciate any help with this.\n\nThanks,\n\nBrant Inman\nMayo Clinic\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}