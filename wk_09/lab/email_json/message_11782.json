{"category": "ham", "to_address": "Deepayan Sarkar <deepayan.sarkar@gmail.com>", "from_address": "Michael Kubovy <kubovy@virginia.edu>", "subject": "Re: [R] Positioning in xyplot", "body": "Hi Deepayan,\n\nThere appears to be a small problem in the code you created to  \nreposition one panel in xyplot: it plots the panels but not the  \ncontents. Putting together everything that you did on this problem, I  \nhave the following:\n\nrequire(lattice)\nrequire(grid)\n## this is a safer version of current.panel.limits()\ncurrent.limits <-\n    function ()\n{\n    xlim <- convertX(unit(c(0, 1), \"npc\"), \"native\", valueOnly = TRUE)\n    ylim <- convertY(unit(c(0, 1), \"npc\"), \"native\", valueOnly = TRUE)\n    if (any(!is.finite(xlim))) xlim <- c(0, 1)\n    if (any(!is.finite(ylim))) ylim <- c(0, 1)\n    list(xlim = xlim, ylim = ylim)\n}\n## this calls 'fun' after moving its viewport if panel.number() == 5\ncallAfterMoving <-\n   function(fun, border = TRUE, move.x = 1, ...)\n{\n   if (panel.number() != 5) {  ## was == 5\n       fun(...)\n       if (border) grid.rect()\n   }\n   else {\n       cpl <- current.limits()\n       pushViewport(viewport(x = move.x,\n                             width = unit(1, \"npc\"),\n                             xscale = cpl$xlim,\n                             yscale = cpl$ylim,\n                             clip = \"off\"))\n       fun(...)\n       if (border) grid.rect()\n       upViewport()\n   }\n}\n## panel function with axes on the left:\npanel.leftaxes <- function(...)\n{\n    if (panel.number() == 5)\n       panel.axis(\"left\", outside = TRUE,\n                   line.col = \"black\")\n    panel.xyplot(...)\n}\n\nz <- expand.grid(x = 1:10, p = 1:5, r = 1:10)\nz$y <- rnorm(nrow(z))\nz$p <- factor(z$p, levels = c(1, 5, 2, 4, 3))\n\nxyplot(y ~ x | p, z, groups = r,\n       layout = c(2, 3), type = \"l\",\n       par.settings =\n       list(axis.line = list(col = \"transparent\"),\n            strip.border = list(col = \"transparent\")),\n       panel = function(...) {\n           callAfterMoving(panel.leftaxes, ...)\n       },\n       strip = function(...) {\n           callAfterMoving(strip.default, ...)\n       },\n       axis = function(..., line.col, side) {\n           if (side != \"left\" || panel.number() != 5) {\n               callAfterMoving(axis.default,\n                               border = FALSE,\n                               line.col = 'black',\n                               side = side,\n                               ...)\n           }\n       })\n\n\nI also wonder why one doesn't need to call panel.xyplot().\n\nThanks,\nMK\n\n\n_____________________________\nProfessor Michael Kubovy\nUniversity of Virginia\nDepartment of Psychology\nUSPS:     P.O.Box 400400    Charlottesville, VA 22904-4400\nParcels:    Room 102        Gilmer Hall\n         McCormick Road    Charlottesville, VA 22903\nOffice:    B011    +1-434-982-4729\nLab:        B019    +1-434-982-4751\nFax:        +1-434-982-4766\nWWW:    http://www.people.virginia.edu/~mk9y/\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}