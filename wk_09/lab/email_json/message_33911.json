{"category": "ham", "to_address": "Perl 6 Internals <perl6-internals@perl.org>", "from_address": "Will Coleda <will@coleda.com>", "subject": "Freeze/thaw; bus error", "body": "Given this code, which requires that you've built languages/tcl:\n\n.sub main :main\n   load_bytecode 'languages/tcl/runtime/tcllib.pir'\n   $P1 = compreg 'PIR'\n   $P2 = $P1(<<'EO_PIR')\n.HLL 'Tcl', ''\n.sub '_anon' :anon\n   '&namespace'('eval', 'tcltest', \"set a 1;proc b {} {}\")\n   print \"ok\\n\"\n.end\nEO_PIR\n\n   $P2() # works\n   $S2 = freeze $P2\n   $P3 = thaw $S2\n   $P3() # vomits\n.end\n\n\nI expect it to print 'ok' 2x. However, it prints ok once, and then  \ngives a bus error.\n\nThe tcl that is [namespace eval'd] here is important. if you remove  \nthe proc, it works. If you remove the set, it works. However, if you  \njust switch the order of the set and the proc, it still fails.\n\nI'll see if I can get this down to just PIR, without any tcl, but  \nfigured I'd post this in the meantime, in case this was small enough  \nthat someone might be able to figure out. (It started out as nearly  \n1kloc of generated PIR).\n\nRegards.\n\n--\nWill \"Coke\" Coleda\nwill@coleda.com\n\n\n"}