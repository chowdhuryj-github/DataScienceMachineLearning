{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "Juan Pablo Lewinger <lewinger@usc.edu>", "subject": "[R] Speeding up resampling of rows from a large matrix", "body": "I'm trying to:\n\nResample with replacement pairs of distinct rows from a 120 x 65,000 \nmatrix H of 0's and 1's. For each resampled pair sum the resulting 2 \nx 65,000 matrix by column:\n\n     0 1 0 1 ...\n+\n     0 0 1 1 ...\n    _______\n=  0 1 1 2 ...\n\nFor each column accumulate the number of 0's, 1's and 2's over the \nresamples to obtain a 3 x 65,000 matrix G.\n\nFor those interested in the background, H is a matrix of haplotypes, \neach pair of haplotypes forms a genotype, and each column corresponds \nto a SNP. I'm using resampling to compute the null distribution of \nthe maximum over correlated SNPs of a simple statistic.\n\n\nThe code:\n#-------------------------------------------------------------------------------\nnSNPs <- 1000\nH <- matrix(sample(0:1, 120*nSNPs , replace=T), nrow=120)\nG <- matrix(0, nrow=3, ncol=nSNPs)\n# Keep in mind that the real H is 120 x 65000\n\nnResamples <- 3000\npair <- replicate(nResamples, sample(1:120, 2))\n\ngen <- function(x){g <- sum(x); c(g==0, g==1, g==2)}\n\nfor (i in 1:nResamples){\n    G <- G + apply(H[pair[,i],], 2, gen)\n}\n#-------------------------------------------------------------------------------\nThe problem is that the loop takes about 80 mins to complete and I \nneed to repeat the whole thing 10,000 times, which would then take \nover a year and a half!\n\nIs there a way to speed this up so that the full 10,000 iterations \ntake a reasonable amount of time (say a week)?\n\nMy machine has an Intel Xeon 3.40GHz CPU with 1GB of RAM\n\n > sessionInfo()\nR version 2.5.0 (2007-04-23)\ni386-pc-mingw32\n\nI would greatly appreciate any help.\n\nJuan Pablo Lewinger\nDepartment of Preventive Medicine\nKeck School of Medicine\nUniversity of Southern California\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}