{"category": "ham", "to_address": "\"Michael Kubovy\" <kubovy@virginia.edu>", "from_address": "\"Deepayan Sarkar\" <deepayan.sarkar@gmail.com>", "subject": "Re: [R] xyplot() and controlling panel.polygon()", "body": "On 4/27/07, Michael Kubovy  wrote:\n> Hi Deepayan,\n>\n> Thanks for your advice. This is moving along, however:\n> The following is drawing the same polygons in each panel. I'm trying\n> to get a different polygon (confidence band) for each group in each\n> panel. That's why I thought I would need to pass groups and\n> subscripts to the panel.groups\n>\n> est <- c(1:4, 3:6, 7, 9, 11, 13, 12, 15, 18, 21)\n> cond <- rep(c('a','b'), each = 8)\n> grp <- rep(c('I', 'II'), each = 4, 2)\n> x <- rep(c(.5, .7, .9, 1.1), 4)\n> upper <- est + 1\n> lower = est - 1\n> data <- data.frame(est = est, x = x, cond = cond, grp = grp, upper =\n> upper, lower = lower)\n>\n> my.panel.polygon <- function(..., font, fontface)\n> {\n>     panel.polygon(...)\n> }\n>\n> xyplot(est ~ x | cond, group = grp, data = data, type = 'b',\n>      panel = function(x, y, ...){\n>          panel.superpose(c(x, rev(x)), c(upper, rev(lower)),\n>              panel.groups = 'my.panel.polygon', default.units =\n> 'native', ...)\n>          panel.xyplot(x, y, ...)\n>      }\n> )\n>\n> It's pretty clear that panel.superpose is not getting its x and y\n> values after they are split by group and panel.\n\nYou are not even trying to do that; you have\n\n  panel.superpose(c(x, rev(x)), c(upper, rev(lower)), <...>\n\nso your x=c(x, rev(x)) is not the same length as x (and subscripts), and your\ny = c(upper, rev(lower)) is not the same length as anything. Also,\nyour upper and lower are being taken from the global env, not data\n(they happen to be the same, but since your data has them, I assume\nyou want to use them).\n\nPerhaps you are looking for something like this:\n\n\npanel.bands <-\n    function(x, y, upper, lower,\n             subscripts, ..., font, fontface)\n{\n    upper <- upper[subscripts]\n    lower <- lower[subscripts]\n    panel.polygon(c(x, rev(x)), c(upper, rev(lower)), ...)\n}\n\nxyplot(est ~ x | cond, group = grp, data = data, type = 'b',\n       upper = data$upper,\n       lower = data$lower,\n       panel = function(x, y, ...){\n           panel.superpose(x, y, panel.groups = 'panel.bands', ...)\n           panel.xyplot(x, y, ...)\n       })\n\n-Deepayan\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}