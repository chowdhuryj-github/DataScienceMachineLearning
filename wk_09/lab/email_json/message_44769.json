{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23380 - in branches/SAMBA_3_0/source: include\n\trpc_client rpc_parse rpcclient", "body": "Author: gd\nDate: 2007-06-08 10:29:46 +0000 (Fri, 08 Jun 2007)\nNew Revision: 23380\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23380\n\nLog:\nnetr_getdcname returns WERROR not NTSTATUS.\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/include/rpc_netlogon.h\n   branches/SAMBA_3_0/source/rpc_client/cli_netlogon.c\n   branches/SAMBA_3_0/source/rpc_parse/parse_net.c\n   branches/SAMBA_3_0/source/rpcclient/cmd_netlogon.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/include/rpc_netlogon.h\n===================================================================\n--- branches/SAMBA_3_0/source/include/rpc_netlogon.h\t2007-06-08 10:15:19 UTC (rev 23379)\n+++ branches/SAMBA_3_0/source/include/rpc_netlogon.h\t2007-06-08 10:29:46 UTC (rev 23380)\n@@ -442,7 +442,7 @@\n typedef struct net_r_getdcname {\n \tuint32  ptr_dcname;\n \tUNISTR2 uni_dcname;\n-\tNTSTATUS status;\n+\tWERROR status;\n } NET_R_GETDCNAME;\n \n /* NET_Q_TRUST_DOM_LIST - LSA Query Trusted Domains */\n\nModified: branches/SAMBA_3_0/source/rpc_client/cli_netlogon.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_client/cli_netlogon.c\t2007-06-08 10:15:19 UTC (rev 23379)\n+++ branches/SAMBA_3_0/source/rpc_client/cli_netlogon.c\t2007-06-08 10:29:46 UTC (rev 23380)\n@@ -420,14 +420,14 @@\n \n /* GetDCName */\n \n-NTSTATUS rpccli_netlogon_getdcname(struct rpc_pipe_client *cli,\n-\t\t\t\t   TALLOC_CTX *mem_ctx, const char *mydcname,\n-\t\t\t\t   const char *domainname, fstring newdcname)\n+WERROR rpccli_netlogon_getdcname(struct rpc_pipe_client *cli,\n+\t\t\t\t TALLOC_CTX *mem_ctx, const char *mydcname,\n+\t\t\t\t const char *domainname, fstring newdcname)\n {\n \tprs_struct qbuf, rbuf;\n \tNET_Q_GETDCNAME q;\n \tNET_R_GETDCNAME r;\n-\tNTSTATUS result;\n+\tWERROR result;\n \tfstring mydcname_slash;\n \n \tZERO_STRUCT(q);\n@@ -440,16 +440,16 @@\n \n \t/* Marshall data and send request */\n \n-\tCLI_DO_RPC(cli, mem_ctx, PI_NETLOGON, NET_GETDCNAME,\n+\tCLI_DO_RPC_WERR(cli, mem_ctx, PI_NETLOGON, NET_GETDCNAME,\n \t\tq, r,\n \t\tqbuf, rbuf,\n \t\tnet_io_q_getdcname,\n \t\tnet_io_r_getdcname,\n-\t\tNT_STATUS_UNSUCCESSFUL);\n+\t\tWERR_GENERAL_FAILURE);\n \n \tresult = r.status;\n \n-\tif (NT_STATUS_IS_OK(result)) {\n+\tif (W_ERROR_IS_OK(result)) {\n \t\trpcstr_pull_unistr2_fstring(newdcname, &r.uni_dcname);\n \t}\n \n\nModified: branches/SAMBA_3_0/source/rpc_parse/parse_net.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_parse/parse_net.c\t2007-06-08 10:15:19 UTC (rev 23379)\n+++ branches/SAMBA_3_0/source/rpc_parse/parse_net.c\t2007-06-08 10:29:46 UTC (rev 23380)\n@@ -644,7 +644,7 @@\n \tif (!prs_align(ps))\n \t\treturn False;\n \n-\tif (!prs_ntstatus(\"status\", ps, depth, &r_t->status))\n+\tif (!prs_werror(\"status\", ps, depth, &r_t->status))\n \t\treturn False;\n \n \treturn True;\n\nModified: branches/SAMBA_3_0/source/rpcclient/cmd_netlogon.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpcclient/cmd_netlogon.c\t2007-06-08 10:15:19 UTC (rev 23379)\n+++ branches/SAMBA_3_0/source/rpcclient/cmd_netlogon.c\t2007-06-08 10:29:46 UTC (rev 23380)\n@@ -76,17 +76,17 @@\n \treturn result;\n }\n \n-static NTSTATUS cmd_netlogon_getdcname(struct rpc_pipe_client *cli, \n-\t\t\t\t       TALLOC_CTX *mem_ctx, int argc, \n-\t\t\t\t       const char **argv)\n+static WERROR cmd_netlogon_getdcname(struct rpc_pipe_client *cli, \n+\t\t\t\t     TALLOC_CTX *mem_ctx, int argc, \n+\t\t\t\t     const char **argv)\n {\n \tfstring dcname;\n-\tNTSTATUS result = NT_STATUS_UNSUCCESSFUL;\n+\tWERROR result = WERR_GENERAL_FAILURE;\n \tint old_timeout;\n \n \tif (argc != 2) {\n \t\tfprintf(stderr, \"Usage: %s domainname\\n\", argv[0]);\n-\t\treturn NT_STATUS_OK;\n+\t\treturn WERR_OK;\n \t}\n \n \t/* Make sure to wait for our DC's reply */\n@@ -96,7 +96,7 @@\n \n \tcli_set_timeout(cli->cli, old_timeout);\n \n-\tif (!NT_STATUS_IS_OK(result))\n+\tif (!W_ERROR_IS_OK(result))\n \t\tgoto done;\n \n \t/* Display results */\n@@ -580,7 +580,7 @@\n \n \t{ \"logonctrl2\", RPC_RTYPE_NTSTATUS, cmd_netlogon_logon_ctrl2, NULL, PI_NETLOGON, NULL, \"Logon Control 2\",     \"\" },\n \t{ \"getanydcname\", RPC_RTYPE_WERROR, NULL, cmd_netlogon_getanydcname, PI_NETLOGON, NULL, \"Get trusted DC name\",     \"\" },\n-\t{ \"getdcname\", RPC_RTYPE_NTSTATUS, cmd_netlogon_getdcname, NULL, PI_NETLOGON, NULL, \"Get trusted PDC name\",     \"\" },\n+\t{ \"getdcname\", RPC_RTYPE_WERROR, NULL, cmd_netlogon_getdcname, PI_NETLOGON, NULL, \"Get trusted PDC name\",     \"\" },\n \t{ \"dsr_getdcname\", RPC_RTYPE_WERROR, NULL, cmd_netlogon_dsr_getdcname, PI_NETLOGON, NULL, \"Get trusted DC name\",     \"\" },\n \t{ \"dsr_getdcnameex\", RPC_RTYPE_WERROR, NULL, cmd_netlogon_dsr_getdcnameex, PI_NETLOGON, NULL, \"Get trusted DC name\",     \"\" },\n \t{ \"dsr_getdcnameex2\", RPC_RTYPE_WERROR, NULL, cmd_netlogon_dsr_getdcnameex2, PI_NETLOGON, NULL, \"Get trusted DC name\",     \"\" },\n\n"}