{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jelmer@samba.org", "subject": "svn commit: samba r22356 - in branches/SAMBA_4_0: .\n\tsource/script/tests", "body": "Author: jelmer\nDate: 2007-04-19 01:23:09 +0000 (Thu, 19 Apr 2007)\nNew Revision: 22356\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22356\n\nLog:\nSimple refactoring.\nModified:\n   branches/SAMBA_4_0/\n   branches/SAMBA_4_0/source/script/tests/selftest.pl\n\n\nChangeset:\n\nProperty changes on: branches/SAMBA_4_0\n___________________________________________________________________\nName: bzr:merge\n...skipped...\n\nModified: branches/SAMBA_4_0/source/script/tests/selftest.pl\n===================================================================\n--- branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-19 01:20:37 UTC (rev 22355)\n+++ branches/SAMBA_4_0/source/script/tests/selftest.pl\t2007-04-19 01:23:09 UTC (rev 22356)\n@@ -672,6 +672,12 @@\n \tdelete $running_envs{$envname};\n }\n \n+my $msg_ops;\n+if ($from_build_farm) {\n+\t$msg_ops = $buildfarm_msg_ops;\n+} else {\n+\t$msg_ops = $plain_msg_ops;\n+}\n \n if ($opt_testenv) {\n \tmy $testenv_vars = setup_env(\"dc\");\n@@ -708,12 +714,8 @@\n \t\tmy $pcap_file = \"$pcap_dir/$shname.cap\";\n \n \t\tSocketWrapper::setup_pcap($pcap_file) if ($opt_socket_wrapper_pcap);\n-\t\tmy $result;\n-\t\tif ($from_build_farm) {\n-\t\t\t$result = run_test($envname, $name, $cmd, $i, $suitestotal, $buildfarm_msg_ops);\n-\t\t} else {\n-\t\t\t$result = run_test($envname, $name, $cmd, $i, $suitestotal, $plain_msg_ops);\n-\t\t}\n+\t\tmy $result = run_test($envname, $name, $cmd, $i, $suitestotal, \n+\t\t\t\t\t\t\t  $msg_ops);\n \n \t\tif ($opt_socket_wrapper_pcap and $result and \n \t\t\tnot $opt_socket_wrapper_keep_pcap) {\n@@ -738,7 +740,8 @@\n my $duration = ($end-$start);\n my $numfailed = $#$suitesfailed+1;\n if ($numfailed == 0) {\n-\tmy $ok = $statistics->{TESTS_EXPECTED_OK} + $statistics->{TESTS_EXPECTED_FAIL};\n+\tmy $ok = $statistics->{TESTS_EXPECTED_OK} + \n+\t         $statistics->{TESTS_EXPECTED_FAIL};\n \tprint \"ALL OK ($ok tests in $statistics->{SUITES_OK} testsuites)\\n\";\n } else {\n \tunless ($from_build_farm) {\n\n"}