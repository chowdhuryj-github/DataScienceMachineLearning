{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "ab@samba.org", "subject": "svn commit: samba r22867 - in branches: SAMBA_3_0/source/utils\n\tSAMBA_3_0_25/source/utils SAMBA_3_0_26/source/utils", "body": "Author: ab\nDate: 2007-05-14 19:26:22 +0000 (Mon, 14 May 2007)\nNew Revision: 22867\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22867\n\nLog:\nWith Samba4's IDL, we now have two new flags for share types: STYPE_TEMPORARY and STYPE_HIDDEN\nStrip them out when referencing share_type[] entries.\n\nApparently, some Windows XP installs create shares set to STYPE_HIDDEN by default, found by\nDamir Shayhutdinov . This also fixes smb4k crashes as it does call 'net share -l'.\n\nModified:\n   branches/SAMBA_3_0/source/utils/net_rpc.c\n   branches/SAMBA_3_0_25/source/utils/net_rpc.c\n   branches/SAMBA_3_0_26/source/utils/net_rpc.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/utils/net_rpc.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/net_rpc.c\t2007-05-14 18:02:49 UTC (rev 22866)\n+++ branches/SAMBA_3_0/source/utils/net_rpc.c\t2007-05-14 19:26:22 UTC (rev 22867)\n@@ -3118,7 +3118,7 @@\n {\n \tif (opt_long_list_entries) {\n \t\td_printf(\"%-12s %-8.8s %-50s\\n\",\n-\t\t\t info1->name, share_type[info1->type],\n+\t\t\t info1->name, share_type[info1->type & ~(STYPE_TEMPORARY|STYPE_HIDDEN)],\n \t\t\t info1->comment ? info1->comment : \"\");\n \t} else {\n \t\td_printf(\"%s\\n\", info1->name);\n\nModified: branches/SAMBA_3_0_25/source/utils/net_rpc.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/utils/net_rpc.c\t2007-05-14 18:02:49 UTC (rev 22866)\n+++ branches/SAMBA_3_0_25/source/utils/net_rpc.c\t2007-05-14 19:26:22 UTC (rev 22867)\n@@ -3113,7 +3113,7 @@\n \n \tif (opt_long_list_entries) {\n \t\td_printf(\"%-12s %-8.8s %-50s\\n\",\n-\t\t\t netname, share_type[info1->info_1.type], remark);\n+\t\t\t netname, share_type[info1->info_1.type & ~(STYPE_TEMPORARY|STYPE_HIDDEN)], remark);\n \t} else {\n \t\td_printf(\"%s\\n\", netname);\n \t}\n\nModified: branches/SAMBA_3_0_26/source/utils/net_rpc.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/net_rpc.c\t2007-05-14 18:02:49 UTC (rev 22866)\n+++ branches/SAMBA_3_0_26/source/utils/net_rpc.c\t2007-05-14 19:26:22 UTC (rev 22867)\n@@ -3113,7 +3113,7 @@\n \n \tif (opt_long_list_entries) {\n \t\td_printf(\"%-12s %-8.8s %-50s\\n\",\n-\t\t\t netname, share_type[info1->info_1.type], remark);\n+\t\t\t netname, share_type[info1->info_1.type & ~(STYPE_TEMPORARY|STYPE_HIDDEN)], remark);\n \t} else {\n \t\td_printf(\"%s\\n\", netname);\n \t}\n\n"}