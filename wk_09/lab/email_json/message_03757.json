{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22202 - in branches/SAMBA_3_0/source/nsswitch: .", "body": "Author: jra\nDate: 2007-04-12 19:16:29 +0000 (Thu, 12 Apr 2007)\nNew Revision: 22202\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22202\n\nLog:\nVolker is clever :-). Use TDB_NOMMAP to prevent any wild pointer\nproblems when validating the winbindd cache. Wish I'd have\nthought of that.\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\n===================================================================\n--- branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\t2007-04-12 15:06:24 UTC (rev 22201)\n+++ branches/SAMBA_3_0/source/nsswitch/winbindd_cache.c\t2007-04-12 19:16:29 UTC (rev 22202)\n@@ -2790,9 +2790,12 @@\n \t\t\tgoto out;\n \t}\n \n+\t/* Doh ! Volker is very smart :-). Use TDB_NOMMAP to prevent\n+\t * any wild pointer references when reading a corrupt tdb file. */\n+\n \ttdb = tdb_open_log(cache_path,\n \t\t\tWINBINDD_CACHE_TDB_DEFAULT_HASH_SIZE,\n-\t\t\tlp_winbind_offline_logon() ? TDB_DEFAULT : (TDB_DEFAULT | TDB_CLEAR_IF_FIRST),\n+\t\t\tlp_winbind_offline_logon() ? TDB_NOMMAP : (TDB_NOMMAP | TDB_CLEAR_IF_FIRST),\n \t\t\tO_RDWR|O_CREAT, 0600);\n \tif (!tdb) {\n \t\tgoto out;\n\n"}