{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r23503 - in branches/SAMBA_4_0/source/kdc: .", "body": "Author: abartlet\nDate: 2007-06-15 00:14:11 +0000 (Fri, 15 Jun 2007)\nNew Revision: 23503\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23503\n\nLog:\nuse hdb_dbc not hdb_openp.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/kdc/hdb-ldb.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/kdc/hdb-ldb.c\n===================================================================\n--- branches/SAMBA_4_0/source/kdc/hdb-ldb.c\t2007-06-14 18:48:51 UTC (rev 23502)\n+++ branches/SAMBA_4_0/source/kdc/hdb-ldb.c\t2007-06-15 00:14:11 UTC (rev 23503)\n@@ -988,7 +988,7 @@\n static krb5_error_code LDB_seq(krb5_context context, HDB *db, unsigned flags, hdb_entry_ex *entry)\n {\n \tkrb5_error_code ret;\n-\tstruct hdb_ldb_seq *priv = (struct hdb_ldb_seq *)db->hdb_openp;\n+\tstruct hdb_ldb_seq *priv = (struct hdb_ldb_seq *)db->hdb_dbc;\n \tTALLOC_CTX *mem_ctx;\n \thdb_entry_ex entry_ex;\n \tmemset(&entry_ex, '\\0', sizeof(entry_ex));\n@@ -1015,7 +1015,7 @@\n \n \tif (ret != 0) {\n \t\ttalloc_free(priv);\n-\t\tdb->hdb_openp = 0;\n+\t\tdb->hdb_dbc = NULL;\n \t} else {\n \t\ttalloc_free(mem_ctx);\n \t}\n@@ -1027,7 +1027,7 @@\n \t\t\t\t\thdb_entry_ex *entry)\n {\n \tstruct ldb_context *ldb_ctx = (struct ldb_context *)db->hdb_db;\n-\tstruct hdb_ldb_seq *priv = (struct hdb_ldb_seq *)db->hdb_openp;\n+\tstruct hdb_ldb_seq *priv = (struct hdb_ldb_seq *)db->hdb_dbc;\n \tchar *realm;\n \tstruct ldb_dn *realm_dn = NULL;\n \tstruct ldb_result *res = NULL;\n@@ -1038,7 +1038,7 @@\n \n \tif (priv) {\n \t\ttalloc_free(priv);\n-\t\tdb->hdb_openp = 0;\n+\t\tdb->hdb_dbc = NULL;\n \t}\n \n \tpriv = (struct hdb_ldb_seq *) talloc(db, struct hdb_ldb_seq);\n@@ -1094,14 +1094,13 @@\n \tpriv->msgs = talloc_steal(priv, res->msgs);\n \ttalloc_free(res);\n \n-\t/* why has hdb_openp changed from (void *) to (int) ??? */\n-\tdb->hdb_openp = (int)priv;\n+\tdb->hdb_dbc = priv;\n \n \tret = LDB_seq(context, db, flags, entry);\n \n \tif (ret != 0) {\n     \t\ttalloc_free(priv);\n-\t\tdb->hdb_openp = 0;\n+\t\tdb->hdb_dbc = NULL;\n \t} else {\n \t\ttalloc_free(mem_ctx);\n \t}\n@@ -1162,7 +1161,7 @@\n \t\treturn NT_STATUS_CANT_ACCESS_DOMAIN_INFO;\n \t}\n \n-\t(*db)->hdb_openp = 0;\n+\t(*db)->hdb_dbc = NULL;\n \t(*db)->hdb_open = LDB_open;\n \t(*db)->hdb_close = LDB_close;\n \t(*db)->hdb_fetch = LDB_fetch;\n\n"}