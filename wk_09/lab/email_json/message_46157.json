{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 535: make sure we start the freeze process quickly on all nodes\n\twhen we are going to do recovery - this prevents\n\tserialisation of freeze,\n\twhich can take a long time in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 535\nrevision-id: tridge@samba.org-20070611130323-4jb1shtg78r4wsed\nparent: tridge@samba.org-20070611122723-0n15ehpi0fa9na90\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Mon 2007-06-11 23:03:23 +1000\nmessage:\n  make sure we start the freeze process quickly on all nodes when we are going to do recovery - this prevents serialisation of freeze, which can take a long time\nmodified:\n  server/ctdb_recoverd.c         recoverd.c-20070503213540-bvxuyd9jm1f7ig90-1\n=== modified file 'server/ctdb_recoverd.c'\n--- a/server/ctdb_recoverd.c\t2007-06-11 11:37:09 +0000\n+++ b/server/ctdb_recoverd.c\t2007-06-11 13:03:23 +0000\n@@ -125,6 +125,11 @@\n {\n \tint j, ret;\n \n+\t/* start the freeze process immediately on all nodes */\n+\tctdb_control(ctdb, CTDB_BROADCAST_CONNECTED, 0, \n+\t\t     CTDB_CONTROL_FREEZE, CTDB_CTRL_FLAG_NOREPLY, tdb_null, \n+\t\t     NULL, NULL, NULL, NULL, NULL);\n+\n \t/* set recovery mode to active on all nodes */\n \tfor (j=0; jnum; j++) {\n \t\t/* dont change it for nodes that are unavailable */\n\n"}