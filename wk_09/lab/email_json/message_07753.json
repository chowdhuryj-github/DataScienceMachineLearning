{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22307 - in branches/SAMBA_4_0/source/script: .", "body": "Author: metze\nDate: 2007-04-17 13:48:12 +0000 (Tue, 17 Apr 2007)\nNew Revision: 22307\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22307\n\nLog:\nwhen no lex or yacc is found:\n- just touch $DEST if it's already there and newer than $SRC\n- touch $DEST if it's already there but older than $SRC and print warnings\n  to stderr\n- otherwise return an error\n\nwhen lex or yacc is found:\n- just touch $DEST if it's already there and newer than $SRC\n- otherwise regenerate $DEST from $SRC using lex or yacc\n\n\nI don't like that every 'make' tries to regenerate because the timestamp\nof $DEST is never updated...\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/script/lex_compile.sh\n   branches/SAMBA_4_0/source/script/yacc_compile.sh\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/script/lex_compile.sh\n===================================================================\n--- branches/SAMBA_4_0/source/script/lex_compile.sh\t2007-04-17 13:14:33 UTC (rev 22306)\n+++ branches/SAMBA_4_0/source/script/lex_compile.sh\t2007-04-17 13:48:12 UTC (rev 22307)\n@@ -8,11 +8,23 @@\n file=`basename $SRC`\n base=`basename $SRC .l`\n if [ -z \"$LEX\" ]; then\n-\techo \"lex not found - not regenerating $DEST\"\n-\texit;\n+\t# if $DEST is more recent than $SRC, we can just touch\n+\t# otherwise we touch but print out warnings\n+\tif [ -r $DEST ]; then\n+\t\tif [ x`find $SRC -newer $DEST -print` = x$SRC ]; then\n+\t\t\techo \"warning: lex not found - cannot generate $SRC => $DEST\" >&2\n+\t\t\techo \"warning: lex not found - only updating the timestamp of $DEST\" >&2\n+\t\tfi\n+\t\ttouch $DEST;\n+\t\texit;\n+\tfi\n+\techo \"error: lex not found - cannot generate $SRC => $DEST\" >&2\n+\texit 1;\n fi\n+# if $DEST is more recent than $SRC, we can just touch\n if [ -r $DEST ]; then\n \tif [ x`find $SRC -newer $DEST -print` != x$SRC ]; then\n+\t\ttouch $DEST;\n \t\texit;\n \tfi\n fi\n\nModified: branches/SAMBA_4_0/source/script/yacc_compile.sh\n===================================================================\n--- branches/SAMBA_4_0/source/script/yacc_compile.sh\t2007-04-17 13:14:33 UTC (rev 22306)\n+++ branches/SAMBA_4_0/source/script/yacc_compile.sh\t2007-04-17 13:48:12 UTC (rev 22307)\n@@ -8,18 +8,30 @@\n file=`basename $SRC`\n base=`basename $SRC .y`\n if [ -z \"$YACC\" ]; then\n-\techo \"yacc not found\"\n-\texit;\n+\t# if $DEST is more recent than $SRC, we can just touch\n+\t# otherwise we touch but print out warnings\n+\tif [ -r $DEST ]; then\n+\t\tif [ x`find $SRC -newer $DEST -print` = x$SRC ]; then\n+\t\t\techo \"warning: yacc not found - cannot generate $SRC => $DEST\" >&2\n+\t\t\techo \"warning: yacc not found - only updating the timestamp of $DEST\" >&2\n+\t\tfi\n+\t\ttouch $DEST;\n+\t\texit;\n+\tfi\n+\techo \"error: yacc not found - cannot generate $SRC => $DEST\" >&2\n+\texit 1;\n fi\n+# if $DEST is more recent than $SRC, we can just touch\n if [ -r $DEST ]; then\n \tif [ x`find $SRC -newer $DEST -print` != x$SRC ]; then\n+\t\ttouch $DEST;\n \t\texit;\n \tfi\n fi\n TOP=`pwd`\n if cd $dir && $YACC -d $file; then\n \tif [ -r y.tab.h -a -r y.tab.c ];then\n-\t\techo \"move files\"\n+\t\t#echo \"info: move files\"\n \t\tsed -e \"/^#/!b\" -e \"/^#/ s|y\\.tab\\.h|$SRC|\" -e \"/^#/ s|\\\"$base.y|\\\"$SRC|\"  y.tab.h > $base.h\n \t\tsed -e \"/^#/ s|y\\.tab\\.c|$SRC|\" -e \"/^#/ s|\\\"$base.y|\\\"$SRC|\" y.tab.c > $base.c\n \t\trm -f y.tab.c y.tab.h\n\n"}