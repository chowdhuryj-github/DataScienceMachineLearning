{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 312: merge from ronnie in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 312\nrevision-id: tridge@samba.org-20070517024650-i4at8m57g4gzoasu\nparent: tridge@samba.org-20070517024309-2e9qy28mgxdcevc2\nparent: sahlberg@ronnie-20070517020729-prfu9kv7k2x1m8rp\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Thu 2007-05-17 12:46:50 +1000\nmessage:\n  merge from ronnie\nmodified:\n  common/ctdb_client.c           ctdb_client.c-20070411010216-3kd8v37k61steeya-1\n  include/ctdb.h                 ctdb.h-20061117234101-o3qt14umlg9en8z0-11\n  tools/ctdb_control.c           ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1\n    ------------------------------------------------------------\n    revno: 197.1.116\n    merged: sahlberg@ronnie-20070517020729-prfu9kv7k2x1m8rp\n    parent: sahlberg@ronnie-20070517004531-ttyt43eorz178m4p\n    committer: Ronnie Sahlberg \n    branch nick: ctdb\n    timestamp: Thu 2007-05-17 12:07:29 +1000\n    message:\n      we no longer pass lmaster across during pulldb    so dont print it from \n      catdb either\n=== modified file 'common/ctdb_client.c'\n--- a/common/ctdb_client.c\t2007-05-17 00:45:31 +0000\n+++ b/common/ctdb_client.c\t2007-05-17 02:07:29 +0000\n@@ -1109,7 +1109,6 @@\n \t\n \tkeys->keys     = talloc_array(mem_ctx, TDB_DATA, keys->num);\n \tkeys->headers  = talloc_array(mem_ctx, struct ctdb_ltdb_header, keys->num);\n-\tkeys->lmasters = talloc_array(mem_ctx, uint32_t, keys->num);\n \tkeys->data     = talloc_array(mem_ctx, TDB_DATA, keys->num);\n \n \trec = (struct ctdb_rec_data *)&reply->data[0];\n@@ -1117,7 +1116,7 @@\n \tfor (i=0;icount;i++) {\n \t\tkeys->keys[i].dptr = talloc_memdup(mem_ctx, &rec->data[0], rec->keylen);\n \t\tkeys->keys[i].dsize = rec->keylen;\n-\n+\t\t\n \t\tkeys->data[i].dptr = talloc_memdup(mem_ctx, &rec->data[keys->keys[i].dsize], rec->datalen);\n \t\tkeys->data[i].dsize = rec->datalen;\n \n\n=== modified file 'include/ctdb.h'\n--- a/include/ctdb.h\t2007-05-17 00:45:31 +0000\n+++ b/include/ctdb.h\t2007-05-17 02:07:29 +0000\n@@ -244,7 +244,6 @@\n \tuint32_t num;\n \tTDB_DATA *keys;\n \tstruct ctdb_ltdb_header *headers;\n-\tuint32_t *lmasters;\n \tTDB_DATA *data;\n };\n int ctdb_ctrl_pulldb(struct ctdb_context *ctdb, uint32_t destnode, uint32_t dbid, uint32_t lmaster, TALLOC_CTX *mem_ctx, struct ctdb_key_list *keys);\n\n=== modified file 'tools/ctdb_control.c'\n--- a/tools/ctdb_control.c\t2007-05-17 00:45:31 +0000\n+++ b/tools/ctdb_control.c\t2007-05-17 02:07:29 +0000\n@@ -513,8 +513,8 @@\n \t\t\tkeystr  = hex_encode(ctdb, keys.keys[i].dptr, keys.keys[i].dsize);\n \t\t\tdatastr = hex_encode(ctdb, keys.data[i].dptr, keys.data[i].dsize);\n \n-\t\t\tprintf(\"rsn:%llu lmaster:%d dmaster:%d key:%s data:%s\\n\", \n-\t\t\t       (unsigned long long)keys.headers[i].rsn, keys.lmasters[i], \n+\t\t\tprintf(\"rsn:%llu dmaster:%d key:%s data:%s\\n\", \n+\t\t\t       (unsigned long long)keys.headers[i].rsn,  \n \t\t\t       keys.headers[i].dmaster, keystr, datastr); \n \t\t\tret++;\n \t\t}\n\n"}