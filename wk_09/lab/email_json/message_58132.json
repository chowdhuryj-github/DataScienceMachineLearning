{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "gd@samba.org", "subject": "svn commit: samba r23650 - in branches: SAMBA_3_0/source/libads\n\tSAMBA_3_0/source/libsmb SAMBA_3_0_26/source/libads\n\tSAMBA_3_0_26/source/libsmb", "body": "Author: gd\nDate: 2007-06-29 09:54:39 +0000 (Fri, 29 Jun 2007)\nNew Revision: 23650\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23650\n\nLog:\nFix remaining callers of krb5_kt_default().\n\nGuenther\n\nModified:\n   branches/SAMBA_3_0/source/libads/kerberos_keytab.c\n   branches/SAMBA_3_0/source/libsmb/clikrb5.c\n   branches/SAMBA_3_0_26/source/libads/kerberos_keytab.c\n   branches/SAMBA_3_0_26/source/libsmb/clikrb5.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libads/kerberos_keytab.c\n===================================================================\n--- branches/SAMBA_3_0/source/libads/kerberos_keytab.c\t2007-06-29 09:42:14 UTC (rev 23649)\n+++ branches/SAMBA_3_0/source/libads/kerberos_keytab.c\t2007-06-29 09:54:39 UTC (rev 23650)\n@@ -546,10 +546,11 @@\n \t\tDEBUG(1,(\"ads_keytab_create_default: could not krb5_init_context: %s\\n\",error_message(ret)));\n \t\treturn ret;\n \t}\n-\tret = krb5_kt_default(context, &keytab);\n+\n+\tret = smb_krb5_open_keytab(context, NULL, True, &keytab);\n \tif (ret) {\n-\t\tDEBUG(1,(\"ads_keytab_create_default: krb5_kt_default failed (%s)\\n\",error_message(ret)));\n-\t\tgoto done;\n+\t\tDEBUG(1,(\"ads_keytab_create_default: smb_krb5_open_keytab failed (%s)\\n\", error_message(ret)));\n+\t\tgoto out;\n \t}\n \n \tret = krb5_kt_start_seq_get(context, keytab, &cursor);\n\nModified: branches/SAMBA_3_0/source/libsmb/clikrb5.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/clikrb5.c\t2007-06-29 09:42:14 UTC (rev 23649)\n+++ branches/SAMBA_3_0/source/libsmb/clikrb5.c\t2007-06-29 09:54:39 UTC (rev 23650)\n@@ -951,10 +951,10 @@\n \t   may be in the middle of a keytab enumeration when this is\n \t   called. JRA. */\n \n-\tret = krb5_kt_default(context, &keytab);\n+\tret = smb_krb5_open_keytab(context, NULL, False, &keytab);\n \tif (ret) {\n-\t\tDEBUG(0,(\"get_key_from_keytab: failed to open keytab: %s\\n\", error_message(ret)));\n-\t\treturn ret;\n+\t\tDEBUG(1,(\"get_key_from_keytab: smb_krb5_open_keytab failed (%s)\\n\", error_message(ret)));\n+\t\tgoto out;\n \t}\n \n \tif ( DEBUGLEVEL >= 10 ) {\n\nModified: branches/SAMBA_3_0_26/source/libads/kerberos_keytab.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libads/kerberos_keytab.c\t2007-06-29 09:42:14 UTC (rev 23649)\n+++ branches/SAMBA_3_0_26/source/libads/kerberos_keytab.c\t2007-06-29 09:54:39 UTC (rev 23650)\n@@ -546,10 +546,11 @@\n \t\tDEBUG(1,(\"ads_keytab_create_default: could not krb5_init_context: %s\\n\",error_message(ret)));\n \t\treturn ret;\n \t}\n-\tret = krb5_kt_default(context, &keytab);\n+\n+\tret = smb_krb5_open_keytab(context, NULL, True, &keytab);\n \tif (ret) {\n-\t\tDEBUG(1,(\"ads_keytab_create_default: krb5_kt_default failed (%s)\\n\",error_message(ret)));\n-\t\tgoto done;\n+\t\tDEBUG(1,(\"ads_keytab_create_default: smb_krb5_open_keytab failed (%s)\\n\", error_message(ret)));\n+\t\tgoto out;\n \t}\n \n \tret = krb5_kt_start_seq_get(context, keytab, &cursor);\n\nModified: branches/SAMBA_3_0_26/source/libsmb/clikrb5.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/libsmb/clikrb5.c\t2007-06-29 09:42:14 UTC (rev 23649)\n+++ branches/SAMBA_3_0_26/source/libsmb/clikrb5.c\t2007-06-29 09:54:39 UTC (rev 23650)\n@@ -951,10 +951,10 @@\n \t   may be in the middle of a keytab enumeration when this is\n \t   called. JRA. */\n \n-\tret = krb5_kt_default(context, &keytab);\n+\tret = smb_krb5_open_keytab(context, NULL, False, &keytab);\n \tif (ret) {\n-\t\tDEBUG(0,(\"get_key_from_keytab: failed to open keytab: %s\\n\", error_message(ret)));\n-\t\treturn ret;\n+\t\tDEBUG(1,(\"get_key_from_keytab: smb_krb5_open_keytab failed (%s)\\n\", error_message(ret)));\n+\t\tgoto out;\n \t}\n \n \tif ( DEBUGLEVEL >= 10 ) {\n\n"}