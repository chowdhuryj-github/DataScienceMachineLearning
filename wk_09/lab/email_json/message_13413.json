{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "mimir@samba.org", "subject": "svn commit: samba r22487 - in\n\tbranches/SAMBA_4_0/webapps/swat/source/class/swat/module/netmgr: .", "body": "Author: mimir\nDate: 2007-04-23 13:37:33 +0000 (Mon, 23 Apr 2007)\nNew Revision: 22487\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22487\n\nLog:\nAdd a separate widget class for listing users and reposition\nthings on NetManager's screen. Qooxdoo layout positioning can\nbe tricky sometimes...\n\n\nrafal\n\n\nAdded:\n   branches/SAMBA_4_0/webapps/swat/source/class/swat/module/netmgr/UsersView.js\nModified:\n   branches/SAMBA_4_0/webapps/swat/source/class/swat/module/netmgr/Gui.js\n\n\nChangeset:\nModified: branches/SAMBA_4_0/webapps/swat/source/class/swat/module/netmgr/Gui.js\n===================================================================\n--- branches/SAMBA_4_0/webapps/swat/source/class/swat/module/netmgr/Gui.js\t2007-04-23 12:31:12 UTC (rev 22486)\n+++ branches/SAMBA_4_0/webapps/swat/source/class/swat/module/netmgr/Gui.js\t2007-04-23 13:37:33 UTC (rev 22487)\n@@ -2,6 +2,7 @@\n  * Copyright (C)  Rafal Szczesniak 2007\n  */\n \n+\n /**\n  * Swat Net Manager class graphical user interface\n  */\n@@ -14,7 +15,6 @@\n \n //qx.OO.addProperty({ name : \"_tree\", type : \"object\" });\n //qx.OO.addProperty({ name : \"_panel\", type : \"object\" });\n-//qx.OO.addProperty({ name : \"_view\", type : \"object\" });\n //qx.OO.addProperty({ name : \"_txtDomain\", type : \"object\" });\n //qx.OO.addProperty({ name : \"_txtUsername\", type : \"object\" });\n \n@@ -30,9 +30,9 @@\n   // Main layout composing the whole form\n   var vlayout = new qx.ui.layout.VerticalBoxLayout();\n   vlayout.set({\n-                top: 20,\n-                left: 20,\n-                width: \"100%\",\n+                top: 10,\n+                left: 10,\n+                right: 10,\n                 bottom: 20\n               });\n \n@@ -70,37 +70,17 @@\n   // \"Panel\" for list view\n   this._panel = new qx.ui.layout.VerticalBoxLayout();\n   var panel = this._panel;\n-  \n+\n+  // TODO: Find out what's causing this bug - specifying 'width' works fine,\n+  // but setting 'right' instead does not which makes impossible to position\n+  // the panel against right boundary of a box\n   panel.set({\n               top: 0,\n               left: 10,\n-              width: \"80%\",\n+              width:\"80%\",\n               height: \"100%\"\n             });\n \n-  // Setup some initial columns and (empty) item list - to be replaced soon\n-  // with default view loading\n-  var columns = { name : { label: \"Name\", width: 120, type: \"text\" }};\n-  var items = [];\n-\n-  // Setup the list view\n-  this._view = new qx.ui.listview.ListView(items, columns);\n-  var view = this._view;\n-  view.setBorder(qx.renderer.border.BorderPresets.getInstance().shadow);\n-  view.setBackgroundColor(\"white\");\n-  view.set({\n-             top: 0,\n-             left: 0,\n-             width: \"80%\",\n-             height: \"100%\"\n-           });\n-\n-  // Give a list view name to handle\n-  fsm.addObject(\"view\", view);\n-\n-  // and the list view to the panel\n-  panel.add(view);\n-  \n   // Add the tree view and panel for list view to the layout\n   hlayout.add(tree);\n   hlayout.add(panel);\n@@ -110,8 +90,8 @@\n   statusLayout.set({\n                      top: 10,\n                      left: 0,\n-                     right: 0,\n-                     height: \"100%\"\n+                     width: \"100%\",\n+                     height: \"20%\"\n                    });\n \n   // First \"column\" of status fields\n@@ -119,13 +99,13 @@\n   colALayout.set({\n                   top: 0,\n                   left: 0,\n-                  width: 150,\n+                  width: \"25%\",\n                   height: \"100%\"\n                 });\n \n   // Domain name (credentials) - label and text box\n   var statusDomain = new qx.ui.layout.HorizontalBoxLayout();\n-  statusDomain.set({ top: 0, left: 0, width: \"100%\", height: 20,\n+  statusDomain.set({ top: 0, left: 0, width: \"100%\", height: \"auto\",\n \t\t       verticalChildrenAlign: \"middle\" });\n   \n   var lblDomain = new qx.ui.basic.Atom();\n@@ -141,7 +121,7 @@\n   \n   // Username (credentials) - label and text box\n   var statusUsername = new qx.ui.layout.HorizontalBoxLayout();\n-  statusUsername.set({ top: 0, left: 0, width: \"100%\", height: 20,\n+  statusUsername.set({ top: 0, left: 0, width: \"100%\", height: \"auto\",\n                        verticalChildrenAlign: \"middle\" });\n \n   var lblUsername = new qx.ui.basic.Atom();\n@@ -281,7 +261,13 @@\n qx.Proto._initUserManager = function(module, rpcRequest)\n {\n   // Get obtained UsrCtx handle\n-  var result = rpcRequest.getUserData(\"result\").data;\n+  var usrCtx = rpcRequest.getUserData(\"result\").data;\n+\n+  // Create user view and pass the context\n+  var view = new swat.module.netmgr.UsersView(module.fsm);\n+  view.setUsrCtx(usrCtx);\n+  \n+  this._panel.add(view);\n };\n \n \n\nAdded: branches/SAMBA_4_0/webapps/swat/source/class/swat/module/netmgr/UsersView.js\n===================================================================\n--- branches/SAMBA_4_0/webapps/swat/source/class/swat/module/netmgr/UsersView.js\t2007-04-23 12:31:12 UTC (rev 22486)\n+++ branches/SAMBA_4_0/webapps/swat/source/class/swat/module/netmgr/UsersView.js\t2007-04-23 13:37:33 UTC (rev 22487)\n@@ -0,0 +1,62 @@\n+/*\n+ * Copyright (C)  Rafal Szczesniak 2007\n+ */\n+\n+//qx.OO.addProperty({ name: \"_fsm\", type: \"object\"});\n+//qx.OO.addProperty({ name: \"_columns\", type: \"object\"});\n+//qx.OO.addProperty({ name: \"_items\", type: \"object\"});\n+//qx.OO.addProperty({ name: \"_view\", type: \"object\" });\n+\n+/**\n+ * Users View \n+ */\n+qx.OO.defineClass(\"swat.module.netmgr.UsersView\", qx.ui.layout.HorizontalBoxLayout,\n+function(fsm)\n+{\n+  qx.ui.layout.HorizontalBoxLayout.call(this);\n+\n+  this._fsm = fsm;\n+  \n+  // Set the whole view panel size and spacing between boxes\n+  this.set({ top: 0, left: 0, width: \"100%\", height: \"100%\" });\n+  this.setSpacing(5);\n+\n+  // Provide vertical positioning of combo box and list view\n+  var innerBox = new qx.ui.layout.VerticalBoxLayout();\n+  innerBox.set({ top: 0, left: 0, width: \"100%\", height: \"100%\"});\n+\n+  // horizontal box for domain selection label and combo box\n+  var selectDomainBox = new qx.ui.layout.HorizontalBoxLayout();\n+  selectDomainBox.set({ top: 0, left: 0, width: \"auto\", height: \"10%\" });\n+  selectDomainBox.setVerticalChildrenAlign(\"middle\");\n+  selectDomainBox.setSpacing(5);\n+  \n+  // Setup domain selection combo box\n+  var lblDomain = new qx.ui.basic.Atom(\"Domain:\");\n+  lblDomain.setHorizontalChildrenAlign(\"right\");\n+  \n+  var cmbDomain = new qx.ui.form.ComboBox();\n+  cmbDomain.setEditable(false);\n+\n+  // Create an empty list view with sample column\n+  this._columns = { username : { label: \"Username\", width: 150, type: \"text\" }};\n+  this._items = [];\n+  this._view = new qx.ui.listview.ListView(this._items, this._columns);\n+  var view = this._view;\n+  view.set({ top: 0, left: 0, width: \"90%\", height: \"90%\" });\n+  view.setBorder(qx.renderer.border.BorderPresets.getInstance().shadow);\n+\n+  // Arrange widgets and boxes\n+  selectDomainBox.add(lblDomain);\n+  selectDomainBox.add(cmbDomain);\n+\n+  innerBox.add(selectDomainBox);\n+  innerBox.add(view);\n+\n+  // place the inner box in the UsersView box\n+  this.add(innerBox);\n+});\n+\n+\n+// UsrMgr context is required for any operation on user accounts\n+qx.OO.addProperty({ name : \"usrCtx\", type : \"number\" });\n\n"}