{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r23161 - in branches:\n\tSAMBA_3_0/source/lib/tdb/common SAMBA_3_0/source/lib/tdb/include\n\tSAMBA_3_0_26/source/lib/tdb/common\n\tSAMBA_3_0_26/source/lib/tdb/include", "body": "Author: vlendec\nDate: 2007-05-27 09:22:11 +0000 (Sun, 27 May 2007)\nNew Revision: 23161\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23161\n\nLog:\nAdd TDB_VOLATILE as open_flag to activate the per-hashchain dead record\noptimization.\n\nModified:\n   branches/SAMBA_3_0/source/lib/tdb/common/open.c\n   branches/SAMBA_3_0/source/lib/tdb/include/tdb.h\n   branches/SAMBA_3_0_26/source/lib/tdb/common/open.c\n   branches/SAMBA_3_0_26/source/lib/tdb/include/tdb.h\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/tdb/common/open.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/tdb/common/open.c\t2007-05-26 16:57:53 UTC (rev 23160)\n+++ branches/SAMBA_3_0/source/lib/tdb/common/open.c\t2007-05-27 09:22:11 UTC (rev 23161)\n@@ -165,6 +165,10 @@\n \t\ttdb->page_size = 0x2000;\n \t}\n \n+\tif (open_flags & TDB_VOLATILE) {\n+\t\ttdb->max_dead_records = 5;\n+\t}\n+\n \tif ((open_flags & O_ACCMODE) == O_WRONLY) {\n \t\tTDB_LOG((tdb, TDB_DEBUG_ERROR, \"tdb_open_ex: can't open tdb %s write-only\\n\",\n \t\t\t name));\n\nModified: branches/SAMBA_3_0/source/lib/tdb/include/tdb.h\n===================================================================\n--- branches/SAMBA_3_0/source/lib/tdb/include/tdb.h\t2007-05-26 16:57:53 UTC (rev 23160)\n+++ branches/SAMBA_3_0/source/lib/tdb/include/tdb.h\t2007-05-27 09:22:11 UTC (rev 23161)\n@@ -47,6 +47,7 @@\n #define TDB_BIGENDIAN 32 /* header is big-endian (internal use) */\n #define TDB_NOSYNC   64 /* don't use synchronous transactions */\n #define TDB_SEQNUM   128 /* maintain a sequence number */\n+#define TDB_VOLATILE   256 /* Activate the per-hashchain freelist, default 5 */\n \n #define TDB_ERRCODE(code, ret) ((tdb->ecode = (code)), ret)\n \n\nModified: branches/SAMBA_3_0_26/source/lib/tdb/common/open.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/tdb/common/open.c\t2007-05-26 16:57:53 UTC (rev 23160)\n+++ branches/SAMBA_3_0_26/source/lib/tdb/common/open.c\t2007-05-27 09:22:11 UTC (rev 23161)\n@@ -165,6 +165,10 @@\n \t\ttdb->page_size = 0x2000;\n \t}\n \n+\tif (open_flags & TDB_VOLATILE) {\n+\t\ttdb->max_dead_records = 5;\n+\t}\n+\n \tif ((open_flags & O_ACCMODE) == O_WRONLY) {\n \t\tTDB_LOG((tdb, TDB_DEBUG_ERROR, \"tdb_open_ex: can't open tdb %s write-only\\n\",\n \t\t\t name));\n\nModified: branches/SAMBA_3_0_26/source/lib/tdb/include/tdb.h\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/tdb/include/tdb.h\t2007-05-26 16:57:53 UTC (rev 23160)\n+++ branches/SAMBA_3_0_26/source/lib/tdb/include/tdb.h\t2007-05-27 09:22:11 UTC (rev 23161)\n@@ -47,6 +47,7 @@\n #define TDB_BIGENDIAN 32 /* header is big-endian (internal use) */\n #define TDB_NOSYNC   64 /* don't use synchronous transactions */\n #define TDB_SEQNUM   128 /* maintain a sequence number */\n+#define TDB_VOLATILE   256 /* Activate the per-hashchain freelist, default 5 */\n \n #define TDB_ERRCODE(code, ret) ((tdb->ecode = (code)), ret)\n \n\n"}