{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "mimir@samba.org", "subject": "svn commit: samba r22323 - in\n\tbranches/SAMBA_4_0/source/scripting/ejs/ejsnet: .", "body": "Author: mimir\nDate: 2007-04-17 23:06:43 +0000 (Tue, 17 Apr 2007)\nNew Revision: 22323\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22323\n\nLog:\n- add credentials property to NetContext object\n- change a comment (matches the idea better)\n\n\nrafal\n\n\nModified:\n   branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_ctx.c\n   branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_user.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_ctx.c\n===================================================================\n--- branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_ctx.c\t2007-04-17 22:35:01 UTC (rev 22322)\n+++ branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_ctx.c\t2007-04-17 23:06:43 UTC (rev 22323)\n@@ -43,7 +43,7 @@\n \tTALLOC_CTX *event_mem_ctx = talloc_new(mprMemCtx());\n \tstruct cli_credentials *creds;\n \tstruct libnet_context *ctx;\n-\tstruct MprVar obj;\n+\tstruct MprVar obj, mprCreds;\n \tstruct event_context *ev;\n \n \tif (!event_mem_ctx) {\n@@ -59,6 +59,9 @@\n \ttalloc_steal(ctx, event_mem_ctx);\n \n \tif (argc == 0 || (argc == 1 && argv[0]->type == MPR_TYPE_NULL)) {\n+\t\t/* \n+\t\t   create the default credentials\n+\t\t*/\n \t\tcreds = cli_credentials_init(ctx);\n \t\tif (creds == NULL) {\n \t\t\tejsSetErrorMsg(eid, \"cli_credential_init() failed\");\n@@ -68,11 +71,16 @@\n \t\tcli_credentials_set_conf(creds);\n \t\tcli_credentials_set_anonymous(creds);\n \n+\t\tmprCreds = mprCredentials(creds);\n+\n \t} else if (argc == 1 && argv[0]->type == MPR_TYPE_OBJECT) {\n-\t\t/* get credential values from credentials object */\n-\t\tcreds = mprGetPtr(argv[0], \"creds\");\n+\t\t/*\n+\t\t  get credential values from credentials object\n+\t\t*/\n+\t\tmprCreds = *(argv[0]);\n+\t\tcreds = mprGetPtr(&mprCreds, \"creds\");\n \t\tif (creds == NULL) {\n-\t\t\tejsSetErrorMsg(eid, \"userAuth requires a 'creds' first parameter\");\n+\t\t\tejsSetErrorMsg(eid, \"invalid credentials parameter\");\n \t\t\ttalloc_free(ctx);\n \t\t\treturn -1;\n \t\t}\n@@ -82,15 +90,25 @@\n \t\ttalloc_free(ctx);\n \t\treturn -1;\n \t}\n-\n+\t\n+\t/* setup libnet_context credentials */\n \tctx->cred = creds;\n \n-\tobj = mprObject(\"NetCtx\");\n+\t/* create the NetContext object */\n+\tobj = mprObject(\"NetContext\");\n+\n+\t/* add internal libnet_context pointer to the NetContext object */\n \tmprSetPtrChild(&obj, \"ctx\", ctx);\n+\n+\t/* add properties publicly available from js code */\n+\tmprCreateProperty(&obj, \"credentials\", &mprCreds);\n \t\n+\t/* add methods to the object */\n \tmprSetCFunction(&obj, \"UserMgr\", ejs_net_userman);\n \tmprSetCFunction(&obj, \"JoinDomain\", ejs_net_join_domain);\n \tmprSetCFunction(&obj, \"SamSyncLdb\", ejs_net_samsync_ldb);\n+\n+\t/* return the object */\n \tmpr_Return(eid, obj);\n \n \treturn 0;\n\nModified: branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_user.c\n===================================================================\n--- branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_user.c\t2007-04-17 22:35:01 UTC (rev 22322)\n+++ branches/SAMBA_4_0/source/scripting/ejs/ejsnet/net_user.c\t2007-04-17 23:06:43 UTC (rev 22323)\n@@ -59,7 +59,7 @@\n \n \t} else if (argc == 1 && mprVarIsString(argv[0]->type)) {\n \t\t/* domain name can also be specified explicitly \n-\t\t   (e.g. to connect remote domain) */\n+\t\t   (e.g. to connect BUILTIN domain) */\n \t\tuserman_domain = mprToString(argv[0]);\n \n \t} else {\n\n"}