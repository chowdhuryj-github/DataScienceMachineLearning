{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r23208 - in\n\tbranches/SAMBA_4_0/source/lib/replace: .", "body": "Author: metze\nDate: 2007-05-29 15:18:20 +0000 (Tue, 29 May 2007)\nNew Revision: 23208\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23208\n\nLog:\non some HP-UX boxes dlfcn.h is available and use unsigned int flags\nfor dlopen but no library contains the function...\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/lib/replace/dlfcn.c\n   branches/SAMBA_4_0/source/lib/replace/dlfcn.m4\n   branches/SAMBA_4_0/source/lib/replace/replace.h\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/lib/replace/dlfcn.c\n===================================================================\n--- branches/SAMBA_4_0/source/lib/replace/dlfcn.c\t2007-05-29 14:53:46 UTC (rev 23207)\n+++ branches/SAMBA_4_0/source/lib/replace/dlfcn.c\t2007-05-29 15:18:20 UTC (rev 23208)\n@@ -26,7 +26,11 @@\n #include \"replace.h\"\n \n #ifndef HAVE_DLOPEN\n+#ifdef DLOPEN_TAKES_UNSIGNED_FLAGS\n+void *rep_dlopen(const char *name, unsigned int flags)\n+#else\n void *rep_dlopen(const char *name, int flags)\n+#endif\n {\n \treturn NULL;\n }\n\nModified: branches/SAMBA_4_0/source/lib/replace/dlfcn.m4\n===================================================================\n--- branches/SAMBA_4_0/source/lib/replace/dlfcn.m4\t2007-05-29 14:53:46 UTC (rev 23207)\n+++ branches/SAMBA_4_0/source/lib/replace/dlfcn.m4\t2007-05-29 15:18:20 UTC (rev 23208)\n@@ -5,13 +5,18 @@\n libreplace_cv_dlfcn=no\n AC_SEARCH_LIBS(dlopen, dl)\n \n-if test x\"${ac_cv_search_dlopen}\" = x\"no\"; then\n-\tlibreplace_cv_dlfcn=yes\n-else\n-\tAC_CHECK_HEADERS(dlfcn.h)\n-\tAC_CHECK_FUNCS([dlopen dlsym dlerror dlclose],[],[libreplace_cv_dlfcn=yes])\n-fi\n+AC_CHECK_HEADERS(dlfcn.h)\n+AC_CHECK_FUNCS([dlopen dlsym dlerror dlclose],[],[libreplace_cv_dlfcn=yes])\n \n+AC_VERIFY_C_PROTOTYPE([void *dlopen(const char* filename, unsigned int flags)],\n+\t[\n+\treturn 0;\n+\t],[\n+\tAC_DEFINE(DLOPEN_TAKES_UNSIGNED_FLAGS, 1, [Whether dlopen takes unsinged int flags])\n+\t],[],[\n+\t#include \n+\t])\n+\n if test x\"${libreplace_cv_dlfcn}\" = x\"yes\";then\n \tLIBREPLACEOBJ=\"${LIBREPLACEOBJ} dlfcn.o\"\n fi\n\nModified: branches/SAMBA_4_0/source/lib/replace/replace.h\n===================================================================\n--- branches/SAMBA_4_0/source/lib/replace/replace.h\t2007-05-29 14:53:46 UTC (rev 23207)\n+++ branches/SAMBA_4_0/source/lib/replace/replace.h\t2007-05-29 15:18:20 UTC (rev 23208)\n@@ -228,8 +228,12 @@\n \n #ifndef HAVE_DLOPEN\n #define dlopen rep_dlopen\n+#ifdef DLOPEN_TAKES_UNSIGNED_FLAGS\n+void *rep_dlopen(const char *name, unsigned int flags);\n+#else\n void *rep_dlopen(const char *name, int flags);\n #endif\n+#endif\n \n #ifndef HAVE_DLSYM\n #define dlsym rep_dlsym\n\n"}