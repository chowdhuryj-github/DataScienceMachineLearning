{"category": "ham", "to_address": "r-help@stat.math.ethz.ch", "from_address": "D G Rossiter <rossiter@itc.nl>", "subject": "Re: [R] Sweave bug? when writing figures / deleting variable in\n\tchunk", "body": "Thanks to the four distinguished R'ers who answered. I have used  \nSweave intensively for over a year, and have poured through all the  \ndoc. as well as the help archives, and could find nothing on this. It  \nis now \"well known\" to me! since it bit me, but it did cost me a day  \nof head-scratching and putting it in the shortest possible form for  \nthe list (the original example where this happened was a lot more  \ncomplicated). Perhaps it could be documented in Sweave- \nmanual-20060104.pdf or its successor?\n\nNow I see the reasoning behind it, thanks. I had already determined  \nthe work-around. The problem is that I distribute the Tangled .R  \nfiles along with the Sweaved PDF doc, so that students etc. can run  \nthe code. Anything unintuitive in the code confuses people. In this  \ncase I think it's good pratice to delete temporary variables right  \nafter they are no longer needed (as in my original example), so  \nthat's why I want to put it in the same chunk.\n\nHaving said that, I am a Sweave devotee, it has radically improved my  \nproductivity in writing R-based tech. notes.\n\nDavid Rossiter\nITC Enschede (NL)\n\nOn 27 Jun2007, at 21:34, Achim Zeileis wrote:\n\n> On Wed, 27 Jun 2007 21:06:04 -0400 D G Rossiter wrote:\n>\n>> I have found a quite strange (to me) behaviour in Sweave. It only\n>> occurs in the following situation:\n>>\n>> 1. define a variable in one chunk\n>> 2. use it within a subsequent figure-generating chunk\n>> 3. delete it at the end of that same chunk\n>> Then the Sweave driver chokes, not finding the variable name when\n>> generating the figure\n>\n> Sweave() executes figure chunks more than once because they might\n> also create printed output. If you create both EPS and PDF  \n> graphics, it\n> executes them three times (print + EPS + PDF). Hence, data\n> manipulations should be avoided in figure chunks.\n>\n> I was also once bitten by this when I permuted columns of a table  \n> prior\n> to plotting and never obtained the desired order...\n>\n> Fritz, maybe this is worth an entry in the FAQ?\n> Z\n>\n>> Example:\n>>\n>> % document bug2.Rnw\n>> \\documentclass{article}\n>> \\usepackage{Sweave}\n>> \\begin{document}\n>> \\SweaveOpts{eps=false}\n>> <<>>=\n>> sel <- 1:5\n>> @\n>> <>=\n>> plot(trees[sel,])\n>> rm(sel)\n>> @\n>> \\end{document}\n>>\n>> Try to sweave:\n>>\n>>> Sweave(\"bug2.Rnw\")\n>> Writing to file bug2.tex\n>> Processing code chunks ...\n>> 1 : echo term verbatim\n>> 2 : echo term verbatim pdf\n>> Error: no function to return from, jumping to top level\n>> Error in plot(trees[sel, ]) : error in evaluating the argument 'x'\n>> in selecting a method for function 'plot'\n>> Error in driver$runcode(drobj, chunk, chunkopts) :\n>> \tError in plot(trees[sel, ]) : error in evaluating the\n>> argument 'x' in selecting a method for function 'plot'\n>>\n>> The generated .tex is complete up through the rm() but no figure is\n>> generated. The file bug2-002.pdf is incomplete (corrupt).\n>>\n>> ...\n>> \\begin{Schunk}\n>> \\begin{Sinput}\n>>> plot(trees[sel, ])\n>>> rm(sel)\n>> \\end{Sinput}\n>> \\end{Schunk}\n>>\n>> The following ALL eliminate the problem:\n>>\n>> 0. Executing the code directly, also with ESS\n>> 1. <>\n>> 2. moving rm(sel) to a separate, later code chunk\n>> 3. Stangle the source and then source it\n>> 4. don't use a variable, i.e. in this case:  plot(trees[1:5,])\n>>\n>> It seems that Sweave is executing the rm(sel)  before it uses it in\n>> the trees[sel,].\n>>\n>> Technical details: R 2.5.0, Mac OS X 10.4.10, PPC\n>> Same behaviour in stand-alone R for Mac and for R within Aquamacs\n>> using ESS\n>>\n>> Workaround: I am putting any deletions into a later code chunk. This\n>> only has the disadvantage of making more chunks, so now that I know\n>> what's happening it's no big deal. But it's driving me crazy... am I\n>> missing something? Thanks!\n>>\n>> D. G. Rossiter\n>> Senior University Lecturer\n>> Department of Earth Systems Analysis\n>> International Institute for Geo-Information Science and Earth\n>> Observation (ITC)\n>> Hengelosestraat 99\n>> PO Box 6, 7500 AA Enschede, The Netherlands\n>> Phone:\t+31-(0)53 4874 499\n>> Fax:\t+31-(0)53 4874 336\n>> mailto:rossiter--at--itc.nl,  Internet: http://www.itc.nl/personal/\n>> rossiter\n>>\n>> ______________________________________________\n>> R-help@stat.math.ethz.ch mailing list\n>> https://stat.ethz.ch/mailman/listinfo/r-help\n>> PLEASE do read the posting guide\n>> http://www.R-project.org/posting-guide.html and provide commented,\n>> minimal, self-contained, reproducible code.\n>>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}