{"category": "ham", "to_address": "Duncan Murdoch <murdoch@stats.uwo.ca>", "from_address": "Prof Brian Ripley <ripley@stats.ox.ac.uk>", "subject": "Re: [R] bug in closing gzfile-opened connections?", "body": "Note that the use of read.table() does make a difference.  If you did\n\nx <- scan(gzfile(\"xxx.gz\"), list(\"\",\"\",\"\"))\n\nyou would leave an unused connection, and showConnections(all=TRUE) would \nshow this.  There is a finite pool of connections, and in general the \ncorrect way to use them is\n\ncon <- gzfile(\"xxx.gz\")\nx <- scan(con, list(\"\",\"\",\"\"))\nclose(con)\n\nread.table() is the exception, so I suspect it is other things that have \nbeen done in the session that have used up the pool of connections.\n\nOn Tue, 3 Jul 2007, Duncan Murdoch wrote:\n\n> On 03/07/2007 1:37 PM, David Reiss wrote:\n>> Hi,\n>> I am making multiple calls to gzfile() via read.table(), e.g.\n>>\n>>> x <- read.table( gzfile( \"xxx.gz\" ) )\n>>\n>> After i do this many times (I haven't counted, but probably between 50 and\n>> 100 times) I get the error message:\n>>\n>> Error in open.connection(file, \"r\") : unable to open connection\n>> In addition: Warning message:\n>> cannot open compressed file 'xxx.gz'\n>>\n>> however, I also find that:\n>>\n>>> showConnections()\n>>      description class mode text isopen can read can write\n>>\n>> so there are no (apparently) open connections. Calling closeAllConnections()\n>> does not fix the problem. I have to quit and re-start R.\n>> I am using R 2.5.0 on a Mac (OSX 10.4.9).\n>>\n>> Anyone know if this is a bug or a 'feature'? I see from the gzfile help\n>> that:\n>>\n>>  In general functions using connections\n>>      will open them if they are not open, but then close them again, so\n>>      to leave a connection open call 'open' explicitly.\n>\n> You didn't give a reproducible example, so I couldn't say.  When I\n> create a gzipped version of a write.table output and run\n>\n> for(i in 1:1000) read.table(gzfile(f))\n>\n> in R 2.5.0 I don't see a problem.  This is on Windows, but I doubt that\n> makes a difference.\n>\n> Duncan Murdoch\n>\n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n>\n\n-- \nBrian D. Ripley,                  ripley@stats.ox.ac.uk\nProfessor of Applied Statistics,  http://www.stats.ox.ac.uk/~ripley/\nUniversity of Oxford,             Tel:  +44 1865 272861 (self)\n1 South Parks Road,                     +44 1865 272866 (PA)\nOxford OX1 3TG, UK                Fax:  +44 1865 272595\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}