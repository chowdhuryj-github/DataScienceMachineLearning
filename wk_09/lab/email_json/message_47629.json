{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jpeach@samba.org", "subject": "svn commit: samba r23479 - in branches/SAMBA_3_0_26/source: .", "body": "Author: jpeach\nDate: 2007-06-14 03:59:44 +0000 (Thu, 14 Jun 2007)\nNew Revision: 23479\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23479\n\nLog:\nMerge branches/SAMBA_3_0@23478\n\nChange the handling of the developer CFLAGS so that they are always\nemited to the Makefile in the DEVELOPER_CFLAGS variable. This makes\nit easy to turn developer mode on and off without waiting for\nconfigure to run. The developer flags are only added to CFLAGS for\nthe --enable-developer and --enable-krb5developer cases.\n\nModified:\n   branches/SAMBA_3_0_26/source/Makefile.in\n   branches/SAMBA_3_0_26/source/configure.in\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/Makefile.in\n===================================================================\n--- branches/SAMBA_3_0_26/source/Makefile.in\t2007-06-14 03:38:43 UTC (rev 23478)\n+++ branches/SAMBA_3_0_26/source/Makefile.in\t2007-06-14 03:59:44 UTC (rev 23479)\n@@ -20,8 +20,14 @@\n LIBS=@LIBS@\n CC=@CC@\n SHLD=@SHLD@\n+\n+# Add $(DEVELOPER_CFLAGS) to $(CFLAGS) to enable extra compiler\n+# (GCC) warnings. This is done automtically for --enable-developer\n+# and --enable-krb5developer.\n+DEVELOPER_CFLAGS=@DEVELOPER_CFLAGS@\n CFLAGS=@CFLAGS@\n CPPFLAGS=-DHAVE_CONFIG_H @CPPFLAGS@\n+\n EXEEXT=@EXEEXT@\n LDFLAGS=@PIE_LDFLAGS@ @LDFLAGS@\n AR=@AR@\n\nModified: branches/SAMBA_3_0_26/source/configure.in\n===================================================================\n--- branches/SAMBA_3_0_26/source/configure.in\t2007-06-14 03:38:43 UTC (rev 23478)\n+++ branches/SAMBA_3_0_26/source/configure.in\t2007-06-14 03:59:44 UTC (rev 23479)\n@@ -405,7 +405,19 @@\n AC_ARG_ENABLE(developer, [  --enable-developer      Turn on developer warnings and debugging (default=no)],\n     [if eval \"test x$enable_developer = xyes\"; then\n         developer=yes\n-    \tCFLAGS=\"${CFLAGS} -gstabs -Wall -Wshadow -Wstrict-prototypes -Wpointer-arith -Wcast-align -Wwrite-strings -DDEBUG_PASSWORD -DDEVELOPER\"\n+    fi])\n+\n+AC_ARG_ENABLE(krb5developer, [  --enable-krb5developer  Turn on developer warnings and debugging, except -Wstrict-prototypes (default=no)],\n+    [if eval \"test x$enable_krb5developer = xyes\"; then\n+        developer=yes\n+\tkrb5_developer=yes\n+    fi])\n+\n+# Probe the gcc version for extra CFLAGS. We always stash these in\n+# DEVELOPER_CFLAGS, so that you can turn them on and off with a simple\n+# Makefile edit, avoiding the need to re-run configure.\n+if test x\"$ac_cv_prog_gcc\" = x\"yes\" ; then\n+    \tDEVELOPER_CFLAGS=\"-gstabs -Wall -Wshadow -Wpointer-arith -Wcast-align -Wwrite-strings -DDEBUG_PASSWORD -DDEVELOPER\"\n \t# Add -Wdeclaration-after-statement if compiler supports it\n \tAC_CACHE_CHECK(\n           [that the C compiler understands -Wdeclaration-after-statement],\n@@ -419,16 +431,34 @@\n \t    samba_cv_HAVE_Wdeclaration_after_statement=no,\n \t    samba_cv_HAVE_Wdeclaration_after_statement=cross)\n        ])\n-       if test x\"$samba_cv_HAVE_Wdeclaration_after_statement\" = x\"yes\"; then\n-\t    CFLAGS=\"${CFLAGS} -Wdeclaration-after-statement\"\n+\n+\tif test x\"$samba_cv_HAVE_Wdeclaration_after_statement\" = x\"yes\"; then\n+\t    DEVELOPER_CFLAGS=\"${DEVELOPER_CFLAGS} -Wdeclaration-after-statement\"\n+\tfi\n+\n+\t#-Werror-implicit-function-declaration\n+\tAC_CACHE_CHECK(\n+          [that the C compiler understands -Werror-implicit-function-declaration],\n+          samba_cv_HAVE_Werror_implicit_function_declaration, [\n+\t  AC_TRY_RUN_STRICT([\n+\t    int main(void)\n+\t    {\n+\t    \treturn 0;\n+\t    }],[-Werror-implicit-function-declaration],[$CPPFLAGS],[$LDFLAGS],\n+\t    samba_cv_HAVE_Werror_implicit_function_declaration=yes,\n+\t    samba_cv_HAVE_Werror_implicit_function_declaration=no,\n+\t    samba_cv_HAVE_Werror_implicit_function_declaration=cross)\n+       ])\n+       if test x\"$samba_cv_HAVE_Werror_implicit_function_declaration\" = x\"yes\"; then\n+\t    DEVELOPER_CFLAGS=\"${DEVELOPER_CFLAGS} -Werror-implicit-function-declaration\"\n        fi\n-    fi])\n \n-AC_ARG_ENABLE(krb5developer, [  --enable-krb5developer  Turn on developer warnings and debugging, except -Wstrict-prototypes (default=no)],\n-    [if eval \"test x$enable_krb5developer = xyes\"; then\n-        developer=yes\n-\tCFLAGS=\"${CFLAGS} -gstabs -Wall -Wshadow -Wpointer-arith -Wcast-qual -Wcast-align -Wwrite-strings -DDEBUG_PASSWORD -DDEVELOPER\"\n-    fi])\n+\t# krb5developer is like developer, except we don't get\n+\t# -Wstrict-prototypes.\n+       if test x\"$krb5_developer\" ~= x\"$yes\" ; then\n+\t    DEVELOPER_CFLAGS=\"$DEVELOPER_CFLAGS -Wstrict-prototypes\"\n+       fi\n+fi\n \n AC_ARG_ENABLE(dmalloc, [  --enable-dmalloc        Enable heap debugging [default=no]])\n \n@@ -6319,6 +6349,12 @@\n \t   AC_MSG_ERROR([summary failure. Aborting config]); exit 1;,\n \t   AC_MSG_WARN([cannot run when cross-compiling]))\n \n+dnl Merge in developer cflags from now on\n+AC_SUBST(DEVELOPER_CFLAGS)\n+if test x\"$krb5_developer\" = x\"yes\" -o x\"$developer\" = x\"yes\"; then\n+    CFLAGS=\"${CFLAGS} \\$(DEVELOPER_CFLAGS)\"\n+fi\n+\n builddir=`pwd`\n AC_SUBST(builddir)\n \n\n"}