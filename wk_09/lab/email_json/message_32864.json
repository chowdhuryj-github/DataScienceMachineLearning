{"category": "ham", "to_address": "Jeremy Allison <jra@samba.org>", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: posix locking and the brlock database", "body": "On Sat, May 19, 2007 at 11:23:45AM -0700, Jeremy Allison wrote:\n> On Sat, May 19, 2007 at 07:43:53PM +1000, tridge@samba.org wrote:\n> > \n> > While the file is locked, a windows client tries to get the lock. It\n> > will check the posix lock in brlock.c, and see that it can't get the\n> > lock, so it puts in a pending lock entry in the brlock.tdb record for\n> > that file.\n> > \n> > Then the NFS client or local unix application releases the byte range\n> > lock. What triggers the retry of the pending lock? We don't get any\n> > notification from the kernel, and we don't retry internally.\n> \n> Ah, phew. You had me worried there :-). Yes we do retry internally,\n> just not as often as we used to :-).\n\nActually, whilst porting my patch to SAMBA_3_0 I noticed\nthis wasn't being done correctly in that branch due to\nthe blocking timeouts being done entirely by events.\n\nThe patch I'm checking in will fix this with a 10sec\ntimeout for both the SAMBA_3_0 event based code and\nthe SAMBA_3_0_25/26 select based code.\n\nJeremy.\n\n"}