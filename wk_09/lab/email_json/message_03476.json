{"category": "ham", "to_address": "ron@rblasch.org", "from_address": "\"jerry gay\" <jerry.gay@gmail.com>", "subject": "Re: [Proposed PATCH] Change libparrot Names and Locations", "body": "On 4/12/07, Ron Blaschke  wrote:\n> Attached is a proposed patch to change the libparrot names and locations\n> for Windows.  I have tested the changes for \"core\" Parrot on Win32\n> Visual C++, Cygwin GCC, MinGW GCC and Ubuntu GCC.\n\n>\nthis looks fabulous. thank you for providing your strategy, and the\ndetailed references. however, there are some minor problems.\n\n> There are some test failures, but I don't think they are related to the\n> changes.\n\n>\ni agree, failures related to this patch would likely look much different.\n\ni've put my comments inline with the patch data below.\n~jerry\n\n\n> Index: ext/Parrot-Embed/Build.PL\n> ===================================================================\n> --- ext/Parrot-Embed/Build.PL   (revision 18140)\n> +++ ext/Parrot-Embed/Build.PL   (working copy)\n> @@ -118,7 +118,7 @@\n>         }\n>\n>      $vars{Cflags} .= ' -I' . catdir( ($updir) x 2, 'include' );\n> -    $vars{Libs}   .= $^O =~ /Win32/ ? ' ..\\..\\libparrot.lib' : \" -L$libp\";\n> +    $vars{Libs}   .= $^O =~ /Win32/ ? ' ..\\..\\parrot.lib' : \" -L$libp\";\n>\n>         return @vars{qw( Cflags Libs )};\n>  }\n> Index: tools/build/ln_rel_sf.pl\n> ===================================================================\n> --- tools/build/ln_rel_sf.pl    (revision 0)\n> +++ tools/build/ln_rel_sf.pl    (revision 0)\n> @@ -0,0 +1,67 @@\n> +#!perl\n> +\n> +use strict;\n> +use warnings;\n> +\n> +use File::Spec;\n> +use File::Basename;\n> +\n> +sub usage {\n> +    my ($arg) = @_;\n> +    print \"Missing argument: $arg\\n\";\n> +    print \"usage: ln_rel_sf  \\n\";\n> +    print \"    target  existing destination of link\\n\";\n> +    print \"    source  link source to be created\\n\";\n> +\n> +    exit 1;\n> +}\n> +\n> +my ($target, $source) = @ARGV;\n> +\n> +if (!defined $target) {\n> +    usage('target');\n> +}\n> +\n> +if (!defined $source) {\n> +    usage('source');\n> +}\n> +\n> +\nthe above logic misses the case where there are too many arguments.\ni notice you haven't provided tests, either--that's not a reason for\nrejection, just a note that we need to enter a CAGE ticket to write\nsome after applying this.\n\n> +my $link = File::Spec->abs2rel(\n> +               File::Spec->rel2abs($target),\n> +               dirname $target\n> +           );\n> +\n> +if (-e $source) {\n> +    unlink $source or die \"Can't delete $source: $!\";\n> +}\n> +\n> +exit !symlink $link, $source;\n> +\n> +\n> +# Copyright (C) 2007, The Perl Foundation.\n> +# $Id:$\n> +\n> +=head1 NAME\n> +\n> +tools/build/ln_rel_sf.pl - Makes a symbolic link\n> +\n> +=head1 SYNOPSIS\n> +\n> +    % perl tools/build/ln_rel_sf.pl target source\n> +\n> +=head1 DESCRIPTION\n> +\n> +Creates a symbolic link at F to point to F.  Note that\n> +F is the target path, not the link.  The link will be the relative\n> +path from source to target.\n> +\n> +=cut\n> +\n> +\n> +# Local Variables:\n> +#   mode: cperl\n> +#   cperl-indent-level: 4\n> +#   fill-column: 100\n> +# End:\n> +# vim: expandtab shiftwidth=4:\n>\n> Property changes on: tools\\build\\ln_rel_sf.pl\n> ___________________________________________________________________\n> Name: svn:eol-style\n>    + native\n>\n> Index: lib/Parrot/IO/File.pm\n> ===================================================================\n> --- lib/Parrot/IO/File.pm       (revision 18140)\n> +++ lib/Parrot/IO/File.pm       (working copy)\n> @@ -248,7 +248,6 @@\n>      my $self = shift;\n>\n>      # CFLAGS\n> -    # libparrot.def\n>      # Makefile\n>      # myconfig\n>\n> @@ -264,7 +263,7 @@\n>      return 1\n>          if $self->suffix =~ /^(?:dump|html|flag|o)$/o\n>          or $self->name =~\n> -/^(?:perl6-config|libparrot.def|CFLAGS|myconfig|(?:core_pmcs|exec_(?:cpu|dep)|fingerprint|jit_(?:cpu|emit)|nci|platform(?:_interface)?)\\.[ch]|(?:charclass|feature)\\.h)$/o\n> +/^(?:perl6-config|CFLAGS|myconfig|(?:core_pmcs|exec_(?:cpu|dep)|fingerprint|jit_(?:cpu|emit)|nci|platform(?:_interface)?)\\.[ch]|(?:charclass|feature)\\.h)$/o\n>          or $self->parent->name eq 'ops'\n>          and $self->suffix =~ /^(?:c|pod)$/;\n>\n> Index: config/init/defaults.pm\n> ===================================================================\n> --- config/init/defaults.pm     (revision 18140)\n> +++ config/init/defaults.pm     (working copy)\n> @@ -119,11 +119,11 @@\n>          sym_import => '',\n>\n>          # Library build directory\n> -        blib_dir => 'blib/lib',\n> +        blib_dir => File::Spec->catdir('blib', 'lib'),\n>\n>          # libparrot library names\n> -        libparrot_static => 'libparrot' . $Config{_a},\n> -        libparrot_shared => 'libparrot.' . $Config{so},\n> +        libparrot_static => File::Spec->catfile('blib', 'lib', 'libparrot'  . $Config{_a}),\n> +        libparrot_shared => File::Spec->catfile('blib', 'lib', 'libparrot.' . $Config{so}),\n>\n>          # does the system know about static/dynamic linking?\n>          has_static_linking  => 1,\n> Index: config/init/hints/freebsd.pm\n> ===================================================================\n> --- config/init/hints/freebsd.pm        (revision 18140)\n> +++ config/init/hints/freebsd.pm        (working copy)\n> @@ -6,6 +6,8 @@\n>  use strict;\n>  use warnings;\n>\n> +use File::Spec;\n> +\n>  sub runstep {\n>      my ( $self, $conf ) = @_;\n>\n> @@ -28,6 +30,8 @@\n>\n>      $libs .= ' -pthread';\n>\n> +    my $blib_dir = $conf->data->get('blib_dir');\n> +\n>      $conf->data->set(\n>          libs  => $libs,\n>          link  => 'g++',\n> @@ -35,8 +39,8 @@\n>\n>          has_dynamic_linking    => 1,\n>          parrot_is_shared       => 1,\n> -        libparrot_shared       => 'libparrot$(SHARE_EXT).$(SOVERSION)',\n> -        libparrot_shared_alias => 'libparrot$(SHARE_EXT)',\n> +        libparrot_shared       => File::Spec->catfile($blib_dir, 'libparrot$(SHARE_EXT).$(SOVERSION)'),\n> +        libparrot_shared_alias => File::Spec->catfile($blib_dir, 'libparrot$(SHARE_EXT)'),\n>          libparrot_soname       => '-Wl,-soname=libparrot$(SHARE_EXT).$(SOVERSION)',\n>      );\n>  }\n> Index: config/init/hints/darwin.pm\n> ===================================================================\n> --- config/init/hints/darwin.pm (revision 18140)\n> +++ config/init/hints/darwin.pm (working copy)\n> @@ -6,6 +6,8 @@\n>  use strict;\n>  use warnings;\n>\n> +use File::Spec;\n> +\n>  sub runstep {\n>      my ( $self, $conf ) = @_;\n>\n> @@ -27,6 +29,8 @@\n>      $ldflags =~ s/-flat_namespace\\s*//;\n>      $ldflags .= \" -flat_namespace \";\n>\n> +    my $blib_dir = $conf->data->get('blib_dir');\n> +\n>      $conf->data->set(\n>          darwin              => 1,\n>          ccflags             => $ccflags,\n> @@ -45,8 +49,8 @@\n>          # XXX when built against a dynamic libparrot installable_parrot records\n>          # the path to the blib version of the library\n>          parrot_is_shared       => 0,\n> -        libparrot_shared       => 'libparrot.$(SOVERSION)$(SHARE_EXT)',\n> -        libparrot_shared_alias => 'libparrot$(SHARE_EXT)',\n> +        libparrot_shared       => File::Spec->catfile($blib_dir, 'libparrot.$(SOVERSION)$(SHARE_EXT)'),\n> +        libparrot_shared_alias => File::Spec->catfile($blib_dir, 'libparrot$(SHARE_EXT)'),\n>\n>          # This variable needs renaming to be more general\n>          # XXX ugly hack for rpath_lib in config/inter/libparrot.pm\n> Index: config/init/hints/linux.pm\n> ===================================================================\n> --- config/init/hints/linux.pm  (revision 18140)\n> +++ config/init/hints/linux.pm  (working copy)\n> @@ -7,6 +7,7 @@\n>  use warnings;\n>\n>  use Config;\n> +use File::Spec;\n>\n>  sub runstep {\n>      my ( $self, $conf ) = @_;\n> @@ -71,6 +72,9 @@\n>          $cflags .= ' -D_GNU_SOURCE';\n>      }\n>\n> +\n> +    my $blib_dir = $conf->data->get('blib_dir');\n> +\n>      $conf->data->set(\n>          ccflags        => $cflags,\n>          libs           => $libs,\n> @@ -84,8 +88,8 @@\n>\n>          has_dynamic_linking    => 1,\n>          parrot_is_shared       => 1,\n> -        libparrot_shared       => 'libparrot$(SHARE_EXT).$(SOVERSION)',\n> -        libparrot_shared_alias => 'libparrot$(SHARE_EXT)',\n> +        libparrot_shared       => File::Spec->catfile($blib_dir, 'libparrot$(SHARE_EXT).$(SOVERSION)'),\n> +        libparrot_shared_alias => File::Spec->catfile($blib_dir, 'libparrot$(SHARE_EXT)'),\n>          libparrot_soname       => '-Wl,-soname=libparrot$(SHARE_EXT).$(SOVERSION)',\n>      );\n>\n> Index: config/init/hints/cygwin.pm\n> ===================================================================\n> --- config/init/hints/cygwin.pm (revision 18140)\n> +++ config/init/hints/cygwin.pm (working copy)\n> @@ -17,6 +17,10 @@\n>      my $build_dir = $conf->data->get('build_dir');\n>      $build_dir =~ s/ /\\\\ /g;\n>\n> +    my $blib_dir = $conf->data->get('blib_dir');\n> +\n> +    my $dll_name_version = join '.', $conf->data->get(qw( MAJOR MINOR ));\n> +\n>      # A note about building shared libraries:  Perl5 uses the 'ld2' tool, which\n>      # is installed as part of the perl5 installation.  So far, it appears\n>      # parrot can get by with simply using gcc -shared, so we override the\n> @@ -24,16 +28,19 @@\n>      # If this later causes problems, it might be worth revisiting.\n>      # A. Spieherty 9/9/2002\n>      $conf->data->set(\n> -        build_dir           => $build_dir,\n> -        ld                  => 'gcc',\n> -        ld_share_flags      => '-shared',\n> -        ld_load_flags       => '-shared',\n> -        libs                => $libs,\n> -        has_static_linking  => 0,\n> -        has_dynamic_linking => 1,\n> -        parrot_is_shared    => 1,\n> -        sym_export          => '__declspec(dllexport)',\n> -        sym_import          => '__declspec(dllimport)'\n> +        build_dir              => $build_dir,\n> +        ld                     => 'gcc',\n> +        ld_share_flags         => '-shared -Wl,--export-all-symbols -Wl,--out-implib='\n> +                                    . File::Spec->catfile($blib_dir, 'libparrot.dll.a'),\n> +        ld_load_flags          => '-shared',\n> +        libs                   => $libs,\n> +        has_static_linking     => 1,\n> +        has_dynamic_linking    => 1,\n> +        parrot_is_shared       => 1,\n> +        libparrot_static       => File::Spec->catfile($blib_dir,  'libparrot.a'),\n> +        libparrot_shared       => File::Spec->catfile($build_dir, \"cygparrot$dll_name_version.dll\"),\n> +        sym_export             => '__declspec(dllexport)',\n> +        sym_import             => '__declspec(dllimport)'\n>      );\n>\n>      # inet_aton needs to be defined on Cygwin.\n> Index: config/init/hints/mswin32.pm\n> ===================================================================\n> --- config/init/hints/mswin32.pm        (revision 18140)\n> +++ config/init/hints/mswin32.pm        (working copy)\n> @@ -5,6 +5,8 @@\n>\n>  use strict;\n>  use warnings;\n> +\n> +use File::Spec;\n>  use Win32;\n>\n>  sub runstep {\n> @@ -35,6 +37,10 @@\n>          $conf->data->set( build_dir => Win32::GetShortPathName($build_dir) );\n>      }\n>\n> +    my $blib_dir = $conf->data->get('blib_dir');\n> +\n> +    my $dll_name_version = join '.', $conf->data->get(qw( MAJOR MINOR ));\n> +\n>      if ($is_msvc) {\n>\n>          # Check the output of cl.exe to see if it contains the\n> @@ -53,7 +59,7 @@\n>              o          => '.obj',\n>              cc_o_out   => '-Fo',\n>              cc_exe_out => '-out:',\n> -            cc_ldflags => '/link',\n> +            cc_ldflags => '-link',\n>\n>              make_c => q{$(PERL) -e \"chdir shift @ARGV;}\n>                  . q{system '$(MAKE)', '-nologo', @ARGV; exit $$? >> 8;\"},\n> @@ -62,16 +68,15 @@\n>              # ZI messes with __LINE__\n>              cc_debug            => '-Zi',\n>              ld_debug            => '-debug',\n> -            ld_share_flags      => '-dll',\n> +            ld_share_flags      => '-dll -implib:' . File::Spec->catfile($blib_dir, 'parrot.lib'),\n>              ld_load_flags       => '-dll',\n>              ld_out              => '-out:',\n>              ldflags             => '-nologo -nodefaultlib',\n> -            libparrot_static    => 'libparrot' . $conf->data->get('a'),\n> -            libparrot_shared    => 'libparrot$(SHARE_EXT)',\n> +            libparrot_static    => File::Spec->catfile($blib_dir, 'libparrot' . $conf->data->get('a')),\n> +            libparrot_shared    => 'parrot' . $dll_name_version . '$(SHARE_EXT)',\n>              ar_flags            => '',\n>              ar_out              => '-out:',\n>              slash               => '\\\\',\n> -            blib_dir            => 'blib\\\\lib',\n>              ccflags             => $ccflags,\n>              ccwarn              => '',\n>              has_dynamic_linking => 1,\n> @@ -81,12 +86,18 @@\n>              sym_import => '__declspec(dllimport)'\n>          );\n>\n> -        # If we are building shared, need to include dynamic libparrot.lib, otherwise\n> +\n> +        # If we are building shared, need to include dynamic parrot.lib, otherwise\n>          # the static libparrot.lib.\nthis code section and this comment in particular interests me. it\nshows me that the name of the dynamic lib is different than the static\nlib. this reminds me of some time ago when static/dynamic builds of\nparrot were overhauled, allowing either type to be built. i always\nwondered if we could build *both*. do you think this patch gets us\ncloser to building both static and dynamic parrot in the same build?\n\n>          if ( $conf->data->get('parrot_is_shared') ) {\n> -            $conf->data->set( libparrot_ldflags => 'libparrot$(A)' );\n> +            $conf->data->set( libparrot_ldflags => '-libpath:'\n> +                . File::Spec->rel2abs($blib_dir) . ' parrot.lib' );\n> +        } else {\n> +            $conf->data->set( libparrot_ldflags => '-libpath:'\n> +                . File::Spec->rel2abs($blib_dir) . ' libparrot.lib' );\n>          }\n>\n> +\n>          # 'link' needs to be link.exe, not cl.exe.\n>          # This makes 'link' and 'ld' the same.\n>          $conf->data->set( link => $conf->data->get('ld') );\n> @@ -201,13 +212,17 @@\n>          else {\n>              warn \"unknown configuration\";\n>          }\n> +\n> +        my $build_dir = $conf->data->get('build_dir');\n>\n>          $conf->data->set(\n>              parrot_is_shared    => 1,\n>              has_dynamic_linking => 1,\n>              ld_load_flags       => '-shared ',\n> -            ld_share_flags      => '-shared ',\n> -            libparrot_ldflags   => $conf->data->get('build_dir') . '/libparrot.dll',\n> +            ld_share_flags      => '-shared -Wl,--out-implib='\n> +                                    . File::Spec->catfile($blib_dir, 'libparrot.dll.a'),\n> +            libparrot_static    => File::Spec->catfile($blib_dir,  'libparrot' . $conf->data->get('a')),\n> +            libparrot_shared    => File::Spec->catfile($build_dir, \"parrot$dll_name_version.dll\"),\n>              ncilib_link_extra   => 'src/libnci_test.def',\n>              sym_export          => '__declspec(dllexport)',\n>              sym_import          => '__declspec(dllimport)',\n> Index: config/gen/makefiles/root.in\n> ===================================================================\n> --- config/gen/makefiles/root.in        (revision 18140)\n> +++ config/gen/makefiles/root.in        (working copy)\n> @@ -518,10 +518,9 @@\n>  INSTALLABLEPDB      = $(CUR_DIR)/installable_pdb$(EXE)\n>\n>  # Libraries\n> -LIBPARROT_STATIC    = @blib_dir@/@libparrot_static@\n> +LIBPARROT_STATIC    = @libparrot_static@\n>  #CONDITIONED_LINE(darwin):export DYLD_LIBRARY_PATH := @blib_dir@:$(DYLD_LIBRARY_PATH)\n> -#CONDITIONED_LINE(win32):LIBPARROT_SHARED  = @libparrot_shared@\n> -#INVERSE_CONDITIONED_LINE(win32):LIBPARROT_SHARED  = @blib_dir@/@libparrot_shared@\n> +LIBPARROT_SHARED  = @libparrot_shared@\n>\n>  # This line controls whether a static or shared library is built\n>  LIBPARROT           = @libparrot@\n> @@ -764,22 +763,23 @@\n>      lib/Parrot/OpLib/core.pm $(SRC_DIR)/parrot_config$(O) \\\n>      $(MINIPARROT)\n>         $(LINK) @ld_out@$@ \\\n> -    $(IMCC_DIR)/main$(O) @rpath_blib@ $(ALL_PARROT_LIBS) $(LINKFLAGS) $(LINK_DYNAMIC) \\\n> -    $(SRC_DIR)/parrot_config$(O)\n> +    $(IMCC_DIR)/main$(O) $(SRC_DIR)/parrot_config$(O) \\\n> +    @rpath_blib@ $(ALL_PARROT_LIBS) $(LINKFLAGS) $(LINK_DYNAMIC)\n> +\n>  #\n>  # TODO build the real miniparrot\n>  #\n>  $(MINIPARROT) : $(IMCC_DIR)/main$(O) $(GEN_HEADERS) $(LIBPARROT) \\\n>      lib/Parrot/OpLib/core.pm $(SRC_DIR)/null_config$(O)\n> -       $(LINK) @ld_out@$@ $(IMCC_DIR)/main$(O) \\\n> -    @rpath_blib@ $(ALL_PARROT_LIBS) $(LINKFLAGS) $(SRC_DIR)/null_config$(O)\n> +       $(LINK) @ld_out@$@ $(IMCC_DIR)/main$(O) $(SRC_DIR)/null_config$(O) \\\n> +    @rpath_blib@ $(ALL_PARROT_LIBS) $(LINKFLAGS)\n>\n>  $(INSTALLABLEPARROT) : $(IMCC_DIR)/main$(O) $(GEN_HEADERS) $(LIBPARROT) \\\n>      lib/Parrot/OpLib/core.pm $(SRC_DIR)/install_config$(O) \\\n>      $(PARROT)\n>         $(LINK) @ld_out@$@ \\\n> -    $(IMCC_DIR)/main$(O) \\\n> -    $(ALL_PARROT_LIBS) $(LINKFLAGS) $(SRC_DIR)/install_config$(O)\n> +    $(IMCC_DIR)/main$(O) $(SRC_DIR)/install_config$(O) \\\n> +    $(ALL_PARROT_LIBS) $(LINKFLAGS)\n>\n>  $(SRC_DIR)/parrot_config.c :  runtime/parrot/include/config.fpmc \\\n>      $(BUILD_TOOLS_DIR)/parrot_config_c.pl\n> @@ -834,7 +834,7 @@\n>         $(MKPATH) @blib_dir@\n>         $(LD) $(LD_SHARE_FLAGS) $(LDFLAGS) @ld_out@$@ @libparrot_soname@ \\\n>      $(O_FILES) $(C_LIBS) $(ICU_SHARED)\n> -#CONDITIONED_LINE(libparrot_shared_alias):     ( cd @blib_dir@ ; ln -sf @libparrot_shared@ @libparrot_shared_alias@ )\n> +#CONDITIONED_LINE(libparrot_shared_alias):     perl tools/build/ln_rel_sf.pl @libparrot_shared@ @libparrot_shared_alias@\n>\n>\n>  #\n> Index: config/gen/makefiles/dynpmc_pl.in\n> ===================================================================\n> --- config/gen/makefiles/dynpmc_pl.in   (revision 18140)\n> +++ config/gen/makefiles/dynpmc_pl.in   (working copy)\n> @@ -39,10 +39,6 @@\n>  if ($^O eq 'MSWin32') {\n>      # Paths need quoting as they may contain spaces.\n>      $PATHQUOTE = '\"';\n> -\n> -    unless ($CC =~ /gcc/i) {\n> -        $LIBPARROT = '@build_dir@/libparrot@a@';\n> -    }\n>  }\n>\n>  # PMC2C Config\n> @@ -94,7 +90,7 @@\n>          \"$LD \".\n>          '@ld_out@' . $target . \" \" .\n>          join(\" \", map {\"$PATHQUOTE$_$PATHQUOTE\"} @$sources) .\n> -        \" $liblist $LDFLAGS $LD_LOAD_FLAGS $PATHQUOTE$LIBPARROT$PATHQUOTE\";\n> +        \" $liblist $LDFLAGS $LD_LOAD_FLAGS $LIBPARROT\";\n>  }\n>\n>  our $NOW = time();\n> Index: config/gen/makefiles/dynoplibs_pl.in\n> ===================================================================\n> --- config/gen/makefiles/dynoplibs_pl.in        (revision 18140)\n> +++ config/gen/makefiles/dynoplibs_pl.in        (working copy)\n> @@ -39,10 +39,6 @@\n>  if ($^O eq 'MSWin32') {\n>      # Paths need quoting as they may contain spaces.\n>      $PATHQUOTE = q[\"];\n> -\n> -    unless ($CC =~ /gcc/i) {\n> -        $LIBPARROT = '@build_dir@/libparrot@a@';\n> -    }\n>  }\n>\n>  # OPS2C Config\n> @@ -93,7 +89,7 @@\n>          \"$LD \".\n>          \"@ld_out@\" . $target . \" \" .\n>          join(\" \", map {\"$PATHQUOTE$_$PATHQUOTE\"} @$sources) .\n> -        \" $liblist $LDFLAGS $LD_LOAD_FLAGS $PATHQUOTE$LIBPARROT$PATHQUOTE\";\n> +        \" $liblist $LDFLAGS $LD_LOAD_FLAGS $LIBPARROT\";\n>  }\n>\n>  our $NOW = time();\n> Index: config/gen/makefiles/parrot_embed.in\n> ===================================================================\n> --- config/gen/makefiles/parrot_embed.in        (revision 18140)\n> +++ config/gen/makefiles/parrot_embed.in        (working copy)\n> @@ -4,6 +4,7 @@\n>  use Cwd;\n>  use Config;\n>  use File::Copy;\n> +use File::Spec;\n>  use ExtUtils::MakeMaker;\n>\n>  copy( 'lib/Parrot/Embed.xs', 'Embed.xs' );\n> @@ -15,24 +16,16 @@\n>  $config{PARROT}          = '..@slash@..@slash@parrot@exe@';\n>  $config{C_LIBS}          = '@libs@';\n>  $config{INCLUDE}         = \"$config{PARROTDIR}/include\";\n> -#INVERSE_CONDITIONED_LINE(win32):$config{ALL_PARROT_LIBS} = \"@libparrot_ldflags@ $config{C_LIBS}\";\n> +$config{ALL_PARROT_LIBS} = \"@libparrot_ldflags@ $config{C_LIBS}\";\n>  $config{ABS_PARROTDIR}   = Cwd::realpath(\n>                                 File::Spec->rel2abs( $config{PARROTDIR} ) );\n>  $config{LDDLFLAGS}       = $Config{lddlflags};\n>\n> -if ($config{CC} eq 'cl')\n> -{\n> -    $config{LDDLFLAGS} .= qq| -libpath:\"$config{ABS_PARROTDIR} \"|\n> -        .  File::Spec->catfile( $config{ABS_PARROTDIR}, 'libparrot.lib' );\n> -}\n> -\n>  WriteMakefile(\n>      'NAME'         => 'Parrot::Embed',\n>      'VERSION_FROM' => 'lib/Parrot/Embed.pm',\n>      'PREREQ_PM'    => { 'ExtUtils::CBuilder' => 0 },\n> -#CONDITIONED_LINE(win32):    'LIBS'         => [ $config{C_LIBS} ],\n> -#CONDITIONED_LINE(win32):    'OBJECT'       => \"@libparrot_ldflags@ Embed@o@\",\n> -#INVERSE_CONDITIONED_LINE(win32):    'LIBS'         => [ $config{ALL_PARROT_LIBS} ],\n> +    'LIBS'         => [ $config{ALL_PARROT_LIBS} ],\n>      'INC'          => \"-I$config{INCLUDE}\",\n>      'PM'           => { map { $_ => \"blib/$_\" }  },\n>      'clean'        => { FILES => '*.xs t/greet.pbc' },\n>\n>\n\n"}