{"category": "ham", "to_address": "ted.harding@manchester.ac.uk, r-help@stat.math.ethz.ch", "from_address": "Stephen Tucker <brown_emu@yahoo.com>", "subject": "Re: [R] Tools For Preparing Data For Analysis", "body": "Embarrasingly, I don't know awk or sed but R's code seems to be\nshorter for most tasks than Python, which is my basis for comparison.\n\nIt's true that R's more powerful data structures usually aren't\nnecessary for the data cleaning, but sometimes in the filtering\nprocess I will pick out lines that contain certain data, in which case\nI have to convert text to numbers and perform operations like\nwhich.min(), order(), etc., so in that sense I like to have R's\nvectorized notation and the objects/functions that support it.\n\nAs far as some of the tasks you described, I've tried transcribing\nthem to R. I know you provided only the simplest examples, but even in\nthese cases I think R's functions for handling these situations\nexemplify their usefulness in this step of the analysis. But perhaps\nyou would argue that this code is too long... In any event it will\nstill save the trouble of keeping track of an extra (intermediate)\nfile passed between awk and R.\n\n(1) the numbers of fields in each line equivalent to \n>    cat datafile.csv | awk 'BEGIN{FS=\",\"}{n=NF;print n}'\nin awk\n\n# R equivalent:\nnFields <- count.fields(\"datafile.csv\",sep=\",\")\n# or \nnFields <- sapply(strsplit(readLines(\"datafile.csv\"),\",\"),length)\n\n(2) which lines have the wrong number of fields, and how many fields\nthey have. You can similarly count how many lines there are (e.g. pipe\ninto wc -l).\n\n# number of lines with wrong number of fields\nnWrongFields <- length(nFields[nFields > 10])\n\n# select only first ten fields from each line\n# and return a matrix\nfirstTenFields <- \n  do.call(rbind,\n          lapply(strsplit(readLines(\"datafile.csv\"),\",\"),\n                 function(x) x[1:10]))\n\n# select only those lines which contain ten fields\n# and return a matrix\nonlyTenFields <- \n  do.call(rbind,\n          lapply(strsplit(readLines(\"datafile.csv\"),\",\"),\n                 function(x) if(length(x) <= 10) x else NULL))\n\n(3)\n>    If for instance you try to\n>    read the following CSV into R as a dataframe:\n> \n>    1,2,.,4\n>    2,.,4,5\n>    3,4,.,6\n> \n\ntxtC <- textConnection(\n\"1,2,.,4\n2,.,4,5\n3,4,.,6\")\n# using read.csv() specifying na.string argument:\n> read.csv(txtC,header=FALSE,na.string=\".\")\n  V1 V2 V3 V4\n1  1  2 NA  4\n2  2 NA  4  5\n3  3  4 NA  6\n\n# Of course, read.csv will work only if data is formatted correctly.\n# More generally, using readLines(), strsplit(), etc., which are more\n# flexible :\n\n> do.call(rbind,\n+         lapply(strsplit(readLines(txtC),\",\"),\n+                type.convert,na.string=\".\"))\n     [,1] [,2] [,3] [,4]\n[1,]    1    2   NA    4\n[2,]    2   NA    4    5\n[3,]    3    4   NA    6\n\n(4) Situations where people mix \",,\" and \",.,\"!\n\n# type.convert (and read.csv) will still work when missing values are \",,\"\n# and \",.,\" (automatically recognizes \"\" as NA and through\n# specification of 'na.string', can recognize \".\" as NA)\n\n# If it is desired to convert \".\" to \"\" first, this is simple as\n# well:\n\nm <- do.call(rbind,\n        lapply(strsplit(readLines(txtC),\",\"),\n               function(x) gsub(\"^\\\\.$\",\"\",x)))\n> m\n     [,1] [,2] [,3] [,4]\n[1,] \"1\"  \"2\"  \"\"   \"4\" \n[2,] \"2\"  \"\"   \"4\"  \"5\" \n[3,] \"3\"  \"4\"  \"\"   \"6\" \n\n# then\nmode(m) <- \"numeric\"\n# or\nm <- apply(m,2,type.convert)\n# will give\n> m\n     [,1] [,2] [,3] [,4]\n[1,]    1    2   NA    4\n[2,]    2   NA    4    5\n[3,]    3    4   NA    6\n\n\n--- Ted.Harding@manchester.ac.uk wrote:\n\n> On 10-Jun-07 19:27:50, Stephen Tucker wrote:\n> > \n> > Since R is supposed to be a complete programming language,\n> > I wonder why these tools couldn't be implemented in R\n> > (unless speed is the issue). Of course, it's a naive desire\n> > to have a single language that does everything, but it seems\n> > that R currently has most of the functions necessary to do\n> > the type of data cleaning described.\n> \n> In principle that is certainly true. A couple of comments,\n> though.\n> \n> 1. R's rich data structures are likely to be superfluous.\n>    Mostly, at the sanitisation stage, one is working with\n>    \"flat\" files (row & column). This straightforward format\n>    is often easier to handle using simple programs for the\n>    kind of basic filtering needed, rather then getting into\n>    the heavier programming constructs of R.\n> \n> 2. As follow-on and contrast at the same time, very often\n>    what should be a nice flat file with no rough edges is not.\n>    If there are variable numbers of fields per line, R will\n>    not handle it straightforwardly (you can force it in,\n>    but it's more elaborate). There are related issues as well.\n> \n> a) If someone entering data into an Excel table lets their\n>    cursor wander outside the row/col range of the table,\n>    this can cause invisible entities to be planted in the\n>    extraneous cells. When saved as a CSV, this file then\n>    has variable numbers of fields per line, and possibly\n>    also extra lines with arbitrary blank fields.\n> \n>    cat datafile.csv | awk 'BEGIN{FS=\",\"}{n=NF;print n}'\n> \n>    will give you the numbers of fields in each line.\n> \n>    If you further pipe it into | sort -nu you will get\n>    the distinct field-numbers. If you know (by now) how many\n>    fields there should be (e.g. 10), then\n> \n>    cat datafile.csv | awk 'BEGIN{FS=\",\"} (NF != 10){print NR \", \" NF}'\n> \n>    will tell you which lines have the wrong number of fields,\n>    and how many fields they have. You can similarly count how\n>    many lines there are (e.g. pipe into wc -l).\n> \n> b) Poeple sometimes randomly use a blank space or a \".\" in a\n>    cell to demote a missing value. Consistent use of either\n>    is OK: \",,\" in a CSV will be treated as \"NA\" by R. The use\n>    of \".\" can be more problematic. If for instance you try to\n>    read the following CSV into R as a dataframe:\n> \n>    1,2,.,4\n>    2,.,4,5\n>    3,4,.,6\n> \n>    the \".\" in cols 2 and 3 is treated as the character \".\",\n>    with the result that something complicated happens to\n>    the typing of the items.\n> \n>    typeeof(D[i,j]) is always integer. sum(D[1,1]=1, but\n>    sum(D[1,2]) gives a type-error, even though the entry\n>    is in fact 2. And so on , in various combinations.\n> \n>    And (as.nmatrix(D)) is of course a matrix of characters.\n> \n>    In fact, columns 2 and 3 of D are treated as factors!\n> \n>    for(i in (1:3)){ for(j in (1:4)){ print( (D[i,j]))}}\n>    [1] 1\n>    [1] 2\n>    Levels: . 2 4\n>    [1] .\n>    Levels: . 4\n>    [1] 4\n>    [1] 2\n>    [1] .\n>    Levels: . 2 4\n>    [1] 4\n>    Levels: . 4\n>    [1] 5\n>    [1] 3\n>    [1] 4\n>    Levels: . 2 4\n>    [1] .\n>    Levels: . 4\n>    [1] 6\n> \n>    This is getting altogether too complicated for the job\n>    one wants to do!\n> \n>    And it gets worse when people mix \",,\" and \",.,\"!\n> \n>    On the other hand, a simple brush with awk (or sed in\n>    this case) can sort it once and for all, without waking\n>    the sleeping dogs in R.\n> \n> I could go on. R undoubtedly has the power, but it can very\n> quickly get over-complicated for simple jobs.\n> \n> Best wishes to all,\n> Ted.\n> \n> --------------------------------------------------------------------\n> E-Mail: (Ted Harding) \n> Fax-to-email: +44 (0)870 094 0861\n> Date: 10-Jun-07                                       Time: 22:14:35\n> ------------------------------ XFMail ------------------------------\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide\n> http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n> \n\n\n\n       \n____________________________________________________________________________________\nPinpoint customers who are looking for what you sell.\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}