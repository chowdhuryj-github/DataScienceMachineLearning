{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 283: report number of frozen/thawed nodes in\n\thttp://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 283\nrevision-id: tridge@samba.org-20070512054456-hq4sgzwco9ovtb0x\nparent: tridge@samba.org-20070512054435-rqvdnu9lqvzlf3s1\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Sat 2007-05-12 15:44:56 +1000\nmessage:\n  report number of frozen/thawed nodes\nmodified:\n  tools/ctdb_control.c           ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1\n=== modified file 'tools/ctdb_control.c'\n--- a/tools/ctdb_control.c\t2007-05-12 05:15:27 +0000\n+++ b/tools/ctdb_control.c\t2007-05-12 05:44:56 +0000\n@@ -806,7 +806,7 @@\n  */\n static int control_freeze(struct ctdb_context *ctdb, int argc, const char **argv)\n {\n-\tint ret=0;\n+\tint ret=0, count=0;\n \tuint32_t vnn, i;\n \tuint32_t *nodes;\n \tuint32_t num_nodes;\n@@ -830,9 +830,12 @@\n \t\tint res = ctdb_ctrl_freeze(ctdb, timeval_current_ofs(5, 0), nodes[i]);\n \t\tif (res != 0) {\n \t\t\tprintf(\"Warning: Unable to freeze node %u\\n\", nodes[i]);\n+\t\t} else {\n+\t\t\tcount++;\n \t\t}\n \t\tret |= res;\n \t}\n+\tprintf(\"Froze %u nodes\\n\", count);\n \ttalloc_free(nodes);\n \treturn 0;\n }\n@@ -842,7 +845,7 @@\n  */\n static int control_thaw(struct ctdb_context *ctdb, int argc, const char **argv)\n {\n-\tint ret=0;\n+\tint ret=0, count=0;\n \tuint32_t vnn, i;\n \tuint32_t *nodes;\n \tuint32_t num_nodes;\n@@ -866,9 +869,12 @@\n \t\tint res = ctdb_ctrl_thaw(ctdb, timeval_current_ofs(5, 0), nodes[i]);\n \t\tif (res != 0) {\n \t\t\tprintf(\"Warning: Unable to thaw node %u\\n\", nodes[i]);\n+\t\t} else {\n+\t\t\tcount++;\n \t\t}\n \t\tret |= res;\n \t}\n+\tprintf(\"Thawed %u nodes\\n\", count);\n \ttalloc_free(nodes);\n \treturn 0;\n }\n\n"}