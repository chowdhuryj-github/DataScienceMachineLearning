{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "Michael Adam <ma@sernet.de>", "subject": "Rev 5382: merge from upstream in\n\thttp://samba.sernet.de/ma/bzr/SAMBA_3_0-registry.bzr/", "body": "At http://samba.sernet.de/ma/bzr/SAMBA_3_0-registry.bzr/\n\n------------------------------------------------------------\nrevno: 5382\nrevision-id: ma@sernet.de-20070620084939-3tnfwiq5o8uicrf4\nparent: ma@sernet.de-20070619095401-4h1nq927seojlqmt\nparent: jra@samba.org-20070620013143-3sumaujvv7mri3po\ncommitter: Michael Adam \nbranch nick: SAMBA_3_0-registry.bzr\ntimestamp: Wed 2007-06-20 10:49:39 +0200\nmessage:\n  merge from upstream\nmodified:\n  REVISION                       REVISION-20060530022625-68239662668b41c3\n  source/lib/errmap_unix.c       errmap_unix.c-20070529202201-h7olgulww7h3tzz1-1\n  source/param/loadparm.c        loadparm.c-20060530022627-1efa1edb3eb0e897\n  source/utils/net_conf.c        net_conf.c-20070409110216-64p0zt0mes4j6yoe-1\n    ------------------------------------------------------------\n    revno: 5275.1.899\n    merged: jra@samba.org-20070620013143-3sumaujvv7mri3po\n    parent: obnox@samba.org-20070619214619-l3rwrt1urx2ktvv1\n    committer: jra@samba.org\n    branch nick: SAMBA_3_0.bzr\n    timestamp: Tue 2007-06-19 20:31:43 -0500\n    message:\n      jra@samba.org (r23550)  2007-06-19 20:26:18 -0500 (Tue, 19 Jun 2007)\n          \n          Add more UNIX error -> NT status mappings.\n          Jeremy.\n          \n    ------------------------------------------------------------\n    revno: 5275.1.898\n    merged: obnox@samba.org-20070619214619-l3rwrt1urx2ktvv1\n    parent: obnox@samba.org-20070619211557-a944onvd0qjxw15i\n    committer: obnox@samba.org\n    branch nick: SAMBA_3_0.bzr\n    timestamp: Tue 2007-06-19 16:46:19 -0500\n    message:\n      obnox@samba.org (r23549)  2007-06-19 16:40:27 -0500 (Tue, 19 Jun 2007)\n          \n          Make \"net conf setparm\" always use registry data type \"sz\".\n          This simplifies the usage of this command from\n          \"net conf setparm    \"\n          to\n          \"net conf setparm   \".\n          \n          Micheal\n          \n          \n    ------------------------------------------------------------\n    revno: 5275.1.897\n    merged: obnox@samba.org-20070619211557-a944onvd0qjxw15i\n    parent: obnox@samba.org-20070619211553-keb4z21va0bmvk9n\n    committer: obnox@samba.org\n    branch nick: SAMBA_3_0.bzr\n    timestamp: Tue 2007-06-19 16:15:57 -0500\n    message:\n      obnox@samba.org (r23548)  2007-06-19 16:08:46 -0500 (Tue, 19 Jun 2007)\n          \n          Fix comments.\n          \n          Michael\n          \n          \n    ------------------------------------------------------------\n    revno: 5275.1.896\n    merged: obnox@samba.org-20070619211553-keb4z21va0bmvk9n\n    parent: obnox@samba.org-20070619111604-ze82g2i347tpwt7m\n    committer: obnox@samba.org\n    branch nick: SAMBA_3_0.bzr\n    timestamp: Tue 2007-06-19 16:15:53 -0500\n    message:\n      obnox@samba.org (r23547)  2007-06-19 16:06:31 -0500 (Tue, 19 Jun 2007)\n          \n          Ignore parameter \"include\" in regsitry globals.\n          \n          Michael\n          \n          \n    ------------------------------------------------------------\n    revno: 5275.1.895\n    merged: obnox@samba.org-20070619111604-ze82g2i347tpwt7m\n    parent: jpeach@samba.org-20070618161516-tu4uk4na2br24sq0\n    committer: obnox@samba.org\n    branch nick: SAMBA_3_0.bzr\n    timestamp: Tue 2007-06-19 06:16:04 -0500\n    message:\n      obnox@samba.org (r23543)  2007-06-19 06:11:01 -0500 (Tue, 19 Jun 2007)\n          \n          Adjust comments.\n          \n          \n=== modified file 'REVISION'\n--- a/REVISION\t2007-06-18 16:15:16 +0000\n+++ b/REVISION\t2007-06-20 01:31:43 +0000\n@@ -2,9 +2,9 @@\n URL: file:///home/drizzt/jerry/src/svn/samba/branches/SAMBA_3_0\n Repository Root: file:///home/drizzt/jerry/src/svn/samba\n Repository UUID: 0c0555d6-39d7-0310-84fc-f1cc0bd64818\n-Revision: 23541\n+Revision: 23550\n Node Kind: directory\n-Last Changed Author: jpeach\n-Last Changed Rev: 23541\n-Last Changed Date: 2007-06-18 11:10:00 -0500 (Mon, 18 Jun 2007)\n+Last Changed Author: jra\n+Last Changed Rev: 23550\n+Last Changed Date: 2007-06-19 20:26:18 -0500 (Tue, 19 Jun 2007)\n \n\n=== modified file 'source/lib/errmap_unix.c'\n--- a/source/lib/errmap_unix.c\t2007-05-29 20:22:03 +0000\n+++ b/source/lib/errmap_unix.c\t2007-06-20 01:31:43 +0000\n@@ -63,9 +63,34 @@\n \t{ ENOBUFS, ERRDOS, ERRnomem, NT_STATUS_INSUFFICIENT_RESOURCES },\n #endif\n \t{ EAGAIN, ERRDOS, 111, NT_STATUS_NETWORK_BUSY },\n+#ifdef EADDRINUSE\n+\t{ EADDRINUSE, ERRDOS, 52, NT_STATUS_ADDRESS_ALREADY_ASSOCIATED},\n+#endif\n+#ifdef ENETUNREACH\n+\t{ ENETUNREACH, ERRHRD, ERRgeneral, NT_STATUS_NETWORK_UNREACHABLE},\n+#endif\n+#ifdef EHOSTUNREACH\n+\t\t{ EHOSTUNREACH, ERRHRD, ERRgeneral, NT_STATUS_HOST_UNREACHABLE},\n+#endif\n+#ifdef ECONNREFUSED\n+\t{ ECONNREFUSED, ERRHRD, ERRgeneral, NT_STATUS_CONNECTION_REFUSED},\n+#endif\n+#ifdef ETIMEDOUT\n+\t{ ETIMEDOUT, ERRHRD, 121, NT_STATUS_IO_TIMEOUT},\n+#endif\n+#ifdef ECONNABORTED\n+\t{ ECONNABORTED, ERRHRD, ERRgeneral, NT_STATUS_CONNECTION_ABORTED},\n+#endif\n+#ifdef ENODEV\n+\t{ ENODEV, ERRDOS, 55, NT_STATUS_DEVICE_DOES_NOT_EXIST},\n+#endif\n+#ifdef EPIPE\n+\t{ EPIPE, ERRDOS, 109, NT_STATUS_PIPE_BROKEN},\n+#endif\n #ifdef EWOULDBLOCK\n \t{ EWOULDBLOCK, ERRDOS, 111, NT_STATUS_NETWORK_BUSY },\n #endif\n+\n \t{ 0, 0, 0, NT_STATUS_OK }\n };\n \n\n=== modified file 'source/param/loadparm.c'\n--- a/source/param/loadparm.c\t2007-06-19 09:54:01 +0000\n+++ b/source/param/loadparm.c\t2007-06-20 08:49:39 +0000\n@@ -3136,7 +3136,7 @@\n \t\t\t\t KEY_SMBCONF, GLOBAL_NAME);\n \tnormalize_dbkey(keystr);\n \n-\tDEBUG(10, (\"process_registry_shares: fetching key '%s'\\n\",\n+\tDEBUG(10, (\"process_registry_globals: fetching key '%s'\\n\",\n \t\t   keystr));\n \n \tdata = tdb_fetch_bystring(reg_tdb->tdb, keystr);\n@@ -3150,7 +3150,7 @@\n \n \t/* unpack number of values */\n \tlen = tdb_unpack(buf, buflen, \"d\", &num_values);\n-\tDEBUG(10, (\"process_registry_shares: got %d values from tdb\\n\",\n+\tDEBUG(10, (\"process_registry_globals: got %d values from tdb\\n\",\n \t\t   num_values));\n \n \t/* unpack the values */\n@@ -3163,7 +3163,12 @@\n \t\t\t\t  &type,\n \t\t\t\t  &size,\n \t\t\t\t  &data_p);\n-\t\tDEBUG(10, (\"process_registry_shares: got value '%s'\\n\",\n+\t\tif (strcmp(valname,\"include\")) {\n+\t\t\tDEBUG(10, (\"process_registry_globals: Ignoring \"\n+\t\t\t\t   \"parameter 'include' in registry.\\n\"));\n+\t\t\tcontinue;\n+\t\t}\n+\t\tDEBUG(10, (\"process_registry_globals: got value '%s'\\n\",\n \t\t\t   valname));\n \t\tif (size && data_p) {\n \t\t\terr = registry_pull_value(reg_tdb, \n\n=== modified file 'source/utils/net_conf.c'\n--- a/source/utils/net_conf.c\t2007-06-19 09:54:01 +0000\n+++ b/source/utils/net_conf.c\t2007-06-20 08:49:39 +0000\n@@ -20,19 +20,9 @@\n  */\n \n /*\n- * This currently only an interface to the configuration\n- * stored inside the samba registry. In the future there\n- * might be support for other configuration backends as well.\n- */\n-\n-/*\n- * TODO:\n- *\n- *  - check uid 0 for write operations\n- *  - check for valid parameter names and types (loadparm...) ???\n- *  - check for correctness of shares (service_ok) ?\n- *  - refactor to use _internal functions for pieces of code\n- *\n+ * This is an interface to the configuration stored inside the \n+ * samba registry. In the future there might be support for other \n+ * configuration backends as well.\n  */\n \n #include \"includes.h\"\n@@ -92,8 +82,7 @@\n \n static int net_conf_setparm_usage(int argc, const char **argv)\n {\n-\td_printf(\"USAGE: net conf setparm    \\n\"\n-\t\t \"\\t(Supported types are 'dword' and 'sz' by now.)\\n\");\n+\td_printf(\"USAGE: net conf setparm   \\n\");\n \treturn -1;\n }\n \n@@ -928,20 +917,18 @@\n \tstruct registry_key *key = NULL;\n \tchar *service = NULL;\n \tchar *param = NULL;\n-\tchar *type = NULL;\n \tconst char *value_str = NULL;\n \tTALLOC_CTX *ctx;\n \n \tctx = talloc_init(\"setparm\");\n \n-\tif (argc != 4) {\n+\tif (argc != 3) {\n \t\tnet_conf_setparm_usage(argc, argv);\n \t\tgoto done;\n \t}\n \tservice = strdup_lower(argv[0]);\n \tparam = strdup_lower(argv[1]);\n-\ttype = strdup_lower(argv[2]);\n-\tvalue_str = argv[3];\n+\tvalue_str = argv[2];\n \n \tif (!smbconf_key_exists(ctx, service)) {\n \t\twerr = reg_createkey_internal(ctx, service, &key);\n@@ -953,7 +940,7 @@\n \t\tgoto done;\n \t}\n \n-\twerr = reg_setvalue_internal(key, param, type, value_str);\n+\twerr = reg_setvalue_internal(key, param, \"sz\", value_str);\n \tif (!W_ERROR_IS_OK(werr)) {\n \t\td_fprintf(stderr, \"Error setting value '%s': %s\\n\",\n \t\t\t  param, dos_errstr(werr));\n\n"}