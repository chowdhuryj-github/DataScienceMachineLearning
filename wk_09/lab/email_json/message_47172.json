{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r23462 - in\n\tbranches/SAMBA_3_0_26/source/registry: .", "body": "Author: obnox\nDate: 2007-06-13 10:32:57 +0000 (Wed, 13 Jun 2007)\nNew Revision: 23462\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23462\n\nLog:\nMerge r20209 from 3_0:\n\nFix two memleaks.\n\n\nModified:\n   branches/SAMBA_3_0_26/source/registry/reg_eventlog.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0_26/source/registry/reg_eventlog.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/registry/reg_eventlog.c\t2007-06-13 10:15:48 UTC (rev 23461)\n+++ branches/SAMBA_3_0_26/source/registry/reg_eventlog.c\t2007-06-13 10:32:57 UTC (rev 23462)\n@@ -48,8 +48,10 @@\n \t\t}\n \t\tregdb_fetch_keys( KEY_EVENTLOG, subkeys );\n \t\tregsubkey_ctr_addkey( subkeys, *elogs );\n-\t\tif ( !regdb_store_keys( KEY_EVENTLOG, subkeys ) )\n+\t\tif ( !regdb_store_keys( KEY_EVENTLOG, subkeys ) ) {\n+\t\t\tTALLOC_FREE(subkeys);\n \t\t\treturn False;\n+\t\t}\n \t\tTALLOC_FREE( subkeys );\n \n \t\t/* add in the key of form KEY_EVENTLOG/Application */\n@@ -70,8 +72,10 @@\n \t\tregdb_fetch_keys( evtlogpath, subkeys );\n \t\tregsubkey_ctr_addkey( subkeys, *elogs );\n \n-\t\tif ( !regdb_store_keys( evtlogpath, subkeys ) )\n+\t\tif ( !regdb_store_keys( evtlogpath, subkeys ) ) {\n+\t\t\tTALLOC_FREE(subkeys);\n \t\t\treturn False;\n+\t\t}\n \t\tTALLOC_FREE( subkeys );\n \n \t\t/* now add the values to the KEY_EVENTLOG/Application form key */\n@@ -287,8 +291,7 @@\n \t\t\t sourcename ) );\n \t}\n \tTALLOC_FREE( values );\n-\tif ( wrklist )\n-\t\tTALLOC_FREE( wrklist );\t/*  */\n+\tTALLOC_FREE( wrklist );\t/*  */\n \n \tif ( !( subkeys = TALLOC_ZERO_P( NULL, REGSUBKEY_CTR ) ) ) {\n \t\tDEBUG( 0, ( \"talloc() failure!\\n\" ) );\n\n"}