{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r22911 - in branches: SAMBA_3_0/source/lib\n\tSAMBA_3_0/source/nmbd SAMBA_3_0/source/rpc_server\n\tSAMBA_3_0/source/smbd SAMBA_3_0/source/utils\n\tSAMBA_3_0_26/source/lib SAMBA_3_0_26/source/nmbd\n\tSAMBA_3_0_26/source/rpc_server SAMBA_3_0_26/source/smbd\n\tSAMBA_3_0_26/source/utils", "body": "Author: vlendec\nDate: 2007-05-15 15:49:55 +0000 (Tue, 15 May 2007)\nNew Revision: 22911\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22911\n\nLog:\nPass a messaging_context to message_send_all\n\nModified:\n   branches/SAMBA_3_0/source/lib/messages.c\n   branches/SAMBA_3_0/source/nmbd/nmbd_processlogon.c\n   branches/SAMBA_3_0/source/rpc_server/srv_netlog_nt.c\n   branches/SAMBA_3_0/source/rpc_server/srv_spoolss_nt.c\n   branches/SAMBA_3_0/source/rpc_server/srv_srvsvc_nt.c\n   branches/SAMBA_3_0/source/smbd/lanman.c\n   branches/SAMBA_3_0/source/smbd/statcache.c\n   branches/SAMBA_3_0/source/utils/smbcontrol.c\n   branches/SAMBA_3_0_26/source/lib/messages.c\n   branches/SAMBA_3_0_26/source/nmbd/nmbd_processlogon.c\n   branches/SAMBA_3_0_26/source/rpc_server/srv_netlog_nt.c\n   branches/SAMBA_3_0_26/source/rpc_server/srv_spoolss_nt.c\n   branches/SAMBA_3_0_26/source/rpc_server/srv_srvsvc_nt.c\n   branches/SAMBA_3_0_26/source/smbd/lanman.c\n   branches/SAMBA_3_0_26/source/smbd/statcache.c\n   branches/SAMBA_3_0_26/source/utils/smbcontrol.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/lib/messages.c\n===================================================================\n--- branches/SAMBA_3_0/source/lib/messages.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0/source/lib/messages.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -659,7 +659,8 @@\n  *\n  * @retval True for success.\n  **/\n-BOOL message_send_all(int msg_type,\n+BOOL message_send_all(struct messaging_context *msg_ctx,\n+\t\t      int msg_type,\n \t\t      const void *buf, size_t len,\n \t\t      BOOL duplicates_allowed,\n \t\t      int *n_sent)\n\nModified: branches/SAMBA_3_0/source/nmbd/nmbd_processlogon.c\n===================================================================\n--- branches/SAMBA_3_0/source/nmbd/nmbd_processlogon.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0/source/nmbd/nmbd_processlogon.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -40,8 +40,8 @@\n {\n         DEBUG(3, (\"sending replication message, serial = 0x%04x\\n\", \n                   low_serial));\n-        message_send_all(MSG_SMB_SAM_REPL, &low_serial,\n-                         sizeof(low_serial), False, NULL);\n+        message_send_all(nmbd_messaging_context(), MSG_SMB_SAM_REPL,\n+\t\t\t &low_serial, sizeof(low_serial), False, NULL);\n }\n \n /****************************************************************************\n\nModified: branches/SAMBA_3_0/source/rpc_server/srv_netlog_nt.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_server/srv_netlog_nt.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0/source/rpc_server/srv_netlog_nt.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -76,7 +76,8 @@\n static void send_sync_message(void)\n {\n         DEBUG(3, (\"sending sam synchronisation message\\n\"));\n-        message_send_all(MSG_SMB_SAM_SYNC, NULL, 0, False, NULL);\n+        message_send_all(smbd_messaging_context(), MSG_SMB_SAM_SYNC, NULL, 0,\n+\t\t\t False, NULL);\n }\n \n /*************************************************************************\n\nModified: branches/SAMBA_3_0/source/rpc_server/srv_spoolss_nt.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_server/srv_spoolss_nt.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0/source/rpc_server/srv_spoolss_nt.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -311,7 +311,8 @@\n \t\t\n \tif ( (ret = smbrun(command, NULL)) == 0 ) {\n \t\t/* Tell everyone we updated smb.conf. */\n-\t\tmessage_send_all(MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n+\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n \t}\n \t\t\n \tif ( is_print_op )\n@@ -6255,7 +6256,8 @@\n \t\n \tif ( (ret = smbrun(command, &fd)) == 0 ) {\n \t\t/* Tell everyone we updated smb.conf. */\n-\t\tmessage_send_all(MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n+\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n \t}\n \n \tif ( is_print_op )\n\nModified: branches/SAMBA_3_0/source/rpc_server/srv_srvsvc_nt.c\n===================================================================\n--- branches/SAMBA_3_0/source/rpc_server/srv_srvsvc_nt.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0/source/rpc_server/srv_srvsvc_nt.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -1421,7 +1421,8 @@\n \n \t\tif ( (ret = smbrun(command, NULL)) == 0 ) {\n \t\t\t/* Tell everyone we updated smb.conf. */\n-\t\t\tmessage_send_all(MSG_SMB_CONF_UPDATED,\n+\t\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t\t MSG_SMB_CONF_UPDATED,\n \t\t\t\t\t NULL, 0, False, NULL);\n \t\t}\n \n@@ -1517,7 +1518,8 @@\n \n \t\tif ( (ret = smbrun(command, NULL)) == 0 ) {\n \t\t\t/* Tell everyone we updated smb.conf. */\n-\t\t\tmessage_send_all(MSG_SMB_CONF_UPDATED,\n+\t\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t\t MSG_SMB_CONF_UPDATED,\n \t\t\t\t\t NULL, 0, False, NULL);\n \t\t}\n \n@@ -1575,7 +1577,8 @@\n \t\t\t\n \t\tif ( (ret = smbrun(command, NULL)) == 0 ) {\n \t\t\t/* Tell everyone we updated smb.conf. */\n-\t\t\tmessage_send_all(MSG_SMB_CONF_UPDATED,\n+\t\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t\t MSG_SMB_CONF_UPDATED,\n \t\t\t\t\t NULL, 0, False, NULL);\n \t\t}\n \t\t\n\nModified: branches/SAMBA_3_0/source/smbd/lanman.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/lanman.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0/source/smbd/lanman.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -1894,7 +1894,8 @@\n \t\t\tgoto error_exit;\n \t\t} else {\n \t\t\tSAFE_FREE(command);\n-\t\t\tmessage_send_all(MSG_SMB_CONF_UPDATED, NULL, 0,\n+\t\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t\t MSG_SMB_CONF_UPDATED, NULL, 0,\n \t\t\t\t\t False, NULL);\n \t\t}\n \t} else {\n\nModified: branches/SAMBA_3_0/source/smbd/statcache.c\n===================================================================\n--- branches/SAMBA_3_0/source/smbd/statcache.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0/source/smbd/statcache.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -292,7 +292,8 @@\n void send_stat_cache_delete_message(const char *name)\n {\n #ifdef DEVELOPER\n-\tmessage_send_all(MSG_SMB_STAT_CACHE_DELETE,\n+\tmessage_send_all(smbd_messaging_context(),\n+\t\t\tMSG_SMB_STAT_CACHE_DELETE,\n \t\t\tname,\n \t\t\tstrlen(name)+1,\n \t\t\tTrue,\n\nModified: branches/SAMBA_3_0/source/utils/smbcontrol.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/smbcontrol.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0/source/utils/smbcontrol.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -60,7 +60,7 @@\n \t\t\tmessaging_send_buf(msg_ctx, pid, msg_type,\n \t\t\t\t\t   (uint8 *)buf, len));\n \n-\tret = message_send_all(msg_type, buf, len, duplicates,\n+\tret = message_send_all(msg_ctx, msg_type, buf, len, duplicates,\n \t\t\t       &n_sent);\n \tDEBUG(10,(\"smbcontrol/send_message: broadcast message to \"\n \t\t  \"%d processes\\n\", n_sent));\n\nModified: branches/SAMBA_3_0_26/source/lib/messages.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/lib/messages.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0_26/source/lib/messages.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -659,7 +659,8 @@\n  *\n  * @retval True for success.\n  **/\n-BOOL message_send_all(int msg_type,\n+BOOL message_send_all(struct messaging_context *msg_ctx,\n+\t\t      int msg_type,\n \t\t      const void *buf, size_t len,\n \t\t      BOOL duplicates_allowed,\n \t\t      int *n_sent)\n\nModified: branches/SAMBA_3_0_26/source/nmbd/nmbd_processlogon.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/nmbd/nmbd_processlogon.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0_26/source/nmbd/nmbd_processlogon.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -40,8 +40,8 @@\n {\n         DEBUG(3, (\"sending replication message, serial = 0x%04x\\n\", \n                   low_serial));\n-        message_send_all(MSG_SMB_SAM_REPL, &low_serial,\n-                         sizeof(low_serial), False, NULL);\n+        message_send_all(nmbd_messaging_context(), MSG_SMB_SAM_REPL,\n+\t\t\t &low_serial, sizeof(low_serial), False, NULL);\n }\n \n /****************************************************************************\n\nModified: branches/SAMBA_3_0_26/source/rpc_server/srv_netlog_nt.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_server/srv_netlog_nt.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0_26/source/rpc_server/srv_netlog_nt.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -76,7 +76,8 @@\n static void send_sync_message(void)\n {\n         DEBUG(3, (\"sending sam synchronisation message\\n\"));\n-        message_send_all(MSG_SMB_SAM_SYNC, NULL, 0, False, NULL);\n+        message_send_all(smbd_messaging_context(), MSG_SMB_SAM_SYNC, NULL, 0,\n+\t\t\t False, NULL);\n }\n \n /*************************************************************************\n\nModified: branches/SAMBA_3_0_26/source/rpc_server/srv_spoolss_nt.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_server/srv_spoolss_nt.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0_26/source/rpc_server/srv_spoolss_nt.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -311,7 +311,8 @@\n \t\t\n \tif ( (ret = smbrun(command, NULL)) == 0 ) {\n \t\t/* Tell everyone we updated smb.conf. */\n-\t\tmessage_send_all(MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n+\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n \t}\n \t\t\n \tif ( is_print_op )\n@@ -6117,7 +6118,8 @@\n \t\n \tif ( (ret = smbrun(command, &fd)) == 0 ) {\n \t\t/* Tell everyone we updated smb.conf. */\n-\t\tmessage_send_all(MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n+\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n \t}\n \n \tif ( is_print_op )\n\nModified: branches/SAMBA_3_0_26/source/rpc_server/srv_srvsvc_nt.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/rpc_server/srv_srvsvc_nt.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0_26/source/rpc_server/srv_srvsvc_nt.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -1609,7 +1609,9 @@\n \t\t\t\n \t\tif ( (ret = smbrun(command, NULL)) == 0 ) {\n \t\t\t/* Tell everyone we updated smb.conf. */\n-\t\t\tmessage_send_all(MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n+\t\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t\t MSG_SMB_CONF_UPDATED, NULL, 0,\n+\t\t\t\t\t False, NULL);\n \t\t}\n \t\t\n \t\tif ( is_disk_op )\n@@ -1771,7 +1773,8 @@\n \n \tif ( (ret = smbrun(command, NULL)) == 0 ) {\n \t\t/* Tell everyone we updated smb.conf. */\n-\t\tmessage_send_all(MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n+\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n \t}\n \n \tif ( is_disk_op )\n@@ -1862,7 +1865,8 @@\n \n \tif ( (ret = smbrun(command, NULL)) == 0 ) {\n \t\t/* Tell everyone we updated smb.conf. */\n-\t\tmessage_send_all(MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n+\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t MSG_SMB_CONF_UPDATED, NULL, 0, False, NULL);\n \t}\n \n \tif ( is_disk_op )\n\nModified: branches/SAMBA_3_0_26/source/smbd/lanman.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/smbd/lanman.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0_26/source/smbd/lanman.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -1893,7 +1893,8 @@\n \t\t\tgoto error_exit;\n \t\t} else {\n \t\t\tSAFE_FREE(command);\n-\t\t\tmessage_send_all(MSG_SMB_CONF_UPDATED, NULL, 0,\n+\t\t\tmessage_send_all(smbd_messaging_context(),\n+\t\t\t\t\t MSG_SMB_CONF_UPDATED, NULL, 0,\n \t\t\t\t\t False, NULL);\n \t\t}\n \t} else {\n\nModified: branches/SAMBA_3_0_26/source/smbd/statcache.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/smbd/statcache.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0_26/source/smbd/statcache.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -292,7 +292,8 @@\n void send_stat_cache_delete_message(const char *name)\n {\n #ifdef DEVELOPER\n-\tmessage_send_all(MSG_SMB_STAT_CACHE_DELETE,\n+\tmessage_send_all(smbd_messaging_context(),\n+\t\t\tMSG_SMB_STAT_CACHE_DELETE,\n \t\t\tname,\n \t\t\tstrlen(name)+1,\n \t\t\tTrue,\n\nModified: branches/SAMBA_3_0_26/source/utils/smbcontrol.c\n===================================================================\n--- branches/SAMBA_3_0_26/source/utils/smbcontrol.c\t2007-05-15 15:41:37 UTC (rev 22910)\n+++ branches/SAMBA_3_0_26/source/utils/smbcontrol.c\t2007-05-15 15:49:55 UTC (rev 22911)\n@@ -60,7 +60,7 @@\n \t\t\tmessaging_send_buf(msg_ctx, pid, msg_type,\n \t\t\t\t\t   (uint8 *)buf, len));\n \n-\tret = message_send_all(msg_type, buf, len, duplicates,\n+\tret = message_send_all(msg_ctx, msg_type, buf, len, duplicates,\n \t\t\t       &n_sent);\n \tDEBUG(10,(\"smbcontrol/send_message: broadcast message to \"\n \t\t  \"%d processes\\n\", n_sent));\n\n"}