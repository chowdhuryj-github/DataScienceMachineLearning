{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "vlendec@samba.org", "subject": "svn commit: samba r22554 - in branches: SAMBA_3_0/source/groupdb\n\tSAMBA_3_0_25/source/groupdb", "body": "Author: vlendec\nDate: 2007-04-28 13:52:49 +0000 (Sat, 28 Apr 2007)\nNew Revision: 22554\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22554\n\nLog:\nFix an assumption that TALLOC_ARRAY(.., 0) != NULL.\n\nVolker\n\nModified:\n   branches/SAMBA_3_0/source/groupdb/mapping.c\n   branches/SAMBA_3_0_25/source/groupdb/mapping.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/groupdb/mapping.c\n===================================================================\n--- branches/SAMBA_3_0/source/groupdb/mapping.c\t2007-04-28 12:50:35 UTC (rev 22553)\n+++ branches/SAMBA_3_0/source/groupdb/mapping.c\t2007-04-28 13:52:49 UTC (rev 22554)\n@@ -578,12 +578,17 @@\n \tif (!NT_STATUS_IS_OK(result))\n \t\treturn result;\n \n+\t*p_num_alias_rids = 0;\n+\n+\tif (num_alias_sids == 0) {\n+\t\tTALLOC_FREE(alias_sids);\n+\t\treturn NT_STATUS_OK;\n+\t}\n+\n \t*pp_alias_rids = TALLOC_ARRAY(mem_ctx, uint32, num_alias_sids);\n \tif (*pp_alias_rids == NULL)\n \t\treturn NT_STATUS_NO_MEMORY;\n \n-\t*p_num_alias_rids = 0;\n-\n \tfor (i=0; i<num_alias_sids; i++) {\n \t\tif (!sid_peek_check_rid(domain_sid, &alias_sids[i],\n \t\t\t\t\t&(*pp_alias_rids)[*p_num_alias_rids]))\n\nModified: branches/SAMBA_3_0_25/source/groupdb/mapping.c\n===================================================================\n--- branches/SAMBA_3_0_25/source/groupdb/mapping.c\t2007-04-28 12:50:35 UTC (rev 22553)\n+++ branches/SAMBA_3_0_25/source/groupdb/mapping.c\t2007-04-28 13:52:49 UTC (rev 22554)\n@@ -578,12 +578,17 @@\n \tif (!NT_STATUS_IS_OK(result))\n \t\treturn result;\n \n+\t*p_num_alias_rids = 0;\n+\n+\tif (num_alias_sids == 0) {\n+\t\tTALLOC_FREE(alias_sids);\n+\t\treturn NT_STATUS_OK;\n+\t}\n+\n \t*pp_alias_rids = TALLOC_ARRAY(mem_ctx, uint32, num_alias_sids);\n \tif (*pp_alias_rids == NULL)\n \t\treturn NT_STATUS_NO_MEMORY;\n \n-\t*p_num_alias_rids = 0;\n-\n \tfor (i=0; i<num_alias_sids; i++) {\n \t\tif (!sid_peek_check_rid(domain_sid, &alias_sids[i],\n \t\t\t\t\t&(*pp_alias_rids)[*p_num_alias_rids]))\n\n"}