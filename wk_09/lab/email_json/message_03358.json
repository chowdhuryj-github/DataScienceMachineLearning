{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "metze@samba.org", "subject": "svn commit: samba r22194 - in\n\tbranches/SAMBA_4_0/source/torture/rpc: .", "body": "Author: metze\nDate: 2007-04-12 11:42:09 +0000 (Thu, 12 Apr 2007)\nNew Revision: 22194\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22194\n\nLog:\nfix compiler warning and \ncompile in but disable NetShareAddSetDel test\n\nmetze\nModified:\n   branches/SAMBA_4_0/source/torture/rpc/srvsvc.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/torture/rpc/srvsvc.c\n===================================================================\n--- branches/SAMBA_4_0/source/torture/rpc/srvsvc.c\t2007-04-12 11:35:00 UTC (rev 22193)\n+++ branches/SAMBA_4_0/source/torture/rpc/srvsvc.c\t2007-04-12 11:42:09 UTC (rev 22194)\n@@ -525,6 +525,11 @@\n \tint i;\n \tBOOL ret = True;\n \n+\tif (!lp_parm_bool(-1, \"torture\", \"dangerous\", False)) {\n+\t\td_printf(\"NetShareAddSetDel disabled - enable dangerous tests to use\\n\");\n+\t\treturn True;\n+\t}\n+\n \ta.in.server_unc = r.in.server_unc = q.in.server_unc = d.in.server_unc =\n \t\ttalloc_asprintf(mem_ctx, \"\\\\\\\\%s\", dcerpc_server_name(p));\n \tr.in.share_name = talloc_strdup(mem_ctx, \"testshare\");\n@@ -1047,7 +1052,7 @@\n \t\t\t}\n \t\t}\n \n-\t\ttalloc_free(r.in.name);\n+\t\ttalloc_free(name);\n \n \t\td_printf(\"Maximum length for type %2d, flags %08x: %d\\n\", i, r.in.flags, max);\n \n@@ -1056,7 +1061,7 @@\n \t\tinvalidc = talloc_strdup(mem_ctx, \"\");\n \n \t\tfor (n = 0x20; n < 0x7e; n++) {\n-\t\t\tr.in.name = talloc_asprintf(mem_ctx, \"%c\", (char)n);\n+\t\t\tr.in.name = name = talloc_asprintf(mem_ctx, \"%c\", (char)n);\n \n \t\t\tstatus = dcerpc_srvsvc_NetNameValidate(p, mem_ctx, &r);\n \t\t\tif (!NT_STATUS_IS_OK(status)) {\n@@ -1069,7 +1074,7 @@\n \t\t\t\tinvalidc = talloc_asprintf_append(invalidc, \"%c\", (char)n);\n \t\t\t}\n \n-\t\t\ttalloc_free(r.in.name);\n+\t\t\ttalloc_free(name);\n \t\t}\n \n \t\td_printf(\" Invalid chars for type %2d, flags %08x: \\\"%s\\\"\\n\", i, r.in.flags, invalidc);\n@@ -1115,7 +1120,7 @@\n \tret &= test_NetRemoteTOD(p, mem_ctx);\n \tret &= test_NetShareEnum(p, mem_ctx, True);\n \tret &= test_NetShareGetInfo(p, mem_ctx, \"ADMIN$\", True);\n-/*\tret &= test_NetShareAddSetDel(p, mem_ctx); */\n+\tret &= test_NetShareAddSetDel(p, mem_ctx);\n \tret &= test_NetNameValidate(p, mem_ctx);\n \t\n \tstatus = torture_rpc_connection(mem_ctx, &p, &dcerpc_table_srvsvc);\n\n"}