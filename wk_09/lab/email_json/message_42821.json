{"category": "ham", "to_address": "<r-help@stat.math.ethz.ch>", "from_address": "\"Patnaik, Tirthankar \" <tirthankar.patnaik@citi.com>", "subject": "[R] Problems with Merge", "body": "Hi,\n I have a history dataset, a matrix with about 1590 obs, and 242 cols,\nand I need to update this matrix with an 'update' matrix that has about\n30 rows, and roughly similar number of columns as the history ds (but\nnot necessarily equal). The update dataset is read from an Excel ODBC\nconnection. When I try and merge these datasets, I get counter-intuitive\nresults.\n\nlibrary(RODBC)\n   chn <- odbcConnectExcel(UpdateFile)\n   sqlTables(chn)\n   UpdateData <- sqlFetch(chn,\"MCap243\")\n   colnames(UpdateData) <- gsub(\"#\",\".\",colnames(UpdateData))\n   close(chn)\n   # specify just how many rows we need from the Update file. We'd only\nread five\n   # rows at a time.\n   UpdateRows = 20\n   UpdateData <- UpdateData[1:UpdateRows,]\n\n   # Delete Unwanted stocks.\n   UpdateData <- UpdateData[,!names(UpdateData) %in% ToBeDeleted]\n   x <- tail(UpdateData[c(\"Date\",\"ABAN.BO\")],n=50)\n   print(x)\n   \n\nGives x as:\n\n         Date  ABAN.BO\n1  2007-04-30 96448.40\n2  2007-05-01 96448.40\n3  2007-05-02 96448.40\n4  2007-05-03 96300.44\n5  2007-05-04 93718.52\n6  2007-05-05 93718.52\n7  2007-05-06 93718.52\n8  2007-05-07 92743.82\n9  2007-05-08 90374.60\n10 2007-05-09 89126.18\n11 2007-05-10 87082.47\n12 2007-05-11 85493.73\n13 2007-05-12 85493.73\n14 2007-05-13 85493.73\n15 2007-05-14 85033.21\n16 2007-05-15 89209.41\n17 2007-05-16 89089.19\n18 2007-05-17 90472.62\n19 2007-05-18 90326.51\n20 2007-05-19 90326.51\n\nBut when I merge this file with the history dataset, I get the dates\nmisaligned by one row.\n\nwhistory <- merge(rhistory,UpdateData,by.x=rhistory[\"Date\"],all=TRUE)\n\ntail(WHist4[c(\"Date\",\"ABAN.BO\")],n=30)\n\n          Date  ABAN.BO\n1581 2007-04-19 83632.60\n1582 2007-04-20 85942.00\n1583 2007-04-23 88244.00\n1584 2007-04-24 90309.50\n1585 2007-04-25 92048.00\n1586 2007-04-26 92051.70\n1587 2007-04-27 95863.10\n1588 2007-04-29 96448.40\n1589 2007-04-30 96448.40\n1590 2007-04-30 96343.40\n1591 2007-05-01 96448.40\n1592 2007-05-02 96300.44\n1593 2007-05-03 93718.52\n1594 2007-05-03 96195.60\n1595 2007-05-04 93718.52\n1596 2007-05-04 93616.50\n1597 2007-05-05 93718.52\n1598 2007-05-06 92743.82\n1599 2007-05-07 90374.60\n1600 2007-05-08 89126.18\n1601 2007-05-09 87082.47\n1602 2007-05-10 85493.73\n1603 2007-05-11 85493.73\n1604 2007-05-12 85493.73\n1605 2007-05-13 85033.21\n1606 2007-05-14 89209.41\n1607 2007-05-15 89089.19\n1608 2007-05-16 90472.62\n1609 2007-05-17 90326.51\n1610 2007-05-18 90326.51\n\nAny reasons why the dates are shifted by one date? Am I missing some\nparameters in the merge statement?\n\nTIA and best,\n-Tir\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}