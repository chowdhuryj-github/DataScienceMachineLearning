{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "jra@samba.org", "subject": "svn commit: samba r22950 - in branches/SAMBA_3_0/source/libsmb: .", "body": "Author: jra\nDate: 2007-05-16 17:17:25 +0000 (Wed, 16 May 2007)\nNew Revision: 22950\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22950\n\nLog:\nFix the issue Volker reported here :\n\n\"Attempt to fix some build farm failures: On port 139 the first\nsuccessful packet gives len==0 from the server, so the = in\n\n        if (len <= 0) {\n\nin line 136 of clientgen.c throws a failure.\"\n\nThe irritating thing is that I already had it correct in\nSAMBA_3_0_26 and forgot to merge the change across.\n\nlen == 0 is a valid return - I messed that up when\nconverting client_receive_smb() to return a length\nrather than a BOOL.\n\nDoh !\n\nJeremy.\n\nModified:\n   branches/SAMBA_3_0/source/libsmb/cliconnect.c\n   branches/SAMBA_3_0/source/libsmb/clientgen.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/libsmb/cliconnect.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/cliconnect.c\t2007-05-16 15:48:22 UTC (rev 22949)\n+++ branches/SAMBA_3_0/source/libsmb/cliconnect.c\t2007-05-16 17:17:25 UTC (rev 22950)\n@@ -1347,7 +1347,7 @@\n \tcli_send_smb(cli);\n \tDEBUG(5,(\"Sent session request\\n\"));\n \n-\tif (!cli_receive_sessionreply(cli))\n+\tif (!cli_receive_smb(cli))\n \t\treturn False;\n \n \tif (CVAL(cli->inbuf,0) == 0x84) {\n\nModified: branches/SAMBA_3_0/source/libsmb/clientgen.c\n===================================================================\n--- branches/SAMBA_3_0/source/libsmb/clientgen.c\t2007-05-16 15:48:22 UTC (rev 22949)\n+++ branches/SAMBA_3_0/source/libsmb/clientgen.c\t2007-05-16 17:17:25 UTC (rev 22950)\n@@ -133,7 +133,7 @@\n \t}\n \n \t/* If the server is not responding, note that now */\n-\tif (len <= 0) {\n+\tif (len < 0) {\n                 DEBUG(0, (\"Receiving SMB: Server stopped responding\\n\"));\n \t\tcli->smb_rw_error = smb_read_error;\n \t\tclose(cli->fd);\n@@ -191,32 +191,6 @@\n }\n \n /****************************************************************************\n- Recv an smb session reply\n-****************************************************************************/\n-\n-BOOL cli_receive_sessionreply(struct cli_state *cli)\n-{\n-\tssize_t len;\n-\n-\t/* fd == -1 causes segfaults -- Tom (tom@ninja.nl) */\n-\tif (cli->fd == -1)\n-\t\treturn False; \n-\n-\tlen = client_receive_smb(cli, False, 0);\n-\n-\t/* If the server is not responding, note that now */\n-\tif (len < 0) {\n-                DEBUG(0, (\"Receiving SMB: Server stopped responding\\n\"));\n-\t\tcli->smb_rw_error = smb_read_error;\n-\t\tclose(cli->fd);\n-\t\tcli->fd = -1;\n-\t\treturn False;\n-\t}\n-\n-\treturn True;\n-}\n-\n-/****************************************************************************\n  Read the data portion of a readX smb.\n  The timeout is in milliseconds\n ****************************************************************************/\n\n"}