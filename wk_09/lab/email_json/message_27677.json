{"category": "ham", "to_address": "\"Gerald (Jerry) Carter\" <jerry@samba.org>", "from_address": "Jeremy Allison <jra@samba.org>", "subject": "Re: symlink failure when listing a dircetory in samba 3.0.25", "body": "On Fri, May 11, 2007 at 10:40:08AM -0500, Gerald (Jerry) Carter wrote:\n> -----BEGIN PGP SIGNED MESSAGE-----\n> Hash: SHA1\n> \n> Jeremy,\n> \n> Is this a change in behavior ?\n> \n> * create a symlink in a share to a directory that\n>   has permissions that would deny a given user to\n>   stat the link target\n> \n> * smbd removes the link from the list of files\n>   in the output to smbclient and Windows 2003\n> \n>   get_lanman2_dir_entry: SMB_FIND_FILE_BOTH_DIRECTORY_INFO\n>   get_lanman2_dir_entry:readdir on dirptr 0x8558a30 now at offset\n>     -2147483648\n>   dos_mode: ./..\n>   dos_mode_from_sbuf returning d\n>   dos_mode returning d\n>   get_lanman2_dir_entry found ./.. fname=..\n>   get_lanman2_dir_entry: SMB_FIND_FILE_BOTH_DIRECTORY_INFO\n>   get_lanman2_dir_entry:readdir on dirptr 0x8558a30 now at offset 56\n>   get_lanman2_dir_entry:Couldn't stat [./lwi-builds] (Permission denied)\n>   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>   get_lanman2_dir_entry:readdir on dirptr 0x8558a30 now at offset 72\n>   dos_mode: ./winadmin\n>   dos_mode_from_sbuf returning d\n>   dos_mode returning d\n>   get_lanman2_dir_entry found ./winadmin fname=winadmin\n>   get_lanman2_dir_entry: SMB_FIND_FILE_BOTH_DIRECTORY_INFO\n>   get_lanman2_dir_entry:readdir on dirptr 0x8558a30 now at offset 4096\n> \n> It seems to be that we should display the link anyways.\n> Hide unreadable is not set.\n\nActually this isn't a change in behavior I think.\n\nWhat should we display if we can't stat a symlink target ?\nIs is a link to a directory ? Is it a link to a file ?\n\nWe don't know and can't guess - whatever we guess it'll be\nwrong. I think we just have to filter it.\n\nJeremy.\n\n"}