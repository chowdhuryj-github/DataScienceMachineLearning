{"category": "ham", "to_address": "Kirsten Beyer <kirsten-beyer@uiowa.edu>", "from_address": "Adaikalavan Ramasamy <ramasamy@cancer.org.uk>", "subject": "Re: [R] sampling question", "body": "Lets assume your zcta data looks like this\n\n    set.seed(12345) ## temporary for reproducibility\n    zcta <- data.frame( zipcode=LETTERS[1:5], prop=runif(5) )\n    zcta\n    zipcode      prop\n1       A 0.7209039\n2       B 0.8757732\n3       C 0.7609823\n4       D 0.8861246\n5       E 0.4564810\n\nThis says that 72.1% of the population in zipcode A is female, ..., and \n45.6% in zipcode E is female.\n\n\nNow suppose you sampled 20 people and you recorded the zipcode (and \nother variables) and stored in 'samp'\n\n    samp <- data.frame( id=1:20,\n                        zipcode=LETTERS[ sample(1:5, 20, replace=TRUE) ])\n\n\nNow, I am not sure what you want to do. But I could see two possible \nmeanings from your message.\n\n1) If you want to sample 10 observation, with each observation weighted \nINDEPENDENTLY by the proportion of women in its zipcode, try something \nlike the following. The problem with this option is that it depends on \nthe prevalence of the zipcodes of the observations.\n\n    comb <- merge( samp, zcta, all.x=T )\n    comb <- comb[ order(comb$id), ]\n    comb[ sample( comb$id, 10, prob=comb$prop ), ]\n\n\n\n2) If you want to sample x% in each zipcode, where x is the proportion \nof women in that zipcode. Then this is what I would call stratified \nsampling. Try this:\n\n    tmp <- split( samp, samp$zipcode )\n    out <- NULL\n\n    for( z in names(tmp) ){\n       df <- tmp[[z]]\n       p  <- zcta[ zcta$zipcode == z, \"prop\" ]\n       out[[z]] <- df[ sample( 1:nrow(df), p*nrow(df) ), ]\n    }\n    do.call(\"rbind\", out)\n\nYou probably need a variant of these but if you need further help, you \nwill need to provide more information and better yet examples.\n\nRegards, Adai\n\n\n\nKirsten Beyer wrote:\n> I am interested in locating a script to implement a sampling scheme\n> that would basically make it more likely that a particular observation\n> is chosen based on a weight associated with the observation.  I am\n> trying to select a sample of ~30 census blocks from each ZIP code area\n> based on the proportion of women in a ZCTA living in a particular\n> block.  I want to make it more likely that a block will be chosen if\n> the proportion of women in a patient's age group in a particular block\n> is high. Any ideas are appreciated!\n> \n> ______________________________________________\n> R-help@stat.math.ethz.ch mailing list\n> https://stat.ethz.ch/mailman/listinfo/r-help\n> PLEASE do read the posting guide http://www.R-project.org/posting-guide.html\n> and provide commented, minimal, self-contained, reproducible code.\n> \n> \n>\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}