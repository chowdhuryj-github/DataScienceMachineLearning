{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "tridge@samba.org", "subject": "Rev 150: use shutdown in more tests in http://samba.org/~tridge/ctdb", "body": "------------------------------------------------------------\nrevno: 150\nrevision-id: tridge@samba.org-20070418052738-c581c86e6c27b24e\nparent: tridge@samba.org-20070418052726-e7908fbec401dbef\ncommitter: Andrew Tridgell \nbranch nick: tridge\ntimestamp: Wed 2007-04-18 15:27:38 +1000\nmessage:\n  use shutdown in more tests\nmodified:\n  tests/ctdb_bench.c             ctdb_bench.c-20061219052637-2liagoglohxb6p7s-1\n  tests/ctdb_fetch.c             ctdb_fetch.c-20070405031748-f7gslozfj3rwh5ie-1\n  tests/ctdb_messaging.c         ctdb_messaging.c-20070411034205-6d6vne56pbih2x1p-1\n=== modified file 'tests/ctdb_bench.c'\n--- a/tests/ctdb_bench.c\t2007-04-17 12:16:50 +0000\n+++ b/tests/ctdb_bench.c\t2007-04-18 05:27:38 +0000\n@@ -259,6 +259,7 @@\n \tbench_ring(ctdb, ev);\n        \n \t/* shut it down */\n-\ttalloc_free(ctdb);\n+\tctdb_shutdown(ctdb);\n+\n \treturn 0;\n }\n\n=== modified file 'tests/ctdb_fetch.c'\n--- a/tests/ctdb_fetch.c\t2007-04-18 01:20:24 +0000\n+++ b/tests/ctdb_fetch.c\t2007-04-18 05:27:38 +0000\n@@ -247,7 +247,8 @@\n \n \tprintf(\"DATA:\\n%s\\n\", (char *)call.reply_data.dptr);\n \n-\t/* shut it down */\n-\ttalloc_free(ctdb);\n+\t/* go into a wait loop to allow other nodes to complete */\n+\tctdb_shutdown(ctdb);\n+\n \treturn 0;\n }\n\n=== modified file 'tests/ctdb_messaging.c'\n--- a/tests/ctdb_messaging.c\t2007-04-17 12:27:17 +0000\n+++ b/tests/ctdb_messaging.c\t2007-04-18 05:27:38 +0000\n@@ -141,6 +141,7 @@\n \t}\n        \n \t/* shut it down */\n-\ttalloc_free(ctdb);\n+\tctdb_shutdown(ctdb);\n+\n \treturn 0;\n }\n\n"}