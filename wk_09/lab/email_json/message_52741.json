{"category": "ham", "to_address": "chromatic <chromatic@wgz.org>", "from_address": "Nicholas Clark <nick@ccl4.org>", "subject": "Re: [svn:parrot] r19231 - trunk/languages/perl6/src/pmc", "body": "On Thu, Jun 21, 2007 at 11:08:25PM -0700, chromatic wrote:\n> On Thursday 21 June 2007 17:44:38 Mark Glines wrote:\n> \n> > On Thu, 21 Jun 2007 17:38:15 -0700\n> >\n> > chromatic  wrote:\n> > > > -            return string_from_cstring(INTERP, \"Str\", 3);\n> > > > +            return string_from_cstring(INTERP, \"Bool\", 3);\n> > > >          return SUPER();\n> > > >      }\n> \n> > > That 3 looks like it should be 4.\n> \n> > Yep, fixed in r19238.\n> \n> We have a lot of string_from_cstring() calls with constant second parameters \n> and third parameters of 0 that could use updating.  There's no sense in \n> calling strlen() all the time.\n\nI think that you need something like this\n\n/* concatenating with \"\" ensures that only literal strings are accepted as argument */\n#define STR_WITH_LEN(s)  (s \"\"), (sizeof(s)-1)\n\n/* STR_WITH_LEN() shortcuts */\n#define newSVpvs(str) Perl_newSVpvn(aTHX_ STR_WITH_LEN(str))\n\n...\n\n(Credit to chip for the concatenating with \"\" trick)\n\nNicholas Clark\n\n"}