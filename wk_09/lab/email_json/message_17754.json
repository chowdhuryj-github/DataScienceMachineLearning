{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "psomogyi@gamax.hu", "subject": "Rev 88: ctdb/ib: disconnect error handling rearrangement in\n\thttp://samba.org/~tridge/psomogyi/", "body": "------------------------------------------------------------\nrevno: 88\nrevision-id: psomogyi@gamax.hu-20070427151220-9tbyugiwn8hcjpl3\nparent: psomogyi@gamax.hu-20070427135450-pygimn03o3zyvd32\ncommitter: Peter Somogyi \nbranch nick: ctdb\ntimestamp: Fri 2007-04-27 17:12:20 +0200\nmessage:\n  ctdb/ib: disconnect error handling rearrangement\nmodified:\n  ib/ibwrapper.c                 ibwrapper.c-20061204130028-0125b4f5a72f4b11\n=== modified file 'ib/ibwrapper.c'\n--- a/ib/ibwrapper.c\t2007-04-26 14:54:24 +0000\n+++ b/ib/ibwrapper.c\t2007-04-27 15:12:20 +0000\n@@ -534,13 +534,14 @@\n \n \tcase RDMA_CM_EVENT_DISCONNECTED:\n \t\tDEBUG(11, (\"RDMA_CM_EVENT_DISCONNECTED\\n\"));\n-\t\tif ((rc=rdma_ack_cm_event(event)))\n-\t\t\tDEBUG(0, (\"disc/rdma_ack_cm_event failed with %d\\n\", rc));\n-\t\tevent = NULL; /* don't ack more */\n-\n \t\tif (cma_id!=pctx->cm_id) {\n-\t\t\tDEBUG(0, (\"client DISCONNECT event cm_id=%p\\n\", cma_id));\n+\t\t\tDEBUG(1, (\"client DISCONNECT event cm_id=%p\\n\", cma_id));\n \t\t\tconn = talloc_get_type(cma_id->context, struct ibw_conn);\n+\n+\t\t\tif ((rc=rdma_ack_cm_event(event)))\n+\t\t\t\tDEBUG(0, (\"disc/rdma_ack_cm_event failed with %d\\n\", rc));\n+\t\t\tevent = NULL; /* don't ack it any more */\n+\n \t\t\tconn->state = IBWC_DISCONNECTED;\n \t\t\tpctx->connstate_func(NULL, conn);\n \t\t}\n\n"}