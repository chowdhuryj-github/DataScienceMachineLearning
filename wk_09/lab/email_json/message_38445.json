{"category": "ham", "to_address": "Nicholas Clark <nwc10@colon.colondot.net>", "from_address": "\"Will Coleda\" <will@coleda.com>", "subject": "Re: [svn:parrot] r18661 - trunk/config/init/hints", "body": "Nicholas Clark writes: \n\n> On Sat, May 26, 2007 at 08:14:30PM -0700, chromatic@cvs.perl.org wrote:\n>> Author: chromatic\n>> Date: Sat May 26 20:14:29 2007\n>> New Revision: 18661 \n>> \n>> Modified:\n>>    trunk/config/init/hints/linux.pm \n>> \n>> Log:\n>> Enable symbol hiding with GCC on Linux. \n>> \n>> This'll smoke out some of the errors that plague Windows users.\n> \n> It breaks on gcc 3.3.5 \n> \n>> Modified: trunk/config/init/hints/linux.pm\n>> ==============================================================================\n>> --- trunk/config/init/hints/linux.pm\t(original)\n>> +++ trunk/config/init/hints/linux.pm\tSat May 26 20:14:29 2007\n>> @@ -52,6 +52,9 @@\n>>          }\n>>      }\n>>      else {\n>> +        # hide non-exported symbols\n>> +        $cflags .= ' -fvisibility=hidden';\n>> +\n>>          if ( $ld_share_flags !~ /-fPIC/ ) {\n>>              $ld_share_flags .= ' -fPIC';\n>>          }\n>> @@ -87,6 +90,7 @@\n>>          libparrot_shared       => 'libparrot$(SHARE_EXT).$(SOVERSION)',\n>>          libparrot_shared_alias => 'libparrot$(SHARE_EXT)',\n>>          libparrot_soname       => '-Wl,-soname=libparrot$(SHARE_EXT).$(SOVERSION)',\n>> +        sym_export             => '__attribute__ ((visibility(\"default\")))',\n>>      );\n>>  \n>>      if ( ( split( '-', $Config{archname} ) )[0] eq 'ia64' ) {\n> \n> This is something I really approve of, but it can't be done unconditionally.\n> Is the gcc version kept somewhere convenient in the configure data structures?\n\nYes, in 'gccversion', but the step to determine what version of GCC is being \nused is apparently run *after* the hints file is run.\n\n"}