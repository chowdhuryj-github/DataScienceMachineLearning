{"category": "ham", "to_address": "Andrew Bartlett <abartlet@samba.org>", "from_address": "Michael Adam <ma@sernet.de>", "subject": "Re: svn commit: samba r22897 - in\n\tbranches/SAMBA_3_0_26/source/utils: .", "body": "On Tue, May 15, 2007 at 10:28:32PM +1000, Andrew Bartlett wrote:\n> On Tue, 2007-05-15 at 11:12 +0000, obnox@samba.org wrote:\n> > \n> > Log:\n> > Fix c++ warnings (add explicit casts). \n> \n> These calls would be much safer down without the casts, and with\n> talloc() and a structure assignment.  This would also tag the structure\n> with the correct name. \n>\n> I'm particularly worried by the cast being to (struct devicemode *), but\n> the sizeof() being for DEVICEMODE.  This is exactly the type of bug that\n> the new talloc() was written to avoid.\n\nFirstly, we have \"typedef struct devicemode DEVICEMODE;\"\nand secondly, i only pulled this to sync with 3_0.\n\nOf course you are right, and conceptional enhancements should follow!\n\nMichael\n\n> > Changeset:\n> > Modified: branches/SAMBA_3_0_26/source/utils/net_rpc_printer.c\n> > ===================================================================\n> > --- branches/SAMBA_3_0_26/source/utils/net_rpc_printer.c\t2007-05-15 11:00:20 UTC (rev 22896)\n> > +++ branches/SAMBA_3_0_26/source/utils/net_rpc_printer.c\t2007-05-15 11:12:10 UTC (rev 22897)\n> > @@ -2166,7 +2166,7 @@\n> >  \t\tif (ctr_enum.printers_2[i].devmode != NULL) {\n> >  \n> >  \t\t\t/* copy devmode (info level 2) */\n> > -\t\t\tctr_dst.printers_2->devmode =\n> > +\t\t\tctr_dst.printers_2->devmode = (struct devicemode *)\n> >  \t\t\t\tTALLOC_MEMDUP(mem_ctx,\n> >  \t\t\t\t\t      ctr_enum.printers_2[i].devmode,\n> >  \t\t\t\t\t      sizeof(DEVICEMODE));\n> \n> -- \n> Andrew Bartlett                                http://samba.org/~abartlet/\n> Authentication Developer, Samba Team           http://samba.org\n> Samba Developer, Red Hat Inc.                  http://redhat.com\n\n"}