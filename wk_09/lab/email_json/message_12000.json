{"category": "ham", "to_address": "chromatic <chromatic@wgz.org>", "from_address": "Joshua Isom <jrisom@gmail.com>", "subject": "Re: [perl #42653] PCCMETHOD failures on freebsd/amd64", "body": "\nOn Apr 21, 2007, at 12:41 PM, chromatic wrote:\n\n> On Saturday 21 April 2007 04:01, Joshua Isom wrote:\n>\n>> I'm getting failures in t/pmc/class.t, t/pmc/exporter.t,\n>> t/pmc/pccmethod_test.t, t/pmc/role.t, and t/pmc/smop_attribute.t and\n>> all seem to be related to PCCMETHOD's.  The failures occur in\n>> inter_call.c, fetch_arg_op().  The macro's of UVal_* are where it\n>> occurs, but I can't yet figure out where the bad data comes into it.\n>\n> Can you post the verbose output of the tests?  If they're all similar  \n> or\n> identical, just one is fine.\n>\n> -- c\n>\n\nEach failure occurs with the PCCMETHODs.  Looking a little more, the  \noptional parameters seem to be the ones causing trouble.  Somehow,  \ninterp->current_args points to bad data.  It looks to always be  \nsomething like 0x7fffffxxxxxx, and it just crashes later on.  I'll look  \nmore into it later unless someone figures the fix.\n\n\n% prove -v t/pmc/class.t t/pmc/exporter.t t/pmc/pccmethod_test.t  \nt/pmc/role.t t/pmc/smop_attribute.t\nt/pmc/class.............1..15\nok 1 - new\nok 2 - Class PMC has \"I am a class\" flag set\n\nnot ok 3 - name\n#     Failed test (t/pmc/class.t at line 62)\n#          got: 'Bus error (core dumped)\n# '\n#     expected: 'ok 1 - name() with no args returns class name, which  \nis empty at first\n# ok 2 - name() with args sets class name\n# ok 3 - name() with too many args fails\n# ok 4 - name() with args sets namespace too\n# '\n# './parrot   \"/usr/home/jisom/parrot/t/pmc/class_3.pir\"' failed with  \nexit code 138\nok 4 - new\nok 5 - attributes\nok 6 - add_attribute\nnot ok 7 - set_attr/get_attr VTABLE methods\n\n#     Failed test (t/pmc/class.t at line 219)\n#          got: 'Bus error (core dumped)\n# '\n#     expected: 'ok 1 - created a class with two attributes\n# ok 2 - instantiated the class\n# ok 3 - set an attribute\n# 42\n# ok 4 - got an attribute\n# '\n# './parrot   \"/usr/home/jisom/parrot/t/pmc/class_7.pir\"' failed with  \nexit code 138\nok 8 - parents\nok 9 - roles\nnot ok 10 - inspect PCCMETHOD\n\n#     Failed test (t/pmc/class.t at line 290)\n#          got: 'Bus error (core dumped)\n# '\n#     expected: 'ok 1 - inspect with no args called\n# ok 2 - returned hash had correct number of elements\n# foo\n# ok 3 - inspect('name')\n# ok 4 - inspect('attributes')\n# '\n# './parrot   \"/usr/home/jisom/parrot/t/pmc/class_10.pir\"' failed with  \nexit code 138\nnot ok 11 - clone\n\n#     Failed test (t/pmc/class.t at line 324)\n#          got: 'ok 1 - created class Monkey and instantiated it\n# ok 2 - cloned class Monkey\n# Bus error (core dumped)\n# '\n#     expected: 'ok 1 - created class Monkey and instantiated it\n# ok 2 - cloned class Monkey\n# ok 3 - name is empty\n# ok 4 - namespace is null\n# ok 5 - attribute survived cloning\n# ok 6 - can modify cloned class\n# '\n# './parrot   \"/usr/home/jisom/parrot/t/pmc/class_11.pir\"' failed with  \nexit code 138\nnot ok 12 - clone_pmc\n\n#     Failed test (t/pmc/class.t at line 367)\n#          got: 'ok 1 - created class Monkey and instantiated it\n# ok 2 - cloned class Monkey with Hash argument\n# Bus error (core dumped)\n# '\n#     expected: 'ok 1 - created class Monkey and instantiated it\n# ok 2 - cloned class Monkey with Hash argument\n# ok 3 - name is new one set in the Hash\n# ok 4 - namespace is Mandrill too\n# ok 5 - attribute survived cloning\n# ok 6 - can modify cloned class\n# '\n# './parrot   \"/usr/home/jisom/parrot/t/pmc/class_12.pir\"' failed with  \nexit code 138\nok 13 - new with initialization hash\nok 14 - isa()\nnot ok 15 - does()\n\n#     Failed test (t/pmc/class.t at line 498)\n#          got: 'Doesn't Red\n# Bus error (core dumped)\n# '\n#     expected: 'Doesn't Red\n# Does Red\n# Does Green\n# Does Blue\n# Does Class\n# '\n# './parrot   \"/usr/home/jisom/parrot/t/pmc/class_15.pir\"' failed with  \nexit code 138\n# Looks like you failed 6 tests of 15.\ndubious\n         Test returned status 6 (wstat 1536, 0x600)\nDIED. FAILED tests 3, 7, 10-12, 15\n         Failed 6/15 tests, 60.00% okay\nt/pmc/exporter..........1..10\nok 1 - new\nnot ok 2 - source\n\n#     Failed test (t/pmc/exporter.t at line 43)\n#          got: 'Bus error (core dumped)\n# '\n#     expected: 'ok 1 - source() returns PMCNULL upon Exporter init\n# ok 2 - source() with args sets source namespace\n# ok 3 - source() with too many args fails\n# ok 4 - source() with non-namespace arg throws exception\n# '\n# './parrot   \"/usr/home/jisom/parrot/t/pmc/exporter_2.pir\"' failed  \nwith exit code 138\nnot ok 3 - destination\n\n#     Failed test (t/pmc/exporter.t at line 95)\n#          got: 'Bus error (core dumped)\n# '\n#     expected: 'ok 1 - destination() with no args returns destination  \nnamespace\n# ok 2 - ...which is current namespace at first\n# ok 3 - destination() with args sets destination namespace\n# ok 4 - destination() with too many args fails\n# ok 5 - destination() with non-namespace arg throws exception\n# '\n# './parrot   \"/usr/home/jisom/parrot/t/pmc/exporter_3.pir\"' failed  \nwith exit code 138\nok 4 - globals\nok 5 - add_global\nok 6 - import - no args\nok 7 - import - same source and destination namespaces\nok 8 - import - globals as string\nok 9 - import - globals as array\nok 10 - import - globals with destination\n# Looks like you failed 2 tests of 10.\ndubious\n         Test returned status 2 (wstat 512, 0x200)\nDIED. FAILED tests 2-3\n         Failed 2/10 tests, 80.00% okay\nt/pmc/pccmethod_test....1..2\nok 1 - named args\nnot ok 2 - optional args and multiple returns\n\n#     Failed test (t/pmc/pccmethod_test.t at line 36)\n#          got: 'test_method0\n# 1\n# test_method1\n# 1,2,3,4,5,6\n# test_method2\n# 0, 0, ResizablePMCArray [  ]\n# test_method2\n# 1, 1, ResizablePMCArray [  ]\n# test_method2\n# 1, 1, ResizablePMCArray [ 2 ]\n# test_method2\n# 1, 1, ResizablePMCArray [ 2, 3 ]\n# test_method2\n# 101, 1, ResizablePMCArray [  ]\n# Segmentation fault (core dumped)\n# '\n#     expected: 'test_method0\n# 1\n# test_method1\n# 1,2,3,4,5,6\n# test_method2\n# 0, 0, ResizablePMCArray [  ]\n# test_method2\n# 1, 1, ResizablePMCArray [  ]\n# test_method2\n# 1, 1, ResizablePMCArray [ 2 ]\n# test_method2\n# 1, 1, ResizablePMCArray [ 2, 3 ]\n# test_method2\n# 101, 1, ResizablePMCArray [  ]\n# BACK - 1000 - KEVIN -\n# '\n# './parrot   \"/usr/home/jisom/parrot/t/pmc/pccmethod_test_2.pir\"'  \nfailed with exit code 139\n# Looks like you failed 1 test of 2.\ndubious\n         Test returned status 1 (wstat 256, 0x100)\nDIED. FAILED test 2\n         Failed 1/2 tests, 50.00% okay\nt/pmc/role..............1..5\nok 1 - Role type exists\nok 2 - isa Role\nok 3 - Created a Role initialized with a Hash\ndubious\n         Test returned status 0 (wstat 138, 0x8a)\nDIED. FAILED tests 4-5\n         Failed 2/5 tests, 60.00% okay\nt/pmc/smop_attribute....1..9\nok 1 - The object isa SMOP_Attribute\ndubious\n         Test returned status 0 (wstat 138, 0x8a)\nDIED. FAILED tests 2-9\n         Failed 8/9 tests, 11.11% okay\nFailed Test            Stat Wstat Total Fail  List of Failed\n------------------------------------------------------------------------ \n-------\nt/pmc/class.t             6  1536    15    6  3 7 10-12 15\nt/pmc/exporter.t          2   512    10    2  2-3\nt/pmc/pccmethod_test.t    1   256     2    1  2\nt/pmc/role.t              0   138     5    4  4-5\nt/pmc/smop_attribute.t    0   138     9   16  2-9\nFailed 5/5 test scripts. 19/41 subtests failed.\nFiles=5, Tests=41,  2 wallclock secs ( 1.04 cusr +  0.70 csys =  1.73  \nCPU)\nFailed 5/5 test programs. 19/41 subtests failed.\n\n"}