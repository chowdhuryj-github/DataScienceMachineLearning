{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "obnox@samba.org", "subject": "svn commit: samba r22412 - in branches/SAMBA_3_0/source/utils: .", "body": "Author: obnox\nDate: 2007-04-20 12:23:36 +0000 (Fri, 20 Apr 2007)\nNew Revision: 22412\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=22412\n\nLog:\nAdd a \"deletelocalgroup\" subcommand to net sam.\n\nThanks to Karolin Seeger .\n\n\nModified:\n   branches/SAMBA_3_0/source/utils/net_sam.c\n\n\nChangeset:\nModified: branches/SAMBA_3_0/source/utils/net_sam.c\n===================================================================\n--- branches/SAMBA_3_0/source/utils/net_sam.c\t2007-04-20 12:06:38 UTC (rev 22411)\n+++ branches/SAMBA_3_0/source/utils/net_sam.c\t2007-04-20 12:23:36 UTC (rev 22412)\n@@ -572,6 +572,46 @@\n }\n \n /*\n+ * Delete a local group\n+ */\n+\n+static int net_sam_deletelocalgroup(int argc, const char **argv)\n+{\n+\tDOM_SID sid;\n+        enum lsa_SidType type;\n+        const char *dom, *name;\n+\tint ret;\n+\n+\tif (argc != 1) {\n+\t\td_fprintf(stderr, \"usage: net sam deletelocalgroup \\n\");\n+\t\treturn -1;\n+\t}\n+\n+\tif (!lookup_name(tmp_talloc_ctx(), argv[0], LOOKUP_NAME_ISOLATED,\n+\t\t\t &dom, &name, &sid, &type)) {\n+\t\td_fprintf(stderr, \"Could not find name %s.\\n\", argv[0]);\n+\t\treturn -1;\n+\t}\n+\n+\tif (type != SID_NAME_ALIAS) {\n+\t\td_fprintf(stderr, \"%s is a %s, not a local group.\\n\", argv[0],\n+\t\t\t  sid_type_lookup(type));\n+\t\treturn -1;\n+\t}\n+\n+\tret = pdb_delete_alias(&sid);\n+\n+\tif ( !ret ) {\n+\t\td_fprintf(stderr, \"Could not delete local group %s.\\n\", argv[0]);\n+\t\treturn -1;\n+\t}\n+\n+\td_printf(\"Deleted local group %s.\\n\", argv[0]);\n+\n+\treturn 0;\n+}\n+\n+/*\n  * Create a local group\n  */\n \n@@ -1341,6 +1381,8 @@\n \t\t  \"Create a new BUILTIN group\" },\n \t\t{ \"createlocalgroup\", net_sam_createlocalgroup,\n \t\t  \"Create a new local group\" },\n+\t\t{ \"deletelocalgroup\", net_sam_deletelocalgroup,\n+\t\t  \"Delete an existing local group\" },\n \t\t{ \"mapunixgroup\", net_sam_mapunixgroup,\n \t\t  \"Map a unix group to a domain group\" },\n \t\t{ \"addmem\", net_sam_addmem,\n\n"}