{"category": "ham", "to_address": "samba-cvs@samba.org", "from_address": "abartlet@samba.org", "subject": "svn commit: samba r23455 - in\n\tbranches/SAMBA_4_0/source/auth/gensec: .", "body": "Author: abartlet\nDate: 2007-06-13 05:14:00 +0000 (Wed, 13 Jun 2007)\nNew Revision: 23455\n\nWebSVN: http://websvn.samba.org/cgi-bin/viewcvs.cgi?view=rev&root=samba&rev=23455\n\nLog:\nThese buffers may not be null terminated. Ensure we don't run past the\nend of teh buffer printing the error strings.\n\nAndrew Bartlett\n\nModified:\n   branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\n\n\nChangeset:\nModified: branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\n===================================================================\n--- branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\t2007-06-12 23:29:53 UTC (rev 23454)\n+++ branches/SAMBA_4_0/source/auth/gensec/gensec_gssapi.c\t2007-06-13 05:14:00 UTC (rev 23455)\n@@ -87,19 +87,30 @@\n \tOM_uint32 disp_min_stat, disp_maj_stat;\n \tgss_buffer_desc maj_error_message;\n \tgss_buffer_desc min_error_message;\n+\tchar *maj_error_string, *min_error_string;\n \tOM_uint32 msg_ctx = 0;\n \n \tchar *ret;\n \n \tmaj_error_message.value = NULL;\n \tmin_error_message.value = NULL;\n+\tmaj_error_message.length = 0;\n+\tmin_error_message.length = 0;\n \t\n \tdisp_maj_stat = gss_display_status(&disp_min_stat, maj_stat, GSS_C_GSS_CODE,\n \t\t\t   mech, &msg_ctx, &maj_error_message);\n \tdisp_maj_stat = gss_display_status(&disp_min_stat, min_stat, GSS_C_MECH_CODE,\n \t\t\t   mech, &msg_ctx, &min_error_message);\n-\tret = talloc_asprintf(mem_ctx, \"%s: %s\", (char *)maj_error_message.value, (char *)min_error_message.value);\n+\t\n+\tmaj_error_string = talloc_strndup(mem_ctx, (char *)maj_error_message.value, maj_error_message.length);\n \n+\tmin_error_string = talloc_strndup(mem_ctx, (char *)min_error_message.value, min_error_message.length);\n+\n+\tret = talloc_asprintf(mem_ctx, \"%s: %s\", maj_error_string, min_error_string);\n+\n+\ttalloc_free(maj_error_string);\n+\ttalloc_free(min_error_string);\n+\n \tgss_release_buffer(&disp_min_stat, &maj_error_message);\n \tgss_release_buffer(&disp_min_stat, &min_error_message);\n \n\n"}