{"category": "ham", "to_address": "\"'jiho'\" <jo.irisson@gmail.com>, \"'R-help'\" <r-help@stat.math.ethz.ch>", "from_address": "\"Tom La Bone\" <labone@gforcecable.com>", "subject": "Re: [R] Problem with Weighted Variance in Hmisc", "body": "Thanks.  I have another related question:  \n\nThe equation for weighted variance given in the NIST DataPlot documentation\nis the usual variance equation with the weights inserted.  The weighted\nvariance of the weighted mean is this weighted variance divided by N.\n\nThere is another approach to calculating the weighted variance of the\nweighted mean that propagates the uncertainty of each term in the weighted\nmean (see Data Reduction and Error Analysis for the Physical Sciences by\nBevington & Robinson).  The two approaches do not give the same answer. Can\nanyone suggest a reference that discusses the merits of the DataPlot\napproach versus the Bevington approach?\n\nTom La Bone\n\n-----Original Message-----\nFrom: jiho [mailto:jo.irisson@gmail.com] \nSent: Friday, June 01, 2007 2:17 AM\nTo: labone@gforcecable.com; R-help\nSubject: Re: [R] Problem with Weighted Variance in Hmisc\n\nOn 2007-June-01  , at 01:03 , Tom La Bone wrote:\n> The function wtd.var(x,w) in Hmisc calculates the weighted variance  \n> of x\n> where w are the weights.  It appears to me that wtd.var(x,w) = var \n> (x) if all\n> of the weights are equal, but this does not appear to be the case. Can\n> someone point out to me where I am going wrong here?  Thanks.\n\nThe true formula of weighted variance is this one:\n\thttp://www.itl.nist.gov/div898/software/dataplot/refman2/ch2/ \nweighvar.pdf\nBut for computation purposes, wtd.var uses another definition which  \nconsiders the weights as repeats instead of true weights. However if  \nthe weights are normalized (sum to one) to two formulas are equal. If  \nyou consider weights as real weights instead of repeats, I would  \nrecommend to use this option.\nWith normwt=T, your issue is solved:\n\n > a=1:10\n > b=a\n > b[]=2\n > b\n[1] 2 2 2 2 2 2 2 2 2 2\n > wtd.var(a,b)\n[1] 8.68421\n# all weights equal 2 <=> there are two repeats of each element of a\n > var(c(a,a))\n[1] 8.68421\n > wtd.var(a,b,normwt=T)\n[1] 9.166667\n > var(a)\n[1] 9.166667\n\nCheers,\n\nJiHO\n---\nhttp://jo.irisson.free.fr/\n\n______________________________________________\nR-help@stat.math.ethz.ch mailing list\nhttps://stat.ethz.ch/mailman/listinfo/r-help\nPLEASE do read the posting guide http://www.R-project.org/posting-guide.html\nand provide commented, minimal, self-contained, reproducible code.\n\n"}